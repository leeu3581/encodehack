import{b0 as S,b1 as H,b2 as g,b3 as I,b4 as E,b5 as L,b6 as D,b7 as U,b8 as w,b9 as z,ba as y}from"../main.js";const C=new Uint8Array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9]);class X extends S{constructor(h,s,i={},n,v,e){if(super(),this.blockLen=h,this.outputLen=s,this.length=0,this.pos=0,this.finished=!1,this.destroyed=!1,H(h),H(s),H(n),s<0||s>n)throw new Error("outputLen bigger than keyLen");if(i.key!==void 0&&(i.key.length<1||i.key.length>n))throw new Error("key length must be undefined or 1.."+n);if(i.salt!==void 0&&i.salt.length!==v)throw new Error("salt must be undefined or "+v);if(i.personalization!==void 0&&i.personalization.length!==e)throw new Error("personalization must be undefined or "+e);this.buffer=new Uint8Array(h),this.buffer32=g(this.buffer)}update(h){I(this);const{blockLen:s,buffer:i,buffer32:n}=this;h=E(h);const v=h.length,e=h.byteOffset,r=h.buffer;for(let l=0;l<v;){this.pos===s&&(L||D(n),this.compress(n,0,!1),L||D(n),this.pos=0);const a=Math.min(s-this.pos,v-l),f=e+l;if(a===s&&!(f%4)&&l+a<v){const o=new Uint32Array(r,f,Math.floor((v-l)/4));L||D(o);for(let c=0;l+s<v;c+=n.length,l+=s)this.length+=s,this.compress(o,c,!1);L||D(o);continue}i.set(h.subarray(l,l+a),this.pos),this.pos+=a,this.length+=a,l+=a}return this}digestInto(h){I(this),U(h,this);const{pos:s,buffer32:i}=this;this.finished=!0,this.buffer.subarray(s).fill(0),L||D(i),this.compress(i,0,!0),L||D(i);const n=g(h);this.get().forEach((v,e)=>n[e]=w(v))}digest(){const{buffer:h,outputLen:s}=this;this.digestInto(h);const i=h.slice(0,s);return this.destroy(),i}_cloneInto(h){const{buffer:s,length:i,finished:n,destroyed:v,outputLen:e,pos:r}=this;return h||(h=new this.constructor({dkLen:e})),h.set(...this.get()),h.length=i,h.finished=n,h.destroyed=v,h.outputLen=e,h.buffer.set(s),h.pos=r,h}}const d=new Uint32Array([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),t=new Uint32Array(32);function k(B,h,s,i,n,v){const e=n[v],r=n[v+1];let l=t[2*B],a=t[2*B+1],f=t[2*h],o=t[2*h+1],c=t[2*s],x=t[2*s+1],u=t[2*i],b=t[2*i+1],p=y.add3L(l,f,e);a=y.add3H(p,a,o,r),l=p|0,{Dh:b,Dl:u}={Dh:b^a,Dl:u^l},{Dh:b,Dl:u}={Dh:y.rotr32H(b,u),Dl:y.rotr32L(b,u)},{h:x,l:c}=y.add(x,c,b,u),{Bh:o,Bl:f}={Bh:o^x,Bl:f^c},{Bh:o,Bl:f}={Bh:y.rotrSH(o,f,24),Bl:y.rotrSL(o,f,24)},t[2*B]=l,t[2*B+1]=a,t[2*h]=f,t[2*h+1]=o,t[2*s]=c,t[2*s+1]=x,t[2*i]=u,t[2*i+1]=b}function A(B,h,s,i,n,v){const e=n[v],r=n[v+1];let l=t[2*B],a=t[2*B+1],f=t[2*h],o=t[2*h+1],c=t[2*s],x=t[2*s+1],u=t[2*i],b=t[2*i+1],p=y.add3L(l,f,e);a=y.add3H(p,a,o,r),l=p|0,{Dh:b,Dl:u}={Dh:b^a,Dl:u^l},{Dh:b,Dl:u}={Dh:y.rotrSH(b,u,16),Dl:y.rotrSL(b,u,16)},{h:x,l:c}=y.add(x,c,b,u),{Bh:o,Bl:f}={Bh:o^x,Bl:f^c},{Bh:o,Bl:f}={Bh:y.rotrBH(o,f,63),Bl:y.rotrBL(o,f,63)},t[2*B]=l,t[2*B+1]=a,t[2*h]=f,t[2*h+1]=o,t[2*s]=c,t[2*s+1]=x,t[2*i]=u,t[2*i+1]=b}class G extends X{constructor(h={}){super(128,h.dkLen===void 0?64:h.dkLen,h,64,16,16),this.v0l=d[0]|0,this.v0h=d[1]|0,this.v1l=d[2]|0,this.v1h=d[3]|0,this.v2l=d[4]|0,this.v2h=d[5]|0,this.v3l=d[6]|0,this.v3h=d[7]|0,this.v4l=d[8]|0,this.v4h=d[9]|0,this.v5l=d[10]|0,this.v5h=d[11]|0,this.v6l=d[12]|0,this.v6h=d[13]|0,this.v7l=d[14]|0,this.v7h=d[15]|0;const s=h.key?h.key.length:0;if(this.v0l^=this.outputLen|s<<8|65536|1<<24,h.salt){const i=g(E(h.salt));this.v4l^=w(i[0]),this.v4h^=w(i[1]),this.v5l^=w(i[2]),this.v5h^=w(i[3])}if(h.personalization){const i=g(E(h.personalization));this.v6l^=w(i[0]),this.v6h^=w(i[1]),this.v7l^=w(i[2]),this.v7h^=w(i[3])}if(h.key){const i=new Uint8Array(this.blockLen);i.set(E(h.key)),this.update(i)}}get(){let{v0l:h,v0h:s,v1l:i,v1h:n,v2l:v,v2h:e,v3l:r,v3h:l,v4l:a,v4h:f,v5l:o,v5h:c,v6l:x,v6h:u,v7l:b,v7h:p}=this;return[h,s,i,n,v,e,r,l,a,f,o,c,x,u,b,p]}set(h,s,i,n,v,e,r,l,a,f,o,c,x,u,b,p){this.v0l=h|0,this.v0h=s|0,this.v1l=i|0,this.v1h=n|0,this.v2l=v|0,this.v2h=e|0,this.v3l=r|0,this.v3h=l|0,this.v4l=a|0,this.v4h=f|0,this.v5l=o|0,this.v5h=c|0,this.v6l=x|0,this.v6h=u|0,this.v7l=b|0,this.v7h=p|0}compress(h,s,i){this.get().forEach((l,a)=>t[a]=l),t.set(d,16);let{h:n,l:v}=y.fromBig(BigInt(this.length));t[24]=d[8]^v,t[25]=d[9]^n,i&&(t[28]=~t[28],t[29]=~t[29]);let e=0;const r=C;for(let l=0;l<12;l++)k(0,4,8,12,h,s+2*r[e++]),A(0,4,8,12,h,s+2*r[e++]),k(1,5,9,13,h,s+2*r[e++]),A(1,5,9,13,h,s+2*r[e++]),k(2,6,10,14,h,s+2*r[e++]),A(2,6,10,14,h,s+2*r[e++]),k(3,7,11,15,h,s+2*r[e++]),A(3,7,11,15,h,s+2*r[e++]),k(0,5,10,15,h,s+2*r[e++]),A(0,5,10,15,h,s+2*r[e++]),k(1,6,11,12,h,s+2*r[e++]),A(1,6,11,12,h,s+2*r[e++]),k(2,7,8,13,h,s+2*r[e++]),A(2,7,8,13,h,s+2*r[e++]),k(3,4,9,14,h,s+2*r[e++]),A(3,4,9,14,h,s+2*r[e++]);this.v0l^=t[0]^t[16],this.v0h^=t[1]^t[17],this.v1l^=t[2]^t[18],this.v1h^=t[3]^t[19],this.v2l^=t[4]^t[20],this.v2h^=t[5]^t[21],this.v3l^=t[6]^t[22],this.v3h^=t[7]^t[23],this.v4l^=t[8]^t[24],this.v4h^=t[9]^t[25],this.v5l^=t[10]^t[26],this.v5h^=t[11]^t[27],this.v6l^=t[12]^t[28],this.v6h^=t[13]^t[29],this.v7l^=t[14]^t[30],this.v7h^=t[15]^t[31],t.fill(0)}destroy(){this.destroyed=!0,this.buffer32.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const O=z(B=>new G(B));export{O as b};
