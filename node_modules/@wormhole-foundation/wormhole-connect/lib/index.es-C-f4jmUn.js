"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const U=require("./index-Cq7ztix4.js"),ze=require("./evm-Di8LC9_s.js"),j=require("./index-BgQ_5dE8.js"),E=require("./index-BFxFPbWb.js");var ne={};Object.defineProperty(ne,"__esModule",{value:!0});ne.getLocalStorage=ne.getLocalStorageOrThrow=ne.getCrypto=ne.getCryptoOrThrow=ne.getLocation=ne.getLocationOrThrow=ne.getNavigator=ne.getNavigatorOrThrow=ne.getDocument=ne.getDocumentOrThrow=ne.getFromWindowOrThrow=ne.getFromWindow=void 0;function sr(a){let t;return typeof window<"u"&&typeof window[a]<"u"&&(t=window[a]),t}ne.getFromWindow=sr;function Cr(a){const t=sr(a);if(!t)throw new Error(`${a} is not defined in Window`);return t}ne.getFromWindowOrThrow=Cr;function tw(){return Cr("document")}ne.getDocumentOrThrow=tw;function rw(){return sr("document")}ne.getDocument=rw;function iw(){return Cr("navigator")}ne.getNavigatorOrThrow=iw;function sw(){return sr("navigator")}ne.getNavigator=sw;function nw(){return Cr("location")}ne.getLocationOrThrow=nw;function ow(){return sr("location")}ne.getLocation=ow;function aw(){return Cr("crypto")}ne.getCryptoOrThrow=aw;function cw(){return sr("crypto")}ne.getCrypto=cw;function uw(){return Cr("localStorage")}ne.getLocalStorageOrThrow=uw;function hw(){return sr("localStorage")}ne.getLocalStorage=hw;var bo={};Object.defineProperty(bo,"__esModule",{value:!0});bo.getWindowMetadata=void 0;const lu=ne;function lw(){let a,t;try{a=lu.getDocumentOrThrow(),t=lu.getLocationOrThrow()}catch{return null}function r(){const O=a.getElementsByTagName("link"),N=[];for(let q=0;q<O.length;q++){const x=O[q],B=x.getAttribute("rel");if(B&&B.toLowerCase().indexOf("icon")>-1){const D=x.getAttribute("href");if(D)if(D.toLowerCase().indexOf("https:")===-1&&D.toLowerCase().indexOf("http:")===-1&&D.indexOf("//")!==0){let Q=t.protocol+"//"+t.host;if(D.indexOf("/")===0)Q+=D;else{const fe=t.pathname.split("/");fe.pop();const Z=fe.join("/");Q+=Z+"/"+D}N.push(Q)}else if(D.indexOf("//")===0){const Q=t.protocol+D;N.push(Q)}else N.push(D)}}return N}function s(...O){const N=a.getElementsByTagName("meta");for(let q=0;q<N.length;q++){const x=N[q],B=["itemprop","property","name"].map(D=>x.getAttribute(D)).filter(D=>D?O.includes(D):!1);if(B.length&&B){const D=x.getAttribute("content");if(D)return D}}return""}function o(){let O=s("name","og:site_name","og:title","twitter:title");return O||(O=a.title),O}function u(){return s("description","og:description","twitter:description","keywords")}const l=o(),g=u(),w=t.origin,b=r();return{description:g,url:w,icons:b,name:l}}bo.getWindowMetadata=lw;function pw(a,t=[]){const r=[];return Object.keys(a).forEach(s=>{if(t.length&&!t.includes(s))return;const o=a[s];r.push(...o.accounts)}),r}const fw={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}};function dw(a,t){const{message:r,code:s}=fw[a];return{message:r,code:s}}function co(a,t){return!!Array.isArray(a)}var $r={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var uo=function(a,t){return uo=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,s){r.__proto__=s}||function(r,s){for(var o in s)s.hasOwnProperty(o)&&(r[o]=s[o])},uo(a,t)};function gw(a,t){uo(a,t);function r(){this.constructor=a}a.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}var ho=function(){return ho=Object.assign||function(t){for(var r,s=1,o=arguments.length;s<o;s++){r=arguments[s];for(var u in r)Object.prototype.hasOwnProperty.call(r,u)&&(t[u]=r[u])}return t},ho.apply(this,arguments)};function yw(a,t){var r={};for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&t.indexOf(s)<0&&(r[s]=a[s]);if(a!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,s=Object.getOwnPropertySymbols(a);o<s.length;o++)t.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(a,s[o])&&(r[s[o]]=a[s[o]]);return r}function vw(a,t,r,s){var o=arguments.length,u=o<3?t:s===null?s=Object.getOwnPropertyDescriptor(t,r):s,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(a,t,r,s);else for(var g=a.length-1;g>=0;g--)(l=a[g])&&(u=(o<3?l(u):o>3?l(t,r,u):l(t,r))||u);return o>3&&u&&Object.defineProperty(t,r,u),u}function mw(a,t){return function(r,s){t(r,s,a)}}function ww(a,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(a,t)}function _w(a,t,r,s){function o(u){return u instanceof r?u:new r(function(l){l(u)})}return new(r||(r=Promise))(function(u,l){function g(C){try{b(s.next(C))}catch(O){l(O)}}function w(C){try{b(s.throw(C))}catch(O){l(O)}}function b(C){C.done?u(C.value):o(C.value).then(g,w)}b((s=s.apply(a,t||[])).next())})}function bw(a,t){var r={label:0,sent:function(){if(u[0]&1)throw u[1];return u[1]},trys:[],ops:[]},s,o,u,l;return l={next:g(0),throw:g(1),return:g(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function g(b){return function(C){return w([b,C])}}function w(b){if(s)throw new TypeError("Generator is already executing.");for(;r;)try{if(s=1,o&&(u=b[0]&2?o.return:b[0]?o.throw||((u=o.return)&&u.call(o),0):o.next)&&!(u=u.call(o,b[1])).done)return u;switch(o=0,u&&(b=[b[0]&2,u.value]),b[0]){case 0:case 1:u=b;break;case 4:return r.label++,{value:b[1],done:!1};case 5:r.label++,o=b[1],b=[0];continue;case 7:b=r.ops.pop(),r.trys.pop();continue;default:if(u=r.trys,!(u=u.length>0&&u[u.length-1])&&(b[0]===6||b[0]===2)){r=0;continue}if(b[0]===3&&(!u||b[1]>u[0]&&b[1]<u[3])){r.label=b[1];break}if(b[0]===6&&r.label<u[1]){r.label=u[1],u=b;break}if(u&&r.label<u[2]){r.label=u[2],r.ops.push(b);break}u[2]&&r.ops.pop(),r.trys.pop();continue}b=t.call(a,r)}catch(C){b=[6,C],o=0}finally{s=u=0}if(b[0]&5)throw b[1];return{value:b[0]?b[1]:void 0,done:!0}}}function Ew(a,t,r,s){s===void 0&&(s=r),a[s]=t[r]}function Iw(a,t){for(var r in a)r!=="default"&&!t.hasOwnProperty(r)&&(t[r]=a[r])}function lo(a){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&a[t],s=0;if(r)return r.call(a);if(a&&typeof a.length=="number")return{next:function(){return a&&s>=a.length&&(a=void 0),{value:a&&a[s++],done:!a}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function mh(a,t){var r=typeof Symbol=="function"&&a[Symbol.iterator];if(!r)return a;var s=r.call(a),o,u=[],l;try{for(;(t===void 0||t-- >0)&&!(o=s.next()).done;)u.push(o.value)}catch(g){l={error:g}}finally{try{o&&!o.done&&(r=s.return)&&r.call(s)}finally{if(l)throw l.error}}return u}function Pw(){for(var a=[],t=0;t<arguments.length;t++)a=a.concat(mh(arguments[t]));return a}function Sw(){for(var a=0,t=0,r=arguments.length;t<r;t++)a+=arguments[t].length;for(var s=Array(a),o=0,t=0;t<r;t++)for(var u=arguments[t],l=0,g=u.length;l<g;l++,o++)s[o]=u[l];return s}function fi(a){return this instanceof fi?(this.v=a,this):new fi(a)}function Ow(a,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s=r.apply(a,t||[]),o,u=[];return o={},l("next"),l("throw"),l("return"),o[Symbol.asyncIterator]=function(){return this},o;function l(N){s[N]&&(o[N]=function(q){return new Promise(function(x,B){u.push([N,q,x,B])>1||g(N,q)})})}function g(N,q){try{w(s[N](q))}catch(x){O(u[0][3],x)}}function w(N){N.value instanceof fi?Promise.resolve(N.value.v).then(b,C):O(u[0][2],N)}function b(N){g("next",N)}function C(N){g("throw",N)}function O(N,q){N(q),u.shift(),u.length&&g(u[0][0],u[0][1])}}function Rw(a){var t,r;return t={},s("next"),s("throw",function(o){throw o}),s("return"),t[Symbol.iterator]=function(){return this},t;function s(o,u){t[o]=a[o]?function(l){return(r=!r)?{value:fi(a[o](l)),done:o==="return"}:u?u(l):l}:u}}function Nw(a){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=a[Symbol.asyncIterator],r;return t?t.call(a):(a=typeof lo=="function"?lo(a):a[Symbol.iterator](),r={},s("next"),s("throw"),s("return"),r[Symbol.asyncIterator]=function(){return this},r);function s(u){r[u]=a[u]&&function(l){return new Promise(function(g,w){l=a[u](l),o(g,w,l.done,l.value)})}}function o(u,l,g,w){Promise.resolve(w).then(function(b){u({value:b,done:g})},l)}}function Cw(a,t){return Object.defineProperty?Object.defineProperty(a,"raw",{value:t}):a.raw=t,a}function $w(a){if(a&&a.__esModule)return a;var t={};if(a!=null)for(var r in a)Object.hasOwnProperty.call(a,r)&&(t[r]=a[r]);return t.default=a,t}function Tw(a){return a&&a.__esModule?a:{default:a}}function Aw(a,t){if(!t.has(a))throw new TypeError("attempted to get private field on non-instance");return t.get(a)}function xw(a,t,r){if(!t.has(a))throw new TypeError("attempted to set private field on non-instance");return t.set(a,r),r}const Dw=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return ho},__asyncDelegator:Rw,__asyncGenerator:Ow,__asyncValues:Nw,__await:fi,__awaiter:_w,__classPrivateFieldGet:Aw,__classPrivateFieldSet:xw,__createBinding:Ew,__decorate:vw,__exportStar:Iw,__extends:gw,__generator:bw,__importDefault:Tw,__importStar:$w,__makeTemplateObject:Cw,__metadata:ww,__param:mw,__read:mh,__rest:yw,__spread:Pw,__spreadArrays:Sw,__values:lo},Symbol.toStringTag,{value:"Module"})),Is=U.getAugmentedNamespace(Dw);var ii={},Gn={},si={};const Fw=Object.freeze(Object.defineProperty({__proto__:null,IEvents:E.IEvents},Symbol.toStringTag,{value:"Module"})),jw=U.getAugmentedNamespace(Fw);var pu;function qw(){if(pu)return si;pu=1,Object.defineProperty(si,"__esModule",{value:!0}),si.IHeartBeat=void 0;const a=jw;class t extends a.IEvents{constructor(s){super()}}return si.IHeartBeat=t,si}var fu;function wh(){return fu||(fu=1,function(a){Object.defineProperty(a,"__esModule",{value:!0}),Is.__exportStar(qw(),a)}(Gn)),Gn}var Qn={},tr={},du;function Uw(){if(du)return tr;du=1,Object.defineProperty(tr,"__esModule",{value:!0}),tr.HEARTBEAT_EVENTS=tr.HEARTBEAT_INTERVAL=void 0;const a=j.cjs;return tr.HEARTBEAT_INTERVAL=a.FIVE_SECONDS,tr.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},tr}var gu;function _h(){return gu||(gu=1,function(a){Object.defineProperty(a,"__esModule",{value:!0}),Is.__exportStar(Uw(),a)}(Qn)),Qn}var yu;function Mw(){if(yu)return ii;yu=1,Object.defineProperty(ii,"__esModule",{value:!0}),ii.HeartBeat=void 0;const a=Is,t=U.eventsExports,r=j.cjs,s=wh(),o=_h();class u extends s.IHeartBeat{constructor(g){super(g),this.events=new t.EventEmitter,this.interval=o.HEARTBEAT_INTERVAL,this.interval=(g==null?void 0:g.interval)||o.HEARTBEAT_INTERVAL}static init(g){return a.__awaiter(this,void 0,void 0,function*(){const w=new u(g);return yield w.init(),w})}init(){return a.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(g,w){this.events.on(g,w)}once(g,w){this.events.once(g,w)}off(g,w){this.events.off(g,w)}removeListener(g,w){this.events.removeListener(g,w)}initialize(){return a.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),r.toMiliseconds(this.interval))})}pulse(){this.events.emit(o.HEARTBEAT_EVENTS.pulse)}}return ii.HeartBeat=u,ii}(function(a){Object.defineProperty(a,"__esModule",{value:!0});const t=Is;t.__exportStar(Mw(),a),t.__exportStar(wh(),a),t.__exportStar(_h(),a)})($r);class Lw extends E.IEvents{constructor(t){super(),this.opts=t,this.protocol="wc",this.version=2}}let kw=class extends E.IEvents{constructor(t,r){super(),this.core=t,this.logger=r,this.records=new Map}},zw=class{constructor(t,r){this.logger=t,this.core=r}},Hw=class extends E.IEvents{constructor(t,r){super(),this.relayer=t,this.logger=r}},Vw=class extends E.IEvents{constructor(t){super()}},Kw=class{constructor(t,r,s,o){this.core=t,this.logger=r,this.name=s}},Bw=class extends E.IEvents{constructor(t,r){super(),this.relayer=t,this.logger=r}},Ww=class extends E.IEvents{constructor(t,r){super(),this.core=t,this.logger=r}},Jw=class{constructor(t,r){this.projectId=t,this.logger=r}},Gw=class{constructor(t,r){this.projectId=t,this.logger=r}},Qw=class{constructor(t){this.opts=t,this.protocol="wc",this.version=2}},Yw=class{constructor(t){this.client=t}};const Zw=a=>JSON.stringify(a,(t,r)=>typeof r=="bigint"?r.toString()+"n":r),Xw=a=>{const t=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,r=a.replace(t,'$1"$2n"$3');return JSON.parse(r,(s,o)=>typeof o=="string"&&o.match(/^\d+n$/)?BigInt(o.substring(0,o.length-1)):o)};function bh(a){if(typeof a!="string")throw new Error(`Cannot safe json parse value of type ${typeof a}`);try{return Xw(a)}catch{return a}}function Eh(a){return typeof a=="string"?a:Zw(a)||""}var oe={};Object.defineProperty(oe,"__esModule",{value:!0});oe.getLocalStorage=oe.getLocalStorageOrThrow=oe.getCrypto=oe.getCryptoOrThrow=Ih=oe.getLocation=oe.getLocationOrThrow=Io=oe.getNavigator=oe.getNavigatorOrThrow=Eo=oe.getDocument=oe.getDocumentOrThrow=oe.getFromWindowOrThrow=oe.getFromWindow=void 0;function nr(a){let t;return typeof window<"u"&&typeof window[a]<"u"&&(t=window[a]),t}oe.getFromWindow=nr;function Tr(a){const t=nr(a);if(!t)throw new Error(`${a} is not defined in Window`);return t}oe.getFromWindowOrThrow=Tr;function e_(){return Tr("document")}oe.getDocumentOrThrow=e_;function t_(){return nr("document")}var Eo=oe.getDocument=t_;function r_(){return Tr("navigator")}oe.getNavigatorOrThrow=r_;function i_(){return nr("navigator")}var Io=oe.getNavigator=i_;function s_(){return Tr("location")}oe.getLocationOrThrow=s_;function n_(){return nr("location")}var Ih=oe.getLocation=n_;function o_(){return Tr("crypto")}oe.getCryptoOrThrow=o_;function a_(){return nr("crypto")}oe.getCrypto=a_;function c_(){return Tr("localStorage")}oe.getLocalStorageOrThrow=c_;function u_(){return nr("localStorage")}oe.getLocalStorage=u_;var Po={};Object.defineProperty(Po,"__esModule",{value:!0});var Ph=Po.getWindowMetadata=void 0;const vu=oe;function h_(){let a,t;try{a=vu.getDocumentOrThrow(),t=vu.getLocationOrThrow()}catch{return null}function r(){const O=a.getElementsByTagName("link"),N=[];for(let q=0;q<O.length;q++){const x=O[q],B=x.getAttribute("rel");if(B&&B.toLowerCase().indexOf("icon")>-1){const D=x.getAttribute("href");if(D)if(D.toLowerCase().indexOf("https:")===-1&&D.toLowerCase().indexOf("http:")===-1&&D.indexOf("//")!==0){let Q=t.protocol+"//"+t.host;if(D.indexOf("/")===0)Q+=D;else{const fe=t.pathname.split("/");fe.pop();const Z=fe.join("/");Q+=Z+"/"+D}N.push(Q)}else if(D.indexOf("//")===0){const Q=t.protocol+D;N.push(Q)}else N.push(D)}}return N}function s(...O){const N=a.getElementsByTagName("meta");for(let q=0;q<N.length;q++){const x=N[q],B=["itemprop","property","name"].map(D=>x.getAttribute(D)).filter(D=>D?O.includes(D):!1);if(B.length&&B){const D=x.getAttribute("content");if(D)return D}}return""}function o(){let O=s("name","og:site_name","og:title","twitter:title");return O||(O=a.title),O}function u(){return s("description","og:description","twitter:description","keywords")}const l=o(),g=u(),w=t.origin,b=r();return{description:g,url:w,icons:b,name:l}}Ph=Po.getWindowMetadata=h_;const l_=":";function p_(a){const[t,r]=a.split(l_);return{namespace:t,reference:r}}function Sh(a,t){return a.includes(":")?[a]:t.chains||[]}const Oh="base10",De="base16",po="base64pad",So="utf8",Rh=0,or=1,f_=0,mu=1,fo=12,Oo=32;function d_(){const a=ze.x25519.generateKeyPair();return{privateKey:E.toString(a.secretKey,De),publicKey:E.toString(a.publicKey,De)}}function go(){const a=ze.random.randomBytes(Oo);return E.toString(a,De)}function g_(a,t){const r=ze.x25519.sharedKey(E.fromString(a,De),E.fromString(t,De),!0),s=new ze.HKDF_1(ze.sha256.SHA256,r).expand(Oo);return E.toString(s,De)}function y_(a){const t=ze.sha256.hash(E.fromString(a,De));return E.toString(t,De)}function Rr(a){const t=ze.sha256.hash(E.fromString(a,So));return E.toString(t,De)}function v_(a){return E.fromString(`${a}`,Oh)}function gi(a){return Number(E.toString(a,Oh))}function m_(a){const t=v_(typeof a.type<"u"?a.type:Rh);if(gi(t)===or&&typeof a.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const r=typeof a.senderPublicKey<"u"?E.fromString(a.senderPublicKey,De):void 0,s=typeof a.iv<"u"?E.fromString(a.iv,De):ze.random.randomBytes(fo),o=new ze.chacha20poly1305.ChaCha20Poly1305(E.fromString(a.symKey,De)).seal(s,E.fromString(a.message,So));return __({type:t,sealed:o,iv:s,senderPublicKey:r})}function w_(a){const t=new ze.chacha20poly1305.ChaCha20Poly1305(E.fromString(a.symKey,De)),{sealed:r,iv:s}=ms(a.encoded),o=t.open(s,r);if(o===null)throw new Error("Failed to decrypt");return E.toString(o,So)}function __(a){if(gi(a.type)===or){if(typeof a.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return E.toString(E.concat([a.type,a.senderPublicKey,a.iv,a.sealed]),po)}return E.toString(E.concat([a.type,a.iv,a.sealed]),po)}function ms(a){const t=E.fromString(a,po),r=t.slice(f_,mu),s=mu;if(gi(r)===or){const g=s+Oo,w=g+fo,b=t.slice(s,g),C=t.slice(g,w),O=t.slice(w);return{type:r,sealed:O,iv:C,senderPublicKey:b}}const o=s+fo,u=t.slice(s,o),l=t.slice(o);return{type:r,sealed:l,iv:u}}function b_(a,t){const r=ms(a);return Nh({type:gi(r.type),senderPublicKey:typeof r.senderPublicKey<"u"?E.toString(r.senderPublicKey,De):void 0,receiverPublicKey:t==null?void 0:t.receiverPublicKey})}function Nh(a){const t=(a==null?void 0:a.type)||Rh;if(t===or){if(typeof(a==null?void 0:a.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(a==null?void 0:a.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:t,senderPublicKey:a==null?void 0:a.senderPublicKey,receiverPublicKey:a==null?void 0:a.receiverPublicKey}}function wu(a){return a.type===or&&typeof a.senderPublicKey=="string"&&typeof a.receiverPublicKey=="string"}var E_=Object.defineProperty,_u=Object.getOwnPropertySymbols,I_=Object.prototype.hasOwnProperty,P_=Object.prototype.propertyIsEnumerable,bu=(a,t,r)=>t in a?E_(a,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[t]=r,Eu=(a,t)=>{for(var r in t||(t={}))I_.call(t,r)&&bu(a,r,t[r]);if(_u)for(var r of _u(t))P_.call(t,r)&&bu(a,r,t[r]);return a};const S_="ReactNative",Ge={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},O_="js";function Ro(){return typeof U.dist.process<"u"&&typeof U.dist.process.versions<"u"&&typeof U.dist.process.versions.node<"u"}function Ar(){return!Eo()&&!!Io()&&navigator.product===S_}function xr(){return!Ro()&&!!Io()&&!!Eo()}function yi(){return Ar()?Ge.reactNative:Ro()?Ge.node:xr()?Ge.browser:Ge.unknown}function R_(){var a;try{return Ar()&&typeof U.dist.global<"u"&&typeof(U.dist.global==null?void 0:U.dist.global.Application)<"u"?(a=U.dist.global.Application)==null?void 0:a.applicationId:void 0}catch{return}}function N_(a,t){let r=ze.queryString.parse(a);return r=Eu(Eu({},r),t),a=ze.queryString.stringify(r),a}function C_(){return Ph()||{name:"",description:"",url:"",icons:[""]}}function $_(){if(yi()===Ge.reactNative&&typeof U.dist.global<"u"&&typeof(U.dist.global==null?void 0:U.dist.global.Platform)<"u"){const{OS:r,Version:s}=U.dist.global.Platform;return[r,s].join("-")}const a=E.detect();if(a===null)return"unknown";const t=a.os?a.os.replace(" ","").toLowerCase():"unknown";return a.type==="browser"?[t,a.name,a.version].join("-"):[t,a.version].join("-")}function T_(){var a;const t=yi();return t===Ge.browser?[t,((a=Ih())==null?void 0:a.host)||"unknown"].join(":"):t}function A_(a,t,r){const s=$_(),o=T_();return[[a,t].join("-"),[O_,r].join("-"),s,o].join("/")}function x_({protocol:a,version:t,relayUrl:r,sdkVersion:s,auth:o,projectId:u,useOnCloseEvent:l,bundleId:g}){const w=r.split("?"),b=A_(a,t,s),C={auth:o,ua:b,projectId:u,useOnCloseEvent:l,origin:g||void 0},O=N_(w[1]||"",C);return w[0]+"?"+O}function rr(a,t){return a.filter(r=>t.includes(r)).length===a.length}function Ch(a){return Object.fromEntries(a.entries())}function $h(a){return new Map(Object.entries(a))}function Sr(a=j.cjs.FIVE_MINUTES,t){const r=j.cjs.toMiliseconds(a||j.cjs.FIVE_MINUTES);let s,o,u;return{resolve:l=>{u&&s&&(clearTimeout(u),s(l))},reject:l=>{u&&o&&(clearTimeout(u),o(l))},done:()=>new Promise((l,g)=>{u=setTimeout(()=>{g(new Error(t))},r),s=l,o=g})}}function di(a,t,r){return new Promise(async(s,o)=>{const u=setTimeout(()=>o(new Error(r)),t);try{const l=await a;s(l)}catch(l){o(l)}clearTimeout(u)})}function Th(a,t){if(typeof t=="string"&&t.startsWith(`${a}:`))return t;if(a.toLowerCase()==="topic"){if(typeof t!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${t}`}else if(a.toLowerCase()==="id"){if(typeof t!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${t}`}throw new Error(`Unknown expirer target type: ${a}`)}function D_(a){return Th("topic",a)}function F_(a){return Th("id",a)}function Ah(a){const[t,r]=a.split(":"),s={id:void 0,topic:void 0};if(t==="topic"&&typeof r=="string")s.topic=r;else if(t==="id"&&Number.isInteger(Number(r)))s.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${t}:${r}`);return s}function pt(a,t){return j.cjs.fromMiliseconds(Date.now()+j.cjs.toMiliseconds(a))}function zt(a){return Date.now()>=j.cjs.toMiliseconds(a)}function me(a,t){return`${a}${t?`:${t}`:""}`}function Yn(a=[],t=[]){return[...new Set([...a,...t])]}async function j_({id:a,topic:t,wcDeepLink:r}){try{if(!r)return;const s=typeof r=="string"?JSON.parse(r):r;let o=s==null?void 0:s.href;if(typeof o!="string")return;o.endsWith("/")&&(o=o.slice(0,-1));const u=`${o}/wc?requestId=${a}&sessionTopic=${t}`,l=yi();l===Ge.browser?u.startsWith("https://")?window.open(u,"_blank","noreferrer noopener"):window.open(u,"_self","noreferrer noopener"):l===Ge.reactNative&&typeof(U.dist.global==null?void 0:U.dist.global.Linking)<"u"&&await U.dist.global.Linking.openURL(u)}catch(s){console.error(s)}}async function q_(a,t){try{return await a.getItem(t)||(xr()?localStorage.getItem(t):void 0)}catch(r){console.error(r)}}const U_="irn";function yo(a){return(a==null?void 0:a.relay)||{protocol:U_}}function ys(a){const t=E.C[a];if(typeof t>"u")throw new Error(`Relay Protocol not supported: ${a}`);return t}var M_=Object.defineProperty,Iu=Object.getOwnPropertySymbols,L_=Object.prototype.hasOwnProperty,k_=Object.prototype.propertyIsEnumerable,Pu=(a,t,r)=>t in a?M_(a,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[t]=r,z_=(a,t)=>{for(var r in t||(t={}))L_.call(t,r)&&Pu(a,r,t[r]);if(Iu)for(var r of Iu(t))k_.call(t,r)&&Pu(a,r,t[r]);return a};function H_(a,t="-"){const r={},s="relay"+t;return Object.keys(a).forEach(o=>{if(o.startsWith(s)){const u=o.replace(s,""),l=a[o];r[u]=l}}),r}function Su(a){a=a.includes("wc://")?a.replace("wc://",""):a,a=a.includes("wc:")?a.replace("wc:",""):a;const t=a.indexOf(":"),r=a.indexOf("?")!==-1?a.indexOf("?"):void 0,s=a.substring(0,t),o=a.substring(t+1,r).split("@"),u=typeof r<"u"?a.substring(r):"",l=ze.queryString.parse(u);return{protocol:s,topic:V_(o[0]),version:parseInt(o[1],10),symKey:l.symKey,relay:H_(l)}}function V_(a){return a.startsWith("//")?a.substring(2):a}function K_(a,t="-"){const r="relay",s={};return Object.keys(a).forEach(o=>{const u=r+t+o;a[o]&&(s[u]=a[o])}),s}function B_(a){return`${a.protocol}:${a.topic}@${a.version}?`+ze.queryString.stringify(z_({symKey:a.symKey},K_(a.relay)))}function Dr(a){const t=[];return a.forEach(r=>{const[s,o]=r.split(":");t.push(`${s}:${o}`)}),t}function W_(a){const t=[];return Object.values(a).forEach(r=>{t.push(...Dr(r.accounts))}),t}function J_(a,t){const r=[];return Object.values(a).forEach(s=>{Dr(s.accounts).includes(t)&&r.push(...s.methods)}),r}function G_(a,t){const r=[];return Object.values(a).forEach(s=>{Dr(s.accounts).includes(t)&&r.push(...s.events)}),r}function Q_(a,t){const r=vs(a,t);if(r)throw new Error(r.message);const s={};for(const[o,u]of Object.entries(a))s[o]={methods:u.methods,events:u.events,chains:u.accounts.map(l=>`${l.split(":")[0]}:${l.split(":")[1]}`)};return s}function No(a){return a.includes(":")}function hi(a){return No(a)?a.split(":")[0]:a}const Y_={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},Z_={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function $(a,t){const{message:r,code:s}=Z_[a];return{message:t?`${r} ${t}`:r,code:s}}function ve(a,t){const{message:r,code:s}=Y_[a];return{message:t?`${r} ${t}`:r,code:s}}function ir(a,t){return!!Array.isArray(a)}function Nr(a){return Object.getPrototypeOf(a)===Object.prototype&&Object.keys(a).length}function xe(a){return typeof a>"u"}function Ee(a,t){return t&&xe(a)?!0:typeof a=="string"&&!!a.trim().length}function Co(a,t){return t&&xe(a)?!0:typeof a=="number"&&!isNaN(a)}function X_(a,t){const{requiredNamespaces:r}=t,s=Object.keys(a.namespaces),o=Object.keys(r);let u=!0;return rr(o,s)?(s.forEach(l=>{const{accounts:g,methods:w,events:b}=a.namespaces[l],C=Dr(g),O=r[l];(!rr(Sh(l,O),C)||!rr(O.methods,w)||!rr(O.events,b))&&(u=!1)}),u):!1}function ws(a){return Ee(a,!1)&&a.includes(":")?a.split(":").length===2:!1}function e1(a){if(Ee(a,!1)&&a.includes(":")){const t=a.split(":");if(t.length===3){const r=t[0]+":"+t[1];return!!t[2]&&ws(r)}}return!1}function t1(a){if(Ee(a,!1))try{return typeof new URL(a)<"u"}catch{return!1}return!1}function r1(a){var t;return(t=a==null?void 0:a.proposer)==null?void 0:t.publicKey}function i1(a){return a==null?void 0:a.topic}function s1(a,t){let r=null;return Ee(a==null?void 0:a.publicKey,!1)||(r=$("MISSING_OR_INVALID",`${t} controller public key should be a string`)),r}function Ou(a){let t=!0;return ir(a)?a.length&&(t=a.every(r=>Ee(r,!1))):t=!1,t}function n1(a,t,r){let s=null;return ir(t)&&t.length?t.forEach(o=>{s||ws(o)||(s=ve("UNSUPPORTED_CHAINS",`${r}, chain ${o} should be a string and conform to "namespace:chainId" format`))}):ws(a)||(s=ve("UNSUPPORTED_CHAINS",`${r}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),s}function o1(a,t,r){let s=null;return Object.entries(a).forEach(([o,u])=>{if(s)return;const l=n1(o,Sh(o,u),`${t} ${r}`);l&&(s=l)}),s}function a1(a,t){let r=null;return ir(a)?a.forEach(s=>{r||e1(s)||(r=ve("UNSUPPORTED_ACCOUNTS",`${t}, account ${s} should be a string and conform to "namespace:chainId:address" format`))}):r=ve("UNSUPPORTED_ACCOUNTS",`${t}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),r}function c1(a,t){let r=null;return Object.values(a).forEach(s=>{if(r)return;const o=a1(s==null?void 0:s.accounts,`${t} namespace`);o&&(r=o)}),r}function u1(a,t){let r=null;return Ou(a==null?void 0:a.methods)?Ou(a==null?void 0:a.events)||(r=ve("UNSUPPORTED_EVENTS",`${t}, events should be an array of strings or empty array for no events`)):r=ve("UNSUPPORTED_METHODS",`${t}, methods should be an array of strings or empty array for no methods`),r}function xh(a,t){let r=null;return Object.values(a).forEach(s=>{if(r)return;const o=u1(s,`${t}, namespace`);o&&(r=o)}),r}function h1(a,t,r){let s=null;if(a&&Nr(a)){const o=xh(a,t);o&&(s=o);const u=o1(a,t,r);u&&(s=u)}else s=$("MISSING_OR_INVALID",`${t}, ${r} should be an object with data`);return s}function vs(a,t){let r=null;if(a&&Nr(a)){const s=xh(a,t);s&&(r=s);const o=c1(a,t);o&&(r=o)}else r=$("MISSING_OR_INVALID",`${t}, namespaces should be an object with data`);return r}function Dh(a){return Ee(a.protocol,!0)}function l1(a,t){let r=!1;return a?a&&ir(a)&&a.length&&a.forEach(s=>{r=Dh(s)}):r=!0,r}function p1(a){return typeof a=="number"}function ke(a){return typeof a<"u"&&typeof a!==null}function f1(a){return!(!a||typeof a!="object"||!a.code||!Co(a.code,!1)||!a.message||!Ee(a.message,!1))}function d1(a){return!(xe(a)||!Ee(a.method,!1))}function g1(a){return!(xe(a)||xe(a.result)&&xe(a.error)||!Co(a.id,!1)||!Ee(a.jsonrpc,!1))}function y1(a){return!(xe(a)||!Ee(a.name,!1))}function Ru(a,t){return!(!ws(t)||!W_(a).includes(t))}function v1(a,t,r){return Ee(r,!1)?J_(a,t).includes(r):!1}function m1(a,t,r){return Ee(r,!1)?G_(a,t).includes(r):!1}function Nu(a,t,r){let s=null;const o=w1(a),u=_1(t),l=Object.keys(o),g=Object.keys(u),w=Cu(Object.keys(a)),b=Cu(Object.keys(t)),C=w.filter(O=>!b.includes(O));return C.length&&(s=$("NON_CONFORMING_NAMESPACES",`${r} namespaces keys don't satisfy requiredNamespaces.
      Required: ${C.toString()}
      Received: ${Object.keys(t).toString()}`)),rr(l,g)||(s=$("NON_CONFORMING_NAMESPACES",`${r} namespaces chains don't satisfy required namespaces.
      Required: ${l.toString()}
      Approved: ${g.toString()}`)),Object.keys(t).forEach(O=>{if(!O.includes(":")||s)return;const N=Dr(t[O].accounts);N.includes(O)||(s=$("NON_CONFORMING_NAMESPACES",`${r} namespaces accounts don't satisfy namespace accounts for ${O}
        Required: ${O}
        Approved: ${N.toString()}`))}),l.forEach(O=>{s||(rr(o[O].methods,u[O].methods)?rr(o[O].events,u[O].events)||(s=$("NON_CONFORMING_NAMESPACES",`${r} namespaces events don't satisfy namespace events for ${O}`)):s=$("NON_CONFORMING_NAMESPACES",`${r} namespaces methods don't satisfy namespace methods for ${O}`))}),s}function w1(a){const t={};return Object.keys(a).forEach(r=>{var s;r.includes(":")?t[r]=a[r]:(s=a[r].chains)==null||s.forEach(o=>{t[o]={methods:a[r].methods,events:a[r].events}})}),t}function Cu(a){return[...new Set(a.map(t=>t.includes(":")?t.split(":")[0]:t))]}function _1(a){const t={};return Object.keys(a).forEach(r=>{if(r.includes(":"))t[r]=a[r];else{const s=Dr(a[r].accounts);s==null||s.forEach(o=>{t[o]={accounts:a[r].accounts.filter(u=>u.includes(`${o}:`)),methods:a[r].methods,events:a[r].events}})}}),t}function b1(a,t){return Co(a,!1)&&a<=t.max&&a>=t.min}function $u(){const a=yi();return new Promise(t=>{switch(a){case Ge.browser:t(E1());break;case Ge.reactNative:t(I1());break;case Ge.node:t(P1());break;default:t(!0)}})}function E1(){return xr()&&(navigator==null?void 0:navigator.onLine)}async function I1(){if(Ar()&&typeof U.dist.global<"u"&&U.dist.global!=null&&U.dist.global.NetInfo){const a=await(U.dist.global==null?void 0:U.dist.global.NetInfo.fetch());return a==null?void 0:a.isConnected}return!0}function P1(){return!0}function S1(a){switch(yi()){case Ge.browser:O1(a);break;case Ge.reactNative:R1(a);break}}function O1(a){!Ar()&&xr()&&(window.addEventListener("online",()=>a(!0)),window.addEventListener("offline",()=>a(!1)))}function R1(a){var t;Ar()&&typeof U.dist.global<"u"&&U.dist.global!=null&&U.dist.global.NetInfo&&((t=U.dist.global)==null||t.NetInfo.addEventListener(r=>a(r==null?void 0:r.isConnected)))}const Zn={};let ps=class{static get(t){return Zn[t]}static set(t,r){Zn[t]=r}static delete(t){delete Zn[t]}};class $t extends E.r{constructor(t){super(t),this.events=new U.eventsExports.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(t),this.connection.connected&&this.registerEventListeners()}async connect(t=this.connection){await this.open(t)}async disconnect(){await this.close()}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async request(t,r){return this.requestStrict(E.formatJsonRpcRequest(t.method,t.params||[],t.id||E.getBigIntRpcId().toString()),r)}async requestStrict(t,r){return new Promise(async(s,o)=>{if(!this.connection.connected)try{await this.open()}catch(u){o(u)}this.events.on(`${t.id}`,u=>{E.isJsonRpcError(u)?o(u.error):s(u.result)});try{await this.connection.send(t,r)}catch(u){o(u)}})}setConnection(t=this.connection){return t}onPayload(t){this.events.emit("payload",t),E.isJsonRpcResponse(t)?this.events.emit(`${t.id}`,t):this.events.emit("message",{type:t.method,data:t.params})}onClose(t){t&&t.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${t.code} ${t.reason?`(${t.reason})`:""}`)),this.events.emit("disconnect")}async open(t=this.connection){this.connection===t&&this.connection.connected||(this.connection.connected&&this.close(),typeof t=="string"&&(await this.connection.open(t),t=this.connection),this.connection=this.setConnection(t),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",t=>this.onPayload(t)),this.connection.on("close",t=>this.onClose(t)),this.connection.on("error",t=>this.events.emit("error",t)),this.connection.on("register_error",t=>this.onClose()),this.hasRegisteredEventListeners=!0)}}const N1=()=>typeof WebSocket<"u"?WebSocket:typeof U.dist.global<"u"&&typeof U.dist.global.WebSocket<"u"?U.dist.global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),C1=()=>typeof WebSocket<"u"||typeof U.dist.global<"u"&&typeof U.dist.global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",Tu=a=>a.split("?")[0],Au=10,$1=N1();let T1=class{constructor(t){if(this.url=t,this.events=new U.eventsExports.EventEmitter,this.registering=!1,!E.isWsUrl(t))throw new Error(`Provided URL is not compatible with WebSocket connection: ${t}`);this.url=t}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async open(t=this.url){await this.register(t)}async close(){return new Promise((t,r)=>{if(typeof this.socket>"u"){r(new Error("Connection already closed"));return}this.socket.onclose=s=>{this.onClose(s),t()},this.socket.close()})}async send(t){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(Eh(t))}catch(r){this.onError(t.id,r)}}register(t=this.url){if(!E.isWsUrl(t))throw new Error(`Provided URL is not compatible with WebSocket connection: ${t}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((s,o)=>{this.events.once("register_error",u=>{this.resetMaxListeners(),o(u)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return o(new Error("WebSocket connection is missing or invalid"));s(this.socket)})})}return this.url=t,this.registering=!0,new Promise((r,s)=>{const o=new URLSearchParams(t).get("origin"),u=E.cjs.isReactNative()?{headers:{origin:o}}:{rejectUnauthorized:!E.isLocalhostUrl(t)},l=new $1(t,[],u);C1()?l.onerror=g=>{const w=g;s(this.emitError(w.error))}:l.on("error",g=>{s(this.emitError(g))}),l.onopen=()=>{this.onOpen(l),r(l)}})}onOpen(t){t.onmessage=r=>this.onPayload(r),t.onclose=r=>this.onClose(r),this.socket=t,this.registering=!1,this.events.emit("open")}onClose(t){this.socket=void 0,this.registering=!1,this.events.emit("close",t)}onPayload(t){if(typeof t.data>"u")return;const r=typeof t.data=="string"?bh(t.data):t.data;this.events.emit("payload",r)}onError(t,r){const s=this.parseError(r),o=s.message||s.toString(),u=E.formatJsonRpcError(t,o);this.events.emit("payload",u)}parseError(t,r=this.url){return E.parseConnectionError(t,Tu(r),"WS")}resetMaxListeners(){this.events.getMaxListeners()>Au&&this.events.setMaxListeners(Au)}emitError(t){const r=this.parseError(new Error((t==null?void 0:t.message)||`WebSocket connection failed for host: ${Tu(this.url)}`));return this.events.emit("register_error",r),r}};function A1(a,t){return t=t||{},new Promise(function(r,s){var o=new XMLHttpRequest,u=[],l=[],g={},w=function(){return{ok:(o.status/100|0)==2,statusText:o.statusText,status:o.status,url:o.responseURL,text:function(){return Promise.resolve(o.responseText)},json:function(){return Promise.resolve(o.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([o.response]))},clone:w,headers:{keys:function(){return u},entries:function(){return l},get:function(C){return g[C.toLowerCase()]},has:function(C){return C.toLowerCase()in g}}}};for(var b in o.open(t.method||"get",a,!0),o.onload=function(){o.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,function(C,O,N){u.push(O=O.toLowerCase()),l.push([O,N]),g[O]=g[O]?g[O]+","+N:N}),r(w())},o.onerror=s,o.withCredentials=t.credentials=="include",t.headers)o.setRequestHeader(b,t.headers[b]);o.send(t.body||null)})}const x1=Object.freeze(Object.defineProperty({__proto__:null,default:A1},Symbol.toStringTag,{value:"Module"})),xu=U.getAugmentedNamespace(x1);var D1=self.fetch||(self.fetch=xu.default||xu);const F1=U.getDefaultExportFromCjs(D1);function j1(a,t){if(a.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),s=0;s<r.length;s++)r[s]=255;for(var o=0;o<a.length;o++){var u=a.charAt(o),l=u.charCodeAt(0);if(r[l]!==255)throw new TypeError(u+" is ambiguous");r[l]=o}var g=a.length,w=a.charAt(0),b=Math.log(g)/Math.log(256),C=Math.log(256)/Math.log(g);function O(x){if(x instanceof Uint8Array||(ArrayBuffer.isView(x)?x=new Uint8Array(x.buffer,x.byteOffset,x.byteLength):Array.isArray(x)&&(x=Uint8Array.from(x))),!(x instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(x.length===0)return"";for(var B=0,D=0,Q=0,fe=x.length;Q!==fe&&x[Q]===0;)Q++,B++;for(var Z=(fe-Q)*C+1>>>0,ee=new Uint8Array(Z);Q!==fe;){for(var he=x[Q],Fe=0,de=Z-1;(he!==0||Fe<D)&&de!==-1;de--,Fe++)he+=256*ee[de]>>>0,ee[de]=he%g>>>0,he=he/g>>>0;if(he!==0)throw new Error("Non-zero carry");D=Fe,Q++}for(var Ce=Z-D;Ce!==Z&&ee[Ce]===0;)Ce++;for(var At=w.repeat(B);Ce<Z;++Ce)At+=a.charAt(ee[Ce]);return At}function N(x){if(typeof x!="string")throw new TypeError("Expected String");if(x.length===0)return new Uint8Array;var B=0;if(x[B]!==" "){for(var D=0,Q=0;x[B]===w;)D++,B++;for(var fe=(x.length-B)*b+1>>>0,Z=new Uint8Array(fe);x[B];){var ee=r[x.charCodeAt(B)];if(ee===255)return;for(var he=0,Fe=fe-1;(ee!==0||he<Q)&&Fe!==-1;Fe--,he++)ee+=g*Z[Fe]>>>0,Z[Fe]=ee%256>>>0,ee=ee/256>>>0;if(ee!==0)throw new Error("Non-zero carry");Q=he,B++}if(x[B]!==" "){for(var de=fe-Q;de!==fe&&Z[de]===0;)de++;for(var Ce=new Uint8Array(D+(fe-de)),At=D;de!==fe;)Ce[At++]=Z[de++];return Ce}}}function q(x){var B=N(x);if(B)return B;throw new Error(`Non-${t} character`)}return{encode:O,decodeUnsafe:N,decode:q}}var q1=j1,U1=q1;const Fh=a=>{if(a instanceof Uint8Array&&a.constructor.name==="Uint8Array")return a;if(a instanceof ArrayBuffer)return new Uint8Array(a);if(ArrayBuffer.isView(a))return new Uint8Array(a.buffer,a.byteOffset,a.byteLength);throw new Error("Unknown type, must be binary type")},M1=a=>new TextEncoder().encode(a),L1=a=>new TextDecoder().decode(a);class k1{constructor(t,r,s){this.name=t,this.prefix=r,this.baseEncode=s}encode(t){if(t instanceof Uint8Array)return`${this.prefix}${this.baseEncode(t)}`;throw Error("Unknown type, must be binary type")}}class z1{constructor(t,r,s){if(this.name=t,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=s}decode(t){if(typeof t=="string"){if(t.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(t.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(t){return jh(this,t)}}class H1{constructor(t){this.decoders=t}or(t){return jh(this,t)}decode(t){const r=t[0],s=this.decoders[r];if(s)return s.decode(t);throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const jh=(a,t)=>new H1({...a.decoders||{[a.prefix]:a},...t.decoders||{[t.prefix]:t}});class V1{constructor(t,r,s,o){this.name=t,this.prefix=r,this.baseEncode=s,this.baseDecode=o,this.encoder=new k1(t,r,s),this.decoder=new z1(t,r,o)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}}const Ps=({name:a,prefix:t,encode:r,decode:s})=>new V1(a,t,r,s),vi=({prefix:a,name:t,alphabet:r})=>{const{encode:s,decode:o}=U1(r,t);return Ps({prefix:a,name:t,encode:s,decode:u=>Fh(o(u))})},K1=(a,t,r,s)=>{const o={};for(let C=0;C<t.length;++C)o[t[C]]=C;let u=a.length;for(;a[u-1]==="=";)--u;const l=new Uint8Array(u*r/8|0);let g=0,w=0,b=0;for(let C=0;C<u;++C){const O=o[a[C]];if(O===void 0)throw new SyntaxError(`Non-${s} character`);w=w<<r|O,g+=r,g>=8&&(g-=8,l[b++]=255&w>>g)}if(g>=r||255&w<<8-g)throw new SyntaxError("Unexpected end of data");return l},B1=(a,t,r)=>{const s=t[t.length-1]==="=",o=(1<<r)-1;let u="",l=0,g=0;for(let w=0;w<a.length;++w)for(g=g<<8|a[w],l+=8;l>r;)l-=r,u+=t[o&g>>l];if(l&&(u+=t[o&g<<r-l]),s)for(;u.length*r&7;)u+="=";return u},Se=({name:a,prefix:t,bitsPerChar:r,alphabet:s})=>Ps({prefix:t,name:a,encode(o){return B1(o,s,r)},decode(o){return K1(o,s,r,a)}}),W1=Ps({prefix:"\0",name:"identity",encode:a=>L1(a),decode:a=>M1(a)});var J1=Object.freeze({__proto__:null,identity:W1});const G1=Se({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Q1=Object.freeze({__proto__:null,base2:G1});const Y1=Se({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Z1=Object.freeze({__proto__:null,base8:Y1});const X1=vi({prefix:"9",name:"base10",alphabet:"0123456789"});var e0=Object.freeze({__proto__:null,base10:X1});const t0=Se({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),r0=Se({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var i0=Object.freeze({__proto__:null,base16:t0,base16upper:r0});const s0=Se({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),n0=Se({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),o0=Se({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),a0=Se({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),c0=Se({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),u0=Se({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),h0=Se({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),l0=Se({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),p0=Se({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var f0=Object.freeze({__proto__:null,base32:s0,base32upper:n0,base32pad:o0,base32padupper:a0,base32hex:c0,base32hexupper:u0,base32hexpad:h0,base32hexpadupper:l0,base32z:p0});const d0=vi({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),g0=vi({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var y0=Object.freeze({__proto__:null,base36:d0,base36upper:g0});const v0=vi({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),m0=vi({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var w0=Object.freeze({__proto__:null,base58btc:v0,base58flickr:m0});const _0=Se({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),b0=Se({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),E0=Se({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),I0=Se({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var P0=Object.freeze({__proto__:null,base64:_0,base64pad:b0,base64url:E0,base64urlpad:I0});const qh=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),S0=qh.reduce((a,t,r)=>(a[r]=t,a),[]),O0=qh.reduce((a,t,r)=>(a[t.codePointAt(0)]=r,a),[]);function R0(a){return a.reduce((t,r)=>(t+=S0[r],t),"")}function N0(a){const t=[];for(const r of a){const s=O0[r.codePointAt(0)];if(s===void 0)throw new Error(`Non-base256emoji character: ${r}`);t.push(s)}return new Uint8Array(t)}const C0=Ps({prefix:"🚀",name:"base256emoji",encode:R0,decode:N0});var $0=Object.freeze({__proto__:null,base256emoji:C0}),T0=Uh,Du=128,A0=-128,x0=Math.pow(2,31);function Uh(a,t,r){t=t||[],r=r||0;for(var s=r;a>=x0;)t[r++]=a&255|Du,a/=128;for(;a&A0;)t[r++]=a&255|Du,a>>>=7;return t[r]=a|0,Uh.bytes=r-s+1,t}var D0=vo,F0=128,Fu=127;function vo(a,s){var r=0,s=s||0,o=0,u=s,l,g=a.length;do{if(u>=g)throw vo.bytes=0,new RangeError("Could not decode varint");l=a[u++],r+=o<28?(l&Fu)<<o:(l&Fu)*Math.pow(2,o),o+=7}while(l>=F0);return vo.bytes=u-s,r}var j0=Math.pow(2,7),q0=Math.pow(2,14),U0=Math.pow(2,21),M0=Math.pow(2,28),L0=Math.pow(2,35),k0=Math.pow(2,42),z0=Math.pow(2,49),H0=Math.pow(2,56),V0=Math.pow(2,63),K0=function(a){return a<j0?1:a<q0?2:a<U0?3:a<M0?4:a<L0?5:a<k0?6:a<z0?7:a<H0?8:a<V0?9:10},B0={encode:T0,decode:D0,encodingLength:K0},Mh=B0;const ju=(a,t,r=0)=>(Mh.encode(a,t,r),t),qu=a=>Mh.encodingLength(a),mo=(a,t)=>{const r=t.byteLength,s=qu(a),o=s+qu(r),u=new Uint8Array(o+r);return ju(a,u,0),ju(r,u,s),u.set(t,o),new W0(a,r,t,u)};class W0{constructor(t,r,s,o){this.code=t,this.size=r,this.digest=s,this.bytes=o}}const Lh=({name:a,code:t,encode:r})=>new J0(a,t,r);class J0{constructor(t,r,s){this.name=t,this.code=r,this.encode=s}digest(t){if(t instanceof Uint8Array){const r=this.encode(t);return r instanceof Uint8Array?mo(this.code,r):r.then(s=>mo(this.code,s))}else throw Error("Unknown type, must be binary type")}}const kh=a=>async t=>new Uint8Array(await crypto.subtle.digest(a,t)),G0=Lh({name:"sha2-256",code:18,encode:kh("SHA-256")}),Q0=Lh({name:"sha2-512",code:19,encode:kh("SHA-512")});var Y0=Object.freeze({__proto__:null,sha256:G0,sha512:Q0});const zh=0,Z0="identity",Hh=Fh,X0=a=>mo(zh,Hh(a)),eb={code:zh,name:Z0,encode:Hh,digest:X0};var tb=Object.freeze({__proto__:null,identity:eb});new TextEncoder,new TextDecoder;const Uu={...J1,...Q1,...Z1,...e0,...i0,...f0,...y0,...w0,...P0,...$0};({...Y0,...tb});function Vh(a){return globalThis.Buffer!=null?new Uint8Array(a.buffer,a.byteOffset,a.byteLength):a}function rb(a=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Vh(globalThis.Buffer.allocUnsafe(a)):new Uint8Array(a)}function Kh(a,t,r,s){return{name:a,prefix:t,encoder:{name:a,prefix:t,encode:r},decoder:{decode:s}}}const Mu=Kh("utf8","u",a=>"u"+new TextDecoder("utf8").decode(a),a=>new TextEncoder().encode(a.substring(1))),Xn=Kh("ascii","a",a=>{let t="a";for(let r=0;r<a.length;r++)t+=String.fromCharCode(a[r]);return t},a=>{a=a.substring(1);const t=rb(a.length);for(let r=0;r<a.length;r++)t[r]=a.charCodeAt(r);return t}),ib={utf8:Mu,"utf-8":Mu,hex:Uu.base16,latin1:Xn,ascii:Xn,binary:Xn,...Uu};function sb(a,t="utf8"){const r=ib[t];if(!r)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Vh(globalThis.Buffer.from(a,"utf-8")):r.decoder.decode(`${r.prefix}${a}`)}const Bh="wc",nb=2,Wh="core",Ht=`${Bh}@2:${Wh}:`,ob={logger:"error"},ab={database:":memory:"},cb="crypto",Lu="client_ed25519_seed",ub=j.cjs.ONE_DAY,hb="keychain",lb="0.3",pb="messages",fb="0.3",db=j.cjs.SIX_HOURS,gb="publisher",Jh="irn",yb="error",Gh="wss://relay.walletconnect.com",ku="wss://relay.walletconnect.org",vb="relayer",Ne={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},mb="_subscription",Nt={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},wb=j.cjs.ONE_SECOND,_b="2.11.0",bb=1e4,Eb="0.3",Ib="WALLETCONNECT_CLIENT_ID",lt={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},Pb="subscription",Sb="0.3",Ob=j.cjs.FIVE_SECONDS*1e3,Rb="pairing",Nb="0.3",ni={wc_pairingDelete:{req:{ttl:j.cjs.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:j.cjs.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:j.cjs.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:j.cjs.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:j.cjs.ONE_DAY,prompt:!1,tag:0},res:{ttl:j.cjs.ONE_DAY,prompt:!1,tag:0}}},li={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},vt={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},Cb="history",$b="0.3",Tb="expirer",st={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},Ab="0.3",eo="verify-api",Or="https://verify.walletconnect.com",wo="https://verify.walletconnect.org",xb=[Or,wo],Db="echo",Fb="https://echo.walletconnect.com";class jb{constructor(t,r){this.core=t,this.logger=r,this.keychain=new Map,this.name=hb,this.version=lb,this.initialized=!1,this.storagePrefix=Ht,this.init=async()=>{if(!this.initialized){const s=await this.getKeyChain();typeof s<"u"&&(this.keychain=s),this.initialized=!0}},this.has=s=>(this.isInitialized(),this.keychain.has(s)),this.set=async(s,o)=>{this.isInitialized(),this.keychain.set(s,o),await this.persist()},this.get=s=>{this.isInitialized();const o=this.keychain.get(s);if(typeof o>"u"){const{message:u}=$("NO_MATCHING_KEY",`${this.name}: ${s}`);throw new Error(u)}return o},this.del=async s=>{this.isInitialized(),this.keychain.delete(s),await this.persist()},this.core=t,this.logger=E.E(r,this.name)}get context(){return E.y(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(t){await this.core.storage.setItem(this.storageKey,Ch(t))}async getKeyChain(){const t=await this.core.storage.getItem(this.storageKey);return typeof t<"u"?$h(t):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:t}=$("NOT_INITIALIZED",this.name);throw new Error(t)}}}class qb{constructor(t,r,s){this.core=t,this.logger=r,this.name=cb,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=o=>(this.isInitialized(),this.keychain.has(o)),this.getClientId=async()=>{this.isInitialized();const o=await this.getClientSeed(),u=E.Po(o);return E.Qe(u.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const o=d_();return this.setPrivateKey(o.publicKey,o.privateKey)},this.signJWT=async o=>{this.isInitialized();const u=await this.getClientSeed(),l=E.Po(u),g=go(),w=ub;return await E.Qo(g,o,w,l)},this.generateSharedKey=(o,u,l)=>{this.isInitialized();const g=this.getPrivateKey(o),w=g_(g,u);return this.setSymKey(w,l)},this.setSymKey=async(o,u)=>{this.isInitialized();const l=u||y_(o);return await this.keychain.set(l,o),l},this.deleteKeyPair=async o=>{this.isInitialized(),await this.keychain.del(o)},this.deleteSymKey=async o=>{this.isInitialized(),await this.keychain.del(o)},this.encode=async(o,u,l)=>{this.isInitialized();const g=Nh(l),w=Eh(u);if(wu(g)){const N=g.senderPublicKey,q=g.receiverPublicKey;o=await this.generateSharedKey(N,q)}const b=this.getSymKey(o),{type:C,senderPublicKey:O}=g;return m_({type:C,symKey:b,message:w,senderPublicKey:O})},this.decode=async(o,u,l)=>{this.isInitialized();const g=b_(u,l);if(wu(g)){const w=g.receiverPublicKey,b=g.senderPublicKey;o=await this.generateSharedKey(w,b)}try{const w=this.getSymKey(o),b=w_({symKey:w,encoded:u});return bh(b)}catch(w){this.logger.error(`Failed to decode message from topic: '${o}', clientId: '${await this.getClientId()}'`),this.logger.error(w)}},this.getPayloadType=o=>{const u=ms(o);return gi(u.type)},this.getPayloadSenderPublicKey=o=>{const u=ms(o);return u.senderPublicKey?E.toString(u.senderPublicKey,De):void 0},this.core=t,this.logger=E.E(r,this.name),this.keychain=s||new jb(this.core,this.logger)}get context(){return E.y(this.logger)}async setPrivateKey(t,r){return await this.keychain.set(t,r),t}getPrivateKey(t){return this.keychain.get(t)}async getClientSeed(){let t="";try{t=this.keychain.get(Lu)}catch{t=go(),await this.keychain.set(Lu,t)}return sb(t,"base16")}getSymKey(t){return this.keychain.get(t)}isInitialized(){if(!this.initialized){const{message:t}=$("NOT_INITIALIZED",this.name);throw new Error(t)}}}class Ub extends zw{constructor(t,r){super(t,r),this.logger=t,this.core=r,this.messages=new Map,this.name=pb,this.version=fb,this.initialized=!1,this.storagePrefix=Ht,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const s=await this.getRelayerMessages();typeof s<"u"&&(this.messages=s),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(s){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(s)}finally{this.initialized=!0}}},this.set=async(s,o)=>{this.isInitialized();const u=Rr(o);let l=this.messages.get(s);return typeof l>"u"&&(l={}),typeof l[u]<"u"||(l[u]=o,this.messages.set(s,l),await this.persist()),u},this.get=s=>{this.isInitialized();let o=this.messages.get(s);return typeof o>"u"&&(o={}),o},this.has=(s,o)=>{this.isInitialized();const u=this.get(s),l=Rr(o);return typeof u[l]<"u"},this.del=async s=>{this.isInitialized(),this.messages.delete(s),await this.persist()},this.logger=E.E(t,this.name),this.core=r}get context(){return E.y(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setRelayerMessages(t){await this.core.storage.setItem(this.storageKey,Ch(t))}async getRelayerMessages(){const t=await this.core.storage.getItem(this.storageKey);return typeof t<"u"?$h(t):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:t}=$("NOT_INITIALIZED",this.name);throw new Error(t)}}}class Mb extends Hw{constructor(t,r){super(t,r),this.relayer=t,this.logger=r,this.events=new U.eventsExports.EventEmitter,this.name=gb,this.queue=new Map,this.publishTimeout=j.cjs.toMiliseconds(j.cjs.TEN_SECONDS),this.needsTransportRestart=!1,this.publish=async(s,o,u)=>{var l;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:s,message:o,opts:u}});try{const g=(u==null?void 0:u.ttl)||db,w=yo(u),b=(u==null?void 0:u.prompt)||!1,C=(u==null?void 0:u.tag)||0,O=(u==null?void 0:u.id)||E.getBigIntRpcId().toString(),N={topic:s,message:o,opts:{ttl:g,relay:w,prompt:b,tag:C,id:O}},q=setTimeout(()=>this.queue.set(O,N),this.publishTimeout);try{await await di(this.rpcPublish(s,o,g,w,b,C,O),this.publishTimeout,"Failed to publish payload, please try again."),this.removeRequestFromQueue(O),this.relayer.events.emit(Ne.publish,N)}catch(x){if(this.logger.debug("Publishing Payload stalled"),this.needsTransportRestart=!0,(l=u==null?void 0:u.internal)!=null&&l.throwOnFailedPublish)throw this.removeRequestFromQueue(O),x;return}finally{clearTimeout(q)}this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:s,message:o,opts:u}})}catch(g){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(g),g}},this.on=(s,o)=>{this.events.on(s,o)},this.once=(s,o)=>{this.events.once(s,o)},this.off=(s,o)=>{this.events.off(s,o)},this.removeListener=(s,o)=>{this.events.removeListener(s,o)},this.relayer=t,this.logger=E.E(r,this.name),this.registerEventListeners()}get context(){return E.y(this.logger)}rpcPublish(t,r,s,o,u,l,g){var w,b,C,O;const N={method:ys(o.protocol).publish,params:{topic:t,message:r,ttl:s,prompt:u,tag:l},id:g};return xe((w=N.params)==null?void 0:w.prompt)&&((b=N.params)==null||delete b.prompt),xe((C=N.params)==null?void 0:C.tag)&&((O=N.params)==null||delete O.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:N}),this.relayer.request(N)}removeRequestFromQueue(t){this.queue.delete(t)}checkQueue(){this.queue.forEach(async t=>{const{topic:r,message:s,opts:o}=t;await this.publish(r,s,o)})}registerEventListeners(){this.relayer.core.heartbeat.on($r.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(Ne.connection_stalled);return}this.checkQueue()}),this.relayer.on(Ne.message_ack,t=>{this.removeRequestFromQueue(t.id.toString())})}}class Lb{constructor(){this.map=new Map,this.set=(t,r)=>{const s=this.get(t);this.exists(t,r)||this.map.set(t,[...s,r])},this.get=t=>this.map.get(t)||[],this.exists=(t,r)=>this.get(t).includes(r),this.delete=(t,r)=>{if(typeof r>"u"){this.map.delete(t);return}if(!this.map.has(t))return;const s=this.get(t);if(!this.exists(t,r))return;const o=s.filter(u=>u!==r);if(!o.length){this.map.delete(t);return}this.map.set(t,o)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var kb=Object.defineProperty,zb=Object.defineProperties,Hb=Object.getOwnPropertyDescriptors,zu=Object.getOwnPropertySymbols,Vb=Object.prototype.hasOwnProperty,Kb=Object.prototype.propertyIsEnumerable,Hu=(a,t,r)=>t in a?kb(a,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[t]=r,oi=(a,t)=>{for(var r in t||(t={}))Vb.call(t,r)&&Hu(a,r,t[r]);if(zu)for(var r of zu(t))Kb.call(t,r)&&Hu(a,r,t[r]);return a},to=(a,t)=>zb(a,Hb(t));class Bb extends Bw{constructor(t,r){super(t,r),this.relayer=t,this.logger=r,this.subscriptions=new Map,this.topicMap=new Lb,this.events=new U.eventsExports.EventEmitter,this.name=Pb,this.version=Sb,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=Ht,this.subscribeTimeout=1e4,this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(s,o)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:s,opts:o}});try{const u=yo(o),l={topic:s,relay:u};this.pending.set(s,l);const g=await this.rpcSubscribe(s,u);return this.onSubscribe(g,l),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:s,opts:o}}),g}catch(u){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(u),u}},this.unsubscribe=async(s,o)=>{await this.restartToComplete(),this.isInitialized(),typeof(o==null?void 0:o.id)<"u"?await this.unsubscribeById(s,o.id,o):await this.unsubscribeByTopic(s,o)},this.isSubscribed=async s=>this.topics.includes(s)?!0:await new Promise((o,u)=>{const l=new j.cjs.Watch;l.start(this.pendingSubscriptionWatchLabel);const g=setInterval(()=>{!this.pending.has(s)&&this.topics.includes(s)&&(clearInterval(g),l.stop(this.pendingSubscriptionWatchLabel),o(!0)),l.elapsed(this.pendingSubscriptionWatchLabel)>=Ob&&(clearInterval(g),l.stop(this.pendingSubscriptionWatchLabel),u(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1),this.on=(s,o)=>{this.events.on(s,o)},this.once=(s,o)=>{this.events.once(s,o)},this.off=(s,o)=>{this.events.off(s,o)},this.removeListener=(s,o)=>{this.events.removeListener(s,o)},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=t,this.logger=E.E(r,this.name),this.clientId=""}get context(){return E.y(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(t,r){let s=!1;try{s=this.getSubscription(t).topic===r}catch{}return s}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(t,r){const s=this.topicMap.get(t);await Promise.all(s.map(async o=>await this.unsubscribeById(t,o,r)))}async unsubscribeById(t,r,s){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:t,id:r,opts:s}});try{const o=yo(s);await this.rpcUnsubscribe(t,r,o);const u=ve("USER_DISCONNECTED",`${this.name}, ${t}`);await this.onUnsubscribe(t,r,u),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:t,id:r,opts:s}})}catch(o){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(o),o}}async rpcSubscribe(t,r){const s={method:ys(r.protocol).subscribe,params:{topic:t}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s});try{await await di(this.relayer.request(s),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(Ne.connection_stalled)}return Rr(t+this.clientId)}async rpcBatchSubscribe(t){if(!t.length)return;const r=t[0].relay,s={method:ys(r.protocol).batchSubscribe,params:{topics:t.map(o=>o.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s});try{return await await di(this.relayer.request(s),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(Ne.connection_stalled)}}rpcUnsubscribe(t,r,s){const o={method:ys(s.protocol).unsubscribe,params:{topic:t,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:o}),this.relayer.request(o)}onSubscribe(t,r){this.setSubscription(t,to(oi({},r),{id:t})),this.pending.delete(r.topic)}onBatchSubscribe(t){t.length&&t.forEach(r=>{this.setSubscription(r.id,oi({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(t,r,s){this.events.removeAllListeners(r),this.hasSubscription(r,t)&&this.deleteSubscription(r,s),await this.relayer.messages.del(t)}async setRelayerSubscriptions(t){await this.relayer.core.storage.setItem(this.storageKey,t)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(t,r){this.subscriptions.has(t)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:t,subscription:r}),this.addSubscription(t,r))}addSubscription(t,r){this.subscriptions.set(t,oi({},r)),this.topicMap.set(r.topic,t),this.events.emit(lt.created,r)}getSubscription(t){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:t});const r=this.subscriptions.get(t);if(!r){const{message:s}=$("NO_MATCHING_KEY",`${this.name}: ${t}`);throw new Error(s)}return r}deleteSubscription(t,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:t,reason:r});const s=this.getSubscription(t);this.subscriptions.delete(t),this.topicMap.delete(s.topic,t),this.events.emit(lt.deleted,to(oi({},s),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(lt.sync)}async reset(){if(this.cached.length){const t=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let r=0;r<t;r++){const s=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(s)}}this.events.emit(lt.resubscribed)}async restore(){try{const t=await this.getRelayerSubscriptions();if(typeof t>"u"||!t.length)return;if(this.subscriptions.size){const{message:r}=$("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(t){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(t)}}async batchSubscribe(t){if(!t.length)return;const r=await this.rpcBatchSubscribe(t);ir(r)&&this.onBatchSubscribe(r.map((s,o)=>to(oi({},t[o]),{id:s})))}async onConnect(){this.restartInProgress||(await this.restart(),this.onEnable())}onDisconnect(){this.onDisable()}async checkPending(){if(!this.initialized||this.relayer.transportExplicitlyClosed)return;const t=[];this.pending.forEach(r=>{t.push(r)}),await this.batchSubscribe(t)}registerEventListeners(){this.relayer.core.heartbeat.on($r.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.relayer.on(Ne.connect,async()=>{await this.onConnect()}),this.relayer.on(Ne.disconnect,()=>{this.onDisconnect()}),this.events.on(lt.created,async t=>{const r=lt.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),await this.persist()}),this.events.on(lt.deleted,async t=>{const r=lt.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:t}=$("NOT_INITIALIZED",this.name);throw new Error(t)}}async restartToComplete(){this.restartInProgress&&await new Promise(t=>{const r=setInterval(()=>{this.restartInProgress||(clearInterval(r),t())},this.pollingInterval)})}}var Wb=Object.defineProperty,Vu=Object.getOwnPropertySymbols,Jb=Object.prototype.hasOwnProperty,Gb=Object.prototype.propertyIsEnumerable,Ku=(a,t,r)=>t in a?Wb(a,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[t]=r,Qb=(a,t)=>{for(var r in t||(t={}))Jb.call(t,r)&&Ku(a,r,t[r]);if(Vu)for(var r of Vu(t))Gb.call(t,r)&&Ku(a,r,t[r]);return a};class Yb extends Vw{constructor(t){super(t),this.protocol="wc",this.version=2,this.events=new U.eventsExports.EventEmitter,this.name=vb,this.transportExplicitlyClosed=!1,this.initialized=!1,this.connectionAttemptInProgress=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","socket stalled"],this.hasExperiencedNetworkDisruption=!1,this.request=async r=>{this.logger.debug("Publishing Request Payload");try{return await this.toEstablishConnection(),await this.provider.request(r)}catch(s){throw this.logger.debug("Failed to Publish Request"),this.logger.error(s),s}},this.onPayloadHandler=r=>{this.onProviderPayload(r)},this.onConnectHandler=()=>{this.events.emit(Ne.connect)},this.onDisconnectHandler=()=>{this.onProviderDisconnect()},this.onProviderErrorHandler=r=>{this.logger.error(r),this.events.emit(Ne.error,r),this.logger.info("Fatal socket error received, closing transport"),this.transportClose()},this.registerProviderListeners=()=>{this.provider.on(Nt.payload,this.onPayloadHandler),this.provider.on(Nt.connect,this.onConnectHandler),this.provider.on(Nt.disconnect,this.onDisconnectHandler),this.provider.on(Nt.error,this.onProviderErrorHandler)},this.core=t.core,this.logger=typeof t.logger<"u"&&typeof t.logger!="string"?E.E(t.logger,this.name):E.Tt(E.k({level:t.logger||yb})),this.messages=new Ub(this.logger,t.core),this.subscriber=new Bb(this,this.logger),this.publisher=new Mb(this,this.logger),this.relayUrl=(t==null?void 0:t.relayUrl)||Gh,this.projectId=t.projectId,this.bundleId=R_(),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await this.createProvider(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${ku}...`),await this.restartTransport(ku)}this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},bb)}get context(){return E.y(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(t,r,s){this.isInitialized(),await this.publisher.publish(t,r,s),await this.recordMessageEvent({topic:t,message:r,publishedAt:Date.now()})}async subscribe(t,r){var s;this.isInitialized();let o=((s=this.subscriber.topicMap.get(t))==null?void 0:s[0])||"";if(o)return o;let u;const l=g=>{g.topic===t&&(this.subscriber.off(lt.created,l),u())};return await Promise.all([new Promise(g=>{u=g,this.subscriber.on(lt.created,l)}),new Promise(async g=>{o=await this.subscriber.subscribe(t,r),g()})]),o}async unsubscribe(t,r){this.isInitialized(),await this.subscriber.unsubscribe(t,r)}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async transportClose(){this.transportExplicitlyClosed=!0,this.hasExperiencedNetworkDisruption&&this.connected?await di(this.provider.disconnect(),1e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.connected&&await this.provider.disconnect()}async transportOpen(t){if(this.transportExplicitlyClosed=!1,await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress){t&&t!==this.relayUrl&&(this.relayUrl=t,await this.transportClose(),await this.createProvider()),this.connectionAttemptInProgress=!0;try{await Promise.all([new Promise(r=>{if(!this.initialized)return r();this.subscriber.once(lt.resubscribed,()=>{r()})}),new Promise(async(r,s)=>{try{await di(this.provider.connect(),1e4,`Socket stalled when trying to connect to ${this.relayUrl}`)}catch(o){s(o);return}r()})])}catch(r){this.logger.error(r);const s=r;if(!this.isConnectionStalled(s.message))throw r;this.provider.events.emit(Nt.disconnect)}finally{this.connectionAttemptInProgress=!1,this.hasExperiencedNetworkDisruption=!1}}}async restartTransport(t){await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress&&(this.relayUrl=t||this.relayUrl,await this.transportClose(),await this.createProvider(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await $u())throw new Error("No internet connection detected. Please restart your network and try again.")}isConnectionStalled(t){return this.staleConnectionErrors.some(r=>t.includes(r))}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const t=await this.core.crypto.signJWT(this.relayUrl);this.provider=new $t(new T1(x_({sdkVersion:_b,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:t,useOnCloseEvent:!0,bundleId:this.bundleId}))),this.registerProviderListeners()}async recordMessageEvent(t){const{topic:r,message:s}=t;await this.messages.set(r,s)}async shouldIgnoreMessageEvent(t){const{topic:r,message:s}=t;if(!s||s.length===0)return this.logger.debug(`Ignoring invalid/empty message: ${s}`),!0;if(!await this.subscriber.isSubscribed(r))return this.logger.debug(`Ignoring message for non-subscribed topic ${r}`),!0;const o=this.messages.has(r,s);return o&&this.logger.debug(`Ignoring duplicate message: ${s}`),o}async onProviderPayload(t){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:t}),E.isJsonRpcRequest(t)){if(!t.method.endsWith(mb))return;const r=t.params,{topic:s,message:o,publishedAt:u}=r.data,l={topic:s,message:o,publishedAt:u};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(Qb({type:"event",event:r.id},l)),this.events.emit(r.id,l),await this.acknowledgePayload(t),await this.onMessageEvent(l)}else E.isJsonRpcResponse(t)&&this.events.emit(Ne.message_ack,t)}async onMessageEvent(t){await this.shouldIgnoreMessageEvent(t)||(this.events.emit(Ne.message,t),await this.recordMessageEvent(t))}async acknowledgePayload(t){const r=E.formatJsonRpcResult(t.id,!0);await this.provider.connection.send(r)}unregisterProviderListeners(){this.provider.off(Nt.payload,this.onPayloadHandler),this.provider.off(Nt.connect,this.onConnectHandler),this.provider.off(Nt.disconnect,this.onDisconnectHandler),this.provider.off(Nt.error,this.onProviderErrorHandler)}async registerEventListeners(){this.events.on(Ne.connection_stalled,()=>{this.restartTransport().catch(r=>this.logger.error(r))});let t=await $u();S1(async r=>{this.initialized&&t!==r&&(t=r,r?await this.restartTransport().catch(s=>this.logger.error(s)):(this.hasExperiencedNetworkDisruption=!0,await this.transportClose().catch(s=>this.logger.error(s))))})}onProviderDisconnect(){this.events.emit(Ne.disconnect),this.attemptToReconnect()}attemptToReconnect(){this.transportExplicitlyClosed||(this.logger.info("attemptToReconnect called. Connecting..."),setTimeout(async()=>{await this.restartTransport().catch(t=>this.logger.error(t))},j.cjs.toMiliseconds(wb)))}isInitialized(){if(!this.initialized){const{message:t}=$("NOT_INITIALIZED",this.name);throw new Error(t)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectionAttemptInProgress)return await new Promise(t=>{const r=setInterval(()=>{this.connected&&(clearInterval(r),t())},this.connectionStatusPollingInterval)});await this.restartTransport()}}}var Zb=Object.defineProperty,Bu=Object.getOwnPropertySymbols,Xb=Object.prototype.hasOwnProperty,eE=Object.prototype.propertyIsEnumerable,Wu=(a,t,r)=>t in a?Zb(a,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[t]=r,Ju=(a,t)=>{for(var r in t||(t={}))Xb.call(t,r)&&Wu(a,r,t[r]);if(Bu)for(var r of Bu(t))eE.call(t,r)&&Wu(a,r,t[r]);return a};class Ss extends Kw{constructor(t,r,s,o=Ht,u=void 0){super(t,r,s,o),this.core=t,this.logger=r,this.name=s,this.map=new Map,this.version=Eb,this.cached=[],this.initialized=!1,this.storagePrefix=Ht,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(l=>{this.getKey&&l!==null&&!xe(l)?this.map.set(this.getKey(l),l):r1(l)?this.map.set(l.id,l):i1(l)&&this.map.set(l.topic,l)}),this.cached=[],this.initialized=!0)},this.set=async(l,g)=>{this.isInitialized(),this.map.has(l)?await this.update(l,g):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:l,value:g}),this.map.set(l,g),await this.persist())},this.get=l=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:l}),this.getData(l)),this.getAll=l=>(this.isInitialized(),l?this.values.filter(g=>Object.keys(l).every(w=>E._s(g[w],l[w]))):this.values),this.update=async(l,g)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:l,update:g});const w=Ju(Ju({},this.getData(l)),g);this.map.set(l,w),await this.persist()},this.delete=async(l,g)=>{this.isInitialized(),this.map.has(l)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:l,reason:g}),this.map.delete(l),await this.persist())},this.logger=E.E(r,this.name),this.storagePrefix=o,this.getKey=u}get context(){return E.y(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(t){await this.core.storage.setItem(this.storageKey,t)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(t){const r=this.map.get(t);if(!r){const{message:s}=$("NO_MATCHING_KEY",`${this.name}: ${t}`);throw this.logger.error(s),new Error(s)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const t=await this.getDataStore();if(typeof t>"u"||!t.length)return;if(this.map.size){const{message:r}=$("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(t){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(t)}}isInitialized(){if(!this.initialized){const{message:t}=$("NOT_INITIALIZED",this.name);throw new Error(t)}}}class tE{constructor(t,r){this.core=t,this.logger=r,this.name=Rb,this.version=Nb,this.events=new U.ss,this.initialized=!1,this.storagePrefix=Ht,this.ignoredPayloadTypes=[or],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:s})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...s])]},this.create=async()=>{this.isInitialized();const s=go(),o=await this.core.crypto.setSymKey(s),u=pt(j.cjs.FIVE_MINUTES),l={protocol:Jh},g={topic:o,expiry:u,relay:l,active:!1},w=B_({protocol:this.core.protocol,version:this.core.version,topic:o,symKey:s,relay:l});return await this.pairings.set(o,g),await this.core.relayer.subscribe(o),this.core.expirer.set(o,u),{topic:o,uri:w}},this.pair=async s=>{this.isInitialized(),this.isValidPair(s);const{topic:o,symKey:u,relay:l}=Su(s.uri);let g;if(this.pairings.keys.includes(o)&&(g=this.pairings.get(o),g.active))throw new Error(`Pairing already exists: ${o}. Please try again with a new connection URI.`);const w=pt(j.cjs.FIVE_MINUTES),b={topic:o,relay:l,expiry:w,active:!1};return await this.pairings.set(o,b),this.core.expirer.set(o,w),s.activatePairing&&await this.activate({topic:o}),this.events.emit(li.create,b),this.core.crypto.keychain.has(o)||(await this.core.crypto.setSymKey(u,o),await this.core.relayer.subscribe(o,{relay:l})),b},this.activate=async({topic:s})=>{this.isInitialized();const o=pt(j.cjs.THIRTY_DAYS);await this.pairings.update(s,{active:!0,expiry:o}),this.core.expirer.set(s,o)},this.ping=async s=>{this.isInitialized(),await this.isValidPing(s);const{topic:o}=s;if(this.pairings.keys.includes(o)){const u=await this.sendRequest(o,"wc_pairingPing",{}),{done:l,resolve:g,reject:w}=Sr();this.events.once(me("pairing_ping",u),({error:b})=>{b?w(b):g()}),await l()}},this.updateExpiry=async({topic:s,expiry:o})=>{this.isInitialized(),await this.pairings.update(s,{expiry:o})},this.updateMetadata=async({topic:s,metadata:o})=>{this.isInitialized(),await this.pairings.update(s,{peerMetadata:o})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async s=>{this.isInitialized(),await this.isValidDisconnect(s);const{topic:o}=s;this.pairings.keys.includes(o)&&(await this.sendRequest(o,"wc_pairingDelete",ve("USER_DISCONNECTED")),await this.deletePairing(o))},this.sendRequest=async(s,o,u)=>{const l=E.formatJsonRpcRequest(o,u),g=await this.core.crypto.encode(s,l),w=ni[o].req;return this.core.history.set(s,l),this.core.relayer.publish(s,g,w),l.id},this.sendResult=async(s,o,u)=>{const l=E.formatJsonRpcResult(s,u),g=await this.core.crypto.encode(o,l),w=await this.core.history.get(o,s),b=ni[w.request.method].res;await this.core.relayer.publish(o,g,b),await this.core.history.resolve(l)},this.sendError=async(s,o,u)=>{const l=E.formatJsonRpcError(s,u),g=await this.core.crypto.encode(o,l),w=await this.core.history.get(o,s),b=ni[w.request.method]?ni[w.request.method].res:ni.unregistered_method.res;await this.core.relayer.publish(o,g,b),await this.core.history.resolve(l)},this.deletePairing=async(s,o)=>{await this.core.relayer.unsubscribe(s),await Promise.all([this.pairings.delete(s,ve("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(s),o?Promise.resolve():this.core.expirer.del(s)])},this.cleanup=async()=>{const s=this.pairings.getAll().filter(o=>zt(o.expiry));await Promise.all(s.map(o=>this.deletePairing(o.topic)))},this.onRelayEventRequest=s=>{const{topic:o,payload:u}=s;switch(u.method){case"wc_pairingPing":return this.onPairingPingRequest(o,u);case"wc_pairingDelete":return this.onPairingDeleteRequest(o,u);default:return this.onUnknownRpcMethodRequest(o,u)}},this.onRelayEventResponse=async s=>{const{topic:o,payload:u}=s,l=(await this.core.history.get(o,u.id)).request.method;switch(l){case"wc_pairingPing":return this.onPairingPingResponse(o,u);default:return this.onUnknownRpcMethodResponse(l)}},this.onPairingPingRequest=async(s,o)=>{const{id:u}=o;try{this.isValidPing({topic:s}),await this.sendResult(u,s,!0),this.events.emit(li.ping,{id:u,topic:s})}catch(l){await this.sendError(u,s,l),this.logger.error(l)}},this.onPairingPingResponse=(s,o)=>{const{id:u}=o;setTimeout(()=>{E.isJsonRpcResult(o)?this.events.emit(me("pairing_ping",u),{}):E.isJsonRpcError(o)&&this.events.emit(me("pairing_ping",u),{error:o.error})},500)},this.onPairingDeleteRequest=async(s,o)=>{const{id:u}=o;try{this.isValidDisconnect({topic:s}),await this.deletePairing(s),this.events.emit(li.delete,{id:u,topic:s})}catch(l){await this.sendError(u,s,l),this.logger.error(l)}},this.onUnknownRpcMethodRequest=async(s,o)=>{const{id:u,method:l}=o;try{if(this.registeredMethods.includes(l))return;const g=ve("WC_METHOD_UNSUPPORTED",l);await this.sendError(u,s,g),this.logger.error(g)}catch(g){await this.sendError(u,s,g),this.logger.error(g)}},this.onUnknownRpcMethodResponse=s=>{this.registeredMethods.includes(s)||this.logger.error(ve("WC_METHOD_UNSUPPORTED",s))},this.isValidPair=s=>{var o;if(!ke(s)){const{message:l}=$("MISSING_OR_INVALID",`pair() params: ${s}`);throw new Error(l)}if(!t1(s.uri)){const{message:l}=$("MISSING_OR_INVALID",`pair() uri: ${s.uri}`);throw new Error(l)}const u=Su(s.uri);if(!((o=u==null?void 0:u.relay)!=null&&o.protocol)){const{message:l}=$("MISSING_OR_INVALID","pair() uri#relay-protocol");throw new Error(l)}if(!(u!=null&&u.symKey)){const{message:l}=$("MISSING_OR_INVALID","pair() uri#symKey");throw new Error(l)}},this.isValidPing=async s=>{if(!ke(s)){const{message:u}=$("MISSING_OR_INVALID",`ping() params: ${s}`);throw new Error(u)}const{topic:o}=s;await this.isValidPairingTopic(o)},this.isValidDisconnect=async s=>{if(!ke(s)){const{message:u}=$("MISSING_OR_INVALID",`disconnect() params: ${s}`);throw new Error(u)}const{topic:o}=s;await this.isValidPairingTopic(o)},this.isValidPairingTopic=async s=>{if(!Ee(s,!1)){const{message:o}=$("MISSING_OR_INVALID",`pairing topic should be a string: ${s}`);throw new Error(o)}if(!this.pairings.keys.includes(s)){const{message:o}=$("NO_MATCHING_KEY",`pairing topic doesn't exist: ${s}`);throw new Error(o)}if(zt(this.pairings.get(s).expiry)){await this.deletePairing(s);const{message:o}=$("EXPIRED",`pairing topic: ${s}`);throw new Error(o)}},this.core=t,this.logger=E.E(r,this.name),this.pairings=new Ss(this.core,this.logger,this.name,this.storagePrefix)}get context(){return E.y(this.logger)}isInitialized(){if(!this.initialized){const{message:t}=$("NOT_INITIALIZED",this.name);throw new Error(t)}}registerRelayerEvents(){this.core.relayer.on(Ne.message,async t=>{const{topic:r,message:s}=t;if(!this.pairings.keys.includes(r)||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(s)))return;const o=await this.core.crypto.decode(r,s);try{E.isJsonRpcRequest(o)?(this.core.history.set(r,o),this.onRelayEventRequest({topic:r,payload:o})):E.isJsonRpcResponse(o)&&(await this.core.history.resolve(o),await this.onRelayEventResponse({topic:r,payload:o}),this.core.history.delete(r,o.id))}catch(u){this.logger.error(u)}})}registerExpirerEvents(){this.core.expirer.on(st.expired,async t=>{const{topic:r}=Ah(t.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit(li.expire,{topic:r}))})}}class rE extends kw{constructor(t,r){super(t,r),this.core=t,this.logger=r,this.records=new Map,this.events=new U.eventsExports.EventEmitter,this.name=Cb,this.version=$b,this.cached=[],this.initialized=!1,this.storagePrefix=Ht,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(s=>this.records.set(s.id,s)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(s,o,u)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:s,request:o,chainId:u}),this.records.has(o.id))return;const l={id:o.id,topic:s,request:{method:o.method,params:o.params||null},chainId:u,expiry:pt(j.cjs.THIRTY_DAYS)};this.records.set(l.id,l),this.events.emit(vt.created,l)},this.resolve=async s=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:s}),!this.records.has(s.id))return;const o=await this.getRecord(s.id);typeof o.response>"u"&&(o.response=E.isJsonRpcError(s)?{error:s.error}:{result:s.result},this.records.set(o.id,o),this.events.emit(vt.updated,o))},this.get=async(s,o)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:s,id:o}),await this.getRecord(o)),this.delete=(s,o)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:o}),this.values.forEach(u=>{if(u.topic===s){if(typeof o<"u"&&u.id!==o)return;this.records.delete(u.id),this.events.emit(vt.deleted,u)}})},this.exists=async(s,o)=>(this.isInitialized(),this.records.has(o)?(await this.getRecord(o)).topic===s:!1),this.on=(s,o)=>{this.events.on(s,o)},this.once=(s,o)=>{this.events.once(s,o)},this.off=(s,o)=>{this.events.off(s,o)},this.removeListener=(s,o)=>{this.events.removeListener(s,o)},this.logger=E.E(r,this.name)}get context(){return E.y(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const t=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const s={topic:r.topic,request:E.formatJsonRpcRequest(r.request.method,r.request.params,r.id),chainId:r.chainId};return t.push(s)}),t}async setJsonRpcRecords(t){await this.core.storage.setItem(this.storageKey,t)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(t){this.isInitialized();const r=this.records.get(t);if(!r){const{message:s}=$("NO_MATCHING_KEY",`${this.name}: ${t}`);throw new Error(s)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(vt.sync)}async restore(){try{const t=await this.getJsonRpcRecords();if(typeof t>"u"||!t.length)return;if(this.records.size){const{message:r}=$("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(t){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(t)}}registerEventListeners(){this.events.on(vt.created,t=>{const r=vt.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t}),this.persist()}),this.events.on(vt.updated,t=>{const r=vt.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t}),this.persist()}),this.events.on(vt.deleted,t=>{const r=vt.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t}),this.persist()}),this.core.heartbeat.on($r.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.records.forEach(t=>{j.cjs.toMiliseconds(t.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${t.id}`),this.delete(t.topic,t.id))})}catch(t){this.logger.warn(t)}}isInitialized(){if(!this.initialized){const{message:t}=$("NOT_INITIALIZED",this.name);throw new Error(t)}}}class iE extends Ww{constructor(t,r){super(t,r),this.core=t,this.logger=r,this.expirations=new Map,this.events=new U.eventsExports.EventEmitter,this.name=Tb,this.version=Ab,this.cached=[],this.initialized=!1,this.storagePrefix=Ht,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(s=>this.expirations.set(s.target,s)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=s=>{try{const o=this.formatTarget(s);return typeof this.getExpiration(o)<"u"}catch{return!1}},this.set=(s,o)=>{this.isInitialized();const u=this.formatTarget(s),l={target:u,expiry:o};this.expirations.set(u,l),this.checkExpiry(u,l),this.events.emit(st.created,{target:u,expiration:l})},this.get=s=>{this.isInitialized();const o=this.formatTarget(s);return this.getExpiration(o)},this.del=s=>{if(this.isInitialized(),this.has(s)){const o=this.formatTarget(s),u=this.getExpiration(o);this.expirations.delete(o),this.events.emit(st.deleted,{target:o,expiration:u})}},this.on=(s,o)=>{this.events.on(s,o)},this.once=(s,o)=>{this.events.once(s,o)},this.off=(s,o)=>{this.events.off(s,o)},this.removeListener=(s,o)=>{this.events.removeListener(s,o)},this.logger=E.E(r,this.name)}get context(){return E.y(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(t){if(typeof t=="string")return D_(t);if(typeof t=="number")return F_(t);const{message:r}=$("UNKNOWN_TYPE",`Target type: ${typeof t}`);throw new Error(r)}async setExpirations(t){await this.core.storage.setItem(this.storageKey,t)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(st.sync)}async restore(){try{const t=await this.getExpirations();if(typeof t>"u"||!t.length)return;if(this.expirations.size){const{message:r}=$("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(t){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(t)}}getExpiration(t){const r=this.expirations.get(t);if(!r){const{message:s}=$("NO_MATCHING_KEY",`${this.name}: ${t}`);throw this.logger.error(s),new Error(s)}return r}checkExpiry(t,r){const{expiry:s}=r;j.cjs.toMiliseconds(s)-Date.now()<=0&&this.expire(t,r)}expire(t,r){this.expirations.delete(t),this.events.emit(st.expired,{target:t,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((t,r)=>this.checkExpiry(r,t))}registerEventListeners(){this.core.heartbeat.on($r.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(st.created,t=>{const r=st.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()}),this.events.on(st.expired,t=>{const r=st.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()}),this.events.on(st.deleted,t=>{const r=st.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()})}isInitialized(){if(!this.initialized){const{message:t}=$("NOT_INITIALIZED",this.name);throw new Error(t)}}}class sE extends Jw{constructor(t,r){super(t,r),this.projectId=t,this.logger=r,this.name=eo,this.initialized=!1,this.queue=[],this.verifyDisabled=!1,this.init=async s=>{if(this.verifyDisabled||Ar()||!xr())return;const o=this.getVerifyUrl(s==null?void 0:s.verifyUrl);this.verifyUrl!==o&&this.removeIframe(),this.verifyUrl=o;try{await this.createIframe()}catch(u){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(u)}if(!this.initialized){this.removeIframe(),this.verifyUrl=wo;try{await this.createIframe()}catch(u){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(u),this.verifyDisabled=!0}}},this.register=async s=>{this.initialized?this.sendPost(s.attestationId):(this.addToQueue(s.attestationId),await this.init())},this.resolve=async s=>{if(this.isDevEnv)return"";const o=this.getVerifyUrl(s==null?void 0:s.verifyUrl);let u;try{u=await this.fetchAttestation(s.attestationId,o)}catch(l){this.logger.info(`failed to resolve attestation: ${s.attestationId} from url: ${o}`),this.logger.info(l),u=await this.fetchAttestation(s.attestationId,wo)}return u},this.fetchAttestation=async(s,o)=>{this.logger.info(`resolving attestation: ${s} from url: ${o}`);const u=this.startAbortTimer(j.cjs.ONE_SECOND*2),l=await fetch(`${o}/attestation/${s}`,{signal:this.abortController.signal});return clearTimeout(u),l.status===200?await l.json():void 0},this.addToQueue=s=>{this.queue.push(s)},this.processQueue=()=>{this.queue.length!==0&&(this.queue.forEach(s=>this.sendPost(s)),this.queue=[])},this.sendPost=s=>{var o;try{if(!this.iframe)return;(o=this.iframe.contentWindow)==null||o.postMessage(s,"*"),this.logger.info(`postMessage sent: ${s} ${this.verifyUrl}`)}catch{}},this.createIframe=async()=>{let s;const o=u=>{u.data==="verify_ready"&&(this.initialized=!0,this.processQueue(),window.removeEventListener("message",o),s())};await Promise.race([new Promise(u=>{if(document.getElementById(eo))return u();window.addEventListener("message",o);const l=document.createElement("iframe");l.id=eo,l.src=`${this.verifyUrl}/${this.projectId}`,l.style.display="none",document.body.append(l),this.iframe=l,s=u}),new Promise((u,l)=>setTimeout(()=>{window.removeEventListener("message",o),l("verify iframe load timeout")},j.cjs.toMiliseconds(j.cjs.FIVE_SECONDS)))])},this.removeIframe=()=>{this.iframe&&(this.iframe.remove(),this.iframe=void 0,this.initialized=!1)},this.getVerifyUrl=s=>{let o=s||Or;return xb.includes(o)||(this.logger.info(`verify url: ${o}, not included in trusted list, assigning default: ${Or}`),o=Or),o},this.logger=E.E(r,this.name),this.verifyUrl=Or,this.abortController=new AbortController,this.isDevEnv=Ro()&&U.dist.process.env.IS_VITEST}get context(){return E.y(this.logger)}startAbortTimer(t){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),j.cjs.toMiliseconds(t))}}class nE extends Gw{constructor(t,r){super(t,r),this.projectId=t,this.logger=r,this.context=Db,this.registerDeviceToken=async s=>{const{clientId:o,token:u,notificationType:l,enableEncrypted:g=!1}=s,w=`${Fb}/${this.projectId}/clients`;await F1(w,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:o,type:l,token:u,always_raw:g})})},this.logger=E.E(r,this.context)}}var oE=Object.defineProperty,Gu=Object.getOwnPropertySymbols,aE=Object.prototype.hasOwnProperty,cE=Object.prototype.propertyIsEnumerable,Qu=(a,t,r)=>t in a?oE(a,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[t]=r,Yu=(a,t)=>{for(var r in t||(t={}))aE.call(t,r)&&Qu(a,r,t[r]);if(Gu)for(var r of Gu(t))cE.call(t,r)&&Qu(a,r,t[r]);return a};class $o extends Lw{constructor(t){super(t),this.protocol=Bh,this.version=nb,this.name=Wh,this.events=new U.eventsExports.EventEmitter,this.initialized=!1,this.on=(s,o)=>this.events.on(s,o),this.once=(s,o)=>this.events.once(s,o),this.off=(s,o)=>this.events.off(s,o),this.removeListener=(s,o)=>this.events.removeListener(s,o),this.projectId=t==null?void 0:t.projectId,this.relayUrl=(t==null?void 0:t.relayUrl)||Gh,this.customStoragePrefix=t!=null&&t.customStoragePrefix?`:${t.customStoragePrefix}`:"";const r=typeof(t==null?void 0:t.logger)<"u"&&typeof(t==null?void 0:t.logger)!="string"?t.logger:E.Tt(E.k({level:(t==null?void 0:t.logger)||ob.logger}));this.logger=E.E(r,this.name),this.heartbeat=new $r.HeartBeat,this.crypto=new qb(this,this.logger,t==null?void 0:t.keychain),this.history=new rE(this,this.logger),this.expirer=new iE(this,this.logger),this.storage=t!=null&&t.storage?t.storage:new E.h(Yu(Yu({},ab),t==null?void 0:t.storageOptions)),this.relayer=new Yb({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new tE(this,this.logger),this.verify=new sE(this.projectId||"",this.logger),this.echoClient=new nE(this.projectId||"",this.logger)}static async init(t){const r=new $o(t);await r.initialize();const s=await r.crypto.getClientId();return await r.storage.setItem(Ib,s),r}get context(){return E.y(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(t){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,t),this.logger.error(t.message),t}}}const uE=$o,Qh="wc",Yh=2,Zh="client",To=`${Qh}@${Yh}:${Zh}:`,ro={name:Zh,logger:"error"},Zu="WALLETCONNECT_DEEPLINK_CHOICE",hE="proposal",Xh="Proposal expired",lE="session",fs=j.cjs.SEVEN_DAYS,pE="engine",ai={wc_sessionPropose:{req:{ttl:j.cjs.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:j.cjs.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:j.cjs.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:j.cjs.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:j.cjs.ONE_DAY,prompt:!1,tag:1104},res:{ttl:j.cjs.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:j.cjs.ONE_DAY,prompt:!1,tag:1106},res:{ttl:j.cjs.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:j.cjs.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:j.cjs.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:j.cjs.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:j.cjs.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:j.cjs.ONE_DAY,prompt:!1,tag:1112},res:{ttl:j.cjs.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:j.cjs.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:j.cjs.THIRTY_SECONDS,prompt:!1,tag:1115}}},io={min:j.cjs.FIVE_MINUTES,max:j.cjs.SEVEN_DAYS},Ct={idle:"IDLE",active:"ACTIVE"},fE="request",dE=["wc_sessionPropose","wc_sessionRequest","wc_authRequest"];var gE=Object.defineProperty,yE=Object.defineProperties,vE=Object.getOwnPropertyDescriptors,Xu=Object.getOwnPropertySymbols,mE=Object.prototype.hasOwnProperty,wE=Object.prototype.propertyIsEnumerable,eh=(a,t,r)=>t in a?gE(a,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[t]=r,Le=(a,t)=>{for(var r in t||(t={}))mE.call(t,r)&&eh(a,r,t[r]);if(Xu)for(var r of Xu(t))wE.call(t,r)&&eh(a,r,t[r]);return a},ci=(a,t)=>yE(a,vE(t));class _E extends Yw{constructor(t){super(t),this.name=pE,this.events=new U.ss,this.initialized=!1,this.ignoredPayloadTypes=[or],this.requestQueue={state:Ct.idle,queue:[]},this.sessionRequestQueue={state:Ct.idle,queue:[]},this.requestQueueDelay=j.cjs.ONE_SECOND,this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),this.client.core.pairing.register({methods:Object.keys(ai)}),this.initialized=!0,setTimeout(()=>{this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},j.cjs.toMiliseconds(this.requestQueueDelay)))},this.connect=async r=>{await this.isInitialized();const s=ci(Le({},r),{requiredNamespaces:r.requiredNamespaces||{},optionalNamespaces:r.optionalNamespaces||{}});await this.isValidConnect(s);const{pairingTopic:o,requiredNamespaces:u,optionalNamespaces:l,sessionProperties:g,relays:w}=s;let b=o,C,O=!1;if(b&&(O=this.client.core.pairing.pairings.get(b).active),!b||!O){const{topic:Z,uri:ee}=await this.client.core.pairing.create();b=Z,C=ee}const N=await this.client.core.crypto.generateKeyPair(),q=Le({requiredNamespaces:u,optionalNamespaces:l,relays:w??[{protocol:Jh}],proposer:{publicKey:N,metadata:this.client.metadata}},g&&{sessionProperties:g}),{reject:x,resolve:B,done:D}=Sr(j.cjs.FIVE_MINUTES,Xh);if(this.events.once(me("session_connect"),async({error:Z,session:ee})=>{if(Z)x(Z);else if(ee){ee.self.publicKey=N;const he=ci(Le({},ee),{requiredNamespaces:ee.requiredNamespaces,optionalNamespaces:ee.optionalNamespaces});await this.client.session.set(ee.topic,he),await this.setExpiry(ee.topic,ee.expiry),b&&await this.client.core.pairing.updateMetadata({topic:b,metadata:ee.peer.metadata}),B(he)}}),!b){const{message:Z}=$("NO_MATCHING_KEY",`connect() pairing topic: ${b}`);throw new Error(Z)}const Q=await this.sendRequest({topic:b,method:"wc_sessionPropose",params:q}),fe=pt(j.cjs.FIVE_MINUTES);return await this.setProposal(Q,Le({id:Q,expiry:fe},q)),{uri:C,approval:D}},this.pair=async r=>(await this.isInitialized(),await this.client.core.pairing.pair(r)),this.approve=async r=>{await this.isInitialized(),await this.isValidApprove(r);const{id:s,relayProtocol:o,namespaces:u,sessionProperties:l}=r,g=this.client.proposal.get(s);let{pairingTopic:w,proposer:b,requiredNamespaces:C,optionalNamespaces:O}=g;w=w||"",Nr(C)||(C=Q_(u,"approve()"));const N=await this.client.core.crypto.generateKeyPair(),q=b.publicKey,x=await this.client.core.crypto.generateSharedKey(N,q);w&&s&&(await this.client.core.pairing.updateMetadata({topic:w,metadata:b.metadata}),await this.sendResult({id:s,topic:w,result:{relay:{protocol:o??"irn"},responderPublicKey:N}}),await this.client.proposal.delete(s,ve("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:w}));const B=Le({relay:{protocol:o??"irn"},namespaces:u,requiredNamespaces:C,optionalNamespaces:O,pairingTopic:w,controller:{publicKey:N,metadata:this.client.metadata},expiry:pt(fs)},l&&{sessionProperties:l});await this.client.core.relayer.subscribe(x),await this.sendRequest({topic:x,method:"wc_sessionSettle",params:B,throwOnFailedPublish:!0});const D=ci(Le({},B),{topic:x,pairingTopic:w,acknowledged:!1,self:B.controller,peer:{publicKey:b.publicKey,metadata:b.metadata},controller:N});return await this.client.session.set(x,D),await this.setExpiry(x,pt(fs)),{topic:x,acknowledged:()=>new Promise(Q=>setTimeout(()=>Q(this.client.session.get(x)),500))}},this.reject=async r=>{await this.isInitialized(),await this.isValidReject(r);const{id:s,reason:o}=r,{pairingTopic:u}=this.client.proposal.get(s);u&&(await this.sendError(s,u,o),await this.client.proposal.delete(s,ve("USER_DISCONNECTED")))},this.update=async r=>{await this.isInitialized(),await this.isValidUpdate(r);const{topic:s,namespaces:o}=r,u=await this.sendRequest({topic:s,method:"wc_sessionUpdate",params:{namespaces:o}}),{done:l,resolve:g,reject:w}=Sr();return this.events.once(me("session_update",u),({error:b})=>{b?w(b):g()}),await this.client.session.update(s,{namespaces:o}),{acknowledged:l}},this.extend=async r=>{await this.isInitialized(),await this.isValidExtend(r);const{topic:s}=r,o=await this.sendRequest({topic:s,method:"wc_sessionExtend",params:{}}),{done:u,resolve:l,reject:g}=Sr();return this.events.once(me("session_extend",o),({error:w})=>{w?g(w):l()}),await this.setExpiry(s,pt(fs)),{acknowledged:u}},this.request=async r=>{await this.isInitialized(),await this.isValidRequest(r);const{chainId:s,request:o,topic:u,expiry:l}=r,g=E.payloadId(),{done:w,resolve:b,reject:C}=Sr(l,"Request expired. Please try again.");return this.events.once(me("session_request",g),({error:O,result:N})=>{O?C(O):b(N)}),await Promise.all([new Promise(async O=>{await this.sendRequest({clientRpcId:g,topic:u,method:"wc_sessionRequest",params:{request:o,chainId:s},expiry:l,throwOnFailedPublish:!0}).catch(N=>C(N)),this.client.events.emit("session_request_sent",{topic:u,request:o,chainId:s,id:g}),O()}),new Promise(async O=>{const N=await q_(this.client.core.storage,Zu);j_({id:g,topic:u,wcDeepLink:N}),O()}),w()]).then(O=>O[2])},this.respond=async r=>{await this.isInitialized(),await this.isValidRespond(r);const{topic:s,response:o}=r,{id:u}=o;E.isJsonRpcResult(o)?await this.sendResult({id:u,topic:s,result:o.result,throwOnFailedPublish:!0}):E.isJsonRpcError(o)&&await this.sendError(u,s,o.error),this.cleanupAfterResponse(r)},this.ping=async r=>{await this.isInitialized(),await this.isValidPing(r);const{topic:s}=r;if(this.client.session.keys.includes(s)){const o=await this.sendRequest({topic:s,method:"wc_sessionPing",params:{}}),{done:u,resolve:l,reject:g}=Sr();this.events.once(me("session_ping",o),({error:w})=>{w?g(w):l()}),await u()}else this.client.core.pairing.pairings.keys.includes(s)&&await this.client.core.pairing.ping({topic:s})},this.emit=async r=>{await this.isInitialized(),await this.isValidEmit(r);const{topic:s,event:o,chainId:u}=r;await this.sendRequest({topic:s,method:"wc_sessionEvent",params:{event:o,chainId:u}})},this.disconnect=async r=>{await this.isInitialized(),await this.isValidDisconnect(r);const{topic:s}=r;this.client.session.keys.includes(s)?(await this.sendRequest({topic:s,method:"wc_sessionDelete",params:ve("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession(s)):await this.client.core.pairing.disconnect({topic:s})},this.find=r=>(this.isInitialized(),this.client.session.getAll().filter(s=>X_(s,r))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.cleanupDuplicatePairings=async r=>{if(r.pairingTopic)try{const s=this.client.core.pairing.pairings.get(r.pairingTopic),o=this.client.core.pairing.pairings.getAll().filter(u=>{var l,g;return((l=u.peerMetadata)==null?void 0:l.url)&&((g=u.peerMetadata)==null?void 0:g.url)===r.peer.metadata.url&&u.topic&&u.topic!==s.topic});if(o.length===0)return;this.client.logger.info(`Cleaning up ${o.length} duplicate pairing(s)`),await Promise.all(o.map(u=>this.client.core.pairing.disconnect({topic:u.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(s){this.client.logger.error(s)}},this.deleteSession=async(r,s)=>{const{self:o}=this.client.session.get(r);await this.client.core.relayer.unsubscribe(r),this.client.session.delete(r,ve("USER_DISCONNECTED")),this.client.core.crypto.keychain.has(o.publicKey)&&await this.client.core.crypto.deleteKeyPair(o.publicKey),this.client.core.crypto.keychain.has(r)&&await this.client.core.crypto.deleteSymKey(r),s||this.client.core.expirer.del(r),this.client.core.storage.removeItem(Zu).catch(u=>this.client.logger.warn(u)),this.getPendingSessionRequests().forEach(u=>{u.topic===r&&this.deletePendingSessionRequest(u.id,ve("USER_DISCONNECTED"))})},this.deleteProposal=async(r,s)=>{await Promise.all([this.client.proposal.delete(r,ve("USER_DISCONNECTED")),s?Promise.resolve():this.client.core.expirer.del(r)])},this.deletePendingSessionRequest=async(r,s,o=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,s),o?Promise.resolve():this.client.core.expirer.del(r)]),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(u=>u.id!==r),o&&(this.sessionRequestQueue.state=Ct.idle)},this.setExpiry=async(r,s)=>{this.client.session.keys.includes(r)&&await this.client.session.update(r,{expiry:s}),this.client.core.expirer.set(r,s)},this.setProposal=async(r,s)=>{await this.client.proposal.set(r,s),this.client.core.expirer.set(r,s.expiry)},this.setPendingSessionRequest=async r=>{const s=ai.wc_sessionRequest.req.ttl,{id:o,topic:u,params:l,verifyContext:g}=r;await this.client.pendingRequest.set(o,{id:o,topic:u,params:l,verifyContext:g}),s&&this.client.core.expirer.set(o,pt(s))},this.sendRequest=async r=>{const{topic:s,method:o,params:u,expiry:l,relayRpcId:g,clientRpcId:w,throwOnFailedPublish:b}=r,C=E.formatJsonRpcRequest(o,u,w);if(xr()&&dE.includes(o)){const q=Rr(JSON.stringify(C));this.client.core.verify.register({attestationId:q})}const O=await this.client.core.crypto.encode(s,C),N=ai[o].req;return l&&(N.ttl=l),g&&(N.id=g),this.client.core.history.set(s,C),b?(N.internal=ci(Le({},N.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(s,O,N)):this.client.core.relayer.publish(s,O,N).catch(q=>this.client.logger.error(q)),C.id},this.sendResult=async r=>{const{id:s,topic:o,result:u,throwOnFailedPublish:l}=r,g=E.formatJsonRpcResult(s,u),w=await this.client.core.crypto.encode(o,g),b=await this.client.core.history.get(o,s),C=ai[b.request.method].res;l?(C.internal=ci(Le({},C.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(o,w,C)):this.client.core.relayer.publish(o,w,C).catch(O=>this.client.logger.error(O)),await this.client.core.history.resolve(g)},this.sendError=async(r,s,o)=>{const u=E.formatJsonRpcError(r,o),l=await this.client.core.crypto.encode(s,u),g=await this.client.core.history.get(s,r),w=ai[g.request.method].res;this.client.core.relayer.publish(s,l,w),await this.client.core.history.resolve(u)},this.cleanup=async()=>{const r=[],s=[];this.client.session.getAll().forEach(o=>{zt(o.expiry)&&r.push(o.topic)}),this.client.proposal.getAll().forEach(o=>{zt(o.expiry)&&s.push(o.id)}),await Promise.all([...r.map(o=>this.deleteSession(o)),...s.map(o=>this.deleteProposal(o))])},this.onRelayEventRequest=async r=>{this.requestQueue.queue.push(r),await this.processRequestsQueue()},this.processRequestsQueue=async()=>{if(this.requestQueue.state===Ct.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=Ct.active;const r=this.requestQueue.queue.shift();if(r)try{this.processRequest(r),await new Promise(s=>setTimeout(s,300))}catch(s){this.client.logger.warn(s)}}this.requestQueue.state=Ct.idle},this.processRequest=r=>{const{topic:s,payload:o}=r,u=o.method;switch(u){case"wc_sessionPropose":return this.onSessionProposeRequest(s,o);case"wc_sessionSettle":return this.onSessionSettleRequest(s,o);case"wc_sessionUpdate":return this.onSessionUpdateRequest(s,o);case"wc_sessionExtend":return this.onSessionExtendRequest(s,o);case"wc_sessionPing":return this.onSessionPingRequest(s,o);case"wc_sessionDelete":return this.onSessionDeleteRequest(s,o);case"wc_sessionRequest":return this.onSessionRequest(s,o);case"wc_sessionEvent":return this.onSessionEventRequest(s,o);default:return this.client.logger.info(`Unsupported request method ${u}`)}},this.onRelayEventResponse=async r=>{const{topic:s,payload:o}=r,u=(await this.client.core.history.get(s,o.id)).request.method;switch(u){case"wc_sessionPropose":return this.onSessionProposeResponse(s,o);case"wc_sessionSettle":return this.onSessionSettleResponse(s,o);case"wc_sessionUpdate":return this.onSessionUpdateResponse(s,o);case"wc_sessionExtend":return this.onSessionExtendResponse(s,o);case"wc_sessionPing":return this.onSessionPingResponse(s,o);case"wc_sessionRequest":return this.onSessionRequestResponse(s,o);default:return this.client.logger.info(`Unsupported response method ${u}`)}},this.onRelayEventUnknownPayload=r=>{const{topic:s}=r,{message:o}=$("MISSING_OR_INVALID",`Decoded payload on topic ${s} is not identifiable as a JSON-RPC request or a response.`);throw new Error(o)},this.onSessionProposeRequest=async(r,s)=>{const{params:o,id:u}=s;try{this.isValidConnect(Le({},s.params));const l=pt(j.cjs.FIVE_MINUTES),g=Le({id:u,pairingTopic:r,expiry:l},o);await this.setProposal(u,g);const w=Rr(JSON.stringify(s)),b=await this.getVerifyContext(w,g.proposer.metadata);this.client.events.emit("session_proposal",{id:u,params:g,verifyContext:b})}catch(l){await this.sendError(u,r,l),this.client.logger.error(l)}},this.onSessionProposeResponse=async(r,s)=>{const{id:o}=s;if(E.isJsonRpcResult(s)){const{result:u}=s;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:u});const l=this.client.proposal.get(o);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:l});const g=l.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:g});const w=u.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:w});const b=await this.client.core.crypto.generateSharedKey(g,w);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:b});const C=await this.client.core.relayer.subscribe(b);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:C}),await this.client.core.pairing.activate({topic:r})}else E.isJsonRpcError(s)&&(await this.client.proposal.delete(o,ve("USER_DISCONNECTED")),this.events.emit(me("session_connect"),{error:s.error}))},this.onSessionSettleRequest=async(r,s)=>{const{id:o,params:u}=s;try{this.isValidSessionSettleRequest(u);const{relay:l,controller:g,expiry:w,namespaces:b,requiredNamespaces:C,optionalNamespaces:O,sessionProperties:N,pairingTopic:q}=s.params,x=Le({topic:r,relay:l,expiry:w,namespaces:b,acknowledged:!0,pairingTopic:q,requiredNamespaces:C,optionalNamespaces:O,controller:g.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:g.publicKey,metadata:g.metadata}},N&&{sessionProperties:N});await this.sendResult({id:s.id,topic:r,result:!0}),this.events.emit(me("session_connect"),{session:x}),this.cleanupDuplicatePairings(x)}catch(l){await this.sendError(o,r,l),this.client.logger.error(l)}},this.onSessionSettleResponse=async(r,s)=>{const{id:o}=s;E.isJsonRpcResult(s)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(me("session_approve",o),{})):E.isJsonRpcError(s)&&(await this.client.session.delete(r,ve("USER_DISCONNECTED")),this.events.emit(me("session_approve",o),{error:s.error}))},this.onSessionUpdateRequest=async(r,s)=>{const{params:o,id:u}=s;try{const l=`${r}_session_update`,g=ps.get(l);if(g&&this.isRequestOutOfSync(g,u)){this.client.logger.info(`Discarding out of sync request - ${u}`);return}this.isValidUpdate(Le({topic:r},o)),await this.client.session.update(r,{namespaces:o.namespaces}),await this.sendResult({id:u,topic:r,result:!0}),this.client.events.emit("session_update",{id:u,topic:r,params:o}),ps.set(l,u)}catch(l){await this.sendError(u,r,l),this.client.logger.error(l)}},this.isRequestOutOfSync=(r,s)=>parseInt(s.toString().slice(0,-3))<=parseInt(r.toString().slice(0,-3)),this.onSessionUpdateResponse=(r,s)=>{const{id:o}=s;E.isJsonRpcResult(s)?this.events.emit(me("session_update",o),{}):E.isJsonRpcError(s)&&this.events.emit(me("session_update",o),{error:s.error})},this.onSessionExtendRequest=async(r,s)=>{const{id:o}=s;try{this.isValidExtend({topic:r}),await this.setExpiry(r,pt(fs)),await this.sendResult({id:o,topic:r,result:!0}),this.client.events.emit("session_extend",{id:o,topic:r})}catch(u){await this.sendError(o,r,u),this.client.logger.error(u)}},this.onSessionExtendResponse=(r,s)=>{const{id:o}=s;E.isJsonRpcResult(s)?this.events.emit(me("session_extend",o),{}):E.isJsonRpcError(s)&&this.events.emit(me("session_extend",o),{error:s.error})},this.onSessionPingRequest=async(r,s)=>{const{id:o}=s;try{this.isValidPing({topic:r}),await this.sendResult({id:o,topic:r,result:!0}),this.client.events.emit("session_ping",{id:o,topic:r})}catch(u){await this.sendError(o,r,u),this.client.logger.error(u)}},this.onSessionPingResponse=(r,s)=>{const{id:o}=s;setTimeout(()=>{E.isJsonRpcResult(s)?this.events.emit(me("session_ping",o),{}):E.isJsonRpcError(s)&&this.events.emit(me("session_ping",o),{error:s.error})},500)},this.onSessionDeleteRequest=async(r,s)=>{const{id:o}=s;try{this.isValidDisconnect({topic:r,reason:s.params}),await Promise.all([new Promise(u=>{this.client.core.relayer.once(Ne.publish,async()=>{u(await this.deleteSession(r))})}),this.sendResult({id:o,topic:r,result:!0})]),this.client.events.emit("session_delete",{id:o,topic:r})}catch(u){this.client.logger.error(u)}},this.onSessionRequest=async(r,s)=>{const{id:o,params:u}=s;try{this.isValidRequest(Le({topic:r},u));const l=Rr(JSON.stringify(E.formatJsonRpcRequest("wc_sessionRequest",u,o))),g=this.client.session.get(r),w=await this.getVerifyContext(l,g.peer.metadata),b={id:o,topic:r,params:u,verifyContext:w};await this.setPendingSessionRequest(b),this.addSessionRequestToSessionRequestQueue(b),this.processSessionRequestQueue()}catch(l){await this.sendError(o,r,l),this.client.logger.error(l)}},this.onSessionRequestResponse=(r,s)=>{const{id:o}=s;E.isJsonRpcResult(s)?this.events.emit(me("session_request",o),{result:s.result}):E.isJsonRpcError(s)&&this.events.emit(me("session_request",o),{error:s.error})},this.onSessionEventRequest=async(r,s)=>{const{id:o,params:u}=s;try{const l=`${r}_session_event_${u.event.name}`,g=ps.get(l);if(g&&this.isRequestOutOfSync(g,o)){this.client.logger.info(`Discarding out of sync request - ${o}`);return}this.isValidEmit(Le({topic:r},u)),this.client.events.emit("session_event",{id:o,topic:r,params:u}),ps.set(l,o)}catch(l){await this.sendError(o,r,l),this.client.logger.error(l)}},this.addSessionRequestToSessionRequestQueue=r=>{this.sessionRequestQueue.queue.push(r)},this.cleanupAfterResponse=r=>{this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=Ct.idle,this.processSessionRequestQueue()},j.cjs.toMiliseconds(this.requestQueueDelay))},this.processSessionRequestQueue=()=>{if(this.sessionRequestQueue.state===Ct.active){this.client.logger.info("session request queue is already active.");return}const r=this.sessionRequestQueue.queue[0];if(!r){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=Ct.active,this.client.events.emit("session_request",r)}catch(s){this.client.logger.error(s)}},this.onPairingCreated=r=>{if(r.active)return;const s=this.client.proposal.getAll().find(o=>o.pairingTopic===r.topic);s&&this.onSessionProposeRequest(r.topic,E.formatJsonRpcRequest("wc_sessionPropose",{requiredNamespaces:s.requiredNamespaces,optionalNamespaces:s.optionalNamespaces,relays:s.relays,proposer:s.proposer,sessionProperties:s.sessionProperties},s.id))},this.isValidConnect=async r=>{if(!ke(r)){const{message:w}=$("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(w)}const{pairingTopic:s,requiredNamespaces:o,optionalNamespaces:u,sessionProperties:l,relays:g}=r;if(xe(s)||await this.isValidPairingTopic(s),!l1(g)){const{message:w}=$("MISSING_OR_INVALID",`connect() relays: ${g}`);throw new Error(w)}!xe(o)&&Nr(o)!==0&&this.validateNamespaces(o,"requiredNamespaces"),!xe(u)&&Nr(u)!==0&&this.validateNamespaces(u,"optionalNamespaces"),xe(l)||this.validateSessionProps(l,"sessionProperties")},this.validateNamespaces=(r,s)=>{const o=h1(r,"connect()",s);if(o)throw new Error(o.message)},this.isValidApprove=async r=>{if(!ke(r))throw new Error($("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:s,namespaces:o,relayProtocol:u,sessionProperties:l}=r;await this.isValidProposalId(s);const g=this.client.proposal.get(s),w=vs(o,"approve()");if(w)throw new Error(w.message);const b=Nu(g.requiredNamespaces,o,"approve()");if(b)throw new Error(b.message);if(!Ee(u,!0)){const{message:C}=$("MISSING_OR_INVALID",`approve() relayProtocol: ${u}`);throw new Error(C)}xe(l)||this.validateSessionProps(l,"sessionProperties")},this.isValidReject=async r=>{if(!ke(r)){const{message:u}=$("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(u)}const{id:s,reason:o}=r;if(await this.isValidProposalId(s),!f1(o)){const{message:u}=$("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(o)}`);throw new Error(u)}},this.isValidSessionSettleRequest=r=>{if(!ke(r)){const{message:b}=$("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(b)}const{relay:s,controller:o,namespaces:u,expiry:l}=r;if(!Dh(s)){const{message:b}=$("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(b)}const g=s1(o,"onSessionSettleRequest()");if(g)throw new Error(g.message);const w=vs(u,"onSessionSettleRequest()");if(w)throw new Error(w.message);if(zt(l)){const{message:b}=$("EXPIRED","onSessionSettleRequest()");throw new Error(b)}},this.isValidUpdate=async r=>{if(!ke(r)){const{message:w}=$("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(w)}const{topic:s,namespaces:o}=r;await this.isValidSessionTopic(s);const u=this.client.session.get(s),l=vs(o,"update()");if(l)throw new Error(l.message);const g=Nu(u.requiredNamespaces,o,"update()");if(g)throw new Error(g.message)},this.isValidExtend=async r=>{if(!ke(r)){const{message:o}=$("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(o)}const{topic:s}=r;await this.isValidSessionTopic(s)},this.isValidRequest=async r=>{if(!ke(r)){const{message:w}=$("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(w)}const{topic:s,request:o,chainId:u,expiry:l}=r;await this.isValidSessionTopic(s);const{namespaces:g}=this.client.session.get(s);if(!Ru(g,u)){const{message:w}=$("MISSING_OR_INVALID",`request() chainId: ${u}`);throw new Error(w)}if(!d1(o)){const{message:w}=$("MISSING_OR_INVALID",`request() ${JSON.stringify(o)}`);throw new Error(w)}if(!v1(g,u,o.method)){const{message:w}=$("MISSING_OR_INVALID",`request() method: ${o.method}`);throw new Error(w)}if(l&&!b1(l,io)){const{message:w}=$("MISSING_OR_INVALID",`request() expiry: ${l}. Expiry must be a number (in seconds) between ${io.min} and ${io.max}`);throw new Error(w)}},this.isValidRespond=async r=>{var s;if(!ke(r)){const{message:l}=$("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(l)}const{topic:o,response:u}=r;try{await this.isValidSessionTopic(o)}catch(l){throw(s=r==null?void 0:r.response)!=null&&s.id&&this.cleanupAfterResponse(r),l}if(!g1(u)){const{message:l}=$("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(u)}`);throw new Error(l)}},this.isValidPing=async r=>{if(!ke(r)){const{message:o}=$("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(o)}const{topic:s}=r;await this.isValidSessionOrPairingTopic(s)},this.isValidEmit=async r=>{if(!ke(r)){const{message:g}=$("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(g)}const{topic:s,event:o,chainId:u}=r;await this.isValidSessionTopic(s);const{namespaces:l}=this.client.session.get(s);if(!Ru(l,u)){const{message:g}=$("MISSING_OR_INVALID",`emit() chainId: ${u}`);throw new Error(g)}if(!y1(o)){const{message:g}=$("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(o)}`);throw new Error(g)}if(!m1(l,u,o.name)){const{message:g}=$("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(o)}`);throw new Error(g)}},this.isValidDisconnect=async r=>{if(!ke(r)){const{message:o}=$("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(o)}const{topic:s}=r;await this.isValidSessionOrPairingTopic(s)},this.getVerifyContext=async(r,s)=>{const o={verified:{verifyUrl:s.verifyUrl||Or,validation:"UNKNOWN",origin:s.url||""}};try{const u=await this.client.core.verify.resolve({attestationId:r,verifyUrl:s.verifyUrl});u&&(o.verified.origin=u.origin,o.verified.isScam=u.isScam,o.verified.validation=u.origin===new URL(s.url).origin?"VALID":"INVALID")}catch(u){this.client.logger.info(u)}return this.client.logger.info(`Verify context: ${JSON.stringify(o)}`),o},this.validateSessionProps=(r,s)=>{Object.values(r).forEach(o=>{if(!Ee(o,!1)){const{message:u}=$("MISSING_OR_INVALID",`${s} must be in Record<string, string> format. Received: ${JSON.stringify(o)}`);throw new Error(u)}})}}async isInitialized(){if(!this.initialized){const{message:t}=$("NOT_INITIALIZED",this.name);throw new Error(t)}await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(Ne.message,async t=>{const{topic:r,message:s}=t;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(s)))return;const o=await this.client.core.crypto.decode(r,s);try{E.isJsonRpcRequest(o)?(this.client.core.history.set(r,o),this.onRelayEventRequest({topic:r,payload:o})):E.isJsonRpcResponse(o)?(await this.client.core.history.resolve(o),await this.onRelayEventResponse({topic:r,payload:o}),this.client.core.history.delete(r,o.id)):this.onRelayEventUnknownPayload({topic:r,payload:o})}catch(u){this.client.logger.error(u)}})}registerExpirerEvents(){this.client.core.expirer.on(st.expired,async t=>{const{topic:r,id:s}=Ah(t.target);if(s&&this.client.pendingRequest.keys.includes(s))return await this.deletePendingSessionRequest(s,$("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession(r,!0),this.client.events.emit("session_expire",{topic:r})):s&&(await this.deleteProposal(s,!0),this.client.events.emit("proposal_expire",{id:s}))})}registerPairingEvents(){this.client.core.pairing.events.on(li.create,t=>this.onPairingCreated(t))}isValidPairingTopic(t){if(!Ee(t,!1)){const{message:r}=$("MISSING_OR_INVALID",`pairing topic should be a string: ${t}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(t)){const{message:r}=$("NO_MATCHING_KEY",`pairing topic doesn't exist: ${t}`);throw new Error(r)}if(zt(this.client.core.pairing.pairings.get(t).expiry)){const{message:r}=$("EXPIRED",`pairing topic: ${t}`);throw new Error(r)}}async isValidSessionTopic(t){if(!Ee(t,!1)){const{message:r}=$("MISSING_OR_INVALID",`session topic should be a string: ${t}`);throw new Error(r)}if(!this.client.session.keys.includes(t)){const{message:r}=$("NO_MATCHING_KEY",`session topic doesn't exist: ${t}`);throw new Error(r)}if(zt(this.client.session.get(t).expiry)){await this.deleteSession(t);const{message:r}=$("EXPIRED",`session topic: ${t}`);throw new Error(r)}}async isValidSessionOrPairingTopic(t){if(this.client.session.keys.includes(t))await this.isValidSessionTopic(t);else if(this.client.core.pairing.pairings.keys.includes(t))this.isValidPairingTopic(t);else if(Ee(t,!1)){const{message:r}=$("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${t}`);throw new Error(r)}else{const{message:r}=$("MISSING_OR_INVALID",`session or pairing topic should be a string: ${t}`);throw new Error(r)}}async isValidProposalId(t){if(!p1(t)){const{message:r}=$("MISSING_OR_INVALID",`proposal id should be a number: ${t}`);throw new Error(r)}if(!this.client.proposal.keys.includes(t)){const{message:r}=$("NO_MATCHING_KEY",`proposal id doesn't exist: ${t}`);throw new Error(r)}if(zt(this.client.proposal.get(t).expiry)){await this.deleteProposal(t);const{message:r}=$("EXPIRED",`proposal id: ${t}`);throw new Error(r)}}}class bE extends Ss{constructor(t,r){super(t,r,hE,To),this.core=t,this.logger=r}}class EE extends Ss{constructor(t,r){super(t,r,lE,To),this.core=t,this.logger=r}}class IE extends Ss{constructor(t,r){super(t,r,fE,To,s=>s.id),this.core=t,this.logger=r}}let PE=class el extends Qw{constructor(t){super(t),this.protocol=Qh,this.version=Yh,this.name=ro.name,this.events=new U.eventsExports.EventEmitter,this.on=(s,o)=>this.events.on(s,o),this.once=(s,o)=>this.events.once(s,o),this.off=(s,o)=>this.events.off(s,o),this.removeListener=(s,o)=>this.events.removeListener(s,o),this.removeAllListeners=s=>this.events.removeAllListeners(s),this.connect=async s=>{try{return await this.engine.connect(s)}catch(o){throw this.logger.error(o.message),o}},this.pair=async s=>{try{return await this.engine.pair(s)}catch(o){throw this.logger.error(o.message),o}},this.approve=async s=>{try{return await this.engine.approve(s)}catch(o){throw this.logger.error(o.message),o}},this.reject=async s=>{try{return await this.engine.reject(s)}catch(o){throw this.logger.error(o.message),o}},this.update=async s=>{try{return await this.engine.update(s)}catch(o){throw this.logger.error(o.message),o}},this.extend=async s=>{try{return await this.engine.extend(s)}catch(o){throw this.logger.error(o.message),o}},this.request=async s=>{try{return await this.engine.request(s)}catch(o){throw this.logger.error(o.message),o}},this.respond=async s=>{try{return await this.engine.respond(s)}catch(o){throw this.logger.error(o.message),o}},this.ping=async s=>{try{return await this.engine.ping(s)}catch(o){throw this.logger.error(o.message),o}},this.emit=async s=>{try{return await this.engine.emit(s)}catch(o){throw this.logger.error(o.message),o}},this.disconnect=async s=>{try{return await this.engine.disconnect(s)}catch(o){throw this.logger.error(o.message),o}},this.find=s=>{try{return this.engine.find(s)}catch(o){throw this.logger.error(o.message),o}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(s){throw this.logger.error(s.message),s}},this.name=(t==null?void 0:t.name)||ro.name,this.metadata=(t==null?void 0:t.metadata)||C_();const r=typeof(t==null?void 0:t.logger)<"u"&&typeof(t==null?void 0:t.logger)!="string"?t.logger:E.Tt(E.k({level:(t==null?void 0:t.logger)||ro.logger}));this.core=(t==null?void 0:t.core)||new uE(t),this.logger=E.E(r,this.name),this.session=new EE(this.core,this.logger),this.proposal=new bE(this.core,this.logger),this.pendingRequest=new IE(this.core,this.logger),this.engine=new _E(this)}static async init(t){const r=new el(t);return await r.initialize(),r}get context(){return E.y(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.core.verify.init({verifyUrl:this.metadata.verifyUrl}),this.logger.info("SignClient Initialization Success")}catch(t){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(t.message),t}}};const SE=a=>JSON.stringify(a,(t,r)=>typeof r=="bigint"?r.toString()+"n":r),OE=a=>{const t=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,r=a.replace(t,'$1"$2n"$3');return JSON.parse(r,(s,o)=>typeof o=="string"&&o.match(/^\d+n$/)?BigInt(o.substring(0,o.length-1)):o)};function RE(a){if(typeof a!="string")throw new Error(`Cannot safe json parse value of type ${typeof a}`);try{return OE(a)}catch{return a}}function th(a){return typeof a=="string"?a:SE(a)||""}var NE=Object.defineProperty,CE=Object.defineProperties,$E=Object.getOwnPropertyDescriptors,rh=Object.getOwnPropertySymbols,TE=Object.prototype.hasOwnProperty,AE=Object.prototype.propertyIsEnumerable,ih=(a,t,r)=>t in a?NE(a,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[t]=r,sh=(a,t)=>{for(var r in t||(t={}))TE.call(t,r)&&ih(a,r,t[r]);if(rh)for(var r of rh(t))AE.call(t,r)&&ih(a,r,t[r]);return a},nh=(a,t)=>CE(a,$E(t));const xE={Accept:"application/json","Content-Type":"application/json"},DE="POST",oh={headers:xE,method:DE},ah=10;let Kt=class{constructor(t,r=!1){if(this.url=t,this.disableProviderPing=r,this.events=new U.eventsExports.EventEmitter,this.isAvailable=!1,this.registering=!1,!E.isHttpUrl(t))throw new Error(`Provided URL is not compatible with HTTP connection: ${t}`);this.url=t,this.disableProviderPing=r}get connected(){return this.isAvailable}get connecting(){return this.registering}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async open(t=this.url){await this.register(t)}async close(){if(!this.isAvailable)throw new Error("Connection already closed");this.onClose()}async send(t){this.isAvailable||await this.register();try{const r=th(t),s=await(await U.o(this.url,nh(sh({},oh),{body:r}))).json();this.onPayload({data:s})}catch(r){this.onError(t.id,r)}}async register(t=this.url){if(!E.isHttpUrl(t))throw new Error(`Provided URL is not compatible with HTTP connection: ${t}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((s,o)=>{this.events.once("register_error",u=>{this.resetMaxListeners(),o(u)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.isAvailable>"u")return o(new Error("HTTP connection is missing or invalid"));s()})})}this.url=t,this.registering=!0;try{if(!this.disableProviderPing){const r=th({id:1,jsonrpc:"2.0",method:"test",params:[]});await U.o(t,nh(sh({},oh),{body:r}))}this.onOpen()}catch(r){const s=this.parseError(r);throw this.events.emit("register_error",s),this.onClose(),s}}onOpen(){this.isAvailable=!0,this.registering=!1,this.events.emit("open")}onClose(){this.isAvailable=!1,this.registering=!1,this.events.emit("close")}onPayload(t){if(typeof t.data>"u")return;const r=typeof t.data=="string"?RE(t.data):t.data;this.events.emit("payload",r)}onError(t,r){const s=this.parseError(r),o=s.message||s.toString(),u=E.formatJsonRpcError(t,o);this.events.emit("payload",u)}parseError(t,r=this.url){return E.parseConnectionError(t,r,"HTTP")}resetMaxListeners(){this.events.getMaxListeners()>ah&&this.events.setMaxListeners(ah)}};const ch="error",FE="wss://relay.walletconnect.com",jE="wc",qE="universal_provider",uh=`${jE}@2:${qE}:`,UE="https://rpc.walletconnect.com/v1/",Tt={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var ui=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof U.dist.global<"u"?U.dist.global:typeof self<"u"?self:{},_o={exports:{}};/**
* @license
* Lodash <https://lodash.com/>
* Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
* Released under MIT license <https://lodash.com/license>
* Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
* Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
*/(function(a,t){(function(){var r,s="4.17.21",o=200,u="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",l="Expected a function",g="Invalid `variable` option passed into `_.template`",w="__lodash_hash_undefined__",b=500,C="__lodash_placeholder__",O=1,N=2,q=4,x=1,B=2,D=1,Q=2,fe=4,Z=8,ee=16,he=32,Fe=64,de=128,Ce=256,At=512,nl=30,ol="...",al=800,cl=16,xo=1,ul=2,hl=3,mi=1/0,cr=9007199254740991,ll=17976931348623157e292,wi=NaN,ft=4294967295,pl=ft-1,fl=ft>>>1,dl=[["ary",de],["bind",D],["bindKey",Q],["curry",Z],["curryRight",ee],["flip",At],["partial",he],["partialRight",Fe],["rearg",Ce]],ur="[object Arguments]",_i="[object Array]",gl="[object AsyncFunction]",Fr="[object Boolean]",jr="[object Date]",yl="[object DOMException]",bi="[object Error]",Ei="[object Function]",Do="[object GeneratorFunction]",nt="[object Map]",qr="[object Number]",vl="[object Null]",mt="[object Object]",Fo="[object Promise]",ml="[object Proxy]",Ur="[object RegExp]",ot="[object Set]",Mr="[object String]",Ii="[object Symbol]",wl="[object Undefined]",Lr="[object WeakMap]",_l="[object WeakSet]",kr="[object ArrayBuffer]",hr="[object DataView]",Rs="[object Float32Array]",Ns="[object Float64Array]",Cs="[object Int8Array]",$s="[object Int16Array]",Ts="[object Int32Array]",As="[object Uint8Array]",xs="[object Uint8ClampedArray]",Ds="[object Uint16Array]",Fs="[object Uint32Array]",bl=/\b__p \+= '';/g,El=/\b(__p \+=) '' \+/g,Il=/(__e\(.*?\)|\b__t\)) \+\n'';/g,jo=/&(?:amp|lt|gt|quot|#39);/g,qo=/[&<>"']/g,Pl=RegExp(jo.source),Sl=RegExp(qo.source),Ol=/<%-([\s\S]+?)%>/g,Rl=/<%([\s\S]+?)%>/g,Uo=/<%=([\s\S]+?)%>/g,Nl=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Cl=/^\w*$/,$l=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,js=/[\\^$.*+?()[\]{}|]/g,Tl=RegExp(js.source),qs=/^\s+/,Al=/\s/,xl=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Dl=/\{\n\/\* \[wrapped with (.+)\] \*/,Fl=/,? & /,jl=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,ql=/[()=,{}\[\]\/\s]/,Ul=/\\(\\)?/g,Ml=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Mo=/\w*$/,Ll=/^[-+]0x[0-9a-f]+$/i,kl=/^0b[01]+$/i,zl=/^\[object .+?Constructor\]$/,Hl=/^0o[0-7]+$/i,Vl=/^(?:0|[1-9]\d*)$/,Kl=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Pi=/($^)/,Bl=/['\n\r\u2028\u2029\\]/g,Si="\\ud800-\\udfff",Wl="\\u0300-\\u036f",Jl="\\ufe20-\\ufe2f",Gl="\\u20d0-\\u20ff",Lo=Wl+Jl+Gl,ko="\\u2700-\\u27bf",zo="a-z\\xdf-\\xf6\\xf8-\\xff",Ql="\\xac\\xb1\\xd7\\xf7",Yl="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Zl="\\u2000-\\u206f",Xl=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Ho="A-Z\\xc0-\\xd6\\xd8-\\xde",Vo="\\ufe0e\\ufe0f",Ko=Ql+Yl+Zl+Xl,Us="['’]",ep="["+Si+"]",Bo="["+Ko+"]",Oi="["+Lo+"]",Wo="\\d+",tp="["+ko+"]",Jo="["+zo+"]",Go="[^"+Si+Ko+Wo+ko+zo+Ho+"]",Ms="\\ud83c[\\udffb-\\udfff]",rp="(?:"+Oi+"|"+Ms+")",Qo="[^"+Si+"]",Ls="(?:\\ud83c[\\udde6-\\uddff]){2}",ks="[\\ud800-\\udbff][\\udc00-\\udfff]",lr="["+Ho+"]",Yo="\\u200d",Zo="(?:"+Jo+"|"+Go+")",ip="(?:"+lr+"|"+Go+")",Xo="(?:"+Us+"(?:d|ll|m|re|s|t|ve))?",ea="(?:"+Us+"(?:D|LL|M|RE|S|T|VE))?",ta=rp+"?",ra="["+Vo+"]?",sp="(?:"+Yo+"(?:"+[Qo,Ls,ks].join("|")+")"+ra+ta+")*",np="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",op="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",ia=ra+ta+sp,ap="(?:"+[tp,Ls,ks].join("|")+")"+ia,cp="(?:"+[Qo+Oi+"?",Oi,Ls,ks,ep].join("|")+")",up=RegExp(Us,"g"),hp=RegExp(Oi,"g"),zs=RegExp(Ms+"(?="+Ms+")|"+cp+ia,"g"),lp=RegExp([lr+"?"+Jo+"+"+Xo+"(?="+[Bo,lr,"$"].join("|")+")",ip+"+"+ea+"(?="+[Bo,lr+Zo,"$"].join("|")+")",lr+"?"+Zo+"+"+Xo,lr+"+"+ea,op,np,Wo,ap].join("|"),"g"),pp=RegExp("["+Yo+Si+Lo+Vo+"]"),fp=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,dp=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],gp=-1,ae={};ae[Rs]=ae[Ns]=ae[Cs]=ae[$s]=ae[Ts]=ae[As]=ae[xs]=ae[Ds]=ae[Fs]=!0,ae[ur]=ae[_i]=ae[kr]=ae[Fr]=ae[hr]=ae[jr]=ae[bi]=ae[Ei]=ae[nt]=ae[qr]=ae[mt]=ae[Ur]=ae[ot]=ae[Mr]=ae[Lr]=!1;var se={};se[ur]=se[_i]=se[kr]=se[hr]=se[Fr]=se[jr]=se[Rs]=se[Ns]=se[Cs]=se[$s]=se[Ts]=se[nt]=se[qr]=se[mt]=se[Ur]=se[ot]=se[Mr]=se[Ii]=se[As]=se[xs]=se[Ds]=se[Fs]=!0,se[bi]=se[Ei]=se[Lr]=!1;var yp={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},vp={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},mp={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},wp={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},_p=parseFloat,bp=parseInt,sa=typeof ui=="object"&&ui&&ui.Object===Object&&ui,Ep=typeof self=="object"&&self&&self.Object===Object&&self,Ie=sa||Ep||Function("return this")(),Hs=t&&!t.nodeType&&t,Bt=Hs&&!0&&a&&!a.nodeType&&a,na=Bt&&Bt.exports===Hs,Vs=na&&sa.process,Qe=function(){try{var v=Bt&&Bt.require&&Bt.require("util").types;return v||Vs&&Vs.binding&&Vs.binding("util")}catch{}}(),oa=Qe&&Qe.isArrayBuffer,aa=Qe&&Qe.isDate,ca=Qe&&Qe.isMap,ua=Qe&&Qe.isRegExp,ha=Qe&&Qe.isSet,la=Qe&&Qe.isTypedArray;function He(v,I,_){switch(_.length){case 0:return v.call(I);case 1:return v.call(I,_[0]);case 2:return v.call(I,_[0],_[1]);case 3:return v.call(I,_[0],_[1],_[2])}return v.apply(I,_)}function Ip(v,I,_,A){for(var z=-1,X=v==null?0:v.length;++z<X;){var we=v[z];I(A,we,_(we),v)}return A}function Ye(v,I){for(var _=-1,A=v==null?0:v.length;++_<A&&I(v[_],_,v)!==!1;);return v}function Pp(v,I){for(var _=v==null?0:v.length;_--&&I(v[_],_,v)!==!1;);return v}function pa(v,I){for(var _=-1,A=v==null?0:v.length;++_<A;)if(!I(v[_],_,v))return!1;return!0}function xt(v,I){for(var _=-1,A=v==null?0:v.length,z=0,X=[];++_<A;){var we=v[_];I(we,_,v)&&(X[z++]=we)}return X}function Ri(v,I){var _=v==null?0:v.length;return!!_&&pr(v,I,0)>-1}function Ks(v,I,_){for(var A=-1,z=v==null?0:v.length;++A<z;)if(_(I,v[A]))return!0;return!1}function ce(v,I){for(var _=-1,A=v==null?0:v.length,z=Array(A);++_<A;)z[_]=I(v[_],_,v);return z}function Dt(v,I){for(var _=-1,A=I.length,z=v.length;++_<A;)v[z+_]=I[_];return v}function Bs(v,I,_,A){var z=-1,X=v==null?0:v.length;for(A&&X&&(_=v[++z]);++z<X;)_=I(_,v[z],z,v);return _}function Sp(v,I,_,A){var z=v==null?0:v.length;for(A&&z&&(_=v[--z]);z--;)_=I(_,v[z],z,v);return _}function Ws(v,I){for(var _=-1,A=v==null?0:v.length;++_<A;)if(I(v[_],_,v))return!0;return!1}var Op=Js("length");function Rp(v){return v.split("")}function Np(v){return v.match(jl)||[]}function fa(v,I,_){var A;return _(v,function(z,X,we){if(I(z,X,we))return A=X,!1}),A}function Ni(v,I,_,A){for(var z=v.length,X=_+(A?1:-1);A?X--:++X<z;)if(I(v[X],X,v))return X;return-1}function pr(v,I,_){return I===I?Lp(v,I,_):Ni(v,da,_)}function Cp(v,I,_,A){for(var z=_-1,X=v.length;++z<X;)if(A(v[z],I))return z;return-1}function da(v){return v!==v}function ga(v,I){var _=v==null?0:v.length;return _?Qs(v,I)/_:wi}function Js(v){return function(I){return I==null?r:I[v]}}function Gs(v){return function(I){return v==null?r:v[I]}}function ya(v,I,_,A,z){return z(v,function(X,we,ie){_=A?(A=!1,X):I(_,X,we,ie)}),_}function $p(v,I){var _=v.length;for(v.sort(I);_--;)v[_]=v[_].value;return v}function Qs(v,I){for(var _,A=-1,z=v.length;++A<z;){var X=I(v[A]);X!==r&&(_=_===r?X:_+X)}return _}function Ys(v,I){for(var _=-1,A=Array(v);++_<v;)A[_]=I(_);return A}function Tp(v,I){return ce(I,function(_){return[_,v[_]]})}function va(v){return v&&v.slice(0,ba(v)+1).replace(qs,"")}function Ve(v){return function(I){return v(I)}}function Zs(v,I){return ce(I,function(_){return v[_]})}function zr(v,I){return v.has(I)}function ma(v,I){for(var _=-1,A=v.length;++_<A&&pr(I,v[_],0)>-1;);return _}function wa(v,I){for(var _=v.length;_--&&pr(I,v[_],0)>-1;);return _}function Ap(v,I){for(var _=v.length,A=0;_--;)v[_]===I&&++A;return A}var xp=Gs(yp),Dp=Gs(vp);function Fp(v){return"\\"+wp[v]}function jp(v,I){return v==null?r:v[I]}function fr(v){return pp.test(v)}function qp(v){return fp.test(v)}function Up(v){for(var I,_=[];!(I=v.next()).done;)_.push(I.value);return _}function Xs(v){var I=-1,_=Array(v.size);return v.forEach(function(A,z){_[++I]=[z,A]}),_}function _a(v,I){return function(_){return v(I(_))}}function Ft(v,I){for(var _=-1,A=v.length,z=0,X=[];++_<A;){var we=v[_];(we===I||we===C)&&(v[_]=C,X[z++]=_)}return X}function Ci(v){var I=-1,_=Array(v.size);return v.forEach(function(A){_[++I]=A}),_}function Mp(v){var I=-1,_=Array(v.size);return v.forEach(function(A){_[++I]=[A,A]}),_}function Lp(v,I,_){for(var A=_-1,z=v.length;++A<z;)if(v[A]===I)return A;return-1}function kp(v,I,_){for(var A=_+1;A--;)if(v[A]===I)return A;return A}function dr(v){return fr(v)?Hp(v):Op(v)}function at(v){return fr(v)?Vp(v):Rp(v)}function ba(v){for(var I=v.length;I--&&Al.test(v.charAt(I)););return I}var zp=Gs(mp);function Hp(v){for(var I=zs.lastIndex=0;zs.test(v);)++I;return I}function Vp(v){return v.match(zs)||[]}function Kp(v){return v.match(lp)||[]}var Bp=function v(I){I=I==null?Ie:gr.defaults(Ie.Object(),I,gr.pick(Ie,dp));var _=I.Array,A=I.Date,z=I.Error,X=I.Function,we=I.Math,ie=I.Object,en=I.RegExp,Wp=I.String,Ze=I.TypeError,$i=_.prototype,Jp=X.prototype,yr=ie.prototype,Ti=I["__core-js_shared__"],Ai=Jp.toString,re=yr.hasOwnProperty,Gp=0,Ea=function(){var e=/[^.]+$/.exec(Ti&&Ti.keys&&Ti.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),xi=yr.toString,Qp=Ai.call(ie),Yp=Ie._,Zp=en("^"+Ai.call(re).replace(js,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Di=na?I.Buffer:r,jt=I.Symbol,Fi=I.Uint8Array,Ia=Di?Di.allocUnsafe:r,ji=_a(ie.getPrototypeOf,ie),Pa=ie.create,Sa=yr.propertyIsEnumerable,qi=$i.splice,Oa=jt?jt.isConcatSpreadable:r,Hr=jt?jt.iterator:r,Wt=jt?jt.toStringTag:r,Ui=function(){try{var e=Zt(ie,"defineProperty");return e({},"",{}),e}catch{}}(),Xp=I.clearTimeout!==Ie.clearTimeout&&I.clearTimeout,ef=A&&A.now!==Ie.Date.now&&A.now,tf=I.setTimeout!==Ie.setTimeout&&I.setTimeout,Mi=we.ceil,Li=we.floor,tn=ie.getOwnPropertySymbols,rf=Di?Di.isBuffer:r,Ra=I.isFinite,sf=$i.join,nf=_a(ie.keys,ie),_e=we.max,Oe=we.min,of=A.now,af=I.parseInt,Na=we.random,cf=$i.reverse,rn=Zt(I,"DataView"),Vr=Zt(I,"Map"),sn=Zt(I,"Promise"),vr=Zt(I,"Set"),Kr=Zt(I,"WeakMap"),Br=Zt(ie,"create"),ki=Kr&&new Kr,mr={},uf=Xt(rn),hf=Xt(Vr),lf=Xt(sn),pf=Xt(vr),ff=Xt(Kr),zi=jt?jt.prototype:r,Wr=zi?zi.valueOf:r,Ca=zi?zi.toString:r;function p(e){if(pe(e)&&!H(e)&&!(e instanceof G)){if(e instanceof Xe)return e;if(re.call(e,"__wrapped__"))return $c(e)}return new Xe(e)}var wr=function(){function e(){}return function(i){if(!le(i))return{};if(Pa)return Pa(i);e.prototype=i;var n=new e;return e.prototype=r,n}}();function Hi(){}function Xe(e,i){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!i,this.__index__=0,this.__values__=r}p.templateSettings={escape:Ol,evaluate:Rl,interpolate:Uo,variable:"",imports:{_:p}},p.prototype=Hi.prototype,p.prototype.constructor=p,Xe.prototype=wr(Hi.prototype),Xe.prototype.constructor=Xe;function G(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=ft,this.__views__=[]}function df(){var e=new G(this.__wrapped__);return e.__actions__=je(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=je(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=je(this.__views__),e}function gf(){if(this.__filtered__){var e=new G(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function yf(){var e=this.__wrapped__.value(),i=this.__dir__,n=H(e),c=i<0,h=n?e.length:0,f=Nd(0,h,this.__views__),d=f.start,y=f.end,m=y-d,P=c?y:d-1,S=this.__iteratees__,R=S.length,T=0,F=Oe(m,this.__takeCount__);if(!n||!c&&h==m&&F==m)return Xa(e,this.__actions__);var L=[];e:for(;m--&&T<F;){P+=i;for(var K=-1,k=e[P];++K<R;){var J=S[K],Y=J.iteratee,We=J.type,Ae=Y(k);if(We==ul)k=Ae;else if(!Ae){if(We==xo)continue e;break e}}L[T++]=k}return L}G.prototype=wr(Hi.prototype),G.prototype.constructor=G;function Jt(e){var i=-1,n=e==null?0:e.length;for(this.clear();++i<n;){var c=e[i];this.set(c[0],c[1])}}function vf(){this.__data__=Br?Br(null):{},this.size=0}function mf(e){var i=this.has(e)&&delete this.__data__[e];return this.size-=i?1:0,i}function wf(e){var i=this.__data__;if(Br){var n=i[e];return n===w?r:n}return re.call(i,e)?i[e]:r}function _f(e){var i=this.__data__;return Br?i[e]!==r:re.call(i,e)}function bf(e,i){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=Br&&i===r?w:i,this}Jt.prototype.clear=vf,Jt.prototype.delete=mf,Jt.prototype.get=wf,Jt.prototype.has=_f,Jt.prototype.set=bf;function wt(e){var i=-1,n=e==null?0:e.length;for(this.clear();++i<n;){var c=e[i];this.set(c[0],c[1])}}function Ef(){this.__data__=[],this.size=0}function If(e){var i=this.__data__,n=Vi(i,e);if(n<0)return!1;var c=i.length-1;return n==c?i.pop():qi.call(i,n,1),--this.size,!0}function Pf(e){var i=this.__data__,n=Vi(i,e);return n<0?r:i[n][1]}function Sf(e){return Vi(this.__data__,e)>-1}function Of(e,i){var n=this.__data__,c=Vi(n,e);return c<0?(++this.size,n.push([e,i])):n[c][1]=i,this}wt.prototype.clear=Ef,wt.prototype.delete=If,wt.prototype.get=Pf,wt.prototype.has=Sf,wt.prototype.set=Of;function _t(e){var i=-1,n=e==null?0:e.length;for(this.clear();++i<n;){var c=e[i];this.set(c[0],c[1])}}function Rf(){this.size=0,this.__data__={hash:new Jt,map:new(Vr||wt),string:new Jt}}function Nf(e){var i=rs(this,e).delete(e);return this.size-=i?1:0,i}function Cf(e){return rs(this,e).get(e)}function $f(e){return rs(this,e).has(e)}function Tf(e,i){var n=rs(this,e),c=n.size;return n.set(e,i),this.size+=n.size==c?0:1,this}_t.prototype.clear=Rf,_t.prototype.delete=Nf,_t.prototype.get=Cf,_t.prototype.has=$f,_t.prototype.set=Tf;function Gt(e){var i=-1,n=e==null?0:e.length;for(this.__data__=new _t;++i<n;)this.add(e[i])}function Af(e){return this.__data__.set(e,w),this}function xf(e){return this.__data__.has(e)}Gt.prototype.add=Gt.prototype.push=Af,Gt.prototype.has=xf;function ct(e){var i=this.__data__=new wt(e);this.size=i.size}function Df(){this.__data__=new wt,this.size=0}function Ff(e){var i=this.__data__,n=i.delete(e);return this.size=i.size,n}function jf(e){return this.__data__.get(e)}function qf(e){return this.__data__.has(e)}function Uf(e,i){var n=this.__data__;if(n instanceof wt){var c=n.__data__;if(!Vr||c.length<o-1)return c.push([e,i]),this.size=++n.size,this;n=this.__data__=new _t(c)}return n.set(e,i),this.size=n.size,this}ct.prototype.clear=Df,ct.prototype.delete=Ff,ct.prototype.get=jf,ct.prototype.has=qf,ct.prototype.set=Uf;function $a(e,i){var n=H(e),c=!n&&er(e),h=!n&&!c&&kt(e),f=!n&&!c&&!h&&Ir(e),d=n||c||h||f,y=d?Ys(e.length,Wp):[],m=y.length;for(var P in e)(i||re.call(e,P))&&!(d&&(P=="length"||h&&(P=="offset"||P=="parent")||f&&(P=="buffer"||P=="byteLength"||P=="byteOffset")||Pt(P,m)))&&y.push(P);return y}function Ta(e){var i=e.length;return i?e[gn(0,i-1)]:r}function Mf(e,i){return is(je(e),Qt(i,0,e.length))}function Lf(e){return is(je(e))}function nn(e,i,n){(n!==r&&!ut(e[i],n)||n===r&&!(i in e))&&bt(e,i,n)}function Jr(e,i,n){var c=e[i];(!(re.call(e,i)&&ut(c,n))||n===r&&!(i in e))&&bt(e,i,n)}function Vi(e,i){for(var n=e.length;n--;)if(ut(e[n][0],i))return n;return-1}function kf(e,i,n,c){return qt(e,function(h,f,d){i(c,h,n(h),d)}),c}function Aa(e,i){return e&&gt(i,be(i),e)}function zf(e,i){return e&&gt(i,Ue(i),e)}function bt(e,i,n){i=="__proto__"&&Ui?Ui(e,i,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[i]=n}function on(e,i){for(var n=-1,c=i.length,h=_(c),f=e==null;++n<c;)h[n]=f?r:Ln(e,i[n]);return h}function Qt(e,i,n){return e===e&&(n!==r&&(e=e<=n?e:n),i!==r&&(e=e>=i?e:i)),e}function et(e,i,n,c,h,f){var d,y=i&O,m=i&N,P=i&q;if(n&&(d=h?n(e,c,h,f):n(e)),d!==r)return d;if(!le(e))return e;var S=H(e);if(S){if(d=$d(e),!y)return je(e,d)}else{var R=Re(e),T=R==Ei||R==Do;if(kt(e))return rc(e,y);if(R==mt||R==ur||T&&!h){if(d=m||T?{}:bc(e),!y)return m?wd(e,zf(d,e)):md(e,Aa(d,e))}else{if(!se[R])return h?e:{};d=Td(e,R,y)}}f||(f=new ct);var F=f.get(e);if(F)return F;f.set(e,d),Qc(e)?e.forEach(function(k){d.add(et(k,i,n,k,e,f))}):Jc(e)&&e.forEach(function(k,J){d.set(J,et(k,i,n,J,e,f))});var L=P?m?On:Sn:m?Ue:be,K=S?r:L(e);return Ye(K||e,function(k,J){K&&(J=k,k=e[J]),Jr(d,J,et(k,i,n,J,e,f))}),d}function Hf(e){var i=be(e);return function(n){return xa(n,e,i)}}function xa(e,i,n){var c=n.length;if(e==null)return!c;for(e=ie(e);c--;){var h=n[c],f=i[h],d=e[h];if(d===r&&!(h in e)||!f(d))return!1}return!0}function Da(e,i,n){if(typeof e!="function")throw new Ze(l);return ti(function(){e.apply(r,n)},i)}function Gr(e,i,n,c){var h=-1,f=Ri,d=!0,y=e.length,m=[],P=i.length;if(!y)return m;n&&(i=ce(i,Ve(n))),c?(f=Ks,d=!1):i.length>=o&&(f=zr,d=!1,i=new Gt(i));e:for(;++h<y;){var S=e[h],R=n==null?S:n(S);if(S=c||S!==0?S:0,d&&R===R){for(var T=P;T--;)if(i[T]===R)continue e;m.push(S)}else f(i,R,c)||m.push(S)}return m}var qt=ac(dt),Fa=ac(cn,!0);function Vf(e,i){var n=!0;return qt(e,function(c,h,f){return n=!!i(c,h,f),n}),n}function Ki(e,i,n){for(var c=-1,h=e.length;++c<h;){var f=e[c],d=i(f);if(d!=null&&(y===r?d===d&&!Be(d):n(d,y)))var y=d,m=f}return m}function Kf(e,i,n,c){var h=e.length;for(n=V(n),n<0&&(n=-n>h?0:h+n),c=c===r||c>h?h:V(c),c<0&&(c+=h),c=n>c?0:Zc(c);n<c;)e[n++]=i;return e}function ja(e,i){var n=[];return qt(e,function(c,h,f){i(c,h,f)&&n.push(c)}),n}function Pe(e,i,n,c,h){var f=-1,d=e.length;for(n||(n=xd),h||(h=[]);++f<d;){var y=e[f];i>0&&n(y)?i>1?Pe(y,i-1,n,c,h):Dt(h,y):c||(h[h.length]=y)}return h}var an=cc(),qa=cc(!0);function dt(e,i){return e&&an(e,i,be)}function cn(e,i){return e&&qa(e,i,be)}function Bi(e,i){return xt(i,function(n){return St(e[n])})}function Yt(e,i){i=Mt(i,e);for(var n=0,c=i.length;e!=null&&n<c;)e=e[yt(i[n++])];return n&&n==c?e:r}function Ua(e,i,n){var c=i(e);return H(e)?c:Dt(c,n(e))}function $e(e){return e==null?e===r?wl:vl:Wt&&Wt in ie(e)?Rd(e):Ld(e)}function un(e,i){return e>i}function Bf(e,i){return e!=null&&re.call(e,i)}function Wf(e,i){return e!=null&&i in ie(e)}function Jf(e,i,n){return e>=Oe(i,n)&&e<_e(i,n)}function hn(e,i,n){for(var c=n?Ks:Ri,h=e[0].length,f=e.length,d=f,y=_(f),m=1/0,P=[];d--;){var S=e[d];d&&i&&(S=ce(S,Ve(i))),m=Oe(S.length,m),y[d]=!n&&(i||h>=120&&S.length>=120)?new Gt(d&&S):r}S=e[0];var R=-1,T=y[0];e:for(;++R<h&&P.length<m;){var F=S[R],L=i?i(F):F;if(F=n||F!==0?F:0,!(T?zr(T,L):c(P,L,n))){for(d=f;--d;){var K=y[d];if(!(K?zr(K,L):c(e[d],L,n)))continue e}T&&T.push(L),P.push(F)}}return P}function Gf(e,i,n,c){return dt(e,function(h,f,d){i(c,n(h),f,d)}),c}function Qr(e,i,n){i=Mt(i,e),e=Sc(e,i);var c=e==null?e:e[yt(rt(i))];return c==null?r:He(c,e,n)}function Ma(e){return pe(e)&&$e(e)==ur}function Qf(e){return pe(e)&&$e(e)==kr}function Yf(e){return pe(e)&&$e(e)==jr}function Yr(e,i,n,c,h){return e===i?!0:e==null||i==null||!pe(e)&&!pe(i)?e!==e&&i!==i:Zf(e,i,n,c,Yr,h)}function Zf(e,i,n,c,h,f){var d=H(e),y=H(i),m=d?_i:Re(e),P=y?_i:Re(i);m=m==ur?mt:m,P=P==ur?mt:P;var S=m==mt,R=P==mt,T=m==P;if(T&&kt(e)){if(!kt(i))return!1;d=!0,S=!1}if(T&&!S)return f||(f=new ct),d||Ir(e)?mc(e,i,n,c,h,f):Sd(e,i,m,n,c,h,f);if(!(n&x)){var F=S&&re.call(e,"__wrapped__"),L=R&&re.call(i,"__wrapped__");if(F||L){var K=F?e.value():e,k=L?i.value():i;return f||(f=new ct),h(K,k,n,c,f)}}return T?(f||(f=new ct),Od(e,i,n,c,h,f)):!1}function Xf(e){return pe(e)&&Re(e)==nt}function ln(e,i,n,c){var h=n.length,f=h,d=!c;if(e==null)return!f;for(e=ie(e);h--;){var y=n[h];if(d&&y[2]?y[1]!==e[y[0]]:!(y[0]in e))return!1}for(;++h<f;){y=n[h];var m=y[0],P=e[m],S=y[1];if(d&&y[2]){if(P===r&&!(m in e))return!1}else{var R=new ct;if(c)var T=c(P,S,m,e,i,R);if(!(T===r?Yr(S,P,x|B,c,R):T))return!1}}return!0}function La(e){if(!le(e)||Fd(e))return!1;var i=St(e)?Zp:zl;return i.test(Xt(e))}function ed(e){return pe(e)&&$e(e)==Ur}function td(e){return pe(e)&&Re(e)==ot}function rd(e){return pe(e)&&us(e.length)&&!!ae[$e(e)]}function ka(e){return typeof e=="function"?e:e==null?Me:typeof e=="object"?H(e)?Va(e[0],e[1]):Ha(e):uu(e)}function pn(e){if(!ei(e))return nf(e);var i=[];for(var n in ie(e))re.call(e,n)&&n!="constructor"&&i.push(n);return i}function id(e){if(!le(e))return Md(e);var i=ei(e),n=[];for(var c in e)c=="constructor"&&(i||!re.call(e,c))||n.push(c);return n}function fn(e,i){return e<i}function za(e,i){var n=-1,c=qe(e)?_(e.length):[];return qt(e,function(h,f,d){c[++n]=i(h,f,d)}),c}function Ha(e){var i=Nn(e);return i.length==1&&i[0][2]?Ic(i[0][0],i[0][1]):function(n){return n===e||ln(n,e,i)}}function Va(e,i){return $n(e)&&Ec(i)?Ic(yt(e),i):function(n){var c=Ln(n,e);return c===r&&c===i?kn(n,e):Yr(i,c,x|B)}}function Wi(e,i,n,c,h){e!==i&&an(i,function(f,d){if(h||(h=new ct),le(f))sd(e,i,d,n,Wi,c,h);else{var y=c?c(An(e,d),f,d+"",e,i,h):r;y===r&&(y=f),nn(e,d,y)}},Ue)}function sd(e,i,n,c,h,f,d){var y=An(e,n),m=An(i,n),P=d.get(m);if(P){nn(e,n,P);return}var S=f?f(y,m,n+"",e,i,d):r,R=S===r;if(R){var T=H(m),F=!T&&kt(m),L=!T&&!F&&Ir(m);S=m,T||F||L?H(y)?S=y:ge(y)?S=je(y):F?(R=!1,S=rc(m,!0)):L?(R=!1,S=ic(m,!0)):S=[]:ri(m)||er(m)?(S=y,er(y)?S=Xc(y):(!le(y)||St(y))&&(S=bc(m))):R=!1}R&&(d.set(m,S),h(S,m,c,f,d),d.delete(m)),nn(e,n,S)}function Ka(e,i){var n=e.length;if(n)return i+=i<0?n:0,Pt(i,n)?e[i]:r}function Ba(e,i,n){i.length?i=ce(i,function(f){return H(f)?function(d){return Yt(d,f.length===1?f[0]:f)}:f}):i=[Me];var c=-1;i=ce(i,Ve(M()));var h=za(e,function(f,d,y){var m=ce(i,function(P){return P(f)});return{criteria:m,index:++c,value:f}});return $p(h,function(f,d){return vd(f,d,n)})}function nd(e,i){return Wa(e,i,function(n,c){return kn(e,c)})}function Wa(e,i,n){for(var c=-1,h=i.length,f={};++c<h;){var d=i[c],y=Yt(e,d);n(y,d)&&Zr(f,Mt(d,e),y)}return f}function od(e){return function(i){return Yt(i,e)}}function dn(e,i,n,c){var h=c?Cp:pr,f=-1,d=i.length,y=e;for(e===i&&(i=je(i)),n&&(y=ce(e,Ve(n)));++f<d;)for(var m=0,P=i[f],S=n?n(P):P;(m=h(y,S,m,c))>-1;)y!==e&&qi.call(y,m,1),qi.call(e,m,1);return e}function Ja(e,i){for(var n=e?i.length:0,c=n-1;n--;){var h=i[n];if(n==c||h!==f){var f=h;Pt(h)?qi.call(e,h,1):mn(e,h)}}return e}function gn(e,i){return e+Li(Na()*(i-e+1))}function ad(e,i,n,c){for(var h=-1,f=_e(Mi((i-e)/(n||1)),0),d=_(f);f--;)d[c?f:++h]=e,e+=n;return d}function yn(e,i){var n="";if(!e||i<1||i>cr)return n;do i%2&&(n+=e),i=Li(i/2),i&&(e+=e);while(i);return n}function W(e,i){return xn(Pc(e,i,Me),e+"")}function cd(e){return Ta(Pr(e))}function ud(e,i){var n=Pr(e);return is(n,Qt(i,0,n.length))}function Zr(e,i,n,c){if(!le(e))return e;i=Mt(i,e);for(var h=-1,f=i.length,d=f-1,y=e;y!=null&&++h<f;){var m=yt(i[h]),P=n;if(m==="__proto__"||m==="constructor"||m==="prototype")return e;if(h!=d){var S=y[m];P=c?c(S,m,y):r,P===r&&(P=le(S)?S:Pt(i[h+1])?[]:{})}Jr(y,m,P),y=y[m]}return e}var Ga=ki?function(e,i){return ki.set(e,i),e}:Me,hd=Ui?function(e,i){return Ui(e,"toString",{configurable:!0,enumerable:!1,value:Hn(i),writable:!0})}:Me;function ld(e){return is(Pr(e))}function tt(e,i,n){var c=-1,h=e.length;i<0&&(i=-i>h?0:h+i),n=n>h?h:n,n<0&&(n+=h),h=i>n?0:n-i>>>0,i>>>=0;for(var f=_(h);++c<h;)f[c]=e[c+i];return f}function pd(e,i){var n;return qt(e,function(c,h,f){return n=i(c,h,f),!n}),!!n}function Ji(e,i,n){var c=0,h=e==null?c:e.length;if(typeof i=="number"&&i===i&&h<=fl){for(;c<h;){var f=c+h>>>1,d=e[f];d!==null&&!Be(d)&&(n?d<=i:d<i)?c=f+1:h=f}return h}return vn(e,i,Me,n)}function vn(e,i,n,c){var h=0,f=e==null?0:e.length;if(f===0)return 0;i=n(i);for(var d=i!==i,y=i===null,m=Be(i),P=i===r;h<f;){var S=Li((h+f)/2),R=n(e[S]),T=R!==r,F=R===null,L=R===R,K=Be(R);if(d)var k=c||L;else P?k=L&&(c||T):y?k=L&&T&&(c||!F):m?k=L&&T&&!F&&(c||!K):F||K?k=!1:k=c?R<=i:R<i;k?h=S+1:f=S}return Oe(f,pl)}function Qa(e,i){for(var n=-1,c=e.length,h=0,f=[];++n<c;){var d=e[n],y=i?i(d):d;if(!n||!ut(y,m)){var m=y;f[h++]=d===0?0:d}}return f}function Ya(e){return typeof e=="number"?e:Be(e)?wi:+e}function Ke(e){if(typeof e=="string")return e;if(H(e))return ce(e,Ke)+"";if(Be(e))return Ca?Ca.call(e):"";var i=e+"";return i=="0"&&1/e==-1/0?"-0":i}function Ut(e,i,n){var c=-1,h=Ri,f=e.length,d=!0,y=[],m=y;if(n)d=!1,h=Ks;else if(f>=o){var P=i?null:Id(e);if(P)return Ci(P);d=!1,h=zr,m=new Gt}else m=i?[]:y;e:for(;++c<f;){var S=e[c],R=i?i(S):S;if(S=n||S!==0?S:0,d&&R===R){for(var T=m.length;T--;)if(m[T]===R)continue e;i&&m.push(R),y.push(S)}else h(m,R,n)||(m!==y&&m.push(R),y.push(S))}return y}function mn(e,i){return i=Mt(i,e),e=Sc(e,i),e==null||delete e[yt(rt(i))]}function Za(e,i,n,c){return Zr(e,i,n(Yt(e,i)),c)}function Gi(e,i,n,c){for(var h=e.length,f=c?h:-1;(c?f--:++f<h)&&i(e[f],f,e););return n?tt(e,c?0:f,c?f+1:h):tt(e,c?f+1:0,c?h:f)}function Xa(e,i){var n=e;return n instanceof G&&(n=n.value()),Bs(i,function(c,h){return h.func.apply(h.thisArg,Dt([c],h.args))},n)}function wn(e,i,n){var c=e.length;if(c<2)return c?Ut(e[0]):[];for(var h=-1,f=_(c);++h<c;)for(var d=e[h],y=-1;++y<c;)y!=h&&(f[h]=Gr(f[h]||d,e[y],i,n));return Ut(Pe(f,1),i,n)}function ec(e,i,n){for(var c=-1,h=e.length,f=i.length,d={};++c<h;){var y=c<f?i[c]:r;n(d,e[c],y)}return d}function _n(e){return ge(e)?e:[]}function bn(e){return typeof e=="function"?e:Me}function Mt(e,i){return H(e)?e:$n(e,i)?[e]:Cc(te(e))}var fd=W;function Lt(e,i,n){var c=e.length;return n=n===r?c:n,!i&&n>=c?e:tt(e,i,n)}var tc=Xp||function(e){return Ie.clearTimeout(e)};function rc(e,i){if(i)return e.slice();var n=e.length,c=Ia?Ia(n):new e.constructor(n);return e.copy(c),c}function En(e){var i=new e.constructor(e.byteLength);return new Fi(i).set(new Fi(e)),i}function dd(e,i){var n=i?En(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}function gd(e){var i=new e.constructor(e.source,Mo.exec(e));return i.lastIndex=e.lastIndex,i}function yd(e){return Wr?ie(Wr.call(e)):{}}function ic(e,i){var n=i?En(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}function sc(e,i){if(e!==i){var n=e!==r,c=e===null,h=e===e,f=Be(e),d=i!==r,y=i===null,m=i===i,P=Be(i);if(!y&&!P&&!f&&e>i||f&&d&&m&&!y&&!P||c&&d&&m||!n&&m||!h)return 1;if(!c&&!f&&!P&&e<i||P&&n&&h&&!c&&!f||y&&n&&h||!d&&h||!m)return-1}return 0}function vd(e,i,n){for(var c=-1,h=e.criteria,f=i.criteria,d=h.length,y=n.length;++c<d;){var m=sc(h[c],f[c]);if(m){if(c>=y)return m;var P=n[c];return m*(P=="desc"?-1:1)}}return e.index-i.index}function nc(e,i,n,c){for(var h=-1,f=e.length,d=n.length,y=-1,m=i.length,P=_e(f-d,0),S=_(m+P),R=!c;++y<m;)S[y]=i[y];for(;++h<d;)(R||h<f)&&(S[n[h]]=e[h]);for(;P--;)S[y++]=e[h++];return S}function oc(e,i,n,c){for(var h=-1,f=e.length,d=-1,y=n.length,m=-1,P=i.length,S=_e(f-y,0),R=_(S+P),T=!c;++h<S;)R[h]=e[h];for(var F=h;++m<P;)R[F+m]=i[m];for(;++d<y;)(T||h<f)&&(R[F+n[d]]=e[h++]);return R}function je(e,i){var n=-1,c=e.length;for(i||(i=_(c));++n<c;)i[n]=e[n];return i}function gt(e,i,n,c){var h=!n;n||(n={});for(var f=-1,d=i.length;++f<d;){var y=i[f],m=c?c(n[y],e[y],y,n,e):r;m===r&&(m=e[y]),h?bt(n,y,m):Jr(n,y,m)}return n}function md(e,i){return gt(e,Cn(e),i)}function wd(e,i){return gt(e,wc(e),i)}function Qi(e,i){return function(n,c){var h=H(n)?Ip:kf,f=i?i():{};return h(n,e,M(c,2),f)}}function _r(e){return W(function(i,n){var c=-1,h=n.length,f=h>1?n[h-1]:r,d=h>2?n[2]:r;for(f=e.length>3&&typeof f=="function"?(h--,f):r,d&&Te(n[0],n[1],d)&&(f=h<3?r:f,h=1),i=ie(i);++c<h;){var y=n[c];y&&e(i,y,c,f)}return i})}function ac(e,i){return function(n,c){if(n==null)return n;if(!qe(n))return e(n,c);for(var h=n.length,f=i?h:-1,d=ie(n);(i?f--:++f<h)&&c(d[f],f,d)!==!1;);return n}}function cc(e){return function(i,n,c){for(var h=-1,f=ie(i),d=c(i),y=d.length;y--;){var m=d[e?y:++h];if(n(f[m],m,f)===!1)break}return i}}function _d(e,i,n){var c=i&D,h=Xr(e);function f(){var d=this&&this!==Ie&&this instanceof f?h:e;return d.apply(c?n:this,arguments)}return f}function uc(e){return function(i){i=te(i);var n=fr(i)?at(i):r,c=n?n[0]:i.charAt(0),h=n?Lt(n,1).join(""):i.slice(1);return c[e]()+h}}function br(e){return function(i){return Bs(au(ou(i).replace(up,"")),e,"")}}function Xr(e){return function(){var i=arguments;switch(i.length){case 0:return new e;case 1:return new e(i[0]);case 2:return new e(i[0],i[1]);case 3:return new e(i[0],i[1],i[2]);case 4:return new e(i[0],i[1],i[2],i[3]);case 5:return new e(i[0],i[1],i[2],i[3],i[4]);case 6:return new e(i[0],i[1],i[2],i[3],i[4],i[5]);case 7:return new e(i[0],i[1],i[2],i[3],i[4],i[5],i[6])}var n=wr(e.prototype),c=e.apply(n,i);return le(c)?c:n}}function bd(e,i,n){var c=Xr(e);function h(){for(var f=arguments.length,d=_(f),y=f,m=Er(h);y--;)d[y]=arguments[y];var P=f<3&&d[0]!==m&&d[f-1]!==m?[]:Ft(d,m);if(f-=P.length,f<n)return dc(e,i,Yi,h.placeholder,r,d,P,r,r,n-f);var S=this&&this!==Ie&&this instanceof h?c:e;return He(S,this,d)}return h}function hc(e){return function(i,n,c){var h=ie(i);if(!qe(i)){var f=M(n,3);i=be(i),n=function(y){return f(h[y],y,h)}}var d=e(i,n,c);return d>-1?h[f?i[d]:d]:r}}function lc(e){return It(function(i){var n=i.length,c=n,h=Xe.prototype.thru;for(e&&i.reverse();c--;){var f=i[c];if(typeof f!="function")throw new Ze(l);if(h&&!d&&ts(f)=="wrapper")var d=new Xe([],!0)}for(c=d?c:n;++c<n;){f=i[c];var y=ts(f),m=y=="wrapper"?Rn(f):r;m&&Tn(m[0])&&m[1]==(de|Z|he|Ce)&&!m[4].length&&m[9]==1?d=d[ts(m[0])].apply(d,m[3]):d=f.length==1&&Tn(f)?d[y]():d.thru(f)}return function(){var P=arguments,S=P[0];if(d&&P.length==1&&H(S))return d.plant(S).value();for(var R=0,T=n?i[R].apply(this,P):S;++R<n;)T=i[R].call(this,T);return T}})}function Yi(e,i,n,c,h,f,d,y,m,P){var S=i&de,R=i&D,T=i&Q,F=i&(Z|ee),L=i&At,K=T?r:Xr(e);function k(){for(var J=arguments.length,Y=_(J),We=J;We--;)Y[We]=arguments[We];if(F)var Ae=Er(k),Je=Ap(Y,Ae);if(c&&(Y=nc(Y,c,h,F)),f&&(Y=oc(Y,f,d,F)),J-=Je,F&&J<P){var ye=Ft(Y,Ae);return dc(e,i,Yi,k.placeholder,n,Y,ye,y,m,P-J)}var ht=R?n:this,Rt=T?ht[e]:e;return J=Y.length,y?Y=kd(Y,y):L&&J>1&&Y.reverse(),S&&m<J&&(Y.length=m),this&&this!==Ie&&this instanceof k&&(Rt=K||Xr(Rt)),Rt.apply(ht,Y)}return k}function pc(e,i){return function(n,c){return Gf(n,e,i(c),{})}}function Zi(e,i){return function(n,c){var h;if(n===r&&c===r)return i;if(n!==r&&(h=n),c!==r){if(h===r)return c;typeof n=="string"||typeof c=="string"?(n=Ke(n),c=Ke(c)):(n=Ya(n),c=Ya(c)),h=e(n,c)}return h}}function In(e){return It(function(i){return i=ce(i,Ve(M())),W(function(n){var c=this;return e(i,function(h){return He(h,c,n)})})})}function Xi(e,i){i=i===r?" ":Ke(i);var n=i.length;if(n<2)return n?yn(i,e):i;var c=yn(i,Mi(e/dr(i)));return fr(i)?Lt(at(c),0,e).join(""):c.slice(0,e)}function Ed(e,i,n,c){var h=i&D,f=Xr(e);function d(){for(var y=-1,m=arguments.length,P=-1,S=c.length,R=_(S+m),T=this&&this!==Ie&&this instanceof d?f:e;++P<S;)R[P]=c[P];for(;m--;)R[P++]=arguments[++y];return He(T,h?n:this,R)}return d}function fc(e){return function(i,n,c){return c&&typeof c!="number"&&Te(i,n,c)&&(n=c=r),i=Ot(i),n===r?(n=i,i=0):n=Ot(n),c=c===r?i<n?1:-1:Ot(c),ad(i,n,c,e)}}function es(e){return function(i,n){return typeof i=="string"&&typeof n=="string"||(i=it(i),n=it(n)),e(i,n)}}function dc(e,i,n,c,h,f,d,y,m,P){var S=i&Z,R=S?d:r,T=S?r:d,F=S?f:r,L=S?r:f;i|=S?he:Fe,i&=~(S?Fe:he),i&fe||(i&=-4);var K=[e,i,h,F,R,L,T,y,m,P],k=n.apply(r,K);return Tn(e)&&Oc(k,K),k.placeholder=c,Rc(k,e,i)}function Pn(e){var i=we[e];return function(n,c){if(n=it(n),c=c==null?0:Oe(V(c),292),c&&Ra(n)){var h=(te(n)+"e").split("e"),f=i(h[0]+"e"+(+h[1]+c));return h=(te(f)+"e").split("e"),+(h[0]+"e"+(+h[1]-c))}return i(n)}}var Id=vr&&1/Ci(new vr([,-0]))[1]==mi?function(e){return new vr(e)}:Bn;function gc(e){return function(i){var n=Re(i);return n==nt?Xs(i):n==ot?Mp(i):Tp(i,e(i))}}function Et(e,i,n,c,h,f,d,y){var m=i&Q;if(!m&&typeof e!="function")throw new Ze(l);var P=c?c.length:0;if(P||(i&=-97,c=h=r),d=d===r?d:_e(V(d),0),y=y===r?y:V(y),P-=h?h.length:0,i&Fe){var S=c,R=h;c=h=r}var T=m?r:Rn(e),F=[e,i,n,c,h,S,R,f,d,y];if(T&&Ud(F,T),e=F[0],i=F[1],n=F[2],c=F[3],h=F[4],y=F[9]=F[9]===r?m?0:e.length:_e(F[9]-P,0),!y&&i&(Z|ee)&&(i&=-25),!i||i==D)var L=_d(e,i,n);else i==Z||i==ee?L=bd(e,i,y):(i==he||i==(D|he))&&!h.length?L=Ed(e,i,n,c):L=Yi.apply(r,F);var K=T?Ga:Oc;return Rc(K(L,F),e,i)}function yc(e,i,n,c){return e===r||ut(e,yr[n])&&!re.call(c,n)?i:e}function vc(e,i,n,c,h,f){return le(e)&&le(i)&&(f.set(i,e),Wi(e,i,r,vc,f),f.delete(i)),e}function Pd(e){return ri(e)?r:e}function mc(e,i,n,c,h,f){var d=n&x,y=e.length,m=i.length;if(y!=m&&!(d&&m>y))return!1;var P=f.get(e),S=f.get(i);if(P&&S)return P==i&&S==e;var R=-1,T=!0,F=n&B?new Gt:r;for(f.set(e,i),f.set(i,e);++R<y;){var L=e[R],K=i[R];if(c)var k=d?c(K,L,R,i,e,f):c(L,K,R,e,i,f);if(k!==r){if(k)continue;T=!1;break}if(F){if(!Ws(i,function(J,Y){if(!zr(F,Y)&&(L===J||h(L,J,n,c,f)))return F.push(Y)})){T=!1;break}}else if(!(L===K||h(L,K,n,c,f))){T=!1;break}}return f.delete(e),f.delete(i),T}function Sd(e,i,n,c,h,f,d){switch(n){case hr:if(e.byteLength!=i.byteLength||e.byteOffset!=i.byteOffset)return!1;e=e.buffer,i=i.buffer;case kr:return!(e.byteLength!=i.byteLength||!f(new Fi(e),new Fi(i)));case Fr:case jr:case qr:return ut(+e,+i);case bi:return e.name==i.name&&e.message==i.message;case Ur:case Mr:return e==i+"";case nt:var y=Xs;case ot:var m=c&x;if(y||(y=Ci),e.size!=i.size&&!m)return!1;var P=d.get(e);if(P)return P==i;c|=B,d.set(e,i);var S=mc(y(e),y(i),c,h,f,d);return d.delete(e),S;case Ii:if(Wr)return Wr.call(e)==Wr.call(i)}return!1}function Od(e,i,n,c,h,f){var d=n&x,y=Sn(e),m=y.length,P=Sn(i),S=P.length;if(m!=S&&!d)return!1;for(var R=m;R--;){var T=y[R];if(!(d?T in i:re.call(i,T)))return!1}var F=f.get(e),L=f.get(i);if(F&&L)return F==i&&L==e;var K=!0;f.set(e,i),f.set(i,e);for(var k=d;++R<m;){T=y[R];var J=e[T],Y=i[T];if(c)var We=d?c(Y,J,T,i,e,f):c(J,Y,T,e,i,f);if(!(We===r?J===Y||h(J,Y,n,c,f):We)){K=!1;break}k||(k=T=="constructor")}if(K&&!k){var Ae=e.constructor,Je=i.constructor;Ae!=Je&&"constructor"in e&&"constructor"in i&&!(typeof Ae=="function"&&Ae instanceof Ae&&typeof Je=="function"&&Je instanceof Je)&&(K=!1)}return f.delete(e),f.delete(i),K}function It(e){return xn(Pc(e,r,xc),e+"")}function Sn(e){return Ua(e,be,Cn)}function On(e){return Ua(e,Ue,wc)}var Rn=ki?function(e){return ki.get(e)}:Bn;function ts(e){for(var i=e.name+"",n=mr[i],c=re.call(mr,i)?n.length:0;c--;){var h=n[c],f=h.func;if(f==null||f==e)return h.name}return i}function Er(e){var i=re.call(p,"placeholder")?p:e;return i.placeholder}function M(){var e=p.iteratee||Vn;return e=e===Vn?ka:e,arguments.length?e(arguments[0],arguments[1]):e}function rs(e,i){var n=e.__data__;return Dd(i)?n[typeof i=="string"?"string":"hash"]:n.map}function Nn(e){for(var i=be(e),n=i.length;n--;){var c=i[n],h=e[c];i[n]=[c,h,Ec(h)]}return i}function Zt(e,i){var n=jp(e,i);return La(n)?n:r}function Rd(e){var i=re.call(e,Wt),n=e[Wt];try{e[Wt]=r;var c=!0}catch{}var h=xi.call(e);return c&&(i?e[Wt]=n:delete e[Wt]),h}var Cn=tn?function(e){return e==null?[]:(e=ie(e),xt(tn(e),function(i){return Sa.call(e,i)}))}:Wn,wc=tn?function(e){for(var i=[];e;)Dt(i,Cn(e)),e=ji(e);return i}:Wn,Re=$e;(rn&&Re(new rn(new ArrayBuffer(1)))!=hr||Vr&&Re(new Vr)!=nt||sn&&Re(sn.resolve())!=Fo||vr&&Re(new vr)!=ot||Kr&&Re(new Kr)!=Lr)&&(Re=function(e){var i=$e(e),n=i==mt?e.constructor:r,c=n?Xt(n):"";if(c)switch(c){case uf:return hr;case hf:return nt;case lf:return Fo;case pf:return ot;case ff:return Lr}return i});function Nd(e,i,n){for(var c=-1,h=n.length;++c<h;){var f=n[c],d=f.size;switch(f.type){case"drop":e+=d;break;case"dropRight":i-=d;break;case"take":i=Oe(i,e+d);break;case"takeRight":e=_e(e,i-d);break}}return{start:e,end:i}}function Cd(e){var i=e.match(Dl);return i?i[1].split(Fl):[]}function _c(e,i,n){i=Mt(i,e);for(var c=-1,h=i.length,f=!1;++c<h;){var d=yt(i[c]);if(!(f=e!=null&&n(e,d)))break;e=e[d]}return f||++c!=h?f:(h=e==null?0:e.length,!!h&&us(h)&&Pt(d,h)&&(H(e)||er(e)))}function $d(e){var i=e.length,n=new e.constructor(i);return i&&typeof e[0]=="string"&&re.call(e,"index")&&(n.index=e.index,n.input=e.input),n}function bc(e){return typeof e.constructor=="function"&&!ei(e)?wr(ji(e)):{}}function Td(e,i,n){var c=e.constructor;switch(i){case kr:return En(e);case Fr:case jr:return new c(+e);case hr:return dd(e,n);case Rs:case Ns:case Cs:case $s:case Ts:case As:case xs:case Ds:case Fs:return ic(e,n);case nt:return new c;case qr:case Mr:return new c(e);case Ur:return gd(e);case ot:return new c;case Ii:return yd(e)}}function Ad(e,i){var n=i.length;if(!n)return e;var c=n-1;return i[c]=(n>1?"& ":"")+i[c],i=i.join(n>2?", ":" "),e.replace(xl,`{
/* [wrapped with `+i+`] */
`)}function xd(e){return H(e)||er(e)||!!(Oa&&e&&e[Oa])}function Pt(e,i){var n=typeof e;return i=i??cr,!!i&&(n=="number"||n!="symbol"&&Vl.test(e))&&e>-1&&e%1==0&&e<i}function Te(e,i,n){if(!le(n))return!1;var c=typeof i;return(c=="number"?qe(n)&&Pt(i,n.length):c=="string"&&i in n)?ut(n[i],e):!1}function $n(e,i){if(H(e))return!1;var n=typeof e;return n=="number"||n=="symbol"||n=="boolean"||e==null||Be(e)?!0:Cl.test(e)||!Nl.test(e)||i!=null&&e in ie(i)}function Dd(e){var i=typeof e;return i=="string"||i=="number"||i=="symbol"||i=="boolean"?e!=="__proto__":e===null}function Tn(e){var i=ts(e),n=p[i];if(typeof n!="function"||!(i in G.prototype))return!1;if(e===n)return!0;var c=Rn(n);return!!c&&e===c[0]}function Fd(e){return!!Ea&&Ea in e}var jd=Ti?St:Jn;function ei(e){var i=e&&e.constructor,n=typeof i=="function"&&i.prototype||yr;return e===n}function Ec(e){return e===e&&!le(e)}function Ic(e,i){return function(n){return n==null?!1:n[e]===i&&(i!==r||e in ie(n))}}function qd(e){var i=as(e,function(c){return n.size===b&&n.clear(),c}),n=i.cache;return i}function Ud(e,i){var n=e[1],c=i[1],h=n|c,f=h<(D|Q|de),d=c==de&&n==Z||c==de&&n==Ce&&e[7].length<=i[8]||c==(de|Ce)&&i[7].length<=i[8]&&n==Z;if(!(f||d))return e;c&D&&(e[2]=i[2],h|=n&D?0:fe);var y=i[3];if(y){var m=e[3];e[3]=m?nc(m,y,i[4]):y,e[4]=m?Ft(e[3],C):i[4]}return y=i[5],y&&(m=e[5],e[5]=m?oc(m,y,i[6]):y,e[6]=m?Ft(e[5],C):i[6]),y=i[7],y&&(e[7]=y),c&de&&(e[8]=e[8]==null?i[8]:Oe(e[8],i[8])),e[9]==null&&(e[9]=i[9]),e[0]=i[0],e[1]=h,e}function Md(e){var i=[];if(e!=null)for(var n in ie(e))i.push(n);return i}function Ld(e){return xi.call(e)}function Pc(e,i,n){return i=_e(i===r?e.length-1:i,0),function(){for(var c=arguments,h=-1,f=_e(c.length-i,0),d=_(f);++h<f;)d[h]=c[i+h];h=-1;for(var y=_(i+1);++h<i;)y[h]=c[h];return y[i]=n(d),He(e,this,y)}}function Sc(e,i){return i.length<2?e:Yt(e,tt(i,0,-1))}function kd(e,i){for(var n=e.length,c=Oe(i.length,n),h=je(e);c--;){var f=i[c];e[c]=Pt(f,n)?h[f]:r}return e}function An(e,i){if(!(i==="constructor"&&typeof e[i]=="function")&&i!="__proto__")return e[i]}var Oc=Nc(Ga),ti=tf||function(e,i){return Ie.setTimeout(e,i)},xn=Nc(hd);function Rc(e,i,n){var c=i+"";return xn(e,Ad(c,zd(Cd(c),n)))}function Nc(e){var i=0,n=0;return function(){var c=of(),h=cl-(c-n);if(n=c,h>0){if(++i>=al)return arguments[0]}else i=0;return e.apply(r,arguments)}}function is(e,i){var n=-1,c=e.length,h=c-1;for(i=i===r?c:i;++n<i;){var f=gn(n,h),d=e[f];e[f]=e[n],e[n]=d}return e.length=i,e}var Cc=qd(function(e){var i=[];return e.charCodeAt(0)===46&&i.push(""),e.replace($l,function(n,c,h,f){i.push(h?f.replace(Ul,"$1"):c||n)}),i});function yt(e){if(typeof e=="string"||Be(e))return e;var i=e+"";return i=="0"&&1/e==-1/0?"-0":i}function Xt(e){if(e!=null){try{return Ai.call(e)}catch{}try{return e+""}catch{}}return""}function zd(e,i){return Ye(dl,function(n){var c="_."+n[0];i&n[1]&&!Ri(e,c)&&e.push(c)}),e.sort()}function $c(e){if(e instanceof G)return e.clone();var i=new Xe(e.__wrapped__,e.__chain__);return i.__actions__=je(e.__actions__),i.__index__=e.__index__,i.__values__=e.__values__,i}function Hd(e,i,n){(n?Te(e,i,n):i===r)?i=1:i=_e(V(i),0);var c=e==null?0:e.length;if(!c||i<1)return[];for(var h=0,f=0,d=_(Mi(c/i));h<c;)d[f++]=tt(e,h,h+=i);return d}function Vd(e){for(var i=-1,n=e==null?0:e.length,c=0,h=[];++i<n;){var f=e[i];f&&(h[c++]=f)}return h}function Kd(){var e=arguments.length;if(!e)return[];for(var i=_(e-1),n=arguments[0],c=e;c--;)i[c-1]=arguments[c];return Dt(H(n)?je(n):[n],Pe(i,1))}var Bd=W(function(e,i){return ge(e)?Gr(e,Pe(i,1,ge,!0)):[]}),Wd=W(function(e,i){var n=rt(i);return ge(n)&&(n=r),ge(e)?Gr(e,Pe(i,1,ge,!0),M(n,2)):[]}),Jd=W(function(e,i){var n=rt(i);return ge(n)&&(n=r),ge(e)?Gr(e,Pe(i,1,ge,!0),r,n):[]});function Gd(e,i,n){var c=e==null?0:e.length;return c?(i=n||i===r?1:V(i),tt(e,i<0?0:i,c)):[]}function Qd(e,i,n){var c=e==null?0:e.length;return c?(i=n||i===r?1:V(i),i=c-i,tt(e,0,i<0?0:i)):[]}function Yd(e,i){return e&&e.length?Gi(e,M(i,3),!0,!0):[]}function Zd(e,i){return e&&e.length?Gi(e,M(i,3),!0):[]}function Xd(e,i,n,c){var h=e==null?0:e.length;return h?(n&&typeof n!="number"&&Te(e,i,n)&&(n=0,c=h),Kf(e,i,n,c)):[]}function Tc(e,i,n){var c=e==null?0:e.length;if(!c)return-1;var h=n==null?0:V(n);return h<0&&(h=_e(c+h,0)),Ni(e,M(i,3),h)}function Ac(e,i,n){var c=e==null?0:e.length;if(!c)return-1;var h=c-1;return n!==r&&(h=V(n),h=n<0?_e(c+h,0):Oe(h,c-1)),Ni(e,M(i,3),h,!0)}function xc(e){var i=e==null?0:e.length;return i?Pe(e,1):[]}function eg(e){var i=e==null?0:e.length;return i?Pe(e,mi):[]}function tg(e,i){var n=e==null?0:e.length;return n?(i=i===r?1:V(i),Pe(e,i)):[]}function rg(e){for(var i=-1,n=e==null?0:e.length,c={};++i<n;){var h=e[i];c[h[0]]=h[1]}return c}function Dc(e){return e&&e.length?e[0]:r}function ig(e,i,n){var c=e==null?0:e.length;if(!c)return-1;var h=n==null?0:V(n);return h<0&&(h=_e(c+h,0)),pr(e,i,h)}function sg(e){var i=e==null?0:e.length;return i?tt(e,0,-1):[]}var ng=W(function(e){var i=ce(e,_n);return i.length&&i[0]===e[0]?hn(i):[]}),og=W(function(e){var i=rt(e),n=ce(e,_n);return i===rt(n)?i=r:n.pop(),n.length&&n[0]===e[0]?hn(n,M(i,2)):[]}),ag=W(function(e){var i=rt(e),n=ce(e,_n);return i=typeof i=="function"?i:r,i&&n.pop(),n.length&&n[0]===e[0]?hn(n,r,i):[]});function cg(e,i){return e==null?"":sf.call(e,i)}function rt(e){var i=e==null?0:e.length;return i?e[i-1]:r}function ug(e,i,n){var c=e==null?0:e.length;if(!c)return-1;var h=c;return n!==r&&(h=V(n),h=h<0?_e(c+h,0):Oe(h,c-1)),i===i?kp(e,i,h):Ni(e,da,h,!0)}function hg(e,i){return e&&e.length?Ka(e,V(i)):r}var lg=W(Fc);function Fc(e,i){return e&&e.length&&i&&i.length?dn(e,i):e}function pg(e,i,n){return e&&e.length&&i&&i.length?dn(e,i,M(n,2)):e}function fg(e,i,n){return e&&e.length&&i&&i.length?dn(e,i,r,n):e}var dg=It(function(e,i){var n=e==null?0:e.length,c=on(e,i);return Ja(e,ce(i,function(h){return Pt(h,n)?+h:h}).sort(sc)),c});function gg(e,i){var n=[];if(!(e&&e.length))return n;var c=-1,h=[],f=e.length;for(i=M(i,3);++c<f;){var d=e[c];i(d,c,e)&&(n.push(d),h.push(c))}return Ja(e,h),n}function Dn(e){return e==null?e:cf.call(e)}function yg(e,i,n){var c=e==null?0:e.length;return c?(n&&typeof n!="number"&&Te(e,i,n)?(i=0,n=c):(i=i==null?0:V(i),n=n===r?c:V(n)),tt(e,i,n)):[]}function vg(e,i){return Ji(e,i)}function mg(e,i,n){return vn(e,i,M(n,2))}function wg(e,i){var n=e==null?0:e.length;if(n){var c=Ji(e,i);if(c<n&&ut(e[c],i))return c}return-1}function _g(e,i){return Ji(e,i,!0)}function bg(e,i,n){return vn(e,i,M(n,2),!0)}function Eg(e,i){var n=e==null?0:e.length;if(n){var c=Ji(e,i,!0)-1;if(ut(e[c],i))return c}return-1}function Ig(e){return e&&e.length?Qa(e):[]}function Pg(e,i){return e&&e.length?Qa(e,M(i,2)):[]}function Sg(e){var i=e==null?0:e.length;return i?tt(e,1,i):[]}function Og(e,i,n){return e&&e.length?(i=n||i===r?1:V(i),tt(e,0,i<0?0:i)):[]}function Rg(e,i,n){var c=e==null?0:e.length;return c?(i=n||i===r?1:V(i),i=c-i,tt(e,i<0?0:i,c)):[]}function Ng(e,i){return e&&e.length?Gi(e,M(i,3),!1,!0):[]}function Cg(e,i){return e&&e.length?Gi(e,M(i,3)):[]}var $g=W(function(e){return Ut(Pe(e,1,ge,!0))}),Tg=W(function(e){var i=rt(e);return ge(i)&&(i=r),Ut(Pe(e,1,ge,!0),M(i,2))}),Ag=W(function(e){var i=rt(e);return i=typeof i=="function"?i:r,Ut(Pe(e,1,ge,!0),r,i)});function xg(e){return e&&e.length?Ut(e):[]}function Dg(e,i){return e&&e.length?Ut(e,M(i,2)):[]}function Fg(e,i){return i=typeof i=="function"?i:r,e&&e.length?Ut(e,r,i):[]}function Fn(e){if(!(e&&e.length))return[];var i=0;return e=xt(e,function(n){if(ge(n))return i=_e(n.length,i),!0}),Ys(i,function(n){return ce(e,Js(n))})}function jc(e,i){if(!(e&&e.length))return[];var n=Fn(e);return i==null?n:ce(n,function(c){return He(i,r,c)})}var jg=W(function(e,i){return ge(e)?Gr(e,i):[]}),qg=W(function(e){return wn(xt(e,ge))}),Ug=W(function(e){var i=rt(e);return ge(i)&&(i=r),wn(xt(e,ge),M(i,2))}),Mg=W(function(e){var i=rt(e);return i=typeof i=="function"?i:r,wn(xt(e,ge),r,i)}),Lg=W(Fn);function kg(e,i){return ec(e||[],i||[],Jr)}function zg(e,i){return ec(e||[],i||[],Zr)}var Hg=W(function(e){var i=e.length,n=i>1?e[i-1]:r;return n=typeof n=="function"?(e.pop(),n):r,jc(e,n)});function qc(e){var i=p(e);return i.__chain__=!0,i}function Vg(e,i){return i(e),e}function ss(e,i){return i(e)}var Kg=It(function(e){var i=e.length,n=i?e[0]:0,c=this.__wrapped__,h=function(f){return on(f,e)};return i>1||this.__actions__.length||!(c instanceof G)||!Pt(n)?this.thru(h):(c=c.slice(n,+n+(i?1:0)),c.__actions__.push({func:ss,args:[h],thisArg:r}),new Xe(c,this.__chain__).thru(function(f){return i&&!f.length&&f.push(r),f}))});function Bg(){return qc(this)}function Wg(){return new Xe(this.value(),this.__chain__)}function Jg(){this.__values__===r&&(this.__values__=Yc(this.value()));var e=this.__index__>=this.__values__.length,i=e?r:this.__values__[this.__index__++];return{done:e,value:i}}function Gg(){return this}function Qg(e){for(var i,n=this;n instanceof Hi;){var c=$c(n);c.__index__=0,c.__values__=r,i?h.__wrapped__=c:i=c;var h=c;n=n.__wrapped__}return h.__wrapped__=e,i}function Yg(){var e=this.__wrapped__;if(e instanceof G){var i=e;return this.__actions__.length&&(i=new G(this)),i=i.reverse(),i.__actions__.push({func:ss,args:[Dn],thisArg:r}),new Xe(i,this.__chain__)}return this.thru(Dn)}function Zg(){return Xa(this.__wrapped__,this.__actions__)}var Xg=Qi(function(e,i,n){re.call(e,n)?++e[n]:bt(e,n,1)});function ey(e,i,n){var c=H(e)?pa:Vf;return n&&Te(e,i,n)&&(i=r),c(e,M(i,3))}function ty(e,i){var n=H(e)?xt:ja;return n(e,M(i,3))}var ry=hc(Tc),iy=hc(Ac);function sy(e,i){return Pe(ns(e,i),1)}function ny(e,i){return Pe(ns(e,i),mi)}function oy(e,i,n){return n=n===r?1:V(n),Pe(ns(e,i),n)}function Uc(e,i){var n=H(e)?Ye:qt;return n(e,M(i,3))}function Mc(e,i){var n=H(e)?Pp:Fa;return n(e,M(i,3))}var ay=Qi(function(e,i,n){re.call(e,n)?e[n].push(i):bt(e,n,[i])});function cy(e,i,n,c){e=qe(e)?e:Pr(e),n=n&&!c?V(n):0;var h=e.length;return n<0&&(n=_e(h+n,0)),hs(e)?n<=h&&e.indexOf(i,n)>-1:!!h&&pr(e,i,n)>-1}var uy=W(function(e,i,n){var c=-1,h=typeof i=="function",f=qe(e)?_(e.length):[];return qt(e,function(d){f[++c]=h?He(i,d,n):Qr(d,i,n)}),f}),hy=Qi(function(e,i,n){bt(e,n,i)});function ns(e,i){var n=H(e)?ce:za;return n(e,M(i,3))}function ly(e,i,n,c){return e==null?[]:(H(i)||(i=i==null?[]:[i]),n=c?r:n,H(n)||(n=n==null?[]:[n]),Ba(e,i,n))}var py=Qi(function(e,i,n){e[n?0:1].push(i)},function(){return[[],[]]});function fy(e,i,n){var c=H(e)?Bs:ya,h=arguments.length<3;return c(e,M(i,4),n,h,qt)}function dy(e,i,n){var c=H(e)?Sp:ya,h=arguments.length<3;return c(e,M(i,4),n,h,Fa)}function gy(e,i){var n=H(e)?xt:ja;return n(e,cs(M(i,3)))}function yy(e){var i=H(e)?Ta:cd;return i(e)}function vy(e,i,n){(n?Te(e,i,n):i===r)?i=1:i=V(i);var c=H(e)?Mf:ud;return c(e,i)}function my(e){var i=H(e)?Lf:ld;return i(e)}function wy(e){if(e==null)return 0;if(qe(e))return hs(e)?dr(e):e.length;var i=Re(e);return i==nt||i==ot?e.size:pn(e).length}function _y(e,i,n){var c=H(e)?Ws:pd;return n&&Te(e,i,n)&&(i=r),c(e,M(i,3))}var by=W(function(e,i){if(e==null)return[];var n=i.length;return n>1&&Te(e,i[0],i[1])?i=[]:n>2&&Te(i[0],i[1],i[2])&&(i=[i[0]]),Ba(e,Pe(i,1),[])}),os=ef||function(){return Ie.Date.now()};function Ey(e,i){if(typeof i!="function")throw new Ze(l);return e=V(e),function(){if(--e<1)return i.apply(this,arguments)}}function Lc(e,i,n){return i=n?r:i,i=e&&i==null?e.length:i,Et(e,de,r,r,r,r,i)}function kc(e,i){var n;if(typeof i!="function")throw new Ze(l);return e=V(e),function(){return--e>0&&(n=i.apply(this,arguments)),e<=1&&(i=r),n}}var jn=W(function(e,i,n){var c=D;if(n.length){var h=Ft(n,Er(jn));c|=he}return Et(e,c,i,n,h)}),zc=W(function(e,i,n){var c=D|Q;if(n.length){var h=Ft(n,Er(zc));c|=he}return Et(i,c,e,n,h)});function Hc(e,i,n){i=n?r:i;var c=Et(e,Z,r,r,r,r,r,i);return c.placeholder=Hc.placeholder,c}function Vc(e,i,n){i=n?r:i;var c=Et(e,ee,r,r,r,r,r,i);return c.placeholder=Vc.placeholder,c}function Kc(e,i,n){var c,h,f,d,y,m,P=0,S=!1,R=!1,T=!0;if(typeof e!="function")throw new Ze(l);i=it(i)||0,le(n)&&(S=!!n.leading,R="maxWait"in n,f=R?_e(it(n.maxWait)||0,i):f,T="trailing"in n?!!n.trailing:T);function F(ye){var ht=c,Rt=h;return c=h=r,P=ye,d=e.apply(Rt,ht),d}function L(ye){return P=ye,y=ti(J,i),S?F(ye):d}function K(ye){var ht=ye-m,Rt=ye-P,hu=i-ht;return R?Oe(hu,f-Rt):hu}function k(ye){var ht=ye-m,Rt=ye-P;return m===r||ht>=i||ht<0||R&&Rt>=f}function J(){var ye=os();if(k(ye))return Y(ye);y=ti(J,K(ye))}function Y(ye){return y=r,T&&c?F(ye):(c=h=r,d)}function We(){y!==r&&tc(y),P=0,c=m=h=y=r}function Ae(){return y===r?d:Y(os())}function Je(){var ye=os(),ht=k(ye);if(c=arguments,h=this,m=ye,ht){if(y===r)return L(m);if(R)return tc(y),y=ti(J,i),F(m)}return y===r&&(y=ti(J,i)),d}return Je.cancel=We,Je.flush=Ae,Je}var Iy=W(function(e,i){return Da(e,1,i)}),Py=W(function(e,i,n){return Da(e,it(i)||0,n)});function Sy(e){return Et(e,At)}function as(e,i){if(typeof e!="function"||i!=null&&typeof i!="function")throw new Ze(l);var n=function(){var c=arguments,h=i?i.apply(this,c):c[0],f=n.cache;if(f.has(h))return f.get(h);var d=e.apply(this,c);return n.cache=f.set(h,d)||f,d};return n.cache=new(as.Cache||_t),n}as.Cache=_t;function cs(e){if(typeof e!="function")throw new Ze(l);return function(){var i=arguments;switch(i.length){case 0:return!e.call(this);case 1:return!e.call(this,i[0]);case 2:return!e.call(this,i[0],i[1]);case 3:return!e.call(this,i[0],i[1],i[2])}return!e.apply(this,i)}}function Oy(e){return kc(2,e)}var Ry=fd(function(e,i){i=i.length==1&&H(i[0])?ce(i[0],Ve(M())):ce(Pe(i,1),Ve(M()));var n=i.length;return W(function(c){for(var h=-1,f=Oe(c.length,n);++h<f;)c[h]=i[h].call(this,c[h]);return He(e,this,c)})}),qn=W(function(e,i){var n=Ft(i,Er(qn));return Et(e,he,r,i,n)}),Bc=W(function(e,i){var n=Ft(i,Er(Bc));return Et(e,Fe,r,i,n)}),Ny=It(function(e,i){return Et(e,Ce,r,r,r,i)});function Cy(e,i){if(typeof e!="function")throw new Ze(l);return i=i===r?i:V(i),W(e,i)}function $y(e,i){if(typeof e!="function")throw new Ze(l);return i=i==null?0:_e(V(i),0),W(function(n){var c=n[i],h=Lt(n,0,i);return c&&Dt(h,c),He(e,this,h)})}function Ty(e,i,n){var c=!0,h=!0;if(typeof e!="function")throw new Ze(l);return le(n)&&(c="leading"in n?!!n.leading:c,h="trailing"in n?!!n.trailing:h),Kc(e,i,{leading:c,maxWait:i,trailing:h})}function Ay(e){return Lc(e,1)}function xy(e,i){return qn(bn(i),e)}function Dy(){if(!arguments.length)return[];var e=arguments[0];return H(e)?e:[e]}function Fy(e){return et(e,q)}function jy(e,i){return i=typeof i=="function"?i:r,et(e,q,i)}function qy(e){return et(e,O|q)}function Uy(e,i){return i=typeof i=="function"?i:r,et(e,O|q,i)}function My(e,i){return i==null||xa(e,i,be(i))}function ut(e,i){return e===i||e!==e&&i!==i}var Ly=es(un),ky=es(function(e,i){return e>=i}),er=Ma(function(){return arguments}())?Ma:function(e){return pe(e)&&re.call(e,"callee")&&!Sa.call(e,"callee")},H=_.isArray,zy=oa?Ve(oa):Qf;function qe(e){return e!=null&&us(e.length)&&!St(e)}function ge(e){return pe(e)&&qe(e)}function Hy(e){return e===!0||e===!1||pe(e)&&$e(e)==Fr}var kt=rf||Jn,Vy=aa?Ve(aa):Yf;function Ky(e){return pe(e)&&e.nodeType===1&&!ri(e)}function By(e){if(e==null)return!0;if(qe(e)&&(H(e)||typeof e=="string"||typeof e.splice=="function"||kt(e)||Ir(e)||er(e)))return!e.length;var i=Re(e);if(i==nt||i==ot)return!e.size;if(ei(e))return!pn(e).length;for(var n in e)if(re.call(e,n))return!1;return!0}function Wy(e,i){return Yr(e,i)}function Jy(e,i,n){n=typeof n=="function"?n:r;var c=n?n(e,i):r;return c===r?Yr(e,i,r,n):!!c}function Un(e){if(!pe(e))return!1;var i=$e(e);return i==bi||i==yl||typeof e.message=="string"&&typeof e.name=="string"&&!ri(e)}function Gy(e){return typeof e=="number"&&Ra(e)}function St(e){if(!le(e))return!1;var i=$e(e);return i==Ei||i==Do||i==gl||i==ml}function Wc(e){return typeof e=="number"&&e==V(e)}function us(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=cr}function le(e){var i=typeof e;return e!=null&&(i=="object"||i=="function")}function pe(e){return e!=null&&typeof e=="object"}var Jc=ca?Ve(ca):Xf;function Qy(e,i){return e===i||ln(e,i,Nn(i))}function Yy(e,i,n){return n=typeof n=="function"?n:r,ln(e,i,Nn(i),n)}function Zy(e){return Gc(e)&&e!=+e}function Xy(e){if(jd(e))throw new z(u);return La(e)}function ev(e){return e===null}function tv(e){return e==null}function Gc(e){return typeof e=="number"||pe(e)&&$e(e)==qr}function ri(e){if(!pe(e)||$e(e)!=mt)return!1;var i=ji(e);if(i===null)return!0;var n=re.call(i,"constructor")&&i.constructor;return typeof n=="function"&&n instanceof n&&Ai.call(n)==Qp}var Mn=ua?Ve(ua):ed;function rv(e){return Wc(e)&&e>=-9007199254740991&&e<=cr}var Qc=ha?Ve(ha):td;function hs(e){return typeof e=="string"||!H(e)&&pe(e)&&$e(e)==Mr}function Be(e){return typeof e=="symbol"||pe(e)&&$e(e)==Ii}var Ir=la?Ve(la):rd;function iv(e){return e===r}function sv(e){return pe(e)&&Re(e)==Lr}function nv(e){return pe(e)&&$e(e)==_l}var ov=es(fn),av=es(function(e,i){return e<=i});function Yc(e){if(!e)return[];if(qe(e))return hs(e)?at(e):je(e);if(Hr&&e[Hr])return Up(e[Hr]());var i=Re(e),n=i==nt?Xs:i==ot?Ci:Pr;return n(e)}function Ot(e){if(!e)return e===0?e:0;if(e=it(e),e===mi||e===-1/0){var i=e<0?-1:1;return i*ll}return e===e?e:0}function V(e){var i=Ot(e),n=i%1;return i===i?n?i-n:i:0}function Zc(e){return e?Qt(V(e),0,ft):0}function it(e){if(typeof e=="number")return e;if(Be(e))return wi;if(le(e)){var i=typeof e.valueOf=="function"?e.valueOf():e;e=le(i)?i+"":i}if(typeof e!="string")return e===0?e:+e;e=va(e);var n=kl.test(e);return n||Hl.test(e)?bp(e.slice(2),n?2:8):Ll.test(e)?wi:+e}function Xc(e){return gt(e,Ue(e))}function cv(e){return e?Qt(V(e),-9007199254740991,cr):e===0?e:0}function te(e){return e==null?"":Ke(e)}var uv=_r(function(e,i){if(ei(i)||qe(i)){gt(i,be(i),e);return}for(var n in i)re.call(i,n)&&Jr(e,n,i[n])}),eu=_r(function(e,i){gt(i,Ue(i),e)}),ls=_r(function(e,i,n,c){gt(i,Ue(i),e,c)}),hv=_r(function(e,i,n,c){gt(i,be(i),e,c)}),lv=It(on);function pv(e,i){var n=wr(e);return i==null?n:Aa(n,i)}var fv=W(function(e,i){e=ie(e);var n=-1,c=i.length,h=c>2?i[2]:r;for(h&&Te(i[0],i[1],h)&&(c=1);++n<c;)for(var f=i[n],d=Ue(f),y=-1,m=d.length;++y<m;){var P=d[y],S=e[P];(S===r||ut(S,yr[P])&&!re.call(e,P))&&(e[P]=f[P])}return e}),dv=W(function(e){return e.push(r,vc),He(tu,r,e)});function gv(e,i){return fa(e,M(i,3),dt)}function yv(e,i){return fa(e,M(i,3),cn)}function vv(e,i){return e==null?e:an(e,M(i,3),Ue)}function mv(e,i){return e==null?e:qa(e,M(i,3),Ue)}function wv(e,i){return e&&dt(e,M(i,3))}function _v(e,i){return e&&cn(e,M(i,3))}function bv(e){return e==null?[]:Bi(e,be(e))}function Ev(e){return e==null?[]:Bi(e,Ue(e))}function Ln(e,i,n){var c=e==null?r:Yt(e,i);return c===r?n:c}function Iv(e,i){return e!=null&&_c(e,i,Bf)}function kn(e,i){return e!=null&&_c(e,i,Wf)}var Pv=pc(function(e,i,n){i!=null&&typeof i.toString!="function"&&(i=xi.call(i)),e[i]=n},Hn(Me)),Sv=pc(function(e,i,n){i!=null&&typeof i.toString!="function"&&(i=xi.call(i)),re.call(e,i)?e[i].push(n):e[i]=[n]},M),Ov=W(Qr);function be(e){return qe(e)?$a(e):pn(e)}function Ue(e){return qe(e)?$a(e,!0):id(e)}function Rv(e,i){var n={};return i=M(i,3),dt(e,function(c,h,f){bt(n,i(c,h,f),c)}),n}function Nv(e,i){var n={};return i=M(i,3),dt(e,function(c,h,f){bt(n,h,i(c,h,f))}),n}var Cv=_r(function(e,i,n){Wi(e,i,n)}),tu=_r(function(e,i,n,c){Wi(e,i,n,c)}),$v=It(function(e,i){var n={};if(e==null)return n;var c=!1;i=ce(i,function(f){return f=Mt(f,e),c||(c=f.length>1),f}),gt(e,On(e),n),c&&(n=et(n,O|N|q,Pd));for(var h=i.length;h--;)mn(n,i[h]);return n});function Tv(e,i){return ru(e,cs(M(i)))}var Av=It(function(e,i){return e==null?{}:nd(e,i)});function ru(e,i){if(e==null)return{};var n=ce(On(e),function(c){return[c]});return i=M(i),Wa(e,n,function(c,h){return i(c,h[0])})}function xv(e,i,n){i=Mt(i,e);var c=-1,h=i.length;for(h||(h=1,e=r);++c<h;){var f=e==null?r:e[yt(i[c])];f===r&&(c=h,f=n),e=St(f)?f.call(e):f}return e}function Dv(e,i,n){return e==null?e:Zr(e,i,n)}function Fv(e,i,n,c){return c=typeof c=="function"?c:r,e==null?e:Zr(e,i,n,c)}var iu=gc(be),su=gc(Ue);function jv(e,i,n){var c=H(e),h=c||kt(e)||Ir(e);if(i=M(i,4),n==null){var f=e&&e.constructor;h?n=c?new f:[]:le(e)?n=St(f)?wr(ji(e)):{}:n={}}return(h?Ye:dt)(e,function(d,y,m){return i(n,d,y,m)}),n}function qv(e,i){return e==null?!0:mn(e,i)}function Uv(e,i,n){return e==null?e:Za(e,i,bn(n))}function Mv(e,i,n,c){return c=typeof c=="function"?c:r,e==null?e:Za(e,i,bn(n),c)}function Pr(e){return e==null?[]:Zs(e,be(e))}function Lv(e){return e==null?[]:Zs(e,Ue(e))}function kv(e,i,n){return n===r&&(n=i,i=r),n!==r&&(n=it(n),n=n===n?n:0),i!==r&&(i=it(i),i=i===i?i:0),Qt(it(e),i,n)}function zv(e,i,n){return i=Ot(i),n===r?(n=i,i=0):n=Ot(n),e=it(e),Jf(e,i,n)}function Hv(e,i,n){if(n&&typeof n!="boolean"&&Te(e,i,n)&&(i=n=r),n===r&&(typeof i=="boolean"?(n=i,i=r):typeof e=="boolean"&&(n=e,e=r)),e===r&&i===r?(e=0,i=1):(e=Ot(e),i===r?(i=e,e=0):i=Ot(i)),e>i){var c=e;e=i,i=c}if(n||e%1||i%1){var h=Na();return Oe(e+h*(i-e+_p("1e-"+((h+"").length-1))),i)}return gn(e,i)}var Vv=br(function(e,i,n){return i=i.toLowerCase(),e+(n?nu(i):i)});function nu(e){return zn(te(e).toLowerCase())}function ou(e){return e=te(e),e&&e.replace(Kl,xp).replace(hp,"")}function Kv(e,i,n){e=te(e),i=Ke(i);var c=e.length;n=n===r?c:Qt(V(n),0,c);var h=n;return n-=i.length,n>=0&&e.slice(n,h)==i}function Bv(e){return e=te(e),e&&Sl.test(e)?e.replace(qo,Dp):e}function Wv(e){return e=te(e),e&&Tl.test(e)?e.replace(js,"\\$&"):e}var Jv=br(function(e,i,n){return e+(n?"-":"")+i.toLowerCase()}),Gv=br(function(e,i,n){return e+(n?" ":"")+i.toLowerCase()}),Qv=uc("toLowerCase");function Yv(e,i,n){e=te(e),i=V(i);var c=i?dr(e):0;if(!i||c>=i)return e;var h=(i-c)/2;return Xi(Li(h),n)+e+Xi(Mi(h),n)}function Zv(e,i,n){e=te(e),i=V(i);var c=i?dr(e):0;return i&&c<i?e+Xi(i-c,n):e}function Xv(e,i,n){e=te(e),i=V(i);var c=i?dr(e):0;return i&&c<i?Xi(i-c,n)+e:e}function em(e,i,n){return n||i==null?i=0:i&&(i=+i),af(te(e).replace(qs,""),i||0)}function tm(e,i,n){return(n?Te(e,i,n):i===r)?i=1:i=V(i),yn(te(e),i)}function rm(){var e=arguments,i=te(e[0]);return e.length<3?i:i.replace(e[1],e[2])}var im=br(function(e,i,n){return e+(n?"_":"")+i.toLowerCase()});function sm(e,i,n){return n&&typeof n!="number"&&Te(e,i,n)&&(i=n=r),n=n===r?ft:n>>>0,n?(e=te(e),e&&(typeof i=="string"||i!=null&&!Mn(i))&&(i=Ke(i),!i&&fr(e))?Lt(at(e),0,n):e.split(i,n)):[]}var nm=br(function(e,i,n){return e+(n?" ":"")+zn(i)});function om(e,i,n){return e=te(e),n=n==null?0:Qt(V(n),0,e.length),i=Ke(i),e.slice(n,n+i.length)==i}function am(e,i,n){var c=p.templateSettings;n&&Te(e,i,n)&&(i=r),e=te(e),i=ls({},i,c,yc);var h=ls({},i.imports,c.imports,yc),f=be(h),d=Zs(h,f),y,m,P=0,S=i.interpolate||Pi,R="__p += '",T=en((i.escape||Pi).source+"|"+S.source+"|"+(S===Uo?Ml:Pi).source+"|"+(i.evaluate||Pi).source+"|$","g"),F="//# sourceURL="+(re.call(i,"sourceURL")?(i.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++gp+"]")+`
`;e.replace(T,function(k,J,Y,We,Ae,Je){return Y||(Y=We),R+=e.slice(P,Je).replace(Bl,Fp),J&&(y=!0,R+=`' +
__e(`+J+`) +
'`),Ae&&(m=!0,R+=`';
`+Ae+`;
__p += '`),Y&&(R+=`' +
((__t = (`+Y+`)) == null ? '' : __t) +
'`),P=Je+k.length,k}),R+=`';
`;var L=re.call(i,"variable")&&i.variable;if(!L)R=`with (obj) {
`+R+`
}
`;else if(ql.test(L))throw new z(g);R=(m?R.replace(bl,""):R).replace(El,"$1").replace(Il,"$1;"),R="function("+(L||"obj")+`) {
`+(L?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(y?", __e = _.escape":"")+(m?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+R+`return __p
}`;var K=cu(function(){return X(f,F+"return "+R).apply(r,d)});if(K.source=R,Un(K))throw K;return K}function cm(e){return te(e).toLowerCase()}function um(e){return te(e).toUpperCase()}function hm(e,i,n){if(e=te(e),e&&(n||i===r))return va(e);if(!e||!(i=Ke(i)))return e;var c=at(e),h=at(i),f=ma(c,h),d=wa(c,h)+1;return Lt(c,f,d).join("")}function lm(e,i,n){if(e=te(e),e&&(n||i===r))return e.slice(0,ba(e)+1);if(!e||!(i=Ke(i)))return e;var c=at(e),h=wa(c,at(i))+1;return Lt(c,0,h).join("")}function pm(e,i,n){if(e=te(e),e&&(n||i===r))return e.replace(qs,"");if(!e||!(i=Ke(i)))return e;var c=at(e),h=ma(c,at(i));return Lt(c,h).join("")}function fm(e,i){var n=nl,c=ol;if(le(i)){var h="separator"in i?i.separator:h;n="length"in i?V(i.length):n,c="omission"in i?Ke(i.omission):c}e=te(e);var f=e.length;if(fr(e)){var d=at(e);f=d.length}if(n>=f)return e;var y=n-dr(c);if(y<1)return c;var m=d?Lt(d,0,y).join(""):e.slice(0,y);if(h===r)return m+c;if(d&&(y+=m.length-y),Mn(h)){if(e.slice(y).search(h)){var P,S=m;for(h.global||(h=en(h.source,te(Mo.exec(h))+"g")),h.lastIndex=0;P=h.exec(S);)var R=P.index;m=m.slice(0,R===r?y:R)}}else if(e.indexOf(Ke(h),y)!=y){var T=m.lastIndexOf(h);T>-1&&(m=m.slice(0,T))}return m+c}function dm(e){return e=te(e),e&&Pl.test(e)?e.replace(jo,zp):e}var gm=br(function(e,i,n){return e+(n?" ":"")+i.toUpperCase()}),zn=uc("toUpperCase");function au(e,i,n){return e=te(e),i=n?r:i,i===r?qp(e)?Kp(e):Np(e):e.match(i)||[]}var cu=W(function(e,i){try{return He(e,r,i)}catch(n){return Un(n)?n:new z(n)}}),ym=It(function(e,i){return Ye(i,function(n){n=yt(n),bt(e,n,jn(e[n],e))}),e});function vm(e){var i=e==null?0:e.length,n=M();return e=i?ce(e,function(c){if(typeof c[1]!="function")throw new Ze(l);return[n(c[0]),c[1]]}):[],W(function(c){for(var h=-1;++h<i;){var f=e[h];if(He(f[0],this,c))return He(f[1],this,c)}})}function mm(e){return Hf(et(e,O))}function Hn(e){return function(){return e}}function wm(e,i){return e==null||e!==e?i:e}var _m=lc(),bm=lc(!0);function Me(e){return e}function Vn(e){return ka(typeof e=="function"?e:et(e,O))}function Em(e){return Ha(et(e,O))}function Im(e,i){return Va(e,et(i,O))}var Pm=W(function(e,i){return function(n){return Qr(n,e,i)}}),Sm=W(function(e,i){return function(n){return Qr(e,n,i)}});function Kn(e,i,n){var c=be(i),h=Bi(i,c);n==null&&!(le(i)&&(h.length||!c.length))&&(n=i,i=e,e=this,h=Bi(i,be(i)));var f=!(le(n)&&"chain"in n)||!!n.chain,d=St(e);return Ye(h,function(y){var m=i[y];e[y]=m,d&&(e.prototype[y]=function(){var P=this.__chain__;if(f||P){var S=e(this.__wrapped__),R=S.__actions__=je(this.__actions__);return R.push({func:m,args:arguments,thisArg:e}),S.__chain__=P,S}return m.apply(e,Dt([this.value()],arguments))})}),e}function Om(){return Ie._===this&&(Ie._=Yp),this}function Bn(){}function Rm(e){return e=V(e),W(function(i){return Ka(i,e)})}var Nm=In(ce),Cm=In(pa),$m=In(Ws);function uu(e){return $n(e)?Js(yt(e)):od(e)}function Tm(e){return function(i){return e==null?r:Yt(e,i)}}var Am=fc(),xm=fc(!0);function Wn(){return[]}function Jn(){return!1}function Dm(){return{}}function Fm(){return""}function jm(){return!0}function qm(e,i){if(e=V(e),e<1||e>cr)return[];var n=ft,c=Oe(e,ft);i=M(i),e-=ft;for(var h=Ys(c,i);++n<e;)i(n);return h}function Um(e){return H(e)?ce(e,yt):Be(e)?[e]:je(Cc(te(e)))}function Mm(e){var i=++Gp;return te(e)+i}var Lm=Zi(function(e,i){return e+i},0),km=Pn("ceil"),zm=Zi(function(e,i){return e/i},1),Hm=Pn("floor");function Vm(e){return e&&e.length?Ki(e,Me,un):r}function Km(e,i){return e&&e.length?Ki(e,M(i,2),un):r}function Bm(e){return ga(e,Me)}function Wm(e,i){return ga(e,M(i,2))}function Jm(e){return e&&e.length?Ki(e,Me,fn):r}function Gm(e,i){return e&&e.length?Ki(e,M(i,2),fn):r}var Qm=Zi(function(e,i){return e*i},1),Ym=Pn("round"),Zm=Zi(function(e,i){return e-i},0);function Xm(e){return e&&e.length?Qs(e,Me):0}function ew(e,i){return e&&e.length?Qs(e,M(i,2)):0}return p.after=Ey,p.ary=Lc,p.assign=uv,p.assignIn=eu,p.assignInWith=ls,p.assignWith=hv,p.at=lv,p.before=kc,p.bind=jn,p.bindAll=ym,p.bindKey=zc,p.castArray=Dy,p.chain=qc,p.chunk=Hd,p.compact=Vd,p.concat=Kd,p.cond=vm,p.conforms=mm,p.constant=Hn,p.countBy=Xg,p.create=pv,p.curry=Hc,p.curryRight=Vc,p.debounce=Kc,p.defaults=fv,p.defaultsDeep=dv,p.defer=Iy,p.delay=Py,p.difference=Bd,p.differenceBy=Wd,p.differenceWith=Jd,p.drop=Gd,p.dropRight=Qd,p.dropRightWhile=Yd,p.dropWhile=Zd,p.fill=Xd,p.filter=ty,p.flatMap=sy,p.flatMapDeep=ny,p.flatMapDepth=oy,p.flatten=xc,p.flattenDeep=eg,p.flattenDepth=tg,p.flip=Sy,p.flow=_m,p.flowRight=bm,p.fromPairs=rg,p.functions=bv,p.functionsIn=Ev,p.groupBy=ay,p.initial=sg,p.intersection=ng,p.intersectionBy=og,p.intersectionWith=ag,p.invert=Pv,p.invertBy=Sv,p.invokeMap=uy,p.iteratee=Vn,p.keyBy=hy,p.keys=be,p.keysIn=Ue,p.map=ns,p.mapKeys=Rv,p.mapValues=Nv,p.matches=Em,p.matchesProperty=Im,p.memoize=as,p.merge=Cv,p.mergeWith=tu,p.method=Pm,p.methodOf=Sm,p.mixin=Kn,p.negate=cs,p.nthArg=Rm,p.omit=$v,p.omitBy=Tv,p.once=Oy,p.orderBy=ly,p.over=Nm,p.overArgs=Ry,p.overEvery=Cm,p.overSome=$m,p.partial=qn,p.partialRight=Bc,p.partition=py,p.pick=Av,p.pickBy=ru,p.property=uu,p.propertyOf=Tm,p.pull=lg,p.pullAll=Fc,p.pullAllBy=pg,p.pullAllWith=fg,p.pullAt=dg,p.range=Am,p.rangeRight=xm,p.rearg=Ny,p.reject=gy,p.remove=gg,p.rest=Cy,p.reverse=Dn,p.sampleSize=vy,p.set=Dv,p.setWith=Fv,p.shuffle=my,p.slice=yg,p.sortBy=by,p.sortedUniq=Ig,p.sortedUniqBy=Pg,p.split=sm,p.spread=$y,p.tail=Sg,p.take=Og,p.takeRight=Rg,p.takeRightWhile=Ng,p.takeWhile=Cg,p.tap=Vg,p.throttle=Ty,p.thru=ss,p.toArray=Yc,p.toPairs=iu,p.toPairsIn=su,p.toPath=Um,p.toPlainObject=Xc,p.transform=jv,p.unary=Ay,p.union=$g,p.unionBy=Tg,p.unionWith=Ag,p.uniq=xg,p.uniqBy=Dg,p.uniqWith=Fg,p.unset=qv,p.unzip=Fn,p.unzipWith=jc,p.update=Uv,p.updateWith=Mv,p.values=Pr,p.valuesIn=Lv,p.without=jg,p.words=au,p.wrap=xy,p.xor=qg,p.xorBy=Ug,p.xorWith=Mg,p.zip=Lg,p.zipObject=kg,p.zipObjectDeep=zg,p.zipWith=Hg,p.entries=iu,p.entriesIn=su,p.extend=eu,p.extendWith=ls,Kn(p,p),p.add=Lm,p.attempt=cu,p.camelCase=Vv,p.capitalize=nu,p.ceil=km,p.clamp=kv,p.clone=Fy,p.cloneDeep=qy,p.cloneDeepWith=Uy,p.cloneWith=jy,p.conformsTo=My,p.deburr=ou,p.defaultTo=wm,p.divide=zm,p.endsWith=Kv,p.eq=ut,p.escape=Bv,p.escapeRegExp=Wv,p.every=ey,p.find=ry,p.findIndex=Tc,p.findKey=gv,p.findLast=iy,p.findLastIndex=Ac,p.findLastKey=yv,p.floor=Hm,p.forEach=Uc,p.forEachRight=Mc,p.forIn=vv,p.forInRight=mv,p.forOwn=wv,p.forOwnRight=_v,p.get=Ln,p.gt=Ly,p.gte=ky,p.has=Iv,p.hasIn=kn,p.head=Dc,p.identity=Me,p.includes=cy,p.indexOf=ig,p.inRange=zv,p.invoke=Ov,p.isArguments=er,p.isArray=H,p.isArrayBuffer=zy,p.isArrayLike=qe,p.isArrayLikeObject=ge,p.isBoolean=Hy,p.isBuffer=kt,p.isDate=Vy,p.isElement=Ky,p.isEmpty=By,p.isEqual=Wy,p.isEqualWith=Jy,p.isError=Un,p.isFinite=Gy,p.isFunction=St,p.isInteger=Wc,p.isLength=us,p.isMap=Jc,p.isMatch=Qy,p.isMatchWith=Yy,p.isNaN=Zy,p.isNative=Xy,p.isNil=tv,p.isNull=ev,p.isNumber=Gc,p.isObject=le,p.isObjectLike=pe,p.isPlainObject=ri,p.isRegExp=Mn,p.isSafeInteger=rv,p.isSet=Qc,p.isString=hs,p.isSymbol=Be,p.isTypedArray=Ir,p.isUndefined=iv,p.isWeakMap=sv,p.isWeakSet=nv,p.join=cg,p.kebabCase=Jv,p.last=rt,p.lastIndexOf=ug,p.lowerCase=Gv,p.lowerFirst=Qv,p.lt=ov,p.lte=av,p.max=Vm,p.maxBy=Km,p.mean=Bm,p.meanBy=Wm,p.min=Jm,p.minBy=Gm,p.stubArray=Wn,p.stubFalse=Jn,p.stubObject=Dm,p.stubString=Fm,p.stubTrue=jm,p.multiply=Qm,p.nth=hg,p.noConflict=Om,p.noop=Bn,p.now=os,p.pad=Yv,p.padEnd=Zv,p.padStart=Xv,p.parseInt=em,p.random=Hv,p.reduce=fy,p.reduceRight=dy,p.repeat=tm,p.replace=rm,p.result=xv,p.round=Ym,p.runInContext=v,p.sample=yy,p.size=wy,p.snakeCase=im,p.some=_y,p.sortedIndex=vg,p.sortedIndexBy=mg,p.sortedIndexOf=wg,p.sortedLastIndex=_g,p.sortedLastIndexBy=bg,p.sortedLastIndexOf=Eg,p.startCase=nm,p.startsWith=om,p.subtract=Zm,p.sum=Xm,p.sumBy=ew,p.template=am,p.times=qm,p.toFinite=Ot,p.toInteger=V,p.toLength=Zc,p.toLower=cm,p.toNumber=it,p.toSafeInteger=cv,p.toString=te,p.toUpper=um,p.trim=hm,p.trimEnd=lm,p.trimStart=pm,p.truncate=fm,p.unescape=dm,p.uniqueId=Mm,p.upperCase=gm,p.upperFirst=zn,p.each=Uc,p.eachRight=Mc,p.first=Dc,Kn(p,function(){var e={};return dt(p,function(i,n){re.call(p.prototype,n)||(e[n]=i)}),e}(),{chain:!1}),p.VERSION=s,Ye(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){p[e].placeholder=p}),Ye(["drop","take"],function(e,i){G.prototype[e]=function(n){n=n===r?1:_e(V(n),0);var c=this.__filtered__&&!i?new G(this):this.clone();return c.__filtered__?c.__takeCount__=Oe(n,c.__takeCount__):c.__views__.push({size:Oe(n,ft),type:e+(c.__dir__<0?"Right":"")}),c},G.prototype[e+"Right"]=function(n){return this.reverse()[e](n).reverse()}}),Ye(["filter","map","takeWhile"],function(e,i){var n=i+1,c=n==xo||n==hl;G.prototype[e]=function(h){var f=this.clone();return f.__iteratees__.push({iteratee:M(h,3),type:n}),f.__filtered__=f.__filtered__||c,f}}),Ye(["head","last"],function(e,i){var n="take"+(i?"Right":"");G.prototype[e]=function(){return this[n](1).value()[0]}}),Ye(["initial","tail"],function(e,i){var n="drop"+(i?"":"Right");G.prototype[e]=function(){return this.__filtered__?new G(this):this[n](1)}}),G.prototype.compact=function(){return this.filter(Me)},G.prototype.find=function(e){return this.filter(e).head()},G.prototype.findLast=function(e){return this.reverse().find(e)},G.prototype.invokeMap=W(function(e,i){return typeof e=="function"?new G(this):this.map(function(n){return Qr(n,e,i)})}),G.prototype.reject=function(e){return this.filter(cs(M(e)))},G.prototype.slice=function(e,i){e=V(e);var n=this;return n.__filtered__&&(e>0||i<0)?new G(n):(e<0?n=n.takeRight(-e):e&&(n=n.drop(e)),i!==r&&(i=V(i),n=i<0?n.dropRight(-i):n.take(i-e)),n)},G.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},G.prototype.toArray=function(){return this.take(ft)},dt(G.prototype,function(e,i){var n=/^(?:filter|find|map|reject)|While$/.test(i),c=/^(?:head|last)$/.test(i),h=p[c?"take"+(i=="last"?"Right":""):i],f=c||/^find/.test(i);h&&(p.prototype[i]=function(){var d=this.__wrapped__,y=c?[1]:arguments,m=d instanceof G,P=y[0],S=m||H(d),R=function(J){var Y=h.apply(p,Dt([J],y));return c&&T?Y[0]:Y};S&&n&&typeof P=="function"&&P.length!=1&&(m=S=!1);var T=this.__chain__,F=!!this.__actions__.length,L=f&&!T,K=m&&!F;if(!f&&S){d=K?d:new G(this);var k=e.apply(d,y);return k.__actions__.push({func:ss,args:[R],thisArg:r}),new Xe(k,T)}return L&&K?e.apply(this,y):(k=this.thru(R),L?c?k.value()[0]:k.value():k)})}),Ye(["pop","push","shift","sort","splice","unshift"],function(e){var i=$i[e],n=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",c=/^(?:pop|shift)$/.test(e);p.prototype[e]=function(){var h=arguments;if(c&&!this.__chain__){var f=this.value();return i.apply(H(f)?f:[],h)}return this[n](function(d){return i.apply(H(d)?d:[],h)})}}),dt(G.prototype,function(e,i){var n=p[i];if(n){var c=n.name+"";re.call(mr,c)||(mr[c]=[]),mr[c].push({name:i,func:n})}}),mr[Yi(r,Q).name]=[{name:"wrapper",func:r}],G.prototype.clone=df,G.prototype.reverse=gf,G.prototype.value=yf,p.prototype.at=Kg,p.prototype.chain=Bg,p.prototype.commit=Wg,p.prototype.next=Jg,p.prototype.plant=Qg,p.prototype.reverse=Yg,p.prototype.toJSON=p.prototype.valueOf=p.prototype.value=Zg,p.prototype.first=p.prototype.head,Hr&&(p.prototype[Hr]=Gg),p},gr=Bp();Bt?((Bt.exports=gr)._=gr,Hs._=gr):Ie._=gr}).call(ui)})(_o,_o.exports);var ME=Object.defineProperty,LE=Object.defineProperties,kE=Object.getOwnPropertyDescriptors,hh=Object.getOwnPropertySymbols,zE=Object.prototype.hasOwnProperty,HE=Object.prototype.propertyIsEnumerable,lh=(a,t,r)=>t in a?ME(a,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[t]=r,ds=(a,t)=>{for(var r in t||(t={}))zE.call(t,r)&&lh(a,r,t[r]);if(hh)for(var r of hh(t))HE.call(t,r)&&lh(a,r,t[r]);return a},VE=(a,t)=>LE(a,kE(t));function Vt(a,t,r){var s;const o=p_(a);return((s=t.rpcMap)==null?void 0:s[o.reference])||`${UE}?chainId=${o.namespace}:${o.reference}&projectId=${r}`}function ar(a){return a.includes(":")?a.split(":")[1]:a}function tl(a){return a.map(t=>`${t.split(":")[0]}:${t.split(":")[1]}`)}function KE(a,t){const r=Object.keys(t.namespaces).filter(o=>o.includes(a));if(!r.length)return[];const s=[];return r.forEach(o=>{const u=t.namespaces[o].accounts;s.push(...u)}),s}function BE(a={},t={}){const r=ph(a),s=ph(t);return _o.exports.merge(r,s)}function ph(a){var t,r,s,o;const u={};if(!Nr(a))return u;for(const[l,g]of Object.entries(a)){const w=No(l)?[l]:g.chains,b=g.methods||[],C=g.events||[],O=g.rpcMap||{},N=hi(l);u[N]=VE(ds(ds({},u[N]),g),{chains:Yn(w,(t=u[N])==null?void 0:t.chains),methods:Yn(b,(r=u[N])==null?void 0:r.methods),events:Yn(C,(s=u[N])==null?void 0:s.events),rpcMap:ds(ds({},O),(o=u[N])==null?void 0:o.rpcMap)})}return u}function WE(a){return a.includes(":")?a.split(":")[2]:a}function JE(a){const t={};for(const[r,s]of Object.entries(a)){const o=s.methods||[],u=s.events||[],l=s.accounts||[],g=No(r)?[r]:s.chains?s.chains:tl(s.accounts);t[r]={chains:g,methods:o,events:u,accounts:l}}return t}function so(a){return typeof a=="number"?a:a.includes("0x")?parseInt(a,16):a.includes(":")?Number(a.split(":")[1]):Number(a)}const rl={},ue=a=>rl[a],no=(a,t)=>{rl[a]=t};class GE{constructor(t){this.name="polkadot",this.namespace=t.namespace,this.events=ue("events"),this.client=ue("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(Tt.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getAccounts(){const t=this.namespace.accounts;return t?t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;const o=ar(r);t[o]=this.createHttpProvider(o,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||Vt(t,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new $t(new Kt(s,ue("disableProviderPing")))}}class QE{constructor(t){this.name="eip155",this.namespace=t.namespace,this.events=ue("events"),this.client=ue("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(t){switch(t.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(t);case"eth_chainId":return parseInt(this.getDefaultChain())}return this.namespace.methods.includes(t.request.method)?await this.client.request(t):this.getHttpProvider().request(t.request)}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(parseInt(t),r),this.chainId=parseInt(t),this.events.emit(Tt.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}createHttpProvider(t,r){const s=r||Vt(`${this.name}:${t}`,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new $t(new Kt(s,ue("disableProviderPing")))}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;const o=parseInt(ar(r));t[o]=this.createHttpProvider(o,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}getHttpProvider(){const t=this.chainId,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}async handleSwitchChain(t){var r,s;let o=t.request.params?(r=t.request.params[0])==null?void 0:r.chainId:"0x0";o=o.startsWith("0x")?o:`0x${o}`;const u=parseInt(o,16);if(this.isChainApproved(u))this.setDefaultChain(`${u}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:t.topic,request:{method:t.request.method,params:[{chainId:o}]},chainId:(s=this.namespace.chains)==null?void 0:s[0]}),this.setDefaultChain(`${u}`);else throw new Error(`Failed to switch to chain 'eip155:${u}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(t){return this.namespace.chains.includes(`${this.name}:${t}`)}}class YE{constructor(t){this.name="solana",this.namespace=t.namespace,this.events=ue("events"),this.client=ue("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(Tt.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;const o=ar(r);t[o]=this.createHttpProvider(o,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||Vt(t,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new $t(new Kt(s,ue("disableProviderPing")))}}class ZE{constructor(t){this.name="cosmos",this.namespace=t.namespace,this.events=ue("events"),this.client=ue("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(Tt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;const o=ar(r);t[o]=this.createHttpProvider(o,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||Vt(t,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new $t(new Kt(s,ue("disableProviderPing")))}}class XE{constructor(t){this.name="cip34",this.namespace=t.namespace,this.events=ue("events"),this.client=ue("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(Tt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{const s=this.getCardanoRPCUrl(r),o=ar(r);t[o]=this.createHttpProvider(o,s)}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}getCardanoRPCUrl(t){const r=this.namespace.rpcMap;if(r)return r[t]}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||this.getCardanoRPCUrl(t);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new $t(new Kt(s,ue("disableProviderPing")))}}class eI{constructor(t){this.name="elrond",this.namespace=t.namespace,this.events=ue("events"),this.client=ue("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(Tt.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;const o=ar(r);t[o]=this.createHttpProvider(o,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||Vt(t,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new $t(new Kt(s,ue("disableProviderPing")))}}class tI{constructor(t){this.name="multiversx",this.namespace=t.namespace,this.events=ue("events"),this.client=ue("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(Tt.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;const o=ar(r);t[o]=this.createHttpProvider(o,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||Vt(t,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new $t(new Kt(s,ue("disableProviderPing")))}}class rI{constructor(t){this.name="near",this.namespace=t.namespace,this.events=ue("events"),this.client=ue("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){if(this.chainId=t,!this.httpProviders[t]){const s=r||Vt(`${this.name}:${t}`,this.namespace);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);this.setHttpProvider(t,s)}this.events.emit(Tt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;t[r]=this.createHttpProvider(r,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||Vt(t,this.namespace);return typeof s>"u"?void 0:new $t(new Kt(s,ue("disableProviderPing")))}}var iI=Object.defineProperty,sI=Object.defineProperties,nI=Object.getOwnPropertyDescriptors,fh=Object.getOwnPropertySymbols,oI=Object.prototype.hasOwnProperty,aI=Object.prototype.propertyIsEnumerable,dh=(a,t,r)=>t in a?iI(a,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[t]=r,gs=(a,t)=>{for(var r in t||(t={}))oI.call(t,r)&&dh(a,r,t[r]);if(fh)for(var r of fh(t))aI.call(t,r)&&dh(a,r,t[r]);return a},oo=(a,t)=>sI(a,nI(t));class Ao{constructor(t){this.events=new U.ss,this.rpcProviders={},this.shouldAbortPairingAttempt=!1,this.maxPairingAttempts=10,this.disableProviderPing=!1,this.providerOpts=t,this.logger=typeof(t==null?void 0:t.logger)<"u"&&typeof(t==null?void 0:t.logger)!="string"?t.logger:E.Tt(E.k({level:(t==null?void 0:t.logger)||ch})),this.disableProviderPing=(t==null?void 0:t.disableProviderPing)||!1}static async init(t){const r=new Ao(t);return await r.initialize(),r}async request(t,r){const[s,o]=this.validateChain(r);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(s).request({request:gs({},t),chainId:`${s}:${o}`,topic:this.session.topic})}sendAsync(t,r,s){const o=new Date().getTime();this.request(t,s).then(u=>r(null,E.formatJsonRpcResult(o,u))).catch(u=>r(u,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties}),await this.requestAccounts()}async disconnect(){var t;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(t=this.session)==null?void 0:t.topic,reason:ve("USER_DISCONNECTED")}),await this.cleanup()}async connect(t){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(t),await this.cleanupPendingPairings(),!t.skipPairing)return await this.pair(t.pairingTopic)}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}removeListener(t,r){this.events.removeListener(t,r)}off(t,r){this.events.off(t,r)}get isWalletConnect(){return!0}async pair(t){this.shouldAbortPairingAttempt=!1;let r=0;do{if(this.shouldAbortPairingAttempt)throw new Error("Pairing aborted");if(r>=this.maxPairingAttempts)throw new Error("Max auto pairing attempts reached");const{uri:s,approval:o}=await this.client.connect({pairingTopic:t,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});s&&(this.uri=s,this.events.emit("display_uri",s)),await o().then(u=>{this.session=u,this.namespaces||(this.namespaces=JE(u.namespaces),this.persist("namespaces",this.namespaces))}).catch(u=>{if(u.message!==Xh)throw u;r++})}while(!this.session);return this.onConnect(),this.session}setDefaultChain(t,r){try{if(!this.session)return;const[s,o]=this.validateChain(t);this.getProvider(s).setDefaultChain(o,r)}catch(s){if(!/Please call connect/.test(s.message))throw s}}async cleanupPendingPairings(t={}){this.logger.info("Cleaning up inactive pairings...");const r=this.client.pairing.getAll();if(ir(r)){for(const s of r)t.deletePairings?this.client.core.expirer.set(s.topic,0):await this.client.core.relayer.subscriber.unsubscribe(s.topic);this.logger.info(`Inactive pairings cleared: ${r.length}`)}}abortPairingAttempt(){this.shouldAbortPairingAttempt=!0}async checkStorage(){if(this.namespaces=await this.getFromStore("namespaces"),this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.client.session.length){const t=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[t]),this.createProviders()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await PE.init({logger:this.providerOpts.logger||ch,relayUrl:this.providerOpts.relayUrl||FE,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const t=[...new Set(Object.keys(this.session.namespaces).map(r=>hi(r)))];no("client",this.client),no("events",this.events),no("disableProviderPing",this.disableProviderPing),t.forEach(r=>{if(!this.session)return;const s=KE(r,this.session),o=tl(s),u=BE(this.namespaces,this.optionalNamespaces),l=oo(gs({},u[r]),{accounts:s,chains:o});switch(r){case"eip155":this.rpcProviders[r]=new QE({namespace:l});break;case"solana":this.rpcProviders[r]=new YE({namespace:l});break;case"cosmos":this.rpcProviders[r]=new ZE({namespace:l});break;case"polkadot":this.rpcProviders[r]=new GE({namespace:l});break;case"cip34":this.rpcProviders[r]=new XE({namespace:l});break;case"elrond":this.rpcProviders[r]=new eI({namespace:l});break;case"multiversx":this.rpcProviders[r]=new tI({namespace:l});break;case"near":this.rpcProviders[r]=new rI({namespace:l});break}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",t=>{this.events.emit("session_ping",t)}),this.client.on("session_event",t=>{const{params:r}=t,{event:s}=r;if(s.name==="accountsChanged"){const o=s.data;o&&ir(o)&&this.events.emit("accountsChanged",o.map(WE))}else if(s.name==="chainChanged"){const o=r.chainId,u=r.event.data,l=hi(o),g=so(o)!==so(u)?`${l}:${so(u)}`:o;this.onChainChanged(g)}else this.events.emit(s.name,s.data);this.events.emit("session_event",t)}),this.client.on("session_update",({topic:t,params:r})=>{var s;const{namespaces:o}=r,u=(s=this.client)==null?void 0:s.session.get(t);this.session=oo(gs({},u),{namespaces:o}),this.onSessionUpdate(),this.events.emit("session_update",{topic:t,params:r})}),this.client.on("session_delete",async t=>{await this.cleanup(),this.events.emit("session_delete",t),this.events.emit("disconnect",oo(gs({},ve("USER_DISCONNECTED")),{data:t.topic}))}),this.on(Tt.DEFAULT_CHAIN_CHANGED,t=>{this.onChainChanged(t,!0)})}getProvider(t){if(!this.rpcProviders[t])throw new Error(`Provider not found: ${t}`);return this.rpcProviders[t]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(t=>{var r;this.getProvider(t).updateNamespace((r=this.session)==null?void 0:r.namespaces[t])})}setNamespaces(t){const{namespaces:r,optionalNamespaces:s,sessionProperties:o}=t;r&&Object.keys(r).length&&(this.namespaces=r),s&&Object.keys(s).length&&(this.optionalNamespaces=s),this.sessionProperties=o,this.persist("namespaces",r),this.persist("optionalNamespaces",s)}validateChain(t){const[r,s]=(t==null?void 0:t.split(":"))||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[r,s];if(r&&!Object.keys(this.namespaces||{}).map(l=>hi(l)).includes(r))throw new Error(`Namespace '${r}' is not configured. Please call connect() first with namespace config.`);if(r&&s)return[r,s];const o=hi(Object.keys(this.namespaces)[0]),u=this.rpcProviders[o].getDefaultChain();return[o,u]}async requestAccounts(){const[t]=this.validateChain();return await this.getProvider(t).requestAccounts()}onChainChanged(t,r=!1){var s;if(!this.namespaces)return;const[o,u]=this.validateChain(t);r||this.getProvider(o).setDefaultChain(u),((s=this.namespaces[o])!=null?s:this.namespaces[`${o}:${u}`]).defaultChain=u,this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",u)}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,this.persist("namespaces",void 0),this.persist("optionalNamespaces",void 0),this.persist("sessionProperties",void 0),await this.cleanupPendingPairings({deletePairings:!0})}persist(t,r){this.client.core.storage.setItem(`${uh}/${t}`,r)}async getFromStore(t){return await this.client.core.storage.getItem(`${uh}/${t}`)}}const cI=Ao,uI="wc",hI="ethereum_provider",lI=`${uI}@2:${hI}:`,pI="https://rpc.walletconnect.com/v1/",_s=["eth_sendTransaction","personal_sign"],il=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"],bs=["chainChanged","accountsChanged"],sl=["chainChanged","accountsChanged","message","disconnect","connect"];var fI=Object.defineProperty,dI=Object.defineProperties,gI=Object.getOwnPropertyDescriptors,gh=Object.getOwnPropertySymbols,yI=Object.prototype.hasOwnProperty,vI=Object.prototype.propertyIsEnumerable,yh=(a,t,r)=>t in a?fI(a,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[t]=r,pi=(a,t)=>{for(var r in t||(t={}))yI.call(t,r)&&yh(a,r,t[r]);if(gh)for(var r of gh(t))vI.call(t,r)&&yh(a,r,t[r]);return a},vh=(a,t)=>dI(a,gI(t));function Es(a){return Number(a[0].split(":")[1])}function ao(a){return`0x${a.toString(16)}`}function mI(a){const{chains:t,optionalChains:r,methods:s,optionalMethods:o,events:u,optionalEvents:l,rpcMap:g}=a;if(!co(t))throw new Error("Invalid chains");const w={chains:t,methods:s||_s,events:u||bs,rpcMap:pi({},t.length?{[Es(t)]:g[Es(t)]}:{})},b=u==null?void 0:u.filter(q=>!bs.includes(q)),C=s==null?void 0:s.filter(q=>!_s.includes(q));if(!r&&!l&&!o&&!(b!=null&&b.length)&&!(C!=null&&C.length))return{required:t.length?w:void 0};const O=(b==null?void 0:b.length)&&(C==null?void 0:C.length)||!r,N={chains:[...new Set(O?w.chains.concat(r||[]):r)],methods:[...new Set(w.methods.concat(o!=null&&o.length?o:il))],events:[...new Set(w.events.concat(l!=null&&l.length?l:sl))],rpcMap:g};return{required:t.length?w:void 0,optional:r.length?N:void 0}}class Os{constructor(){this.events=new U.eventsExports.EventEmitter,this.namespace="eip155",this.accounts=[],this.chainId=1,this.STORAGE_KEY=lI,this.on=(t,r)=>(this.events.on(t,r),this),this.once=(t,r)=>(this.events.once(t,r),this),this.removeListener=(t,r)=>(this.events.removeListener(t,r),this),this.off=(t,r)=>(this.events.off(t,r),this),this.parseAccount=t=>this.isCompatibleChainId(t)?this.parseAccountId(t).address:t,this.signer={},this.rpc={}}static async init(t){const r=new Os;return await r.initialize(t),r}async request(t){return await this.signer.request(t,this.formatChainId(this.chainId))}sendAsync(t,r){this.signer.sendAsync(t,r,this.formatChainId(this.chainId))}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(t){if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(t);const{required:r,optional:s}=mI(this.rpc);try{const o=await new Promise(async(l,g)=>{var w;this.rpc.showQrModal&&((w=this.modal)==null||w.subscribeModal(b=>{!b.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),g(new Error("Connection request reset. Please try again.")))})),await this.signer.connect(vh(pi({namespaces:pi({},r&&{[this.namespace]:r})},s&&{optionalNamespaces:{[this.namespace]:s}}),{pairingTopic:t==null?void 0:t.pairingTopic})).then(b=>{l(b)}).catch(b=>{g(new Error(b.message))})});if(!o)return;const u=pw(o.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:u),this.setAccounts(u),this.events.emit("connect",{chainId:ao(this.chainId)})}catch(o){throw this.signer.logger.error(o),o}finally{this.modal&&this.modal.closeModal()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",t=>{const{params:r}=t,{event:s}=r;s.name==="accountsChanged"?(this.accounts=this.parseAccounts(s.data),this.events.emit("accountsChanged",this.accounts)):s.name==="chainChanged"?this.setChainId(this.formatChainId(s.data)):this.events.emit(s.name,s.data),this.events.emit("session_event",t)}),this.signer.on("chainChanged",t=>{const r=parseInt(t);this.chainId=r,this.events.emit("chainChanged",ao(this.chainId)),this.persist()}),this.signer.on("session_update",t=>{this.events.emit("session_update",t)}),this.signer.on("session_delete",t=>{this.reset(),this.events.emit("session_delete",t),this.events.emit("disconnect",vh(pi({},dw("USER_DISCONNECTED")),{data:t.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",t=>{var r,s;this.rpc.showQrModal&&((r=this.modal)==null||r.closeModal(),(s=this.modal)==null||s.openModal({uri:t})),this.events.emit("display_uri",t)})}switchEthereumChain(t){this.request({method:"wallet_switchEthereumChain",params:[{chainId:t.toString(16)}]})}isCompatibleChainId(t){return typeof t=="string"?t.startsWith(`${this.namespace}:`):!1}formatChainId(t){return`${this.namespace}:${t}`}parseChainId(t){return Number(t.split(":")[1])}setChainIds(t){const r=t.filter(s=>this.isCompatibleChainId(s)).map(s=>this.parseChainId(s));r.length&&(this.chainId=r[0],this.events.emit("chainChanged",ao(this.chainId)),this.persist())}setChainId(t){if(this.isCompatibleChainId(t)){const r=this.parseChainId(t);this.chainId=r,this.switchEthereumChain(r)}}parseAccountId(t){const[r,s,o]=t.split(":");return{chainId:`${r}:${s}`,address:o}}setAccounts(t){this.accounts=t.filter(r=>this.parseChainId(this.parseAccountId(r).chainId)===this.chainId).map(r=>this.parseAccountId(r).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(t){var r,s;const o=(r=t==null?void 0:t.chains)!=null?r:[],u=(s=t==null?void 0:t.optionalChains)!=null?s:[],l=o.concat(u);if(!l.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const g=o.length?(t==null?void 0:t.methods)||_s:[],w=o.length?(t==null?void 0:t.events)||bs:[],b=(t==null?void 0:t.optionalMethods)||[],C=(t==null?void 0:t.optionalEvents)||[],O=(t==null?void 0:t.rpcMap)||this.buildRpcMap(l,t.projectId),N=(t==null?void 0:t.qrModalOptions)||void 0;return{chains:o==null?void 0:o.map(q=>this.formatChainId(q)),optionalChains:u.map(q=>this.formatChainId(q)),methods:g,events:w,optionalMethods:b,optionalEvents:C,rpcMap:O,showQrModal:!!(t!=null&&t.showQrModal),qrModalOptions:N,projectId:t.projectId,metadata:t.metadata}}buildRpcMap(t,r){const s={};return t.forEach(o=>{s[o]=this.getRpcUrl(o,r)}),s}async initialize(t){if(this.rpc=this.getRpcConfig(t),this.chainId=this.rpc.chains.length?Es(this.rpc.chains):Es(this.rpc.optionalChains),this.signer=await cI.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:t.disableProviderPing,relayUrl:t.relayUrl,storageOptions:t.storageOptions}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let r;try{const{WalletConnectModal:s}=await Promise.resolve().then(()=>require("./index-CyX-UVCQ.js")).then(o=>o.index);r=s}catch{throw new Error("To use QR modal, please install @walletconnect/modal package")}if(r)try{this.modal=new r(pi({projectId:this.rpc.projectId},this.rpc.qrModalOptions))}catch(s){throw this.signer.logger.error(s),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(t){if(!t)return;const{chains:r,optionalChains:s,rpcMap:o}=t;r&&co(r)&&(this.rpc.chains=r.map(u=>this.formatChainId(u)),r.forEach(u=>{this.rpc.rpcMap[u]=(o==null?void 0:o[u])||this.getRpcUrl(u)})),s&&co(s)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=s==null?void 0:s.map(u=>this.formatChainId(u)),s.forEach(u=>{this.rpc.rpcMap[u]=(o==null?void 0:o[u])||this.getRpcUrl(u)}))}getRpcUrl(t,r){var s;return((s=this.rpc.rpcMap)==null?void 0:s[t])||`${pI}?chainId=eip155:${t}&projectId=${r||this.rpc.projectId}`}async loadPersistedSession(){if(!this.session)return;const t=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),r=this.session.namespaces[`${this.namespace}:${t}`]?this.session.namespaces[`${this.namespace}:${t}`]:this.session.namespaces[this.namespace];this.setChainIds(t?[this.formatChainId(t)]:r==null?void 0:r.accounts),this.setAccounts(r==null?void 0:r.accounts)}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(t){return typeof t=="string"||t instanceof String?[this.parseAccount(t)]:t.map(r=>this.parseAccount(r))}}const wI=Os;exports.EthereumProvider=wI;exports.OPTIONAL_EVENTS=sl;exports.OPTIONAL_METHODS=il;exports.REQUIRED_EVENTS=bs;exports.REQUIRED_METHODS=_s;exports.default=Os;
