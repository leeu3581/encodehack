"use strict";var q=Object.defineProperty;var z=(r,e,t)=>e in r?q(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var S=(r,e,t)=>z(r,typeof e!="symbol"?e+"":e,t);Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const i=require("./index-Cq7ztix4.js"),O=require("./index-9m_2ZvS5.js");var w={};Object.defineProperty(w,"__esModule",{value:!0});w.bech32m=m=w.bech32=void 0;const v="qpzry9x8gf2tvdw0s3jn54khce6mua7l",R={};for(let r=0;r<v.length;r++){const e=v.charAt(r);R[e]=r}function y(r){const e=r>>25;return(r&33554431)<<5^-(e>>0&1)&996825010^-(e>>1&1)&642813549^-(e>>2&1)&513874426^-(e>>3&1)&1027748829^-(e>>4&1)&705979059}function B(r){let e=1;for(let t=0;t<r.length;++t){const n=r.charCodeAt(t);if(n<33||n>126)return"Invalid prefix ("+r+")";e=y(e)^n>>5}e=y(e);for(let t=0;t<r.length;++t){const n=r.charCodeAt(t);e=y(e)^n&31}return e}function P(r,e,t,n){let o=0,c=0;const s=(1<<t)-1,a=[];for(let u=0;u<r.length;++u)for(o=o<<e|r[u],c+=e;c>=t;)c-=t,a.push(o>>c&s);if(n)c>0&&a.push(o<<t-c&s);else{if(c>=e)return"Excess padding";if(o<<t-c&s)return"Non-zero padding"}return a}function $(r){return P(r,8,5,!0)}function F(r){const e=P(r,5,8,!1);if(Array.isArray(e))return e}function V(r){const e=P(r,5,8,!1);if(Array.isArray(e))return e;throw new Error(e)}function T(r){let e;r==="bech32"?e=1:e=734539939;function t(s,a,u){if(u=u||90,s.length+7+a.length>u)throw new TypeError("Exceeds length limit");s=s.toLowerCase();let d=B(s);if(typeof d=="string")throw new Error(d);let f=s+"1";for(let l=0;l<a.length;++l){const h=a[l];if(h>>5)throw new Error("Non 5-bit word");d=y(d)^h,f+=v.charAt(h)}for(let l=0;l<6;++l)d=y(d);d^=e;for(let l=0;l<6;++l){const h=d>>(5-l)*5&31;f+=v.charAt(h)}return f}function n(s,a){if(a=a||90,s.length<8)return s+" too short";if(s.length>a)return"Exceeds length limit";const u=s.toLowerCase(),d=s.toUpperCase();if(s!==u&&s!==d)return"Mixed-case string "+s;s=u;const f=s.lastIndexOf("1");if(f===-1)return"No separator character for "+s;if(f===0)return"Missing prefix for "+s;const l=s.slice(0,f),h=s.slice(f+1);if(h.length<6)return"Data too short";let p=B(l);if(typeof p=="string")return p;const x=[];for(let E=0;E<h.length;++E){const k=h.charAt(E),A=R[k];if(A===void 0)return"Unknown character "+k;p=y(p)^A,!(E+6>=h.length)&&x.push(A)}return p!==e?"Invalid checksum for "+s:{prefix:l,words:x}}function o(s,a){const u=n(s,a);if(typeof u=="object")return u}function c(s,a){const u=n(s,a);if(typeof u=="object")return u;throw new Error(u)}return{decodeUnsafe:o,decode:c,encode:t,toWords:$,fromWordsUnsafe:F,fromWords:V}}var m=w.bech32=T("bech32");w.bech32m=T("bech32m");function U(r,e){return i.suiBcs.IntentMessage(i.suiBcs.fixedArray(e.length,i.suiBcs.u8())).serialize({intent:{scope:{[r]:!0},version:{V0:!0},appId:{Sui:!0}},value:e}).toBytes()}const _={ED25519:0,Secp256k1:1,Secp256r1:2,MultiSig:3,ZkLogin:5,Passkey:6},G={ED25519:32,Secp256k1:33,Secp256r1:33},L={0:"ED25519",1:"Secp256k1",2:"Secp256r1",3:"MultiSig",5:"ZkLogin",6:"Passkey"};function M(r,e){if(r===e)return!0;if(r.length!==e.length)return!1;for(let t=0;t<r.length;t++)if(r[t]!==e[t])return!1;return!0}class Z{equals(e){return M(this.toRawBytes(),e.toRawBytes())}toBase64(){return i.toBase64(this.toRawBytes())}toString(){throw new Error("`toString` is not implemented on public keys. Use `toBase64()` or `toRawBytes()` instead.")}toSuiPublicKey(){const e=this.toSuiBytes();return i.toBase64(e)}verifyWithIntent(e,t,n){const o=U(n,e),c=i.blake2b(o,{dkLen:32});return this.verify(c,t)}verifyPersonalMessage(e,t){return this.verifyWithIntent(i.suiBcs.vector(i.suiBcs.u8()).serialize(e).toBytes(),t,"PersonalMessage")}verifyTransaction(e,t){return this.verifyWithIntent(e,t,"TransactionData")}verifyAddress(e){return this.toSuiAddress()===e}toSuiBytes(){const e=this.toRawBytes(),t=new Uint8Array(e.length+1);return t.set([this.flag()]),t.set(e,1),t}toSuiAddress(){return i.normalizeSuiAddress(i.bytesToHex(i.blake2b(this.toSuiBytes(),{dkLen:32})).slice(0,i.SUI_ADDRESS_LENGTH*2))}}function j(r){const e=i.fromBase64(r),t=L[e[0]];switch(t){case"ED25519":case"Secp256k1":case"Secp256r1":const n=G[t],o=e.slice(1,e.length-n),c=e.slice(1+o.length);return{serializedSignature:r,signatureScheme:t,signature:o,publicKey:c,bytes:e};default:throw new Error("Unsupported signature scheme")}}function Y({signature:r,signatureScheme:e,publicKey:t}){if(!t)throw new Error("`publicKey` is required");const n=t.toRawBytes(),o=new Uint8Array(1+r.length+n.length);return o.set([_[e]]),o.set(r,1),o.set(n,1+r.length),i.toBase64(o)}const b=32,N="suiprivkey";class X{async signWithIntent(e,t){const n=U(t,e),o=i.blake2b(n,{dkLen:32});return{signature:Y({signature:await this.sign(o),signatureScheme:this.getKeyScheme(),publicKey:this.getPublicKey()}),bytes:i.toBase64(e)}}async signTransaction(e){return this.signWithIntent(e,"TransactionData")}async signPersonalMessage(e){const{signature:t}=await this.signWithIntent(i.bcs.vector(i.bcs.u8()).serialize(e).toBytes(),"PersonalMessage");return{bytes:i.toBase64(e),signature:t}}toSuiAddress(){return this.getPublicKey().toSuiAddress()}}class J extends X{}function Q(r){const{prefix:e,words:t}=m.decode(r);if(e!==N)throw new Error("invalid private key prefix");const n=new Uint8Array(m.fromWords(t)),o=n.slice(1);return{schema:L[n[0]],secretKey:o}}function ee(r,e){if(r.length!==b)throw new Error("Invalid bytes length");const t=_[e],n=new Uint8Array(r.length+1);return n.set([t]),n.set(r,1),m.encode(N,m.toWords(n))}function I(r){return!!new RegExp("^m\\/44'\\/784'\\/[0-9]+'\\/[0-9]+'\\/[0-9]+'+$").test(r)}function te(r){return O.mnemonicToSeedSync(r,"")}function re(r){return i.toHex(te(r))}const ne="ed25519 seed",se=2147483648,ie=new RegExp("^m(\\/[0-9]+')+$"),W=r=>r.replace("'",""),oe=r=>{const t=i.hmac.create(i.sha512,ne).update(i.fromHex(r)).digest(),n=t.slice(0,32),o=t.slice(32);return{key:n,chainCode:o}},ce=({key:r,chainCode:e},t)=>{const n=new ArrayBuffer(4);new DataView(n).setUint32(0,t);const c=new Uint8Array(1+r.length+n.byteLength);c.set(new Uint8Array(1).fill(0)),c.set(r,1),c.set(new Uint8Array(n,0,n.byteLength),r.length+1);const s=i.hmac.create(i.sha512,e).update(c).digest(),a=s.slice(0,32),u=s.slice(32);return{key:a,chainCode:u}},ae=r=>ie.test(r)?!r.split("/").slice(1).map(W).some(isNaN):!1,C=(r,e,t=se)=>{if(!ae(r))throw new Error("Invalid derivation path");const{key:n,chainCode:o}=oe(e);return r.split("/").slice(1).map(W).map(s=>parseInt(s,10)).reduce((s,a)=>ce(s,a+t),{key:n,chainCode:o})},K=32;class H extends Z{constructor(e){if(super(),typeof e=="string"?this.data=i.fromBase64(e):e instanceof Uint8Array?this.data=e:this.data=Uint8Array.from(e),this.data.length!==K)throw new Error(`Invalid public key input. Expected ${K} bytes, got ${this.data.length}`)}equals(e){return super.equals(e)}toRawBytes(){return this.data}flag(){return _.ED25519}async verify(e,t){let n;if(typeof t=="string"){const o=j(t);if(o.signatureScheme!=="ED25519")throw new Error("Invalid signature scheme");if(!M(this.toRawBytes(),o.publicKey))throw new Error("Signature does not match public key");n=o.signature}else n=t;return i.ed25519.verify(n,e,this.toRawBytes())}}H.SIZE=K;const D="m/44'/784'/0'/0'/0'";class g extends J{constructor(e){if(super(),e)this.keypair={publicKey:e.publicKey,secretKey:e.secretKey.slice(0,32)};else{const t=i.ed25519.utils.randomPrivateKey();this.keypair={publicKey:i.ed25519.getPublicKey(t),secretKey:t}}}getKeyScheme(){return"ED25519"}static generate(){const e=i.ed25519.utils.randomPrivateKey();return new g({publicKey:i.ed25519.getPublicKey(e),secretKey:e})}static fromSecretKey(e,t){if(typeof e=="string"){const c=Q(e);if(c.schema!=="ED25519")throw new Error(`Expected a ED25519 keypair, got ${c.schema}`);return this.fromSecretKey(c.secretKey,t)}const n=e.length;if(n!==b)throw new Error(`Wrong secretKey size. Expected ${b} bytes, got ${n}.`);const o={publicKey:i.ed25519.getPublicKey(e),secretKey:e};if(!t||!t.skipValidation){const s=new TextEncoder().encode("sui validation"),a=i.ed25519.sign(s,e);if(!i.ed25519.verify(a,s,o.publicKey))throw new Error("provided secretKey is invalid")}return new g(o)}getPublicKey(){return new H(this.keypair.publicKey)}getSecretKey(){return ee(this.keypair.secretKey.slice(0,b),this.getKeyScheme())}async sign(e){return i.ed25519.sign(e,this.keypair.secretKey)}static deriveKeypair(e,t){if(t==null&&(t=D),!I(t))throw new Error("Invalid derivation path");const{key:n}=C(t,re(e));return g.fromSecretKey(n)}static deriveKeypairFromSeed(e,t){if(t==null&&(t=D),!I(t))throw new Error("Invalid derivation path");const{key:n}=C(t,e);return g.fromSecretKey(n)}}async function ue(r,e){const[,t]=await i.SuiPlatform.chainFromRpc(r);return new le(t,r,g.deriveKeypair(e,"m/44'/784'/0'/0'/0'"))}class le{constructor(e,t,n,o){S(this,"_chain");S(this,"_client");S(this,"_signer");S(this,"_debug");this._chain=e,this._client=t,this._signer=n,this._debug=o}chain(){return this._chain}address(){return this._signer.toSuiAddress()}async signAndSend(e){const t=[];for(const n of e){const{description:o,transaction:c}=n;this._debug&&console.log(`Signing ${o} for ${this.address()}`);try{const s=await this._client.signAndExecuteTransaction({transaction:c,signer:this._signer});t.push(s.digest)}catch(s){throw s}}return t}}const de={Address:i.SuiAddress,Platform:i.SuiPlatform,getSigner:ue,protocols:{WormholeCore:()=>Promise.resolve().then(()=>require("./index-BbtasVJX.js")),TokenBridge:()=>Promise.resolve().then(()=>require("./index-Z-7qlZOV.js")),CircleBridge:()=>Promise.resolve().then(()=>require("./index-DZNCj2gP.js"))},getChain:(r,e,t)=>new i.SuiChain(e,new i.SuiPlatform(r,i.applyChainsConfigConfigOverrides(r,i._platform$3,{[e]:t})))};exports.default=de;
