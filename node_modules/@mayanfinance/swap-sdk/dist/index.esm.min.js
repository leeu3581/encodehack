import ee from"cross-fetch";var l={MAYAN_FORWARDER_CONTRACT:"0x337685fdaB40D39bd02028545a4FfA7D287cC3E2",MAYAN_PROGRAM_ID:"FC4eXxkyrMPTjiYUpp4EAnkmwMbQyZ6NDCh1kfLn6vsf",AUCTION_PROGRAM_ID:"8QJmxZcEzwuYmCPy6XqgN2sHcYCcFq6AEfBMJZZuLo5a",MCTP_PROGRAM_ID:"dkpZqrxHFrhziEMQ931GLtfy11nFkCsfMftH9u6QwBU",SWIFT_PROGRAM_ID:"BLZRi6frs4X4DNLw56V4EXai1b6QVESN1BhHBTYM9VcY",FEE_MANAGER_PROGRAM_ID:"5VtQHnhs2pfVEr68qQsbTRwKh4JV5GTu9mBHgHFxpHeQ",WORMHOLE_PROGRAM_ID:"worm2ZoG2kUd4vFXhvjh93UUH596ayRfgQ2MgjNMTth",CCTP_CORE_PROGRAM_ID:"CCTPmbSD7gX1bxKPAmg77w8oFzNFpaQiQUWD43TKaecd",CCTP_TOKEN_PROGRAM_ID:"CCTPiPYPc6AsJuwueEnWgSgucamXDZwBd53dQ11YiKX3",TOKEN_PROGRAM_ID:"TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA",TOKEN_2022_PROGRAM_ID:"TokenzQdBNbLqP5VEhdkAS6EPFLC1PHnBqCXEpPxuEb",ASSOCIATED_TOKEN_PROGRAM_ID:"ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL",SPL_UTILS_PROGRAM_ID:"B96dV3Luxzo6SokJx3xt8i5y8Mb7HRR6Eec8hCjJDT69",LOOKUP_TABLE:"75X8YgJPcadksw6Ag3qsYUfi1bsFwDoCKYtqPPqdydAG",SUI_MCTP_STATE:"0xb787fe0f7530b4fd2162fa0cc92f4f6c5a97c54b4c5c55eb04ab29f4b803ac9c",SUI_MCTP_FEE_MANAGER_STATE:"0xa1b4a96ce93d36dd0bbce0adc39533a07d2f32928918c80cd6fe7868320978f2",SUI_CCTP_CORE_PACKAGE_ID:"0x08d87d37ba49e785dde270a83f8e979605b03dc552b5548f26fdf2f49bf7ed1b",SUI_CCTP_CORE_STATE:"0xf68268c3d9b1df3215f2439400c1c4ea08ac4ef4bb7d6f3ca6a2a239e17510af",SUI_CCTP_TOKEN_PACKAGE_ID:"0x2aa6c5d56376c371f88a6cc42e852824994993cb9bab8d3e6450cbe3cb32b94e",SUI_CCTP_TOKEN_STATE:"0x45993eecc0382f37419864992c12faee2238f5cfe22b98ad3bf455baf65c8a2f",SUI_WORMHOLE_PACKAGE_ID:"0x5306f64e312b581766351c07af79c72fcb1cd25147157fdc2f8ad76de9a3fb6a",SUI_WORMHOLE_STATE:"0xaeab97f96cf9877fee2883315d459552b2b921edc16d7ceac6eab944dd88919c",SUI_LOGGER_PACKAGE_ID:"0x05680e9030c147b413a489f7891273acc221d49bd061c433e5771bc170fc37ac",EXPLORER_URL:"https://explorer-api.mayan.finance/v3",PRICE_URL:"https://price-api.mayan.finance/v3",RELAYER_URL:"https://relayer-api.mayan.finance/v3"};import{zeroPadValue as qe,parseUnits as jn,formatUnits as Vn}from"ethers";import{PublicKey as Ce,SystemProgram as It}from"@solana/web3.js";import{Buffer as tt}from"buffer";import*as At from"js-sha3";var $n=At.sha3_256,Yn=e=>/^(0x)?[0-9a-fA-F]+::\w+::\w+$/.test(e);function I(e,t){if(t===1)return qe(new Ce(e).toBytes(),32);if(t===j.ethereum||t===j.bsc||t===j.polygon||t===j.avalanche||t===j.arbitrum||t===j.optimism||t===j.base||t===j.unichain)return qe(e,32);if(t===j.aptos&&Yn(e))return`0x${$n(e)}`;if(t===j.sui){let n=e.startsWith("0x")?e.substring(2):e;if(tt.from(n,"hex").length!==32)throw new Error("Invalid sui address: "+e);return qe(e,32)}else throw console.log(`Unsupported chain id: ${t}`,e),new Error("Unsupported token chain")}function W(e){return new Uint8Array(tt.from(e.startsWith("0x")?e.substring(2):e,"hex"))}function F(e,t,n=!1,a=new Ce(l.TOKEN_PROGRAM_ID),i=new Ce(l.ASSOCIATED_TOKEN_PROGRAM_ID)){if(!n&&!Ce.isOnCurve(t.toBuffer()))throw new Error("TokenOwnerOffCurveError");let[o]=Ce.findProgramAddressSync([t.toBuffer(),a.toBuffer(),e.toBuffer()],i);return o}function w(e,t){if(e==null)throw new Error("getAmountOfFractionalAmount: Amount is null or undefined");if(typeof e!="string"&&typeof e!="number")throw new Error("getAmountOfFractionalAmount: Amount is not a string or number");if(typeof e=="string"&&e.length===0)throw new Error("getAmountOfFractionalAmount: Amount is empty");if(!Number.isFinite(Number(e)))throw new Error("getAmountOfFractionalAmount: Amount is not a number");let n=Math.min(8,Number(t)),a=Number(e).toFixed(n+1),i=new RegExp(`^-?\\d+(?:\\.\\d{0,${n}})?`),o=a.match(i);if(!o)throw new Error("getAmountOfFractionalAmount: fixedAmount is null");let s=o[0];return jn(s,Number(t))}function $r(e,t){return Number(Vn(e,t))}var j={solana:1,ethereum:2,bsc:4,polygon:5,avalanche:6,arbitrum:23,optimism:24,base:30,aptos:22,sui:21,unichain:44};function k(e){return j[e]}var et={[1]:2,[56]:4,[137]:5,[43114]:6,[42161]:23,[10]:24,[8453]:30,[130]:44};function ht(e){let t=j[e],n=Object.keys(et);for(let a of n)if(et[a]===t)return Number(a);throw new Error(`Unsupported chain: ${e}`)}function X(e){return et[e]}var ge=[10,3,0];function Re(){return ge.join("_")}function Ct(e){return ge[0]<e[0]?!1:ge[0]>e[0]?!0:ge[1]<e[1]?!1:ge[1]>e[1]||ge[2]>=e[2]}function v(e){return e==="solana"?9:18}function St(e){return e==="solana"?9:8}var Jn=BigInt(2)**BigInt(64)-BigInt(1);function R(e){if(e<BigInt(0)||e>Jn)throw new Error(`Invalid u64: ${e}`);let t=tt.alloc(8);return t.writeBigUInt64LE(e),t}var se={value:BigInt(0),deadline:0,v:0,r:`0x${It.programId.toBuffer().toString("hex")}`,s:`0x${It.programId.toBuffer().toString("hex")}`};function Oe(e){return new Promise(t=>{setTimeout(()=>{t()},e)})}function de(e,t){return!e||!t?null:e.type==="WH"?t?.solana||null:e.type==="MCTP"||e.type==="SWIFT"?e.toChain==="solana"?t?.solana||null:e.toChain==="sui"?t?.sui||null:t?.evm||null:null}var Fe=1,De=2,Pt=1;function nt(e){return Object.entries(e).filter(([t,n])=>n!=null&&!Array.isArray(n)).map(([t,n])=>`${encodeURIComponent(t)}=${encodeURIComponent(n)}`).join("&")}async function te(e){if(e.status.toString().startsWith("5")){let t;try{let n=await e.json();(n?.code||n?.statusCode)&&(n?.message||n?.msg)&&(t={code:n?.code||n?.statusCode,message:n?.message||n?.msg})}catch{t=new Error("Internal server error")}throw t}}async function Xr(e){let t=e?`?standard=${e.join(",")}`:"",n=await ee(`${l.PRICE_URL}/tokens${t}`,{method:"GET",redirect:"follow"});if(await te(n),n.status===200)return await n.json();throw new Error("Cannot fetch Mayan tokens!")}async function qr(e,t=!1,n){let a={chain:e,nonPortal:t,standard:n?n?.join(","):void 0},i=await ee(`${l.PRICE_URL}/tokens?${nt(a)}`);if(await te(i),i.status===200)return(await i.json())[e];throw new Error("Cannot fetch Mayan tokens!")}function zn(e,t={wormhole:!0,swift:!0,mctp:!0,shuttle:!0,gasless:!1,onlyDirect:!1}){let{gasDrop:n,referrerBps:a}=e,i=e.slippageBps;i!=="auto"&&!Number.isFinite(i)&&(i=e.slippage*100);let s={...{wormhole:t.wormhole!==!1,swift:t.swift!==!1,mctp:t.mctp!==!1,shuttle:t.shuttle===!0,gasless:t.gasless===!0,onlyDirect:t.onlyDirect===!0},solanaProgram:l.MAYAN_PROGRAM_ID,forwarderAddress:l.MAYAN_FORWARDER_CONTRACT,amountIn:!e.amountIn64&&Number.isFinite(e.amount)?e.amount:void 0,amountIn64:e.amountIn64,fromToken:e.fromToken,fromChain:e.fromChain,toToken:e.toToken,toChain:e.toChain,slippageBps:i,referrer:e.referrer,referrerBps:Number.isFinite(a)?a:void 0,gasDrop:Number.isFinite(n)?n:void 0,sdkVersion:Re()},r=`${l.PRICE_URL}/quote?`,p=nt(s);return r+p}async function ea(e,t={swift:!0,mctp:!0,gasless:!1,onlyDirect:!1}){let n=zn(e,t),a=await ee(n,{method:"GET",redirect:"follow"});await te(a);let i=await a.json();if(a.status!==200&&a.status!==201)throw{code:i?.code||0,message:i?.msg||i?.message||"Route not found",data:i?.data};if(!Ct(i.minimumSdkVersion))throw{code:9999,message:"Swap SDK is outdated!"};return i.quotes}async function ta(e){let t=await ee(`${l.PRICE_URL}/clock/${e}`,{method:"GET",redirect:"follow"});await te(t);let n=await t.json();if(t.status!==200&&t.status!==201)throw n;return n.clock}async function _t(){let e=await ee(`${l.RELAYER_URL}/active-relayers?solanaProgram=${l.MAYAN_PROGRAM_ID}`,{method:"GET",redirect:"follow"});await te(e);let t=await e.json();if(e.status!==200&&e.status!==201)throw t;return t.suggested}async function xe(e){let t=nt({...e,sdkVersion:Re()}),n=await ee(`${l.PRICE_URL}/get-swap/solana?${t}`,{method:"GET",redirect:"follow"});await te(n);let a=await n.json();if(n.status!==200&&n.status!==201)throw a;return a}async function kt(e){let t=JSON.stringify({...e,sdkVersion:Re()}),n=`${l.PRICE_URL}/get-swap/sui`,a=await ee(n,{method:"POST",redirect:"follow",body:t,headers:{"Content-Type":"application/json"}});await te(a);let i=await a.json();if(a.status!==200&&a.status!==201)throw i;return i}async function Mt(e,t){let n=await ee(`${l.EXPLORER_URL}/submit/evm`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...e,signature:t},(a,i)=>typeof i=="bigint"?i.toString():i)});await te(n)}async function Et(e){let t=await ee(`${l.EXPLORER_URL}/submit/solana`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({signedTx:e})});await te(t);let n=await t.json();if(t.status!==200&&t.status!==201)throw n;return n}import{Contract as _n,toBeHex as kn,ZeroAddress as En}from"ethers";import{PublicKey as yt,SystemProgram as Dr}from"@solana/web3.js";var Rt={_format:"hh-sol-artifact-1",contractName:"MayanSwap",sourceName:"src/MayanSwap.sol",abi:[{inputs:[{internalType:"address",name:"_tokenBridge",type:"address"},{internalType:"address",name:"_weth",type:"address"}],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint16",name:"emitterChainId",type:"uint16"},{indexed:!0,internalType:"bytes32",name:"emitterAddress",type:"bytes32"},{indexed:!0,internalType:"uint64",name:"sequence",type:"uint64"}],name:"Redeemed",type:"event"},{inputs:[{internalType:"address",name:"newGuardian",type:"address"}],name:"changeGuardian",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"claimGuardian",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{components:[{internalType:"uint8",name:"payloadId",type:"uint8"},{internalType:"bytes32",name:"tokenAddr",type:"bytes32"},{internalType:"uint16",name:"tokenChainId",type:"uint16"},{internalType:"bytes32",name:"destAddr",type:"bytes32"},{internalType:"uint16",name:"destChainId",type:"uint16"},{internalType:"bytes32",name:"sourceAddr",type:"bytes32"},{internalType:"uint16",name:"sourceChainId",type:"uint16"},{internalType:"uint64",name:"sequence",type:"uint64"},{internalType:"uint64",name:"amountOutMin",type:"uint64"},{internalType:"uint64",name:"deadline",type:"uint64"},{internalType:"uint64",name:"swapFee",type:"uint64"},{internalType:"uint64",name:"redeemFee",type:"uint64"},{internalType:"uint64",name:"refundFee",type:"uint64"},{internalType:"bytes32",name:"auctionAddr",type:"bytes32"},{internalType:"bool",name:"unwrapRedeem",type:"bool"},{internalType:"bool",name:"unwrapRefund",type:"bool"}],internalType:"struct MayanStructs.Swap",name:"s",type:"tuple"}],name:"encodeSwap",outputs:[{internalType:"bytes",name:"encoded",type:"bytes"}],stateMutability:"pure",type:"function"},{inputs:[],name:"getWeth",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"isPaused",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes",name:"encoded",type:"bytes"}],name:"parseRedeemPayload",outputs:[{components:[{internalType:"uint8",name:"payloadId",type:"uint8"},{internalType:"bytes32",name:"recipient",type:"bytes32"},{internalType:"uint64",name:"relayerFee",type:"uint64"},{internalType:"bool",name:"unwrap",type:"bool"},{internalType:"uint64",name:"gasDrop",type:"uint64"},{internalType:"bytes",name:"customPayload",type:"bytes"}],internalType:"struct MayanStructs.Redeem",name:"r",type:"tuple"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"bytes",name:"encodedVm",type:"bytes"}],name:"redeem",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"bytes",name:"encodedVm",type:"bytes"}],name:"redeemAndUnwrap",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bool",name:"_pause",type:"bool"}],name:"setPause",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{components:[{internalType:"uint64",name:"swapFee",type:"uint64"},{internalType:"uint64",name:"redeemFee",type:"uint64"},{internalType:"uint64",name:"refundFee",type:"uint64"}],internalType:"struct MayanSwap.RelayerFees",name:"relayerFees",type:"tuple"},{components:[{internalType:"bytes32",name:"mayanAddr",type:"bytes32"},{internalType:"uint16",name:"mayanChainId",type:"uint16"},{internalType:"bytes32",name:"auctionAddr",type:"bytes32"},{internalType:"bytes32",name:"destAddr",type:"bytes32"},{internalType:"uint16",name:"destChainId",type:"uint16"},{internalType:"bytes32",name:"referrer",type:"bytes32"},{internalType:"bytes32",name:"refundAddr",type:"bytes32"}],internalType:"struct MayanSwap.Recepient",name:"recipient",type:"tuple"},{internalType:"bytes32",name:"tokenOutAddr",type:"bytes32"},{internalType:"uint16",name:"tokenOutChainId",type:"uint16"},{components:[{internalType:"uint256",name:"transferDeadline",type:"uint256"},{internalType:"uint64",name:"swapDeadline",type:"uint64"},{internalType:"uint64",name:"amountOutMin",type:"uint64"},{internalType:"bool",name:"unwrap",type:"bool"},{internalType:"uint64",name:"gasDrop",type:"uint64"},{internalType:"bytes",name:"customPayload",type:"bytes"}],internalType:"struct MayanSwap.Criteria",name:"criteria",type:"tuple"},{internalType:"address",name:"tokenIn",type:"address"},{internalType:"uint256",name:"amountIn",type:"uint256"}],name:"swap",outputs:[{internalType:"uint64",name:"sequence",type:"uint64"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"uint256",name:"amount",type:"uint256"},{internalType:"address payable",name:"to",type:"address"}],name:"sweepEth",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"token",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"},{internalType:"address",name:"to",type:"address"}],name:"sweepToken",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{components:[{internalType:"uint64",name:"swapFee",type:"uint64"},{internalType:"uint64",name:"redeemFee",type:"uint64"},{internalType:"uint64",name:"refundFee",type:"uint64"}],internalType:"struct MayanSwap.RelayerFees",name:"relayerFees",type:"tuple"},{components:[{internalType:"bytes32",name:"mayanAddr",type:"bytes32"},{internalType:"uint16",name:"mayanChainId",type:"uint16"},{internalType:"bytes32",name:"auctionAddr",type:"bytes32"},{internalType:"bytes32",name:"destAddr",type:"bytes32"},{internalType:"uint16",name:"destChainId",type:"uint16"},{internalType:"bytes32",name:"referrer",type:"bytes32"},{internalType:"bytes32",name:"refundAddr",type:"bytes32"}],internalType:"struct MayanSwap.Recepient",name:"recipient",type:"tuple"},{internalType:"bytes32",name:"tokenOutAddr",type:"bytes32"},{internalType:"uint16",name:"tokenOutChainId",type:"uint16"},{components:[{internalType:"uint256",name:"transferDeadline",type:"uint256"},{internalType:"uint64",name:"swapDeadline",type:"uint64"},{internalType:"uint64",name:"amountOutMin",type:"uint64"},{internalType:"bool",name:"unwrap",type:"bool"},{internalType:"uint64",name:"gasDrop",type:"uint64"},{internalType:"bytes",name:"customPayload",type:"bytes"}],internalType:"struct MayanSwap.Criteria",name:"criteria",type:"tuple"}],name:"wrapAndSwapETH",outputs:[{internalType:"uint64",name:"sequence",type:"uint64"}],stateMutability:"payable",type:"function"},{stateMutability:"payable",type:"receive"}]};var oe={_format:"hh-sol-artifact-1",contractName:"MayanForwarder",sourceName:"src/MayanForwarder.sol",abi:[{inputs:[{internalType:"address",name:"_guardian",type:"address"},{internalType:"address[]",name:"_swapProtocols",type:"address[]"},{internalType:"address[]",name:"_mayanProtocols",type:"address[]"}],stateMutability:"nonpayable",type:"constructor"},{inputs:[],name:"UnsupportedProtocol",type:"error"},{anonymous:!1,inputs:[{indexed:!1,internalType:"address",name:"token",type:"address"},{indexed:!1,internalType:"uint256",name:"amount",type:"uint256"},{indexed:!1,internalType:"address",name:"mayanProtocol",type:"address"},{indexed:!1,internalType:"bytes",name:"protocolData",type:"bytes"}],name:"ForwardedERC20",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"address",name:"mayanProtocol",type:"address"},{indexed:!1,internalType:"bytes",name:"protocolData",type:"bytes"}],name:"ForwardedEth",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"uint256",name:"amount",type:"uint256"}],name:"SwapAndForwarded",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"address",name:"tokenIn",type:"address"},{indexed:!1,internalType:"uint256",name:"amountIn",type:"uint256"},{indexed:!1,internalType:"address",name:"swapProtocol",type:"address"},{indexed:!1,internalType:"address",name:"middleToken",type:"address"},{indexed:!1,internalType:"uint256",name:"middleAmount",type:"uint256"},{indexed:!1,internalType:"address",name:"mayanProtocol",type:"address"},{indexed:!1,internalType:"bytes",name:"mayanData",type:"bytes"}],name:"SwapAndForwardedERC20",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"uint256",name:"amountIn",type:"uint256"},{indexed:!1,internalType:"address",name:"swapProtocol",type:"address"},{indexed:!1,internalType:"address",name:"middleToken",type:"address"},{indexed:!1,internalType:"uint256",name:"middleAmount",type:"uint256"},{indexed:!1,internalType:"address",name:"mayanProtocol",type:"address"},{indexed:!1,internalType:"bytes",name:"mayanData",type:"bytes"}],name:"SwapAndForwardedEth",type:"event"},{inputs:[{internalType:"address",name:"newGuardian",type:"address"}],name:"changeGuardian",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"claimGuardian",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"tokenIn",type:"address"},{internalType:"uint256",name:"amountIn",type:"uint256"},{components:[{internalType:"uint256",name:"value",type:"uint256"},{internalType:"uint256",name:"deadline",type:"uint256"},{internalType:"uint8",name:"v",type:"uint8"},{internalType:"bytes32",name:"r",type:"bytes32"},{internalType:"bytes32",name:"s",type:"bytes32"}],internalType:"struct MayanForwarder.PermitParams",name:"permitParams",type:"tuple"},{internalType:"address",name:"mayanProtocol",type:"address"},{internalType:"bytes",name:"protocolData",type:"bytes"}],name:"forwardERC20",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address",name:"mayanProtocol",type:"address"},{internalType:"bytes",name:"protocolData",type:"bytes"}],name:"forwardEth",outputs:[],stateMutability:"payable",type:"function"},{inputs:[],name:"guardian",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"}],name:"mayanProtocols",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[],name:"nextGuardian",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"amount",type:"uint256"},{internalType:"address payable",name:"to",type:"address"}],name:"rescueEth",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"token",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"},{internalType:"address",name:"to",type:"address"}],name:"rescueToken",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"mayanProtocol",type:"address"},{internalType:"bool",name:"enabled",type:"bool"}],name:"setMayanProtocol",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"swapProtocol",type:"address"},{internalType:"bool",name:"enabled",type:"bool"}],name:"setSwapProtocol",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"tokenIn",type:"address"},{internalType:"uint256",name:"amountIn",type:"uint256"},{components:[{internalType:"uint256",name:"value",type:"uint256"},{internalType:"uint256",name:"deadline",type:"uint256"},{internalType:"uint8",name:"v",type:"uint8"},{internalType:"bytes32",name:"r",type:"bytes32"},{internalType:"bytes32",name:"s",type:"bytes32"}],internalType:"struct MayanForwarder.PermitParams",name:"permitParams",type:"tuple"},{internalType:"address",name:"swapProtocol",type:"address"},{internalType:"bytes",name:"swapData",type:"bytes"},{internalType:"address",name:"middleToken",type:"address"},{internalType:"uint256",name:"minMiddleAmount",type:"uint256"},{internalType:"address",name:"mayanProtocol",type:"address"},{internalType:"bytes",name:"mayanData",type:"bytes"}],name:"swapAndForwardERC20",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"uint256",name:"amountIn",type:"uint256"},{internalType:"address",name:"swapProtocol",type:"address"},{internalType:"bytes",name:"swapData",type:"bytes"},{internalType:"address",name:"middleToken",type:"address"},{internalType:"uint256",name:"minMiddleAmount",type:"uint256"},{internalType:"address",name:"mayanProtocol",type:"address"},{internalType:"bytes",name:"mayanData",type:"bytes"}],name:"swapAndForwardEth",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"}],name:"swapProtocols",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"}],linkReferences:{},deployedLinkReferences:{}};import{Buffer as Mn}from"buffer";import{Contract as it,toBeHex as J,ZeroAddress as at}from"ethers";import{SystemProgram as Ot}from"@solana/web3.js";var rt={_format:"hh-sol-artifact-1",contractName:"MayanCircle",sourceName:"src/MayanCircle.sol",abi:[{inputs:[{internalType:"address",name:"_cctpTokenMessenger",type:"address"},{internalType:"address",name:"_wormhole",type:"address"},{internalType:"address",name:"_feeManager",type:"address"},{internalType:"uint16",name:"_auctionChainId",type:"uint16"},{internalType:"bytes32",name:"_auctionAddr",type:"bytes32"},{internalType:"uint8",name:"_consistencyLevel",type:"uint8"}],stateMutability:"nonpayable",type:"constructor"},{inputs:[],name:"CallerAlreadySet",type:"error"},{inputs:[],name:"CallerNotSet",type:"error"},{inputs:[],name:"CctpReceiveFailed",type:"error"},{inputs:[],name:"DeadlineViolation",type:"error"},{inputs:[],name:"DomainAlreadySet",type:"error"},{inputs:[],name:"DomainNotSet",type:"error"},{inputs:[],name:"EmitterAlreadySet",type:"error"},{inputs:[],name:"EthTransferFailed",type:"error"},{inputs:[],name:"InvalidAction",type:"error"},{inputs:[],name:"InvalidAddress",type:"error"},{inputs:[],name:"InvalidAmountOut",type:"error"},{inputs:[],name:"InvalidCaller",type:"error"},{inputs:[],name:"InvalidDestAddr",type:"error"},{inputs:[],name:"InvalidDomain",type:"error"},{inputs:[],name:"InvalidEmitter",type:"error"},{inputs:[],name:"InvalidGasDrop",type:"error"},{inputs:[],name:"InvalidMintRecipient",type:"error"},{inputs:[],name:"InvalidNonce",type:"error"},{inputs:[],name:"InvalidOrder",type:"error"},{inputs:[],name:"InvalidPayload",type:"error"},{inputs:[],name:"InvalidProtocolFee",type:"error"},{inputs:[],name:"InvalidRedeemFee",type:"error"},{inputs:[],name:"InvalidReferrerFee",type:"error"},{inputs:[],name:"MintRecipientAlreadySet",type:"error"},{inputs:[],name:"MintRecipientNotSet",type:"error"},{inputs:[],name:"Paused",type:"error"},{inputs:[],name:"Unauthorized",type:"error"},{anonymous:!1,inputs:[{indexed:!1,internalType:"uint32",name:"sourceDomain",type:"uint32"},{indexed:!1,internalType:"uint64",name:"sourceNonce",type:"uint64"},{indexed:!1,internalType:"uint256",name:"amount",type:"uint256"}],name:"OrderFulfilled",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"uint32",name:"sourceDomain",type:"uint32"},{indexed:!1,internalType:"uint64",name:"sourceNonce",type:"uint64"},{indexed:!1,internalType:"uint256",name:"amount",type:"uint256"}],name:"OrderRefunded",type:"event"},{inputs:[],name:"auctionAddr",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"auctionChainId",outputs:[{internalType:"uint16",name:"",type:"uint16"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"tokenIn",type:"address"},{internalType:"uint256",name:"amountIn",type:"uint256"},{internalType:"uint64",name:"redeemFee",type:"uint64"},{internalType:"uint64",name:"gasDrop",type:"uint64"},{internalType:"bytes32",name:"destAddr",type:"bytes32"},{internalType:"uint32",name:"destDomain",type:"uint32"},{internalType:"uint8",name:"payloadType",type:"uint8"},{internalType:"bytes",name:"customPayload",type:"bytes"}],name:"bridgeWithFee",outputs:[{internalType:"uint64",name:"sequence",type:"uint64"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address",name:"tokenIn",type:"address"},{internalType:"uint256",name:"amountIn",type:"uint256"},{internalType:"uint64",name:"gasDrop",type:"uint64"},{internalType:"uint256",name:"redeemFee",type:"uint256"},{internalType:"uint32",name:"destDomain",type:"uint32"},{internalType:"bytes32",name:"destAddr",type:"bytes32"}],name:"bridgeWithLockedFee",outputs:[{internalType:"uint64",name:"cctpNonce",type:"uint64"}],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"cctpTokenMessenger",outputs:[{internalType:"contract ITokenMessenger",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint16",name:"",type:"uint16"}],name:"chainIdToEmitter",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"newGuardian",type:"address"}],name:"changeGuardian",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"claimGuardian",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"consistencyLevel",outputs:[{internalType:"uint8",name:"",type:"uint8"}],stateMutability:"view",type:"function"},{inputs:[{components:[{internalType:"address",name:"tokenIn",type:"address"},{internalType:"uint256",name:"amountIn",type:"uint256"},{internalType:"uint64",name:"gasDrop",type:"uint64"},{internalType:"bytes32",name:"destAddr",type:"bytes32"},{internalType:"uint16",name:"destChain",type:"uint16"},{internalType:"bytes32",name:"tokenOut",type:"bytes32"},{internalType:"uint64",name:"minAmountOut",type:"uint64"},{internalType:"uint64",name:"deadline",type:"uint64"},{internalType:"uint64",name:"redeemFee",type:"uint64"},{internalType:"bytes32",name:"referrerAddr",type:"bytes32"},{internalType:"uint8",name:"referrerBps",type:"uint8"}],internalType:"struct MayanCircle.OrderParams",name:"params",type:"tuple"}],name:"createOrder",outputs:[{internalType:"uint64",name:"sequence",type:"uint64"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"uint32",name:"",type:"uint32"}],name:"domainToCaller",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"feeManager",outputs:[{internalType:"contract IFeeManager",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint64",name:"",type:"uint64"}],name:"feeStorage",outputs:[{internalType:"bytes32",name:"destAddr",type:"bytes32"},{internalType:"uint64",name:"gasDrop",type:"uint64"},{internalType:"address",name:"token",type:"address"},{internalType:"uint256",name:"redeemFee",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes",name:"cctpMsg",type:"bytes"},{internalType:"bytes",name:"cctpSigs",type:"bytes"},{internalType:"bytes",name:"encodedVm",type:"bytes"},{components:[{internalType:"bytes32",name:"destAddr",type:"bytes32"},{internalType:"uint16",name:"destChainId",type:"uint16"},{internalType:"bytes32",name:"tokenOut",type:"bytes32"},{internalType:"uint64",name:"promisedAmount",type:"uint64"},{internalType:"uint64",name:"gasDrop",type:"uint64"},{internalType:"uint64",name:"redeemFee",type:"uint64"},{internalType:"uint64",name:"deadline",type:"uint64"},{internalType:"bytes32",name:"referrerAddr",type:"bytes32"},{internalType:"uint8",name:"referrerBps",type:"uint8"},{internalType:"uint8",name:"protocolBps",type:"uint8"},{internalType:"bytes32",name:"driver",type:"bytes32"}],internalType:"struct MayanCircle.FulfillParams",name:"params",type:"tuple"},{internalType:"address",name:"swapProtocol",type:"address"},{internalType:"bytes",name:"swapData",type:"bytes"}],name:"fulfillOrder",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"uint16",name:"chainId",type:"uint16"}],name:"getDomain",outputs:[{internalType:"uint32",name:"domain",type:"uint32"}],stateMutability:"view",type:"function"},{inputs:[],name:"guardian",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"isPaused",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"",type:"bytes32"}],name:"keyToMintRecipient",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"localDomain",outputs:[{internalType:"uint32",name:"",type:"uint32"}],stateMutability:"view",type:"function"},{inputs:[],name:"paused",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes",name:"cctpMsg",type:"bytes"},{internalType:"bytes",name:"cctpSigs",type:"bytes"},{internalType:"bytes",name:"encodedVm",type:"bytes"},{components:[{internalType:"uint8",name:"payloadType",type:"uint8"},{internalType:"bytes32",name:"destAddr",type:"bytes32"},{internalType:"uint64",name:"gasDrop",type:"uint64"},{internalType:"uint64",name:"redeemFee",type:"uint64"},{internalType:"uint64",name:"burnAmount",type:"uint64"},{internalType:"bytes32",name:"burnToken",type:"bytes32"},{internalType:"bytes32",name:"customPayload",type:"bytes32"}],internalType:"struct MayanCircle.BridgeWithFeeParams",name:"bridgeParams",type:"tuple"}],name:"redeemWithFee",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"bytes",name:"cctpMsg",type:"bytes"},{internalType:"bytes",name:"cctpSigs",type:"bytes"},{internalType:"bytes32",name:"unlockerAddr",type:"bytes32"}],name:"redeemWithLockedFee",outputs:[{internalType:"uint64",name:"sequence",type:"uint64"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"uint32",name:"cctpNonce",type:"uint32"},{internalType:"uint32",name:"cctpDomain",type:"uint32"},{internalType:"bytes32",name:"destAddr",type:"bytes32"},{internalType:"bytes32",name:"unlockerAddr",type:"bytes32"}],name:"refineFee",outputs:[{internalType:"uint64",name:"sequence",type:"uint64"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"bytes",name:"encodedVm",type:"bytes"},{internalType:"bytes",name:"cctpMsg",type:"bytes"},{internalType:"bytes",name:"cctpSigs",type:"bytes"},{components:[{internalType:"address",name:"tokenIn",type:"address"},{internalType:"uint256",name:"amountIn",type:"uint256"},{internalType:"uint64",name:"gasDrop",type:"uint64"},{internalType:"bytes32",name:"destAddr",type:"bytes32"},{internalType:"uint16",name:"destChain",type:"uint16"},{internalType:"bytes32",name:"tokenOut",type:"bytes32"},{internalType:"uint64",name:"minAmountOut",type:"uint64"},{internalType:"uint64",name:"deadline",type:"uint64"},{internalType:"uint64",name:"redeemFee",type:"uint64"},{internalType:"bytes32",name:"referrerAddr",type:"bytes32"},{internalType:"uint8",name:"referrerBps",type:"uint8"}],internalType:"struct MayanCircle.OrderParams",name:"orderParams",type:"tuple"},{components:[{internalType:"bytes32",name:"trader",type:"bytes32"},{internalType:"uint16",name:"sourceChainId",type:"uint16"},{internalType:"uint8",name:"protocolBps",type:"uint8"}],internalType:"struct MayanCircle.ExtraParams",name:"extraParams",type:"tuple"}],name:"refund",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"uint256",name:"amount",type:"uint256"},{internalType:"address payable",name:"to",type:"address"}],name:"rescueEth",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"token",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"},{internalType:"address",name:"to",type:"address"}],name:"rescueToken",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint8",name:"_consistencyLevel",type:"uint8"}],name:"setConsistencyLevel",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint16",name:"chainId",type:"uint16"},{internalType:"uint32",name:"domain",type:"uint32"}],name:"setDomain",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint32",name:"domain",type:"uint32"},{internalType:"bytes32",name:"caller",type:"bytes32"}],name:"setDomainCaller",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint16",name:"chainId",type:"uint16"},{internalType:"bytes32",name:"emitter",type:"bytes32"}],name:"setEmitter",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_feeManager",type:"address"}],name:"setFeeManager",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint32",name:"destDomain",type:"uint32"},{internalType:"address",name:"tokenIn",type:"address"},{internalType:"bytes32",name:"mintRecipient",type:"bytes32"}],name:"setMintRecipient",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bool",name:"_pause",type:"bool"}],name:"setPause",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes",name:"encodedVm",type:"bytes"},{components:[{internalType:"uint8",name:"action",type:"uint8"},{internalType:"uint8",name:"payloadType",type:"uint8"},{internalType:"uint64",name:"cctpNonce",type:"uint64"},{internalType:"uint32",name:"cctpDomain",type:"uint32"},{internalType:"bytes32",name:"unlockerAddr",type:"bytes32"},{internalType:"uint64",name:"gasDrop",type:"uint64"}],internalType:"struct MayanCircle.UnlockFeeMsg",name:"unlockMsg",type:"tuple"}],name:"unlockFee",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes",name:"encodedVm1",type:"bytes"},{internalType:"bytes",name:"encodedVm2",type:"bytes"},{components:[{internalType:"uint8",name:"action",type:"uint8"},{internalType:"uint8",name:"payloadType",type:"uint8"},{internalType:"uint64",name:"cctpNonce",type:"uint64"},{internalType:"uint32",name:"cctpDomain",type:"uint32"},{internalType:"bytes32",name:"unlockerAddr",type:"bytes32"},{internalType:"uint64",name:"gasDrop",type:"uint64"}],internalType:"struct MayanCircle.UnlockFeeMsg",name:"unlockMsg",type:"tuple"},{components:[{internalType:"uint8",name:"action",type:"uint8"},{internalType:"uint8",name:"payloadType",type:"uint8"},{internalType:"uint64",name:"cctpNonce",type:"uint64"},{internalType:"uint32",name:"cctpDomain",type:"uint32"},{internalType:"bytes32",name:"unlockerAddr",type:"bytes32"},{internalType:"uint64",name:"gasDrop",type:"uint64"},{internalType:"bytes32",name:"destAddr",type:"bytes32"}],internalType:"struct MayanCircle.UnlockRefinedFeeMsg",name:"refinedMsg",type:"tuple"}],name:"unlockFeeRefined",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"wormhole",outputs:[{internalType:"contract IWormhole",name:"",type:"address"}],stateMutability:"view",type:"function"},{stateMutability:"payable",type:"receive"}],linkReferences:{},deployedLinkReferences:{}};import{Buffer as Zn}from"buffer";import{PublicKey as q}from"@solana/web3.js";import{Buffer as ne}from"buffer";var L=6;function ye(e){switch(e){case"ethereum":return 0;case"avalanche":return 1;case"optimism":return 2;case"arbitrum":return 3;case"solana":return 5;case"base":return 6;case"polygon":return 7;case"sui":return 8;case"unichain":return 10;default:throw new Error("unsupported chain for cctp")}}function ve(e,t){let n=new q(l.CCTP_CORE_PROGRAM_ID),a=new q(l.CCTP_TOKEN_PROGRAM_ID),[i]=q.findProgramAddressSync([ne.from("message_transmitter")],n),[o]=q.findProgramAddressSync([ne.from("sender_authority")],a),[s]=q.findProgramAddressSync([ne.from("local_token"),e.toBytes()],a),[r]=q.findProgramAddressSync([ne.from("token_messenger")],a),[p]=q.findProgramAddressSync([ne.from("token_minter")],a),u=ye(t),[c]=q.findProgramAddressSync([ne.from("remote_token_messenger"),ne.from(u.toString())],a),[m]=q.findProgramAddressSync([ne.from("__event_authority")],n),[d]=q.findProgramAddressSync([ne.from("__event_authority")],a);return{messageTransmitter:i,senderAuthority:o,remoteTokenMessengerKey:c,tokenMessenger:r,tokenMinter:p,eventAuthToken:d,eventAuthCore:m,localToken:s}}function Xn(e,t,n,a){let i=X(Number(n)),o=k(e.fromChain),s=k(e.toChain);if(o!==i)throw new Error(`Signer chain id(${Number(n)}) and quote from chain are not same! ${o} !== ${i}`);let r=e.cheaperChain===e.fromChain;if(r&&a)throw new Error("Bridge lock fee cannot have custom payload");let p=I(t,s),u=w(e.redeemRelayerFee,L),c=w(e.gasDrop,Math.min(v(e.toChain),8)),m=BigInt(e.effectiveAmountIn64),d=ye(e.toChain);if(!e.mctpMayanContract)throw new Error("MCTP contract address is missing");let f=e.mctpMayanContract;if(e.toChain==="solana"&&r)throw new Error("Cannot lock fee for transfer to solana");let b=w(e.bridgeFee,v(e.fromChain));return r&&(b=BigInt(0)),{lockFee:r,tokenIn:e.mctpInputContract,amountIn:m,redeemFee:u,gasDrop:c,destAddr:p,destDomain:d,payloadType:a?De:Fe,customPayload:a?`0x${Zn.from(a).toString("hex")}`:"0x",bridgeFee:b,contractAddress:f}}function Ft(e,t,n,a){let i=Xn(e,t,n,a),{contractAddress:o,tokenIn:s,amountIn:r,destAddr:p,lockFee:u,redeemFee:c,gasDrop:m,destDomain:d,customPayload:f,payloadType:b,bridgeFee:y}=i,g=new it(o,rt.abi),A,T;return u?A=g.interface.encodeFunctionData("bridgeWithLockedFee",[s,r,m,c,d,p]):A=g.interface.encodeFunctionData("bridgeWithFee",[s,r,c,m,p,d,b,f]),T=J(y),{to:o,data:A,value:T,_params:i}}function qn(e,t,n,a){let i=X(Number(a)),o=k(e.fromChain),s=k(e.toChain);if(o!==i)throw new Error(`Signer chain id(${Number(a)}) and quote from chain are not same! ${o} !== ${i}`);if(!e.mctpMayanContract)throw new Error("MCTP contract address is missing");let r=e.mctpMayanContract,p=I(t,s),u;n?u=I(n,s):u=I(Ot.programId.toString(),k("solana"));let c=w(e.redeemRelayerFee,L),m=w(e.gasDrop,Math.min(v(e.toChain),8)),d=BigInt(e.effectiveAmountIn64),f=w(e.minAmountOut,Math.min(8,e.toToken.decimals)),b=BigInt(e.deadline64),y=e.toToken.contract===at?I(Ot.programId.toString(),k("solana")):I(e.toChain==="sui"?e.toToken.verifiedAddress:e.toToken.contract,e.toToken.wChainId);return{params:{tokenIn:e.mctpInputContract,amountIn:d,gasDrop:m,destAddr:p,destChain:s,tokenOut:y,minAmountOut:f,deadline:b,redeemFee:c,referrerAddr:u,referrerBps:e.referrerBps||0},bridgeFee:w(e.bridgeFee,v(e.fromChain)),contractAddress:r}}function Dt(e,t,n,a){let i=qn(e,t,n,a),{contractAddress:o,params:s,bridgeFee:r}=i,u=new it(o,rt.abi).interface.encodeFunctionData("createOrder",[s]),c=J(r);return{to:o,data:u,value:c,_params:i}}function xt(e,t,n,a,i,o){if(e.type!=="MCTP")throw new Error("Quote type is not MCTP");if(!Number.isFinite(Number(a)))throw new Error("Invalid signer chain id");a=Number(a);let s=i||se,r=new it(l.MAYAN_FORWARDER_CONTRACT,oe.abi),p=w(e.bridgeFee,v(e.fromChain)),u=J(p);if(e.fromToken.contract===e.mctpInputContract)if(e.hasAuction){if(!Number(e.deadline64))throw new Error("MCTP order requires timeout");let c=Dt(e,t,n,a),m="forwardERC20",d=[e.fromToken.contract,c._params.params.amountIn,s,c._params.contractAddress,c.data];return{data:r.interface.encodeFunctionData(m,d),to:l.MAYAN_FORWARDER_CONTRACT,value:J(u),chainId:a,_forwarder:{method:m,params:d}}}else{let c=Ft(e,t,a,o),m="forwardERC20",d=[e.fromToken.contract,c._params.amountIn,s,c._params.contractAddress,c.data];return{data:r.interface.encodeFunctionData(m,d),to:l.MAYAN_FORWARDER_CONTRACT,value:J(u),chainId:a,_forwarder:{method:m,params:d}}}else{let{minMiddleAmount:c,evmSwapRouterAddress:m,evmSwapRouterCalldata:d}=e;if(!c||!m||!d)throw new Error("MCTP swap requires middle amount, router address and calldata");if(e.hasAuction){if(!Number(e.deadline64))throw new Error("MCTP order requires timeout");let f=Dt(e,t,n,a),b=w(e.minMiddleAmount,L);if(e.fromToken.contract===at){let y=f._params.params.amountIn;if(y<=p)throw new Error("Amount in is less than bridge fee");p!==BigInt(0)&&(y-=p),u=J(f._params.params.amountIn);let g="swapAndForwardEth",A=[y,m,d,e.mctpInputContract,b,f._params.contractAddress,f.data];return{data:r.interface.encodeFunctionData(g,A),to:l.MAYAN_FORWARDER_CONTRACT,value:J(u),chainId:a,_forwarder:{method:g,params:A}}}else{let y="swapAndForwardERC20",g=[e.fromToken.contract,f._params.params.amountIn,s,m,d,e.mctpInputContract,b,f._params.contractAddress,f.data];return{data:r.interface.encodeFunctionData(y,g),to:l.MAYAN_FORWARDER_CONTRACT,value:J(u),chainId:a,_forwarder:{method:y,params:g}}}}else{let f=Ft(e,t,a,o),b=w(e.minMiddleAmount,L);if(e.fromToken.contract===at){let y=f._params.amountIn;if(y<=p)throw new Error("Amount in is less than bridge fee");p!==BigInt(0)&&(y-=p),u=J(f._params.amountIn);let g="swapAndForwardEth",A=[y,m,d,e.mctpInputContract,b,f._params.contractAddress,f.data];return{data:r.interface.encodeFunctionData(g,A),to:l.MAYAN_FORWARDER_CONTRACT,value:J(u),chainId:a,_forwarder:{method:g,params:A}}}else{let y="swapAndForwardERC20",g=[e.fromToken.contract,f._params.amountIn,s,m,d,e.mctpInputContract,b,f._params.contractAddress,f.data];return{data:r.interface.encodeFunctionData(y,g),to:l.MAYAN_FORWARDER_CONTRACT,value:J(u),chainId:a,_forwarder:{method:y,params:g}}}}}}import{Contract as gn,toBeHex as Ye,ZeroAddress as Je}from"ethers";import{Keypair as Er,SystemProgram as Tn}from"@solana/web3.js";var vt={_format:"hh-sol-artifact-1",contractName:"MayanSwift",sourceName:"src/MayanSwift.sol",abi:[{inputs:[{internalType:"address",name:"_wormhole",type:"address"},{internalType:"address",name:"_feeManager",type:"address"},{internalType:"uint16",name:"_auctionChainId",type:"uint16"},{internalType:"bytes32",name:"_auctionAddr",type:"bytes32"},{internalType:"bytes32",name:"_solanaEmitter",type:"bytes32"},{internalType:"uint8",name:"_consistencyLevel",type:"uint8"}],stateMutability:"nonpayable",type:"constructor"},{inputs:[],name:"DeadlineViolation",type:"error"},{inputs:[],name:"DuplicateOrder",type:"error"},{inputs:[],name:"FeesTooHigh",type:"error"},{inputs:[],name:"InvalidAction",type:"error"},{inputs:[],name:"InvalidAmount",type:"error"},{inputs:[],name:"InvalidAuctionMode",type:"error"},{inputs:[],name:"InvalidBpsFee",type:"error"},{inputs:[],name:"InvalidContractSignature",type:"error"},{inputs:[],name:"InvalidDestChain",type:"error"},{inputs:[],name:"InvalidEmitterAddress",type:"error"},{inputs:[],name:"InvalidEmitterChain",type:"error"},{inputs:[],name:"InvalidEvmAddr",type:"error"},{inputs:[],name:"InvalidGasDrop",type:"error"},{inputs:[],name:"InvalidOrderHash",type:"error"},{inputs:[],name:"InvalidOrderStatus",type:"error"},{inputs:[],name:"InvalidSignature",type:"error"},{inputs:[],name:"InvalidSignatureLength",type:"error"},{inputs:[],name:"InvalidSigner",type:"error"},{inputs:[],name:"InvalidSrcChain",type:"error"},{inputs:[],name:"InvalidWormholeFee",type:"error"},{inputs:[],name:"OrderNotExists",type:"error"},{inputs:[],name:"Paused",type:"error"},{inputs:[],name:"SmallAmountIn",type:"error"},{inputs:[],name:"Unauthorized",type:"error"},{anonymous:!1,inputs:[{indexed:!1,internalType:"bytes32",name:"key",type:"bytes32"},{indexed:!1,internalType:"uint64",name:"sequence",type:"uint64"}],name:"OrderCanceled",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"bytes32",name:"key",type:"bytes32"}],name:"OrderCreated",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"bytes32",name:"key",type:"bytes32"},{indexed:!1,internalType:"uint64",name:"sequence",type:"uint64"},{indexed:!1,internalType:"uint256",name:"netAmount",type:"uint256"}],name:"OrderFulfilled",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"bytes32",name:"key",type:"bytes32"},{indexed:!1,internalType:"uint256",name:"netAmount",type:"uint256"}],name:"OrderRefunded",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"bytes32",name:"key",type:"bytes32"}],name:"OrderUnlocked",type:"event"},{inputs:[],name:"auctionAddr",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"auctionChainId",outputs:[{internalType:"uint16",name:"",type:"uint16"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"tokenIn",type:"bytes32"},{components:[{internalType:"bytes32",name:"trader",type:"bytes32"},{internalType:"bytes32",name:"tokenOut",type:"bytes32"},{internalType:"uint64",name:"minAmountOut",type:"uint64"},{internalType:"uint64",name:"gasDrop",type:"uint64"},{internalType:"uint64",name:"cancelFee",type:"uint64"},{internalType:"uint64",name:"refundFee",type:"uint64"},{internalType:"uint64",name:"deadline",type:"uint64"},{internalType:"bytes32",name:"destAddr",type:"bytes32"},{internalType:"uint16",name:"destChainId",type:"uint16"},{internalType:"bytes32",name:"referrerAddr",type:"bytes32"},{internalType:"uint8",name:"referrerBps",type:"uint8"},{internalType:"uint8",name:"auctionMode",type:"uint8"},{internalType:"bytes32",name:"random",type:"bytes32"}],internalType:"struct MayanSwift.OrderParams",name:"params",type:"tuple"},{internalType:"uint16",name:"srcChainId",type:"uint16"},{internalType:"uint8",name:"protocolBps",type:"uint8"},{internalType:"bytes32",name:"canceler",type:"bytes32"}],name:"cancelOrder",outputs:[{internalType:"uint64",name:"sequence",type:"uint64"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address",name:"newGuardian",type:"address"}],name:"changeGuardian",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"claimGuardian",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"consistencyLevel",outputs:[{internalType:"uint8",name:"",type:"uint8"}],stateMutability:"view",type:"function"},{inputs:[{components:[{internalType:"bytes32",name:"trader",type:"bytes32"},{internalType:"bytes32",name:"tokenOut",type:"bytes32"},{internalType:"uint64",name:"minAmountOut",type:"uint64"},{internalType:"uint64",name:"gasDrop",type:"uint64"},{internalType:"uint64",name:"cancelFee",type:"uint64"},{internalType:"uint64",name:"refundFee",type:"uint64"},{internalType:"uint64",name:"deadline",type:"uint64"},{internalType:"bytes32",name:"destAddr",type:"bytes32"},{internalType:"uint16",name:"destChainId",type:"uint16"},{internalType:"bytes32",name:"referrerAddr",type:"bytes32"},{internalType:"uint8",name:"referrerBps",type:"uint8"},{internalType:"uint8",name:"auctionMode",type:"uint8"},{internalType:"bytes32",name:"random",type:"bytes32"}],internalType:"struct MayanSwift.OrderParams",name:"params",type:"tuple"}],name:"createOrderWithEth",outputs:[{internalType:"bytes32",name:"orderHash",type:"bytes32"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address",name:"tokenIn",type:"address"},{internalType:"uint256",name:"amountIn",type:"uint256"},{components:[{internalType:"bytes32",name:"trader",type:"bytes32"},{internalType:"bytes32",name:"tokenOut",type:"bytes32"},{internalType:"uint64",name:"minAmountOut",type:"uint64"},{internalType:"uint64",name:"gasDrop",type:"uint64"},{internalType:"uint64",name:"cancelFee",type:"uint64"},{internalType:"uint64",name:"refundFee",type:"uint64"},{internalType:"uint64",name:"deadline",type:"uint64"},{internalType:"bytes32",name:"destAddr",type:"bytes32"},{internalType:"uint16",name:"destChainId",type:"uint16"},{internalType:"bytes32",name:"referrerAddr",type:"bytes32"},{internalType:"uint8",name:"referrerBps",type:"uint8"},{internalType:"uint8",name:"auctionMode",type:"uint8"},{internalType:"bytes32",name:"random",type:"bytes32"}],internalType:"struct MayanSwift.OrderParams",name:"params",type:"tuple"},{internalType:"bytes",name:"signedOrderHash",type:"bytes"}],name:"createOrderWithSig",outputs:[{internalType:"bytes32",name:"orderHash",type:"bytes32"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"tokenIn",type:"address"},{internalType:"uint256",name:"amountIn",type:"uint256"},{components:[{internalType:"bytes32",name:"trader",type:"bytes32"},{internalType:"bytes32",name:"tokenOut",type:"bytes32"},{internalType:"uint64",name:"minAmountOut",type:"uint64"},{internalType:"uint64",name:"gasDrop",type:"uint64"},{internalType:"uint64",name:"cancelFee",type:"uint64"},{internalType:"uint64",name:"refundFee",type:"uint64"},{internalType:"uint64",name:"deadline",type:"uint64"},{internalType:"bytes32",name:"destAddr",type:"bytes32"},{internalType:"uint16",name:"destChainId",type:"uint16"},{internalType:"bytes32",name:"referrerAddr",type:"bytes32"},{internalType:"uint8",name:"referrerBps",type:"uint8"},{internalType:"uint8",name:"auctionMode",type:"uint8"},{internalType:"bytes32",name:"random",type:"bytes32"}],internalType:"struct MayanSwift.OrderParams",name:"params",type:"tuple"}],name:"createOrderWithToken",outputs:[{internalType:"bytes32",name:"orderHash",type:"bytes32"}],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"feeManager",outputs:[{internalType:"contract IFeeManager",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"fulfillAmount",type:"uint256"},{internalType:"bytes",name:"encodedVm",type:"bytes"},{internalType:"bytes32",name:"recepient",type:"bytes32"},{internalType:"bool",name:"batch",type:"bool"}],name:"fulfillOrder",outputs:[{internalType:"uint64",name:"sequence",type:"uint64"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"uint256",name:"fulfillAmount",type:"uint256"},{internalType:"bytes32",name:"orderHash",type:"bytes32"},{internalType:"uint16",name:"srcChainId",type:"uint16"},{internalType:"bytes32",name:"tokenIn",type:"bytes32"},{internalType:"uint8",name:"protocolBps",type:"uint8"},{components:[{internalType:"bytes32",name:"trader",type:"bytes32"},{internalType:"bytes32",name:"tokenOut",type:"bytes32"},{internalType:"uint64",name:"minAmountOut",type:"uint64"},{internalType:"uint64",name:"gasDrop",type:"uint64"},{internalType:"uint64",name:"cancelFee",type:"uint64"},{internalType:"uint64",name:"refundFee",type:"uint64"},{internalType:"uint64",name:"deadline",type:"uint64"},{internalType:"bytes32",name:"destAddr",type:"bytes32"},{internalType:"uint16",name:"destChainId",type:"uint16"},{internalType:"bytes32",name:"referrerAddr",type:"bytes32"},{internalType:"uint8",name:"referrerBps",type:"uint8"},{internalType:"uint8",name:"auctionMode",type:"uint8"},{internalType:"bytes32",name:"random",type:"bytes32"}],internalType:"struct MayanSwift.OrderParams",name:"params",type:"tuple"},{internalType:"bytes32",name:"recepient",type:"bytes32"},{internalType:"bool",name:"batch",type:"bool"}],name:"fulfillSimple",outputs:[{internalType:"uint64",name:"sequence",type:"uint64"}],stateMutability:"payable",type:"function"},{inputs:[],name:"guardian",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"nextGuardian",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"",type:"bytes32"}],name:"orders",outputs:[{internalType:"enum MayanSwift.Status",name:"status",type:"uint8"},{internalType:"uint64",name:"amountIn",type:"uint64"},{internalType:"uint16",name:"destChainId",type:"uint16"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes",name:"encoded",type:"bytes"}],name:"parseFulfillPayload",outputs:[{components:[{internalType:"uint8",name:"action",type:"uint8"},{internalType:"bytes32",name:"orderHash",type:"bytes32"},{internalType:"uint16",name:"destChainId",type:"uint16"},{internalType:"bytes32",name:"destAddr",type:"bytes32"},{internalType:"bytes32",name:"driver",type:"bytes32"},{internalType:"bytes32",name:"tokenOut",type:"bytes32"},{internalType:"uint64",name:"promisedAmount",type:"uint64"},{internalType:"uint64",name:"gasDrop",type:"uint64"},{internalType:"uint64",name:"deadline",type:"uint64"},{internalType:"bytes32",name:"referrerAddr",type:"bytes32"},{internalType:"uint8",name:"referrerBps",type:"uint8"},{internalType:"uint8",name:"protocolBps",type:"uint8"},{internalType:"uint16",name:"srcChainId",type:"uint16"},{internalType:"bytes32",name:"tokenIn",type:"bytes32"}],internalType:"struct MayanSwift.FulfillMsg",name:"fulfillMsg",type:"tuple"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"bytes",name:"encoded",type:"bytes"}],name:"parseRefundPayload",outputs:[{components:[{internalType:"uint8",name:"action",type:"uint8"},{internalType:"bytes32",name:"orderHash",type:"bytes32"},{internalType:"uint16",name:"srcChainId",type:"uint16"},{internalType:"bytes32",name:"tokenIn",type:"bytes32"},{internalType:"bytes32",name:"recipient",type:"bytes32"},{internalType:"bytes32",name:"canceler",type:"bytes32"},{internalType:"uint64",name:"cancelFee",type:"uint64"},{internalType:"uint64",name:"refundFee",type:"uint64"}],internalType:"struct MayanSwift.RefundMsg",name:"refundMsg",type:"tuple"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"bytes",name:"encoded",type:"bytes"}],name:"parseUnlockPayload",outputs:[{components:[{internalType:"uint8",name:"action",type:"uint8"},{internalType:"bytes32",name:"orderHash",type:"bytes32"},{internalType:"uint16",name:"srcChainId",type:"uint16"},{internalType:"bytes32",name:"tokenIn",type:"bytes32"},{internalType:"bytes32",name:"recipient",type:"bytes32"}],internalType:"struct MayanSwift.UnlockMsg",name:"unlockMsg",type:"tuple"}],stateMutability:"pure",type:"function"},{inputs:[],name:"paused",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32[]",name:"orderHashes",type:"bytes32[]"}],name:"postBatch",outputs:[{internalType:"uint64",name:"sequence",type:"uint64"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"bytes",name:"encodedVm",type:"bytes"}],name:"refundOrder",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint8",name:"_consistencyLevel",type:"uint8"}],name:"setConsistencyLevel",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_feeManager",type:"address"}],name:"setFeeManager",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bool",name:"_pause",type:"bool"}],name:"setPause",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"solanaEmitter",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes",name:"encodedVm",type:"bytes"}],name:"unlockBatch",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes32",name:"",type:"bytes32"}],name:"unlockMsgs",outputs:[{internalType:"uint8",name:"action",type:"uint8"},{internalType:"bytes32",name:"orderHash",type:"bytes32"},{internalType:"uint16",name:"srcChainId",type:"uint16"},{internalType:"bytes32",name:"tokenIn",type:"bytes32"},{internalType:"bytes32",name:"recipient",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes",name:"encodedVm",type:"bytes"}],name:"unlockSingle",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"wormhole",outputs:[{internalType:"contract IWormhole",name:"",type:"address"}],stateMutability:"view",type:"function"},{stateMutability:"payable",type:"receive"}],linkReferences:{},deployedLinkReferences:{}};import{Connection as Ne,Keypair as er,PublicKey as D,SystemProgram as fe,SYSVAR_RENT_PUBKEY as Gt,Transaction as st,TransactionInstruction as ue,AddressLookupTableAccount as Bt,ComputeBudgetProgram as tr}from"@solana/web3.js";import{Buffer as pe}from"buffer";import{blob as Ht,struct as We,u8 as Ke}from"@solana/buffer-layout";import{sha256 as nr}from"js-sha256";import rr from"bs58";var ar={};function ir(e){return ar[e]??=new Ne(e),new Ne(e)}async function Le({trx:e,connection:t,errorChance:n,extraRpcs:a,options:i,rate:o=8}){let s=null,r=0,p=[t].concat(a.map(ir));for(let u=0;u<o;u++){if(s)try{let m=await Promise.any(p.map(d=>d.getSignatureStatus(s)));if(m&&m.value){if(m.value.err){if(r>=n)return{signature:s,serializedTrx:e};r++}else if(m.value.confirmationStatus==="confirmed")return{signature:s,serializedTrx:e}}}catch(m){console.error(m)}let c=p.map(m=>m.sendRawTransaction(e,i));if(!s)try{s=await Promise.any(c)}catch(m){console.error("Transaction not submitted, remaining attempts:",o-u-1,m)}await Oe(1e3)}if(!s)throw new Error("Failed to send transaction");return{signature:s,serializedTrx:e}}function V(e,t,n,a,i=new D(l.TOKEN_PROGRAM_ID),o=new D(l.ASSOCIATED_TOKEN_PROGRAM_ID)){let s=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:fe.programId,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:Gt,isSigner:!1,isWritable:!1}];return new ue({keys:s,programId:o,data:pe.alloc(0)})}var Nt=165;async function Ue(e,t,n,a,i,o=new D(l.TOKEN_PROGRAM_ID)){let s=[],r=await e.getMinimumBalanceForRentExemption(Nt);return s.push(fe.createAccount({fromPubkey:t,newAccountPubkey:i.publicKey,lamports:r,space:Nt,programId:o})),s.push(new ue({keys:[{pubkey:i.publicKey,isWritable:!0,isSigner:!1},{pubkey:n,isWritable:!1,isSigner:!1},{pubkey:a,isWritable:!1,isSigner:!1},{pubkey:Gt,isWritable:!1,isSigner:!1}],programId:o,data:pe.from([1])})),s}var Wt=We([Ke("instruction"),Ht(8,"amount")]);function Qt(e,t,n,a,i=new D(l.TOKEN_PROGRAM_ID)){let o=[{pubkey:e,isSigner:!1,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!0,isWritable:!1}],s=pe.alloc(Wt.span);return Wt.encode({instruction:4,amount:R(a)},s),new ue({keys:o,programId:i,data:s})}var Kt=We([Ke("instruction")]);function Se(e){let t=[{pubkey:e,isSigner:!1,isWritable:!0}],n=pe.alloc(Kt.span);return Kt.encode({instruction:17},n),new ue({keys:t,programId:new D(l.TOKEN_PROGRAM_ID),data:n})}var Lt=We([Ke("instruction")]);function sr(e,t,n,a=new D(l.TOKEN_PROGRAM_ID)){let i=[{pubkey:e,isSigner:!1,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!0,isWritable:!1}],o=pe.alloc(Lt.span);return Lt.encode({instruction:9},o),new ue({keys:i,programId:a,data:o})}var Ut=We([Ke("instruction"),Ht(8,"amount")]);function Pe(e,t,n,a,i=new D(l.TOKEN_PROGRAM_ID)){let o=[{pubkey:e,isSigner:!1,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!0,isWritable:!1}],s=pe.alloc(Ut.span);return Ut.encode({instruction:3,amount:R(a)},s),new ue({keys:o,programId:i,data:s})}var re=new D("So11111111111111111111111111111111111111112");async function Fa(e,t,n,a){let i=a??new Ne("https://rpc.ankr.com/solana"),o=F(re,e,!1),{blockhash:s,lastValidBlockHeight:r}=await i.getLatestBlockhash(),p=new st({feePayer:e,blockhash:s,lastValidBlockHeight:r}),u=await i.getAccountInfo(o,"finalized");(!u||u.data.length===0)&&p.add(V(e,o,e,re)),p.add(fe.transfer({fromPubkey:e,toPubkey:o,lamports:w(t,9)})),p.add(Se(o));let c=await n(p);return await Le({trx:c.serialize(),connection:i,errorChance:1,extraRpcs:[]})}async function Da(e,t,n,a){let i=a??new Ne("https://rpc.ankr.com/solana"),o=F(re,e,!1),s=er.generate(),{blockhash:r,lastValidBlockHeight:p}=await i.getLatestBlockhash(),u=new st({feePayer:e,blockhash:r,lastValidBlockHeight:p}),c=F(re,s.publicKey,!1);u.add(V(e,c,s.publicKey,re)),u.add(Pe(o,c,e,w(t,9))),u.add(sr(c,e,s.publicKey)),u.partialSign(s);let m=await n(u);return await Le({trx:m.serialize(),connection:i,errorChance:1,extraRpcs:[]})}function Be(e){return new ue({programId:new D(e.programId),keys:e.accounts.map(t=>({pubkey:new D(t.pubkey),isSigner:t.isSigner,isWritable:t.isWritable})),data:pe.from(e.data,"base64")})}async function Ge(e,t){return(await t.getMultipleAccountsInfo(e.map(a=>new D(a)))).reduce((a,i,o)=>{let s=e[o];if(i){let r=new Bt({key:new D(s),state:Bt.deserialize(i.data)});a.push(r)}return a},new Array)}function He(e,t){let n=Be(e.swapInstruction),a=e.cleanupInstruction?Be(e.cleanupInstruction):null,i=e.computeBudgetInstructions?e.computeBudgetInstructions.map(Be):[],o=e.setupInstructions?e.setupInstructions.map(Be):[];return{swapInstruction:n,cleanupInstruction:a,computeBudgetInstructions:i,setupInstructions:o,addressLookupTableAddresses:e.addressLookupTableAddresses}}function z(e){let t=`global:${e}`;return pe.from(nr.digest(t)).subarray(0,8)}async function jt(){let e;try{let t=await _t();e=new D(t)}catch{console.log("Relayer not found, using system program"),e=fe.programId}return e}function Vt(e,t,n,a){let i=a.jitoAccount||"Cw8CFyM9FkoMi7K7Crf6HNQqf4uEMzpKw6QNghXLvLkY";return new st({feePayer:new D(e),blockhash:t,lastValidBlockHeight:n}).add(fe.transfer({fromPubkey:new D(e),toPubkey:new D(i),lamports:a.tipLamports}))}async function ot(e,t,n=!1){try{let a=[];for(let s of e)a.push(s.serialize());let i={jsonrpc:"2.0",id:1,method:"sendBundle",params:[a.map(s=>rr.encode(s))]},o=await fetch(t.jitoSendUrl||"https://mainnet.block-engine.jito.wtf/api/v1/bundles",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(o.status!==200&&o.status!==201)throw new Error("Send Jito bundle failed");return(await o.json()).result}catch(a){if(console.error("Send Jito bundle failed",a),n)throw a}}async function or(e,t){let a=0;for(;a<5;)try{let i=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:1,method:"getBundleStatuses",params:[e]})});if(!i.ok)throw new Error(`HTTP error! Status: ${i.status}`);let o=await i.json();if(o.error)throw new Error(`Error getting bundle statuses: ${JSON.stringify(o.error,null,2)}`);return o.result}catch(i){if(a++,await Oe(400),a>=5)throw new Error(`Failed to fetch bundle statuses after 5 attempts: ${i.message}`)}}async function $t(e,t,n,a,i){let s=Date.now();for(;Date.now()-s<9e4&&await i.getBlockHeight()<=n;){await Oe(350);let r=await or([e],t.jitoSendUrl||"https://mainnet.block-engine.jito.wtf/api/v1/bundles");if(r&&r.value&&r.value.length>0&&r.value[0]){console.log("===>",r.value[0]);let p=r.value[0].confirmation_status;if(p==="confirmed"||p==="finalized"){let u=await i.getSignatureStatus(a);if(!u||!u.value)continue;if(u.value?.err)throw new Error(`Bundle failed with error: ${u.value.err}`);return}}}throw new Error("Bundle not confirmed, timeout")}async function Yt(e){try{await fetch("https://explorer-api.mayan.finance/v3/submit/jito-bundle",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({bundleId:e})})}catch{}}function ur(e){if(e){if(!e.programId.equals(new D(l.TOKEN_PROGRAM_ID))&&!e.programId.equals(new D(l.TOKEN_2022_PROGRAM_ID)))throw new Error("Invalid cleanup instruction:: programId");if(Uint8Array.from(e.data).length!==1)throw new Error("Invalid cleanup instruction:: data");if(Uint8Array.from(e.data)[0]!==9)throw new Error("Invalid cleanup instruction:: data")}}function pr(e,t){if(!(e.length<1)){if(e.length>6)throw new Error("Invalid setup instruction:: too many instructions");e.forEach(n=>{if(!n.programId.equals(new D(l.ASSOCIATED_TOKEN_PROGRAM_ID))&&!n.programId.equals(fe.programId)&&!n.programId.equals(new D(l.TOKEN_PROGRAM_ID))&&!n.programId.equals(new D(l.TOKEN_2022_PROGRAM_ID)))throw new Error("Invalid setup instruction:: programId");if(n.programId.equals(new D(l.ASSOCIATED_TOKEN_PROGRAM_ID))){if(Uint8Array.from(n.data).length===1){if(Uint8Array.from(n.data)[0]!==1)throw new Error("Invalid setup instruction:: data")}else if(Uint8Array.from(n.data).length!==0)throw new Error("Invalid setup instruction:: data")}else if(n.programId.equals(fe.programId)){if(!t)throw new Error("Invalid setup instruction:: unknown transfer");let a=F(re,t,!0);if(n.data.readUint32LE()!==2)throw new Error("Invalid setup instruction:: invalid system program instruction");if(!n.keys[1].pubkey.equals(a))throw new Error("Invalid setup instruction:: invalid wrap transfer dest")}else if(n.data.toString("base64")!=="EQ==")throw new Error("Invalid setup instruction:: invalid token program instruction")})}}function cr(e,t){if(!e.programId.equals(new D("JUP6LkbZbjS1jKKwapdHNy74zcZ3tLUZoi5QNyVTaV4")))throw new Error("Invalid swap instruction:: programId");if(e.data.subarray(0,8).toString("hex")===z("shared_accounts_route").toString("hex")){if(!e.keys[6].pubkey.equals(t))throw new Error("Invalid swap instruction shared_accounts_route:: dest account")}else if(e.data.subarray(0,8).toString("hex")===z("route").toString("hex")){if(!e.keys[4].pubkey.equals(t))throw new Error("Invalid swap instruction route:: dest account")}else throw new Error("Invalid swap instruction:: ix id")}function lr(e){e.forEach(t=>{if(!t.programId.equals(tr.programId))throw new Error("Invalid compute budget instruction:: programId");if(Uint8Array.from(t.data)[0]===3&&t.data.readBigUInt64LE(1)>100000000n)throw new Error("Invalid compute budget instruction:: to high tx fee")})}function _e(e,t,n){lr(e.computeBudgetInstructions),pr(e.setupInstructions,n),cr(e.swapInstruction,t),ur(e.cleanupInstruction)}function Qe(e,t,n,a,i,o=new D("TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA")){return new ue({keys:[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1}],programId:new D("B96dV3Luxzo6SokJx3xt8i5y8Mb7HRR6Eec8hCjJDT69"),data:z("transfer_all_and_close")})}import{Connection as bn,PublicKey as Q,Keypair as ct,SystemProgram as $e,SYSVAR_CLOCK_PUBKEY as Ar,SYSVAR_RENT_PUBKEY as hr,Transaction as mn,TransactionInstruction as Cr,ComputeBudgetProgram as Sr,MessageV0 as dn,VersionedTransaction as lt}from"@solana/web3.js";import{blob as ce,struct as Pr,u16 as _r,u8 as he}from"@solana/buffer-layout";import{Buffer as le}from"buffer";import{ZeroAddress as mt}from"ethers";import{PublicKey as S,Keypair as we,SystemProgram as be,SYSVAR_CLOCK_PUBKEY as mr,SYSVAR_RENT_PUBKEY as dr,TransactionInstruction as ke,ComputeBudgetProgram as yr}from"@solana/web3.js";import{blob as B,struct as Me,u16 as on,u8 as ut}from"@solana/buffer-layout";import{Buffer as G}from"buffer";import{PublicKey as Te}from"@solana/web3.js";import{Buffer as je}from"buffer";function Jt(e){let t=new Te(l.WORMHOLE_PROGRAM_ID),n=new Te(e),[a]=Te.findProgramAddressSync([je.from("Bridge")],t),[i]=Te.findProgramAddressSync([je.from("emitter")],n),[o]=Te.findProgramAddressSync([je.from("Sequence"),i.toBuffer()],t),[s]=Te.findProgramAddressSync([je.from("fee_collector")],t);return{bridgeConfig:a,sequenceKey:o,feeCollector:s,emitter:i}}var zt=Me([B(8,"instruction")]);function Zt(e,t,n,a,i){let o=new S(l.WORMHOLE_PROGRAM_ID),s=new S(l.TOKEN_PROGRAM_ID),r=new S(l.CCTP_CORE_PROGRAM_ID),p=new S(l.CCTP_TOKEN_PROGRAM_ID),u=new S(l.MCTP_PROGRAM_ID),c=new S(a),m=new S(n),d=F(m,e,!0),f;i&&i>BigInt(0)?f=F(m,c,!1):f=new S(l.MCTP_PROGRAM_ID);let b=ve(m,t),y=Jt(l.MCTP_PROGRAM_ID),g=we.generate(),A=we.generate(),T=[{pubkey:e,isWritable:!0,isSigner:!1},{pubkey:d,isWritable:!0,isSigner:!1},{pubkey:c,isWritable:!0,isSigner:!0},{pubkey:f,isWritable:!0,isSigner:!1},{pubkey:m,isWritable:!0,isSigner:!1},{pubkey:b.senderAuthority,isWritable:!1,isSigner:!1},{pubkey:b.tokenMessenger,isWritable:!1,isSigner:!1},{pubkey:b.remoteTokenMessengerKey,isWritable:!1,isSigner:!1},{pubkey:b.tokenMinter,isWritable:!1,isSigner:!1},{pubkey:b.localToken,isWritable:!0,isSigner:!1},{pubkey:b.eventAuthToken,isWritable:!1,isSigner:!1},{pubkey:b.messageTransmitter,isWritable:!0,isSigner:!1},{pubkey:g.publicKey,isWritable:!0,isSigner:!0},{pubkey:p,isWritable:!1,isSigner:!1},{pubkey:r,isWritable:!1,isSigner:!1},{pubkey:y.emitter,isWritable:!1,isSigner:!1},{pubkey:y.bridgeConfig,isWritable:!0,isSigner:!1},{pubkey:y.sequenceKey,isWritable:!0,isSigner:!1},{pubkey:y.feeCollector,isWritable:!0,isSigner:!1},{pubkey:A.publicKey,isWritable:!0,isSigner:!0},{pubkey:o,isWritable:!1,isSigner:!1},{pubkey:mr,isWritable:!1,isSigner:!1},{pubkey:dr,isWritable:!1,isSigner:!1},{pubkey:s,isWritable:!1,isSigner:!1},{pubkey:be.programId,isWritable:!1,isSigner:!1}],C=G.alloc(zt.span);return zt.encode({instruction:z("bridge_with_fee")},C),{instruction:new ke({keys:T,data:C,programId:u}),signers:[g,A]}}var Xt=Me([B(8,"instruction")]);function qt(e,t,n,a,i){let o=[],s=new S(l.TOKEN_PROGRAM_ID),r=new S(l.ASSOCIATED_TOKEN_PROGRAM_ID),p=new S(l.CCTP_CORE_PROGRAM_ID),u=new S(l.CCTP_TOKEN_PROGRAM_ID),c=new S(l.MCTP_PROGRAM_ID),m=new S(a),d=new S(n),f=F(d,e,!0),b=ve(d,t),y=we.generate(),[g]=S.findProgramAddressSync([G.from("LOCKED_FEE"),d.toBuffer(),y.publicKey.toBytes()],c),A;i&&i>BigInt(0)?A=F(d,m,!1):A=new S(l.MCTP_PROGRAM_ID);let T=F(d,g,!0);o.push(V(m,T,g,d));let C=[{pubkey:e,isWritable:!0,isSigner:!1},{pubkey:f,isWritable:!0,isSigner:!1},{pubkey:m,isWritable:!0,isSigner:!0},{pubkey:A,isWritable:!0,isSigner:!1},{pubkey:g,isWritable:!0,isSigner:!1},{pubkey:T,isWritable:!0,isSigner:!1},{pubkey:d,isWritable:!0,isSigner:!1},{pubkey:b.senderAuthority,isWritable:!1,isSigner:!1},{pubkey:b.tokenMessenger,isWritable:!1,isSigner:!1},{pubkey:b.remoteTokenMessengerKey,isWritable:!1,isSigner:!1},{pubkey:b.tokenMinter,isWritable:!1,isSigner:!1},{pubkey:b.localToken,isWritable:!0,isSigner:!1},{pubkey:b.eventAuthToken,isWritable:!1,isSigner:!1},{pubkey:b.messageTransmitter,isWritable:!0,isSigner:!1},{pubkey:y.publicKey,isWritable:!0,isSigner:!0},{pubkey:u,isWritable:!1,isSigner:!1},{pubkey:p,isWritable:!1,isSigner:!1},{pubkey:s,isWritable:!1,isSigner:!1},{pubkey:r,isWritable:!1,isSigner:!1},{pubkey:be.programId,isWritable:!1,isSigner:!1}],M=G.alloc(Xt.span);Xt.encode({instruction:z("bridge_locked_fee")},M);let _=new ke({keys:C,data:M,programId:c});return o.push(_),{instructions:o,signer:y}}var en=Me([B(8,"instruction")]);function tn(e,t,n,a,i){let o=new S(l.TOKEN_PROGRAM_ID),s=new S(l.CCTP_CORE_PROGRAM_ID),r=new S(l.CCTP_TOKEN_PROGRAM_ID),p=new S(l.MCTP_PROGRAM_ID),u=new S(a),c=new S(n),m=F(c,e,!0),d=ve(c,t),f=we.generate(),[b]=S.findProgramAddressSync([G.from("ORDER_SOLANA_SOURCE"),e.toBuffer()],p),y;i&&i>BigInt(0)?y=F(c,u,!1):y=new S(l.MCTP_PROGRAM_ID);let g=[{pubkey:e,isWritable:!1,isSigner:!1},{pubkey:m,isWritable:!0,isSigner:!1},{pubkey:u,isWritable:!0,isSigner:!0},{pubkey:y,isWritable:!0,isSigner:!1},{pubkey:c,isWritable:!0,isSigner:!1},{pubkey:b,isWritable:!0,isSigner:!1},{pubkey:d.senderAuthority,isWritable:!1,isSigner:!1},{pubkey:d.tokenMessenger,isWritable:!1,isSigner:!1},{pubkey:d.remoteTokenMessengerKey,isWritable:!1,isSigner:!1},{pubkey:d.tokenMinter,isWritable:!1,isSigner:!1},{pubkey:d.localToken,isWritable:!0,isSigner:!1},{pubkey:d.eventAuthToken,isWritable:!1,isSigner:!1},{pubkey:d.messageTransmitter,isWritable:!0,isSigner:!1},{pubkey:f.publicKey,isWritable:!0,isSigner:!0},{pubkey:r,isWritable:!1,isSigner:!1},{pubkey:s,isWritable:!1,isSigner:!1},{pubkey:new S(l.FEE_MANAGER_PROGRAM_ID),isWritable:!1,isSigner:!1},{pubkey:o,isWritable:!1,isSigner:!1},{pubkey:be.programId,isWritable:!1,isSigner:!1}],A=G.alloc(en.span);return en.encode({instruction:z("create_order")},A),{instruction:new ke({keys:g,data:A,programId:p}),signer:f}}var nn=Me([B(8,"instruction"),B(32,"destAddress"),B(8,"amountInMin"),B(8,"gasDrop"),B(8,"feeRedeem"),B(8,"feeSolana"),on("destinationChain"),B(32,"keyRnd"),ut("mode")]);function rn(e){if(e.mode!=="WITH_FEE"&&e.mode!=="LOCK_FEE")throw new Error("Invalid mode: "+e.mode);let t=new S(e.swapperAddress),n=new S(e.mintAddress),a=F(n,e.ledger,!0),i=k(e.toChain),o=G.from(W(I(e.destinationAddress,i))),s=R(e.amountInMin64),r=R(w(e.gasDrop,Math.min(v(e.toChain),8))),p=R(w(e.feeRedeem,L)),u=R(e.feeSolana),c=e.referrerAddress?G.from(W(I(e.referrerAddress,i))):be.programId.toBuffer(),m=[{pubkey:t,isWritable:!0,isSigner:!0},{pubkey:e.ledger,isWritable:!0,isSigner:!1},{pubkey:a,isWritable:!1,isSigner:!1},{pubkey:e.customPayload||new S(l.MCTP_PROGRAM_ID),isWritable:!1,isSigner:!1},{pubkey:n,isWritable:!1,isSigner:!1},{pubkey:be.programId,isWritable:!1,isSigner:!1},{pubkey:new S(c),isWritable:!1,isSigner:!1}],d=G.alloc(nn.span);return nn.encode({instruction:z("init_bridge_ledger"),destAddress:o,amountInMin:s,gasDrop:r,feeRedeem:p,feeSolana:u,destinationChain:i,keyRnd:e.randomKey.toBuffer(),mode:e.mode==="WITH_FEE"?1:2},d),new ke({keys:m,data:d,programId:new S(l.MCTP_PROGRAM_ID)})}var an=Me([B(8,"instruction"),B(32,"destAddress"),B(8,"amountInMin"),B(8,"gasDrop"),B(8,"feeRedeem"),B(8,"feeSolana"),on("destinationChain"),B(32,"keyRnd"),ut("mode"),B(32,"tokenOut"),B(8,"amountOutMin"),B(8,"deadline"),B(32,"refAddress"),ut("feeRateRef")]);function sn(e){let t=new S(e.swapperAddress),n=new S(e.mintAddress),a=F(n,e.ledger,!0),i=k(e.toChain),o=G.from(W(I(e.destinationAddress,i))),s=R(e.amountInMin64),r=R(w(e.gasDrop,Math.min(v(e.toChain),8))),p=R(w(e.feeRedeem,L)),u=R(e.feeSolana),c=G.from(W(I(e.tokenOut,i))),m=e.referrerAddress?G.from(W(I(e.referrerAddress,i))):be.programId.toBuffer(),d=R(w(e.amountOutMin,Math.min(8,e.tokenOutDecimals))),f=R(e.deadline),b=[{pubkey:t,isWritable:!0,isSigner:!0},{pubkey:e.ledger,isWritable:!0,isSigner:!1},{pubkey:a,isWritable:!1,isSigner:!1},{pubkey:n,isWritable:!1,isSigner:!1},{pubkey:be.programId,isWritable:!1,isSigner:!1}],y=G.alloc(an.span);return an.encode({instruction:z("init_order_ledger"),destAddress:o,amountInMin:s,gasDrop:r,feeRedeem:p,feeSolana:u,destinationChain:i,keyRnd:e.randomKey.toBuffer(),mode:3,tokenOut:c,refAddress:m,amountOutMin:d,deadline:f,feeRateRef:e.feeRateRef},y),new ke({keys:b,data:y,programId:new S(l.MCTP_PROGRAM_ID)})}async function un(e,t,n,a,i,o={}){let s=o?.forceSkipCctpInstructions||!1,r=o?.allowSwapperOffCurve||!1;if(e.toChain==="solana")throw new Error("Unsupported destination chain: "+e.toChain);let p=[],u=[],c=[],m=[],d=[],f=[],b=[],y=we.generate(),g=null;p.push(l.LOOKUP_TABLE);let A=new S(l.MCTP_PROGRAM_ID),T=new S(t),C=we.generate(),M=e.deadline64?BigInt(e.deadline64):BigInt(0);if(e.hasAuction&&!Number(e.deadline64))throw new Error("Swap mode requires a timeout");let _=e.hasAuction?"LEDGER_ORDER":"LEDGER_BRIDGE",[h]=S.findProgramAddressSync([G.from(_),T.toBytes(),C.publicKey.toBytes()],A),E=F(new S(e.mctpInputContract),h,!0),x=e.cheaperChain==="solana"?"LOCK_FEE":"WITH_FEE",K=e.toChain==="sui"?e.toToken.verifiedAddress:e.toToken.contract;if(e.fromToken.contract===e.mctpInputContract){let P=BigInt(s?e.solanaRelayerFee64:0);if(e.suggestedPriorityFee>0&&u.push(yr.setComputeUnitPrice({microLamports:e.suggestedPriorityFee})),u.push(V(T,E,h,new S(e.mctpInputContract))),u.push(Pe(F(new S(e.mctpInputContract),T,r),E,T,BigInt(e.effectiveAmountIn64))),e.hasAuction){if(u.push(sn({ledger:h,swapperAddress:t,mintAddress:e.mctpInputContract,randomKey:C.publicKey,toChain:e.toChain,destinationAddress:n,feeSolana:P,feeRedeem:e.redeemRelayerFee,gasDrop:e.gasDrop,amountInMin64:BigInt(e.effectiveAmountIn64),tokenOut:K,tokenOutDecimals:e.toToken.decimals,referrerAddress:a,amountOutMin:e.minAmountOut,deadline:M,feeRateRef:e.referrerBps})),!s){let{instruction:O,signer:U}=tn(h,e.toChain,e.mctpInputContract,t,P);u.push(O),c.push(U)}}else if(u.push(rn({ledger:h,swapperAddress:t,mintAddress:e.mctpInputContract,randomKey:C.publicKey,toChain:e.toChain,destinationAddress:n,feeSolana:P,feeRedeem:e.redeemRelayerFee,gasDrop:e.gasDrop,amountInMin64:BigInt(e.effectiveAmountIn64),mode:x,referrerAddress:a})),!s)if(x==="WITH_FEE"){let{instruction:O,signers:U}=Zt(h,e.toChain,e.mctpInputContract,t,P);u.push(O),c.push(...U)}else{let{instructions:O,signer:U}=qt(h,e.toChain,e.mctpInputContract,t,P);u.push(...O),c.push(U)}}else{let P=await xe({minMiddleAmount:e.minMiddleAmount,middleToken:e.mctpInputContract,userWallet:t,userLedger:h.toString(),slippageBps:e.slippageBps,fromToken:e.fromToken.contract,amountIn64:e.effectiveAmountIn64,depositMode:e.hasAuction?"SWAP":x,fillMaxAccounts:o?.separateSwapTx||!1,tpmTokenAccount:o?.separateSwapTx?y.publicKey.toString():null}),O=He(P,i);o?.separateSwapTx&&P.maxAccountsFilled?(_e(O,y.publicKey,T),b=await Ue(i,T,new S(e.mctpInputContract),T,y),f.push(...O.computeBudgetInstructions),O.setupInstructions&&f.push(...O.setupInstructions),f.push(O.swapInstruction),O.cleanupInstruction&&f.push(O.cleanupInstruction),d.push(...O.addressLookupTableAddresses),u.push(V(T,E,h,new S(e.mctpInputContract))),u.push(Qe(T,new S(e.mctpInputContract),y.publicKey,E,T))):(_e(O,E,T),u.push(...O.computeBudgetInstructions),O.setupInstructions&&u.push(...O.setupInstructions),u.push(O.swapInstruction),O.cleanupInstruction&&u.push(O.cleanupInstruction),p.push(...O.addressLookupTableAddresses));let U=f.length>0?BigInt(0):BigInt(e.solanaRelayerFee64);if(e.hasAuction){if(u.push(sn({ledger:h,swapperAddress:t,mintAddress:e.mctpInputContract,randomKey:C.publicKey,toChain:e.toChain,destinationAddress:n,feeSolana:U,feeRedeem:e.redeemRelayerFee,gasDrop:e.gasDrop,amountInMin64:w(e.minMiddleAmount,L),tokenOut:K,tokenOutDecimals:e.toToken.decimals,referrerAddress:a,amountOutMin:e.minAmountOut,deadline:M,feeRateRef:e.referrerBps})),f.length>0){let{instruction:ie,signer:Y}=tn(h,e.toChain,e.mctpInputContract,t,U);u.push(ie),c.push(Y)}}else if(u.push(rn({ledger:h,swapperAddress:t,mintAddress:e.mctpInputContract,randomKey:C.publicKey,toChain:e.toChain,destinationAddress:n,feeSolana:U,feeRedeem:e.redeemRelayerFee,gasDrop:e.gasDrop,amountInMin64:w(e.minMiddleAmount,L),mode:x,referrerAddress:a})),f.length>0)if(x==="WITH_FEE"){let{instruction:ie,signers:Y}=Zt(h,e.toChain,e.mctpInputContract,t,U);u.push(ie),c.push(...Y)}else{let{instructions:ie,signer:Y}=qt(h,e.toChain,e.mctpInputContract,t,U);u.push(...ie),c.push(Y)}}let N=await Ge(p.concat(d),i);if(m=N.slice(0,p.length),f.length>0){let P=N.slice(p.length);g={messageV0:{payerKey:T,instructions:f,addressLookupTableAccounts:P},createTmpTokenAccountIxs:b,tmpTokenAccount:y}}return{instructions:u,signers:c,lookupTables:m,swapMessageV0Params:g}}import{PublicKey as ae,Keypair as pn,SystemProgram as Ie,TransactionInstruction as fr,ComputeBudgetProgram as br}from"@solana/web3.js";import{blob as $,struct as gr,u16 as Tr,u8 as Ve}from"@solana/buffer-layout";import{Buffer as H}from"buffer";import{ethers as wr,ZeroAddress as Ae}from"ethers";function pt(e,t,n,a,i){let s=H.alloc(239),r=0,p=k(e.fromChain),u=H.from(W(I(t,p)));s.set(u,0),r+=32,s.writeUInt16BE(p,r),r+=2;let c=e.swiftInputContract===Ae?I(Ie.programId.toString(),k("solana")):I(e.swiftInputContract,p),m=H.from(W(c));s.set(m,r),r+=32;let d=k(e.toChain),f=H.from(W(I(n,d)));s.set(f,r),r+=32,s.writeUInt16BE(d,r),r+=2;let b=e.toToken.contract===Ae?I(Ie.programId.toString(),k("solana")):I(e.toToken.contract,d),y=H.from(W(b));s.set(y,r),r+=32,s.writeBigUInt64BE(w(e.minAmountOut,Math.min(e.toToken.decimals,8)),r),r+=8,s.writeBigUInt64BE(w(e.gasDrop,Math.min(v(e.toChain),8)),r),r+=8,s.writeBigUInt64BE(BigInt(e.cancelRelayerFee64),r),r+=8,s.writeBigUInt64BE(BigInt(e.refundRelayerFee64),r),r+=8,s.writeBigUInt64BE(BigInt(e.deadline64),r),r+=8;let g=a?H.from(W(I(a,d))):Ie.programId.toBuffer();s.set(g,r),r+=32,s.writeUInt8(e.referrerBps,r),r+=1;let A=e.protocolBps;s.writeUInt8(A,r),r+=1,s.writeUInt8(e.swiftAuctionMode,r),r+=1;let T=H.from(W(i));if(s.set(T,r),r+=32,r!==239)throw new Error(`Invalid order data size: ${r}`);let C=wr.keccak256(s);return H.from(W(C))}var cn=gr([$(8,"instruction"),$(8,"amountInMin"),Ve("nativeInput"),$(8,"feeSubmit"),$(32,"destAddress"),Tr("destinationChain"),$(32,"tokenOut"),$(8,"amountOutMin"),$(8,"gasDrop"),$(8,"feeCancel"),$(8,"feeRefund"),$(8,"deadline"),$(32,"refAddress"),Ve("feeRateRef"),Ve("feeRateMayan"),Ve("auctionMode"),$(32,"randomKey")]);function Ir(e){let{quote:t}=e,n=t.swiftInputContract===Ae?re:new ae(t.swiftInputContract),a=k(t.toChain);if(a!==t.toToken.wChainId)throw new Error(`Destination chain ID mismatch: ${a} != ${t.toToken.wChainId}`);let i=[{pubkey:e.trader,isWritable:!1,isSigner:!0},{pubkey:e.relayer,isWritable:!0,isSigner:!0},{pubkey:e.state,isWritable:!0,isSigner:!1},{pubkey:e.stateAccount,isWritable:!0,isSigner:!1},{pubkey:e.relayerAccount,isWritable:!0,isSigner:!1},{pubkey:n,isWritable:!1,isSigner:!1},{pubkey:new ae(l.FEE_MANAGER_PROGRAM_ID),isWritable:!1,isSigner:!1},{pubkey:new ae(l.TOKEN_PROGRAM_ID),isWritable:!1,isSigner:!1},{pubkey:Ie.programId,isWritable:!1,isSigner:!1}],o=H.alloc(cn.span),s=e.referrerAddress?H.from(W(I(e.referrerAddress,a))):Ie.programId.toBuffer(),r=t.fromToken.contract===t.swiftInputContract?BigInt(t.effectiveAmountIn64):w(t.minMiddleAmount,t.swiftInputDecimals);return cn.encode({instruction:z("init_order"),amountInMin:R(r),nativeInput:t.swiftInputContract===Ae?1:0,feeSubmit:R(BigInt(t.submitRelayerFee64)),destAddress:H.from(W(I(e.destinationAddress,a))),destinationChain:a,tokenOut:H.from(W(I(t.toToken.contract,a))),amountOutMin:R(w(t.minAmountOut,Math.min(t.toToken.decimals,8))),gasDrop:R(w(t.gasDrop,Math.min(v(t.toChain),8))),feeCancel:R(BigInt(t.cancelRelayerFee64)),feeRefund:R(BigInt(t.refundRelayerFee64)),deadline:R(e.deadline),refAddress:s,feeRateRef:t.referrerBps,feeRateMayan:t.protocolBps,auctionMode:t.swiftAuctionMode,randomKey:e.randomKey.toBuffer()},o),new fr({keys:i,data:o,programId:new ae(l.SWIFT_PROGRAM_ID)})}async function ln(e,t,n,a,i,o={}){if(e.type!=="SWIFT")throw new Error("Unsupported quote type for Swift: "+e.type);if(e.toChain==="solana")throw new Error("Unsupported destination chain: "+e.toChain);let s=o.allowSwapperOffCurve||!1,r=[],p=[],u=[];u.push(l.LOOKUP_TABLE);let c=[],m=[],d=[],f=pn.generate(),b=null,y=new ae(l.SWIFT_PROGRAM_ID),g=new ae(t),A=pn.generate();if(!Number(e.deadline64))throw new Error("Swift mode requires a timeout");let T=BigInt(e.deadline64),C=pt(e,t,n,a,A.publicKey.toBuffer().toString("hex")),[M]=ae.findProgramAddressSync([H.from("STATE_SOURCE"),C],y),_=e.swiftInputContract===Ae?re:new ae(e.swiftInputContract),h=F(_,M,!0),E=e.gasless?new ae(e.relayer):g,x=F(_,E,!1);if(e.fromToken.contract===e.swiftInputContract)e.suggestedPriorityFee>0&&r.push(br.setComputeUnitPrice({microLamports:e.suggestedPriorityFee})),r.push(V(E,h,M,_)),e.swiftInputContract===Ae?r.push(Ie.transfer({fromPubkey:g,toPubkey:h,lamports:BigInt(e.effectiveAmountIn64)}),Se(h)):r.push(Pe(F(_,g,s),h,g,BigInt(e.effectiveAmountIn64)));else{let N=await xe({minMiddleAmount:e.minMiddleAmount,middleToken:e.swiftInputContract,userWallet:t,slippageBps:e.slippageBps,fromToken:e.fromToken.contract,amountIn64:e.effectiveAmountIn64,depositMode:e.gasless?"SWIFT_GASLESS":"SWIFT",orderHash:`0x${C.toString("hex")}`,fillMaxAccounts:o?.separateSwapTx||!1,tpmTokenAccount:o?.separateSwapTx?f.publicKey.toString():null}),P=He(N,i);o?.separateSwapTx&&N.maxAccountsFilled?(_e(P,f.publicKey,g),d=await Ue(i,E,_,g,f),m.push(...P.computeBudgetInstructions),P.setupInstructions&&m.push(...P.setupInstructions),m.push(P.swapInstruction),P.cleanupInstruction&&m.push(P.cleanupInstruction),c.push(...P.addressLookupTableAddresses),r.push(V(E,h,M,_)),r.push(Qe(g,_,f.publicKey,h,E))):(r.push(...P.computeBudgetInstructions),P.setupInstructions&&r.push(...P.setupInstructions),r.push(P.swapInstruction),P.cleanupInstruction&&r.push(P.cleanupInstruction),u.push(...P.addressLookupTableAddresses))}r.push(Ir({quote:e,state:M,trader:g,stateAccount:h,randomKey:A.publicKey,relayerAccount:x,relayer:E,destinationAddress:n,deadline:T,referrerAddress:a}));let K=await Ge(u.concat(c),i);if(p=K.slice(0,u.length),m.length>0){let N=K.slice(u.length);b={messageV0:{payerKey:E,instructions:m,addressLookupTableAccounts:N},createTmpTokenAccountIxs:d,tmpTokenAccount:f}}return{instructions:r,signers:[],lookupTables:p,swapMessageV0Params:b}}import yn from"bs58";var kr=420,fn=Pr([he("instruction"),he("stateNonce"),ce(8,"amount"),ce(8,"minAmountOut"),ce(8,"deadline"),ce(8,"feeSwap"),ce(8,"feeReturn"),ce(8,"feeCancel"),ce(8,"gasDrop"),_r("destinationChain"),ce(32,"destinationAddress"),he("unwrapRedeem"),he("unwrapRefund"),he("mayanFeeNonce"),he("referrerFeeNonce")]);async function Mr(e,t,n,a,i,o={}){let s=de(e,a);if(e.type==="MCTP")return un(e,t,n,s,i,o);if(e.type==="SWIFT")return ln(e,t,n,s,i,o);let r=[],p=i??new bn("https://rpc.ankr.com/solana"),u=new Q(l.MAYAN_PROGRAM_ID),c=new Q(l.TOKEN_PROGRAM_ID),m=new Q(t),d=new Q(l.AUCTION_PROGRAM_ID);e.suggestedPriorityFee>0&&r.push(Sr.setComputeUnitPrice({microLamports:e.suggestedPriorityFee}));let f;s?f=new Q(s):f=$e.programId;let[b,y]=Q.findProgramAddressSync([le.from("MAYANFEE")],u),[g,A]=Q.findProgramAddressSync([le.from("REFERRERFEE"),f.toBuffer()],u),T=ct.generate(),C=ct.generate(),[M,_]=Q.findProgramAddressSync([le.from("V2STATE"),le.from(T.publicKey.toBytes()),le.from(C.publicKey.toBytes())],u),h=new Q(e.fromToken.mint),E=new Q(e.toToken.mint),x=F(h,m),K=F(h,M,!0),[[N,P],O,U]=await Promise.all([p.getMultipleAccountsInfo([x,K],"finalized"),p.getMinimumBalanceForRentExemption(kr),jt()]);(!N||N.data.length===0)&&r.push(V(m,x,m,h)),(!P||P.data.length===0)&&r.push(V(m,K,M,h)),e.fromToken.contract===mt&&(r.push($e.transfer({fromPubkey:m,toPubkey:x,lamports:BigInt(e.effectiveAmountIn64)})),r.push(Se(x)));let ie=BigInt(e.effectiveAmountIn64),Y=ct.generate();r.push(Qt(x,Y.publicKey,m,ie)),r.push($e.transfer({fromPubkey:m,toPubkey:Y.publicKey,lamports:O}));let Dn=[{pubkey:Y.publicKey,isWritable:!1,isSigner:!0},{pubkey:T.publicKey,isWritable:!1,isSigner:!0},{pubkey:C.publicKey,isWritable:!1,isSigner:!0},{pubkey:M,isWritable:!0,isSigner:!1},{pubkey:x,isWritable:!0,isSigner:!1},{pubkey:m,isWritable:!1,isSigner:!1},{pubkey:K,isWritable:!0,isSigner:!1},{pubkey:h,isWritable:!1,isSigner:!1},{pubkey:E,isWritable:!1,isSigner:!1},{pubkey:d,isWritable:!1,isSigner:!1},{pubkey:f,isWritable:!1,isSigner:!1},{pubkey:b,isWritable:!1,isSigner:!1},{pubkey:g,isWritable:!1,isSigner:!1},{pubkey:Y.publicKey,isWritable:!0,isSigner:!0},{pubkey:U,isWritable:!1,isSigner:!1},{pubkey:Ar,isWritable:!1,isSigner:!1},{pubkey:hr,isWritable:!1,isSigner:!1},{pubkey:c,isWritable:!1,isSigner:!1},{pubkey:$e.programId,isWritable:!1,isSigner:!1}],Ze=k(e.toChain);if(Ze===1){let Xe=await p.getAccountInfo(new Q(n));if(Xe&&Xe.owner&&Xe.owner.equals(c))throw new Error("Destination address is not about token account. It should be a owner address")}let xn=le.from(W(I(n,Ze))),vn=w(e.minAmountOut,e.mintDecimals.to),Bn=w(e.swapRelayerFee,e.mintDecimals.from),Nn=w(e.redeemRelayerFee,e.mintDecimals.to),Wn=w(e.refundRelayerFee,e.mintDecimals.from),Kn=w(e.gasDrop,St(e.toChain)),Ln=e.toToken.contract===mt,Un=e.fromToken.contract===mt;if(!Number(e.deadline64))throw new Error("Deadline is not valid");let Gn=BigInt(e.deadline64),wt=le.alloc(fn.span),Hn={instruction:101,stateNonce:_,amount:R(ie),minAmountOut:R(vn),deadline:R(Gn),feeSwap:R(Bn),feeReturn:R(Nn),feeCancel:R(Wn),gasDrop:R(Kn),destinationChain:Ze,destinationAddress:xn,unwrapRedeem:Ln?1:0,unwrapRefund:Un?1:0,mayanFeeNonce:y,referrerFeeNonce:A};fn.encode(Hn,wt);let Qn=new Cr({keys:Dn,data:wt,programId:u});return r.push(Qn),{instructions:r,signers:[Y,T,C],lookupTables:[],swapMessageV0Params:null}}async function Si(e,t,n,a,i,o,s,r,p,u){let c=o??new bn("https://rpc.ankr.com/solana"),m=!!(!e.gasless&&p&&p.tipLamports>0&&p.signAllTransactions),{instructions:d,signers:f,lookupTables:b,swapMessageV0Params:y}=await Mr(e,t,n,a,o,{allowSwapperOffCurve:u?.allowSwapperOffCurve,forceSkipCctpInstructions:u?.forceSkipCctpInstructions,separateSwapTx:m&&p?.separateSwapTx}),g=new Q(t),A=e.gasless?new Q(e.relayer):g,{blockhash:T,lastValidBlockHeight:C}=await o.getLatestBlockhash(),M=dn.compile({instructions:d,payerKey:A,recentBlockhash:T,addressLookupTableAccounts:b}),_=new lt(M);_.sign(f);let h;if(m){let E=[];if(y){let P=new mn({feePayer:g,blockhash:T,lastValidBlockHeight:C}).add(...y.createTmpTokenAccountIxs);P.partialSign(y.tmpTokenAccount),E.push(P);let O=dn.compile({...y.messageV0,recentBlockhash:T});E.push(new lt(O))}let x=Vt(t,T,C,p);E.push(_),E.push(x);let K=await p.signAllTransactions(E);h=K[K.length-2];let N=null;if(h instanceof mn&&h?.signatures[0]?.publicKey?N=yn.encode(Uint8Array.from(h.signatures[0].signature)):h instanceof lt&&h?.signatures[0]&&(N=yn.encode(Uint8Array.from(h.signatures[0]))),N===null)throw new Error("Failed to get mayan tx hash");if(y){let P=await ot(K,p,!0);return await $t(P,p,C,N,o),Yt(P),{signature:N,serializedTrx:null}}else ot(K,p).then(()=>{console.log("Jito bundle sent")}).catch(()=>{})}else h=await i(_);if(e.gasless){let E=le.from(h.serialize()).toString("base64"),{orderHash:x}=await Et(E);return{signature:x,serializedTrx:null}}return await Le({trx:h.serialize(),connection:c,extraRpcs:s??[],errorChance:2,options:r})}function wn(e,t,n,a,i){let o=X(Number(i)),s=k(e.fromChain),r=k(e.toChain);if(s!==o)throw new Error(`Signer chain id(${Number(i)}) and quote from chain are not same! ${s} !== ${o}`);if(!e.swiftMayanContract)throw new Error("SWIFT contract address is missing");if(e.toToken.wChainId!==r)throw new Error(`Destination chain ID mismatch: ${r} != ${e.toToken.wChainId}`);let p=e.swiftMayanContract;if(!Number(e.deadline64))throw new Error("Swift order requires timeout");let u=BigInt(e.deadline64),c=e.swiftInputContract,m=BigInt(e.effectiveAmountIn64),d;a?d=I(a,r):d=I(Tn.programId.toString(),1);let f=I(Er.generate().publicKey.toString(),1),b=e.toToken.contract===Je?I(Tn.programId.toString(),1):I(e.toToken.contract,r),y=w(e.minAmountOut,Math.min(8,e.toToken.decimals)),g=w(e.gasDrop,Math.min(8,v(e.toChain))),A=I(n,r),T={trader:I(t,s),tokenOut:b,minAmountOut:y,gasDrop:g,cancelFee:BigInt(e.cancelRelayerFee64),refundFee:BigInt(e.refundRelayerFee64),deadline:u,destAddr:A,destChainId:r,referrerAddr:d,referrerBps:e.referrerBps||0,auctionMode:e.swiftAuctionMode,random:f};return{contractAddress:p,tokenIn:c,amountIn:m,order:T}}function In(e,t,n,a,i,o){if(e.type!=="SWIFT")throw new Error("Quote type is not SWIFT");if(!Number.isFinite(Number(i)))throw new Error("Invalid signer chain id");if(!Number(e.deadline64))throw new Error("Swift order requires timeout");i=Number(i);let s=o||se,r=new gn(l.MAYAN_FORWARDER_CONTRACT,oe.abi),{tokenIn:p,amountIn:u,order:c,contractAddress:m}=wn(e,t,n,a,i),d,f=new gn(m,vt.abi);e.swiftInputContract===Je?d=f.interface.encodeFunctionData("createOrderWithEth",[c]):d=f.interface.encodeFunctionData("createOrderWithToken",[p,u,c]);let b,y,g;if(e.fromToken.contract===e.swiftInputContract)e.fromToken.contract===Je?(b="forwardEth",y=[m,d],g=Ye(u)):(b="forwardERC20",y=[p,u,s,m,d],g=Ye(0));else{let{evmSwapRouterAddress:T,evmSwapRouterCalldata:C}=e;if(!e.minMiddleAmount||!T||!C)throw new Error("Swift swap requires middle amount, router address and calldata");let M=e.fromToken.contract,_=w(e.minMiddleAmount,e.swiftInputDecimals);e.fromToken.contract===Je?(b="swapAndForwardEth",y=[u,T,C,e.swiftInputContract,_,m,d],g=Ye(u)):(b="swapAndForwardERC20",y=[M,u,s,T,C,e.swiftInputContract,_,m,d],g=Ye(0))}return{data:r.interface.encodeFunctionData(b,y),to:l.MAYAN_FORWARDER_CONTRACT,value:g,chainId:i,_forwarder:{method:b,params:y}}}function Rr(e,t,n){if(!Number.isFinite(Number(n)))throw new Error("Invalid signer chain id");let a=BigInt(e.effectiveAmountIn64),i=BigInt(e.submitRelayerFee64);return{domain:{name:"Mayan Swift",chainId:Number(n),verifyingContract:e.swiftMayanContract},types:{CreateOrder:[{name:"OrderId",type:"bytes32"},{name:"InputAmount",type:"uint256"},{name:"SubmissionFee",type:"uint256"}]},value:{OrderId:t,InputAmount:a-i,SubmissionFee:i}}}function An(e,t,n,a,i,o){if(e.type!=="SWIFT")throw new Error("Quote type is not SWIFT");if(!e.gasless)throw new Error("Quote does not support gasless");if(!Number.isFinite(Number(i)))throw new Error("Invalid signer chain id");if(!Number(e.deadline64))throw new Error("Swift order requires timeout");if(e.fromToken.contract!==e.swiftInputContract)throw new Error("Swift gasless order creation does not support source swap");let{tokenIn:s,amountIn:r,order:p}=wn(e,t,n,a,Number(i)),u=k(e.fromChain),m=`0x${pt(e,t,n,a,p.random).toString("hex")}`,d=Rr(e,m,i);return{permitParams:o,orderParams:{...p,sourceChainId:u,amountIn:r,tokenIn:s,submissionFee:BigInt(e.submitRelayerFee64)},orderHash:m,orderTypedData:d}}import{Contract as Cn,toBeHex as dt,ZeroAddress as Sn}from"ethers";import{Buffer as Z}from"buffer";var hn={abi:[{type:"function",name:"batchMaxApprove",inputs:[{name:"approvals",type:"bytes",internalType:"bytes"}],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"initiate",inputs:[{name:"recipient",type:"bytes32",internalType:"bytes32"},{name:"overrideAmountIn",type:"uint256",internalType:"uint256"},{name:"targetChain",type:"uint16",internalType:"uint16"},{name:"params",type:"bytes",internalType:"bytes"}],outputs:[{name:"",type:"bytes",internalType:"bytes"}],stateMutability:"payable"},{type:"error",name:"ChainNotSupported",inputs:[{name:"chain",type:"uint16",internalType:"uint16"}]},{type:"error",name:"DeadlineExpired",inputs:[{name:"blocktime",type:"uint256",internalType:"uint256"},{name:"deadline",type:"uint256",internalType:"uint256"}]},{type:"error",name:"EthTransferFailed",inputs:[]},{type:"error",name:"ExceedsMaxGasDropoff",inputs:[{name:"requested",type:"uint256",internalType:"uint256"},{name:"maximum",type:"uint256",internalType:"uint256"}]},{type:"error",name:"ExceedsMaxRelayingFee",inputs:[{name:"fee",type:"uint256",internalType:"uint256"},{name:"maximum",type:"uint256",internalType:"uint256"}]},{type:"error",name:"InsufficientInputAmount",inputs:[{name:"input",type:"uint256",internalType:"uint256"},{name:"minimum",type:"uint256",internalType:"uint256"}]},{type:"error",name:"InvalidAddress",inputs:[{name:"addr",type:"bytes32",internalType:"bytes32"}]},{type:"error",name:"InvalidBoolVal",inputs:[{name:"val",type:"uint8",internalType:"uint8"}]},{type:"error",name:"InvalidOverrideAmount",inputs:[{name:"received",type:"uint256",internalType:"uint256"},{name:"maximum",type:"uint256",internalType:"uint256"}]},{type:"error",name:"InvalidSwapType",inputs:[{name:"swapType",type:"uint256",internalType:"uint256"}]},{type:"error",name:"InvalidSwapTypeForChain",inputs:[{name:"chain",type:"uint16",internalType:"uint16"},{name:"swapType",type:"uint256",internalType:"uint256"}]},{type:"error",name:"LengthMismatch",inputs:[{name:"encodedLength",type:"uint256",internalType:"uint256"},{name:"expectedLength",type:"uint256",internalType:"uint256"}]},{type:"error",name:"RelayingDisabledForChain",inputs:[]}]};var me={FAST_MODE_FLAG:1,RELAY_REDEEM_MODE:2,EXACT_IN_FLAG:1,USDC_INPUT_TOKEN_TYPE:0,PRE_APPROVED_ACQUIRE_MODE:0,OUTPUT_USDC_MODE:0,OUTPUT_NATIVE_MODE:1,OUTPUT_OTHER_MODE:2};function Or(e){let t=(1n<<128n)-1n;if(e<0n||e>t)throw new RangeError("Value must fit in an unsigned 128-bit integer (0 <= value < 2^128)");let n=Z.alloc(16);for(let a=15;a>=0;a--)n[a]=Number(e&0xFFn),e>>=8n;return n}function Fr(e,t,n){let{shuttleParams:a}=e;if(!a)throw new Error("Swap layer params are missing in quote response");let i=X(Number(n)),o=k(e.fromChain),s=k(e.toChain);if(o!==i)throw new Error(`Signer chain id(${Number(n)}) and quote from chain are not same! ${o} !== ${i}`);let r=[];r.push(me.FAST_MODE_FLAG);let p=Z.alloc(8);p.writeBigUInt64BE(BigInt(a.maxLLFee));let u=p.subarray(2);r.push(...u);let c=Z.alloc(4);c.writeUInt32BE(a.fastTransferDeadline),r.push(...c),r.push(me.RELAY_REDEEM_MODE);let m=w(e.gasDrop,Math.min(6,v(e.toChain))),d=Z.alloc(8);d.writeBigUInt64BE(m);let f=d.subarray(4);r.push(...f);let b=Z.alloc(8);b.writeBigUInt64BE(BigInt(a.maxRelayingFee));let y=b.subarray(2);r.push(...y),r.push(me.EXACT_IN_FLAG),r.push(me.USDC_INPUT_TOKEN_TYPE);let g=BigInt(e.effectiveAmountIn64);if(e.fromToken.contract===e.shuttleInputContract){r.push(...Array(8).fill(0));let T=Z.alloc(8);T.writeBigUInt64BE(g),r.push(...T)}else r.push(...Array(16).fill(0));if(r.push(me.PRE_APPROVED_ACQUIRE_MODE),a.hasDestSwap){if(e.toToken.contract===Sn)r.push(me.OUTPUT_NATIVE_MODE);else{r.push(me.OUTPUT_OTHER_MODE);let _=Z.from(I(e.toToken.contract,s).slice(2),"hex");r.push(..._)}let T=Z.alloc(4);T.writeUInt32BE(Number(BigInt(e.deadline64))),r.push(...T);let C=w(e.minAmountOut,e.toToken.decimals);if(e.toChain==="solana"){r.push(...Array(8).fill(0));let _=Z.alloc(8);_.writeBigUInt64BE(C),r.push(..._)}else{let _=Or(C);r.push(..._)}let M=Z.from(a.path.slice(2),"hex");r.push(...M)}else r.push(me.OUTPUT_USDC_MODE);return{destAddr:I(t,s),destChainId:s,serializedParams:`0x${Z.from(r).toString("hex")}`,contractAddress:e.shuttleContract,amountIn:g,bridgeFee:w(e.bridgeFee,v(e.fromChain))}}function Pn(e,t,n,a){if(e.type!=="SHUTTLE")throw new Error("Quote type is not SHUTTLE");if(!Number.isFinite(Number(n)))throw new Error("Invalid signer chain id");n=Number(n);let i=a||se,o=new Cn(l.MAYAN_FORWARDER_CONTRACT,oe.abi),{destAddr:s,destChainId:r,serializedParams:p,contractAddress:u,amountIn:c,bridgeFee:m}=Fr(e,t,n),d;d=new Cn(u,hn.abi).interface.encodeFunctionData("initiate",[s,c,r,p]);let b,y,g;if(e.fromToken.contract===e.shuttleInputContract)b="forwardERC20",y=[e.shuttleInputContract,c,i,u,d],g=dt(m);else{let{evmSwapRouterAddress:T,evmSwapRouterCalldata:C}=e;if(!e.minMiddleAmount||!T||!C)throw new Error("Shuttle source chain swap requires middle amount, router address and calldata");let M=e.fromToken.contract,_=w(e.minMiddleAmount,e.shuttleInputDecimals);e.fromToken.contract===Sn?(b="swapAndForwardEth",y=[c,T,C,e.shuttleInputContract,_,u,d],g=dt(c)):(b="swapAndForwardERC20",y=[M,c,i,T,C,e.shuttleInputContract,_,u,d],g=dt(m))}return{data:o.interface.encodeFunctionData(b,y),to:l.MAYAN_FORWARDER_CONTRACT,value:g,chainId:n,_forwarder:{method:b,params:y}}}function xr(e,t,n,a,i,o){let s=new yt(l.MAYAN_PROGRAM_ID),[r]=yt.findProgramAddressSync([Mn.from("MAIN")],s),p=F(new yt(e.fromToken.mint),r,!0),u=BigInt(e.effectiveAmountIn64),c=I(p.toString(),1),m=I(l.AUCTION_PROGRAM_ID,1),d;n?d=I(n,1):d=I(Dr.programId.toString(),1);let f=X(Number(i)),b=k(e.fromChain),y=k(e.toChain);if(b!==f)throw new Error(`Signer chain id(${Number(i)}) and quote from chain are not same! ${b} !== ${f}`);let g=e.whMayanContract,A={mayanAddr:c,mayanChainId:1,destAddr:I(t,y),destChainId:y,auctionAddr:m,referrer:d,refundAddr:I(a,f)},T=e.toToken.contract===En,C={transferDeadline:BigInt(e.deadline64),swapDeadline:BigInt(e.deadline64),amountOutMin:w(e.minAmountOut,Math.min(8,e.toToken.decimals)),gasDrop:w(e.gasDrop,Math.min(8,v(e.toChain))),unwrap:T,customPayload:o?`0x${Mn.from(o).toString("hex")}`:"0x"},M={swapFee:w(e.swapRelayerFee,Math.min(8,e.fromToken.decimals)),redeemFee:w(e.redeemRelayerFee,Math.min(8,e.toToken.decimals)),refundFee:w(e.refundRelayerFee,Math.min(8,e.fromToken.decimals))},_=I(e.toToken.realOriginContractAddress,e.toToken.realOriginChainId),h=w(e.bridgeFee,18);return{amountIn:u,tokenIn:e.fromToken.contract,tokenOut:_,tokenOutWChainId:e.toToken.realOriginChainId,criteria:C,recipient:A,relayerFees:M,contractAddress:g,bridgeFee:h}}function ft(e,t,n,a,i,o,s,r){let p=X(Number(o)),u=k(e.fromChain);if(u!==p)throw new Error(`Signer chain id(${Number(o)}) and quote from chain are not same! ${u} !== ${p}`);let c=de(e,a);if(e.type==="MCTP")return xt(e,n,c,o,r,s);if(e.type==="SWIFT")return In(e,t,n,c,o,r);if(e.type==="SHUTTLE")return Pn(e,n,o,r);if(e.type!="WH")throw new Error("Unsupported quote type");if(!Number(e.deadline64))throw new Error("WH mode requires a timeout");let{relayerFees:m,recipient:d,tokenOut:f,tokenOutWChainId:b,criteria:y,tokenIn:g,amountIn:A,contractAddress:T,bridgeFee:C}=xr(e,n,c,i,o,s),M=new _n(l.MAYAN_FORWARDER_CONTRACT,oe.abi),_=new _n(T,Rt.abi),h,E,x,K=r||se;if(g===En){let P=_.interface.encodeFunctionData("wrapAndSwapETH",[m,d,f,b,y]);h="forwardEth",E=[T,P],x=kn(A)}else{let P=_.interface.encodeFunctionData("swap",[m,d,f,b,y,g,A]);h="forwardERC20",E=[g,A,K,T,P],x=kn(C)}let N=M.interface.encodeFunctionData(h,E);return{to:l.MAYAN_FORWARDER_CONTRACT,data:N,value:x,chainId:o,_forwarder:{method:h,params:E}}}async function ls(e,t,n,a,i,o,s,r){if(!i.provider)throw new Error("No provider found for signer");let p=await i.getAddress();if(p.toLowerCase()!==t.toLowerCase())throw new Error("Signer address does not match swapper address");let u=Number((await i.provider.getNetwork()).chainId);if(e.type==="SWIFT"&&e.gasless){let m=de(e,a),d=An(e,t,n,m,u,o),f=await i.signTypedData(d.orderTypedData.domain,d.orderTypedData.types,d.orderTypedData.value);return await Mt(d,f),d.orderHash}let c=ft(e,t,n,a,p,u,r,o);if(delete c._forwarder,s?.gasPrice&&(c.gasPrice=s.gasPrice),s?.maxFeePerGas&&(c.maxFeePerGas=s.maxFeePerGas),s?.maxPriorityFeePerGas&&(c.maxPriorityFeePerGas=s.maxPriorityFeePerGas),s?.gasLimit)c.gasLimit=s.gasLimit;else{let m=await i.estimateGas(c);c.gasLimit=String(BigInt(String(m))*BigInt(110)/BigInt(100))}return c.chainId=ht(e.fromChain),i.sendTransaction(c)}async function ms(e,t,n,a,i){let o=await n.getAddress(),s=e.toChain==="solana"?"ENsytooJVSZyNHbxvueUeX8Am8gcNqPivVVE8USCBiy5":"0x1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a",r=Number((await n.provider.getNetwork()).chainId);if(e.type==="SWIFT"&&e.gasless)return BigInt(0);let p=ft(e,t,s,null,o,r,i,a);delete p._forwarder;let u=await n.estimateGas(p);return u=BigInt(String(u)),e.type==="MCTP"||e.type==="SWIFT"?u*BigInt(110)/BigInt(100):u}async function ds(e,t,n,a){let i="0x1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a",o=e.toChain==="solana"?"ENsytooJVSZyNHbxvueUeX8Am8gcNqPivVVE8USCBiy5":"0x1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a",s=e?.fromToken?.chainId;if(e.type==="SWIFT"&&e.gasless)return BigInt(0);let r=ft(e,i,o,null,i,s,a,n);return delete r._forwarder,t.estimateGas(r)}async function Rn(e,t){let n;try{n=await t.getMoveFunctionArgTypes({package:e.package,module:e.module,function:e.function})}catch{throw new Error(`Failed to fetch ${e.package}::${e.module}::${e.function} ArgTypes`)}if(n){if(n[e.argumentIndex]!=="Pure"&&n[e.argumentIndex]?.Object!=="ByImmutableReference")throw new Error(`Argument ${e.argumentIndex} of ${e.module}::${e.function} is not immutable`)}else throw new Error(`Failed to fetch package::${e.module}::${e.function} ArgTypes`)}async function bt(e,t){let n=[],a=BigInt(0),i;do{let o=await t.getCoins({...e,owner:e.walletAddress,cursor:i}),s=o.data.filter(r=>BigInt(r.balance)>BigInt(0));if(n=[...n,...s],s.forEach(r=>{a+=BigInt(r.balance)}),o.data.length===0||!o.hasNextPage||!o.nextCursor||a>=e.coinAmount)return{coins:n.sort((r,p)=>Number(BigInt(r.coinObjectId)-BigInt(p.coinObjectId))),sum:a};i=o.nextCursor}while(!0)}async function gt(e,t){let n;try{n=await t.getObject({id:e,options:{showContent:!0}})}catch(a){throw new Error(`Failed to fetch Mayan Sui package ID: 

 ${a}`)}if(n.data?.content?.fields?.latest_package_id)return n.data.content.fields.latest_package_id;throw new Error("latest_package_id not found in Mayan Sui state object")}import{Transaction as Ee}from"@mysten/sui/transactions";import{SUI_TYPE_ARG as vr,SUI_CLOCK_OBJECT_ID as Br}from"@mysten/sui/utils";import{SystemProgram as Tt}from"@solana/web3.js";import{ZeroAddress as Nr}from"ethers";async function On(e,t,n,a,i,o,s){let[r,p]=await Promise.all([gt(l.SUI_MCTP_STATE,o),e.hasAuction?gt(l.SUI_MCTP_FEE_MANAGER_STATE,o):null]),u=w(e.minMiddleAmount,L),c,m,d;if(e.fromToken.contract===e.mctpInputContract)c=s?.builtTransaction??new Ee,m=await ze(u,t,e.mctpInputContract,o,c,s?.inputCoin);else{let{tx:y,outCoin:g,whFeeCoin:A}=await kt({amountIn64:e.effectiveAmountIn64,inputCoinType:e.fromToken.contract,middleCoinType:e.mctpInputContract,userWallet:t,withWhFee:e.hasAuction||e.cheaperChain!=="sui",referrerAddress:a,inputCoin:s?.inputCoin,transaction:s?.builtTransaction?await s.builtTransaction.toJSON():void 0});c=Ee.from(y),m=g,d=A?{result:A}:null}e.hasAuction?await Lr(e,t,n,a,r,p,o,{inputCoin:{result:m},whFeeCoin:d,builtTransaction:c}):e.cheaperChain==="sui"?await Kr(e,t,n,r,o,{inputCoin:{result:m},whFeeCoin:d,builtTransaction:c}):await Wr(e,t,n,r,i,o,{inputCoin:{result:m},whFeeCoin:d,builtTransaction:c});let f=BigInt(e.effectiveAmountIn64),b=i?Uint8Array.from(i):Uint8Array.from([]);c.moveCall({package:r,module:"init_order",function:"log_initialize_mctp",typeArguments:[e.fromToken.contract],arguments:[c.pure.u64(f),c.object(e.fromToken.verifiedAddress),c.pure.vector("u8",b)]});try{let y;a?y=I(a,k(e.toChain)):y=I(Tt.programId.toString(),k("solana")),c.moveCall({package:l.SUI_LOGGER_PACKAGE_ID,module:"referrer_logger",function:"log_referrer",arguments:[c.pure.address(y),c.pure.u8(e.referrerBps||0)]})}catch(y){console.error("Failed to log referrer",y)}return c}async function Wr(e,t,n,a,i,o,s){let r=k(e.toChain),p=s?.builtTransaction??new Ee,u=w(e.minMiddleAmount,L),c=await ze(u,t,e.mctpInputContract,o,p,s?.inputCoin),m=i?De:Fe,d=I(n,r),f=ye(e.toChain),b=w(e.gasDrop,Math.min(v(e.toChain),8)),y=w(e.redeemRelayerFee,L),g=i?Uint8Array.from(i):Uint8Array.from([]),[A]=p.moveCall({package:a,module:"bridge_with_fee",function:"prepare_bridge_with_fee",typeArguments:[e.mctpInputContract],arguments:[p.pure.u8(m),c,p.pure.u64(u),p.pure.address(d),p.pure.u32(f),p.pure.u64(b),p.pure.u64(y),p.pure.vector("u8",g)]}),[T,C]=p.moveCall({package:a,module:"bridge_with_fee",function:"bridge_with_fee",typeArguments:[e.mctpInputContract],arguments:[p.object(l.SUI_MCTP_STATE),p.object(l.SUI_CCTP_CORE_STATE),p.object(e.mctpVerifiedInputAddress),A]}),[M,_]=p.moveCall({package:l.SUI_CCTP_TOKEN_PACKAGE_ID,module:"deposit_for_burn",function:"deposit_for_burn_with_caller_with_package_auth",typeArguments:[e.mctpInputContract,`${a}::bridge_with_fee::CircleAuth`],arguments:[C,p.object(l.SUI_CCTP_TOKEN_STATE),p.object(l.SUI_CCTP_CORE_STATE),p.object("0x403"),p.object(e.mctpInputTreasury)]}),[h]=p.moveCall({package:a,module:"bridge_with_fee",function:"publish_bridge_with_fee",arguments:[p.object(l.SUI_MCTP_STATE),T,_]});return await Fn(p,h,o,BigInt(e.bridgeFee),t,s?.whFeeCoin),p}async function Kr(e,t,n,a,i,o){let s=k(e.toChain),r=o?.builtTransaction??new Ee,p=w(e.minMiddleAmount,L),u=await ze(p,t,e.mctpInputContract,i,r,o?.inputCoin),c=I(n,s),m=ye(e.toChain),d=w(e.gasDrop,Math.min(v(e.toChain),8)),f=w(e.redeemRelayerFee,L),[b]=r.moveCall({package:a,module:"bridge_locked_fee",function:"prepare_bridge_locked_fee",typeArguments:[e.mctpInputContract],arguments:[u,r.pure.u64(p),r.pure.address(c),r.pure.u32(m),r.pure.u64(d),r.pure.u64(f)]}),[y,g]=r.moveCall({package:a,module:"bridge_locked_fee",function:"bridge_locked_fee",typeArguments:[e.mctpInputContract],arguments:[r.object(l.SUI_MCTP_STATE),r.object(l.SUI_CCTP_CORE_STATE),r.object(e.mctpVerifiedInputAddress),b]}),[A,T]=r.moveCall({package:l.SUI_CCTP_TOKEN_PACKAGE_ID,module:"deposit_for_burn",function:"deposit_for_burn_with_caller_with_package_auth",typeArguments:[e.mctpInputContract,`${a}::bridge_locked_fee::CircleAuth`],arguments:[g,r.object(l.SUI_CCTP_TOKEN_STATE),r.object(l.SUI_CCTP_CORE_STATE),r.object("0x403"),r.object(e.mctpInputTreasury)]});return r.moveCall({package:a,module:"bridge_locked_fee",function:"store_bridge_locked_fee",typeArguments:[e.mctpInputContract],arguments:[r.object(l.SUI_MCTP_STATE),r.object(e.mctpVerifiedInputAddress),y,T]}),r}async function Lr(e,t,n,a,i,o,s,r){let p=k(e.toChain),u=r?.builtTransaction??new Ee,c=w(e.minMiddleAmount,L),[m]=await Promise.all([ze(c,t,e.mctpInputContract,s,u,r?.inputCoin),Rn({package:o,module:"calculate_mctp_fee",function:"prepare_calc_mctp_fee",argumentIndex:3},s)]),d=e.toToken.contract===Nr?I(Tt.programId.toString(),k("solana")):I(e.toToken.contract,e.toToken.wChainId),f=w(e.minAmountOut,Math.min(8,e.toToken.decimals)),b=I(n,p),y=ye(e.toChain),g=w(e.gasDrop,Math.min(v(e.toChain),8)),A=w(e.redeemRelayerFee,L),T=BigInt(e.deadline64),C;a?C=I(a,p):C=I(Tt.programId.toString(),k("solana"));let M=[u.object(e.mctpVerifiedInputAddress),u.pure.u8(Pt),u.pure.address(t),m,u.pure.address(b),u.pure.u16(p),u.pure.address(d),u.pure.u64(f),u.pure.u64(g),u.pure.u64(A),u.pure.u64(T),u.pure.address(C),u.pure.u8(e.referrerBps)],[_]=u.moveCall({package:o,module:"calculate_mctp_fee",function:"prepare_calc_mctp_fee",typeArguments:[e.mctpInputContract],arguments:M}),[h]=u.moveCall({package:o,module:"calculate_mctp_fee",function:"calculate_mctp_fee",arguments:[u.object(l.SUI_MCTP_FEE_MANAGER_STATE),_]}),[E]=u.moveCall({package:i,module:"init_order",function:"prepare_initialize_order",typeArguments:[e.mctpInputContract],arguments:[...M.slice(1),u.pure.u32(y),u.pure.u64(c)]}),[x,K]=u.moveCall({package:i,module:"init_order",function:"initialize_order",typeArguments:[e.mctpInputContract],arguments:[u.object(l.SUI_MCTP_STATE),u.object(l.SUI_CCTP_CORE_STATE),u.object(e.mctpVerifiedInputAddress),E,h]}),[N,P]=u.moveCall({package:l.SUI_CCTP_TOKEN_PACKAGE_ID,module:"deposit_for_burn",function:"deposit_for_burn_with_caller_with_package_auth",typeArguments:[e.mctpInputContract,`${i}::init_order::CircleAuth`],arguments:[K,u.object(l.SUI_CCTP_TOKEN_STATE),u.object(l.SUI_CCTP_CORE_STATE),u.object("0x403"),u.object(e.mctpInputTreasury)]}),[O]=u.moveCall({package:i,module:"init_order",function:"publish_init_order",arguments:[u.object(l.SUI_MCTP_STATE),x,P]});return await Fn(u,O,s,BigInt(e.bridgeFee),t,r?.whFeeCoin),u}async function Fn(e,t,n,a,i,o){let s;if(o?.result)s=o.result;else if(o?.objectId)s=e.object(o.objectId);else if(a>BigInt(0)){let{coins:r,sum:p}=await bt({walletAddress:i,coinType:vr,coinAmount:a},n);if(p<a)throw new Error("Insufficient funds to pay Wormhole message fee");r.length>1&&e.mergeCoins(r[0].coinObjectId,r.slice(1).map(c=>c.coinObjectId));let[u]=e.splitCoins(r[0].coinObjectId,[a]);s=u}else{let[r]=e.splitCoins(e.gas,[e.pure.u64(0)]);s=r}return e.moveCall({package:l.SUI_WORMHOLE_PACKAGE_ID,module:"publish_message",function:"publish_message",arguments:[e.object(l.SUI_WORMHOLE_STATE),s,t,e.object(Br)]}),e}async function ze(e,t,n,a,i,o){let s;if(o?.result)s=o.result;else if(o?.objectId)s=i.object(o.objectId);else{let{coins:r,sum:p}=await bt({walletAddress:t,coinType:n,coinAmount:e},a);if(p<e)throw new Error(`Insufficient funds to create Coin ${n} with amount ${e}`);r.length>1&&i.mergeCoins(r[0].coinObjectId,r.slice(1).map(c=>c.coinObjectId));let[u]=i.splitCoins(r[0].coinObjectId,[e]);s=u}return s}async function Ds(e,t,n,a,i,o,s){let r=de(e,a);if(e.type==="MCTP")return On(e,t,n,r,i,o,s);throw new Error("Unsupported quote type from Sui chain")}export{Pt as MCTP_INIT_ORDER_PAYLOAD_ID,De as MCTP_PAYLOAD_TYPE_CUSTOM_PAYLOAD,Fe as MCTP_PAYLOAD_TYPE_DEFAULT,se as ZeroPermit,Kr as addBridgeLockedFeeMoveCalls,Wr as addBridgeWithFeeMoveCalls,Lr as addInitOrderMoveCalls,l as addresses,Rn as assertArgumentIsImmutable,Yt as broadcastJitoBundleId,Ct as checkSdkVersionSupport,$t as confirmJitoBundleId,Qt as createApproveInstruction,V as createAssociatedTokenAccountInstruction,sr as createCloseAccountInstruction,Ue as createInitializeRandomTokenAccountInstructions,un as createMctpFromSolanaInstructions,On as createMctpFromSuiMoveCalls,Pe as createSplTransferInstruction,Mr as createSwapFromSolanaInstructions,Ds as createSwapFromSuiMoveCalls,ln as createSwiftFromSolanaInstructions,pt as createSwiftOrderHash,Se as createSyncNativeInstruction,Qe as createTransferAllAndCloseInstruction,He as decentralizeClientSwapInstructions,jt as decideRelayer,Be as deserializeInstructionInfo,ms as estimateQuoteRequiredGas,ds as estimateQuoteRequiredGasAprox,bt as fetchAllCoins,Xr as fetchAllTokenList,gt as fetchMayanSuiPackageId,ea as fetchQuote,qr as fetchTokenList,zn as generateFetchQuoteUrl,Ge as getAddressLookupTableAccounts,w as getAmountOfFractionalAmount,z as getAnchorInstructionData,F as getAssociatedTokenAddress,ta as getCurrentChainTime,$r as getDisplayAmount,ht as getEvmChainIdByName,v as getGasDecimal,St as getGasDecimalsInSolana,Vt as getJitoTipTransfer,xt as getMctpFromEvmTxPayload,de as getQuoteSuitableReferrerAddress,R as getSafeU64Blob,Re as getSdkVersion,_t as getSuggestedRelayer,ft as getSwapFromEvmTxPayload,xe as getSwapSolana,kt as getSwapSui,X as getWormholeChainIdById,k as getWormholeChainIdByName,W as hexToUint8Array,Yn as isValidAptosType,I as nativeAddressToHexString,ot as sendJitoBundle,re as solMint,Mt as submitSwiftEvmSwap,Et as submitSwiftSolanaSwap,Le as submitTransactionWithRetry,ls as swapFromEvm,Si as swapFromSolana,Da as unwrapSol,_e as validateJupSwap,Oe as wait,Fa as wrapSol};
