function e(e,n,t,i,r,o,s){try{var u=e[o](s);var c=u.value}catch(e){t(e);return}if(u.done){n(c)}else{Promise.resolve(c).then(i,r)}}function n(n){return function(){var t=this,i=arguments;return new Promise(function(r,o){var s=n.apply(t,i);function u(n){e(s,r,o,u,c,"next",n)}function c(n){e(s,r,o,u,c,"throw",n)}u(undefined)})}}function t(e,n){if(!(e instanceof n)){throw new TypeError("Cannot call a class as a function")}}function i(e,n){for(var t=0;t<n.length;t++){var i=n[t];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(e,i.key,i)}}function r(e,n,t){if(n)i(e.prototype,n);if(t)i(e,t);return e}function o(e){"@swc/helpers - typeof";return e&&typeof Symbol!=="undefined"&&e.constructor===Symbol?"symbol":typeof e}function s(e,n){var t,i,r,o,s={label:0,sent:function(){if(r[0]&1)throw r[1];return r[1]},trys:[],ops:[]};return o={next:u(0),"throw":u(1),"return":u(2)},typeof Symbol==="function"&&(o[Symbol.iterator]=function(){return this}),o;function u(e){return function(n){return c([e,n])}}function c(o){if(t)throw new TypeError("Generator is already executing.");while(s)try{if(t=1,i&&(r=o[0]&2?i["return"]:o[0]?i["throw"]||((r=i["return"])&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;if(i=0,r)o=[o[0]&2,r.value];switch(o[0]){case 0:case 1:r=o;break;case 4:s.label++;return{value:o[1],done:false};case 5:s.label++;i=o[1];o=[0];continue;case 7:o=s.ops.pop();s.trys.pop();continue;default:if(!(r=s.trys,r=r.length>0&&r[r.length-1])&&(o[0]===6||o[0]===2)){s=0;continue}if(o[0]===3&&(!r||o[1]>r[0]&&o[1]<r[3])){s.label=o[1];break}if(o[0]===6&&s.label<r[1]){s.label=r[1];r=o;break}if(r&&s.label<r[2]){s.label=r[2];s.ops.push(o);break}if(r[2])s.ops.pop();s.trys.pop();continue}o=n.call(e,s)}catch(e){o=[6,e];i=0}finally{t=r=0}if(o[0]&5)throw o[1];return{value:o[0]?o[1]:void 0,done:true}}}var u=Object.defineProperty;var c=function(e,n,t){return n in e?u(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t};var a=function(e,n,t){return c(e,(typeof n==="undefined"?"undefined":o(n))!="symbol"?n+"":n,t),t};import{HttpClient as l}from"@binance/w3w-http-client";import{SignClient as h}from"@binance/w3w-sign-client";import{log as f,signingMethods as d,utf8ToHex as v,getRpcUrl as p,formatJsonRpcRequest as g,isJsonRpcSuccess as w,isInBinance as y,normalizeChainId as C}from"@binance/w3w-utils";import m from"eventemitter3";var b=function(){"use strict";function e(n){t(this,e);a(this,"events",new m);a(this,"signClient");a(this,"rpc");a(this,"httpClient");a(this,"optsChainId");a(this,"lng");a(this,"showQrCodeModal");this.rpc={infuraId:n===null||n===void 0?void 0:n.infuraId,custom:n===null||n===void 0?void 0:n.rpc},this.lng=(n===null||n===void 0?void 0:n.lng)||"en",this.showQrCodeModal=n===null||n===void 0?void 0:n.showQrCodeModal,this.signClient=new h,this.optsChainId=Number(this.signClient.coreConnection.chainId)||(n===null||n===void 0?void 0:n.chainId)||56,this.registerEventListeners(),this.httpClient=this.setHttpProvider(this.optsChainId)}r(e,[{key:"connected",get:function e(){return this.signClient.connected}},{key:"connector",get:function e(){return this.signClient}},{key:"accounts",get:function e(){return this.signClient.accounts}},{key:"chainId",get:function e(){return f.debug("provider get chainId",this.signClient.chainId),this.signClient.chainId}},{key:"rpcUrl",get:function e(){return this.httpClient.url||""}},{key:"request",value:function e(e){var t=this;return n(function(){var n,i,r;return s(this,function(s){switch(s.label){case 0:n=(f.debug("ethereum-provider request",e),e.method);switch(n){case"eth_requestAccounts":return[3,1];case"eth_chainId":return[3,3];case"eth_accounts":return[3,4];case"wallet_switchEthereumChain":return[3,5]}return[3,6];case 1:return[4,t.connect()];case 2:return[2,(s.sent(),t.accounts)];case 3:return[2,t.chainId];case 4:return[2,t.accounts];case 5:return[2,t.switchChain(e)];case 6:return[3,7];case 7:i=g(e.method,e.params||[]);if(d.includes(e.method))return[2,t.signClient.request(i)];if(o(t.httpClient)>"u")throw new Error("Cannot request JSON-RPC method (".concat(e.method,") without provided rpc url"));return[4,t.httpClient.request(i)];case 8:r=s.sent();if(w(r))return[2,r.result];throw new Error(r.error.message)}})})()}},{key:"signMessage",value:function e(e){var t=this;return n(function(){var n;return s(this,function(i){switch(i.label){case 0:f.debug("signMessage",e);n=t.accounts.length;if(n)return[3,2];return[4,t.enable()];case 1:n=i.sent();i.label=2;case 2:n;return[4,t.request({method:"personal_sign",params:[v(e),t.accounts[0]]})];case 3:return[2,i.sent()]}})})()}},{key:"sendAsync",value:function e(e,n){this.request(e).then(function(e){return n(null,e)}).catch(function(e){return n(e,void 0)})}},{key:"setLng",value:function e(e){this.lng=e}},{key:"enable",value:function e(e){var t=this;return n(function(){return s(this,function(n){switch(n.label){case 0:return[4,t.connect(e)];case 1:return[2,(n.sent(),t.accounts)]}})})()}},{key:"switchChain",value:function e(e){var t=this;return n(function(){var n;return s(this,function(i){switch(i.label){case 0:n=g(e.method,e.params||[]);return[4,Promise.race([t.signClient.request(n),new Promise(function(n){return t.on("chainChanged",function(t){t===e.params[0].chainId&&n(t)})})])];case 1:return[2,i.sent()]}})})()}},{key:"connect",value:function e(e){var t=this;return n(function(){var n,i;return s(this,function(r){switch(r.label){case 0:if(!t.connected)return[3,1];i=f.info("already connected");return[3,3];case 1:return[4,t.signClient.open({requestChainId:(n=e===null||e===void 0?void 0:e.toString())!==null&&n!==void 0?n:t.optsChainId.toString(),lng:t.lng,showQrCodeModal:t.showQrCodeModal})];case 2:i=r.sent();r.label=3;case 3:i;return[2]}})})()}},{key:"disconnect",value:function e(){this.connected&&this.signClient.disconnect()}},{key:"on",value:function e(e,n){this.events.on(e,n)}},{key:"once",value:function e(e,n){this.events.once(e,n)}},{key:"removeListener",value:function e(e,n){this.events.removeListener(e,n)}},{key:"off",value:function e(e,n){this.events.off(e,n)}},{key:"isWalletConnect",get:function e(){return!0}},{key:"registerEventListeners",value:function e(){var e=this;this.signClient.on("accountsChanged",function(n){e.events.emit("accountsChanged",n)}),this.signClient.on("chainChanged",function(n){e.httpClient=e.setHttpProvider(C(n)),e.events.emit("chainChanged",n)}),this.signClient.on("disconnect",function(){e.events.emit("disconnect")}),this.signClient.on("uri_ready",function(n){e.events.emit("uri_ready",n)})}},{key:"setHttpProvider",value:function e(e){var n=p(e,this.rpc);if(!((typeof n==="undefined"?"undefined":o(n))>"u"))return new l(n)}}]);return e}(),k=function(e){if(y()){var n=(typeof window==="undefined"?"undefined":o(window))<"u"?window.ethereum:void 0;if(n)return n.setLng=function(){},n.disconnect=function(){},n}return new b(e)},I=b;export{I as default,k as getProvider};//# sourceMappingURL=index.js.map