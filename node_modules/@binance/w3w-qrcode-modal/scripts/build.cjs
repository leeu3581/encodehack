const { spawn } = require('child_process')
const tailwind = require('tailwindcss')
const { writeFileSync } = require('fs')
const path = require('path')

// define packages path
const cssPath = path.resolve(__dirname, '../src/browser/style.css')

// build style.css into assets/style.ts
const buildCss = () => {
  let output = ''
  const build = spawn('npx', ['tailwind', '-i', cssPath], {
    cwd: path.resolve(__dirname, '../src/browser'),
  })
  build.stdout.on('data', (data) => {
    output += data.toString()
  })
  build.stderr.on('data', (data) => {
    console.error(data.toString())
  })
  build.on('error', (err) => {
    console.error(err)
  })
  build.on('close', (code) => {
    // write file to assets/baseStyle.ts
    writeFileSync(
      path.resolve(__dirname, '../src/browser/assets/baseStyle.ts'),
      `export const baseStyle = \`${output.replaceAll(`\\`, `\\\\`)}\``
    )
  })
}
buildCss()