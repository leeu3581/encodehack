import fs from 'fs'
import path from 'path'
import { fileURLToPath } from 'url'

import fetch from 'node-fetch'

import { SUPPORTED_LNGS } from './constants.mjs'

const __dirname = path.dirname(fileURLToPath(import.meta.url))

function replaceKey(obj, oldKey, newKey) {
  const { [oldKey]: value, ...otherProperties } = obj
  return { [newKey]: value, ...otherProperties }
}
async function fetchDataAndWriteToFile(lng) {
  const response = await fetch(
    `https://bin.bnbstatic.com/api/i18n/-/web/cms/${lng}/MPC-SDK`
  )
  const data = await response
    .json()
    .then((res) =>
      replaceKey(res, 'sdk-download-andriod', 'sdk-download-android')
    )

  const filePath = path.join(__dirname, 'data', `${lng}.json`)
  fs.writeFileSync(filePath, JSON.stringify(data, null, 2))
}
SUPPORTED_LNGS.forEach((lng) => {
  fetchDataAndWriteToFile(lng).catch(console.error)
})
