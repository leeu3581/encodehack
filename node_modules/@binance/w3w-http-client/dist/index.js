function e(e,t,r,n,i,o,s){try{var u=e[o](s);var a=u.value}catch(e){r(e);return}if(u.done){t(a)}else{Promise.resolve(a).then(n,i)}}function t(t){return function(){var r=this,n=arguments;return new Promise(function(i,o){var s=t.apply(r,n);function u(t){e(s,i,o,u,a,"next",t)}function a(t){e(s,i,o,u,a,"throw",t)}u(undefined)})}}function r(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,n.key,n)}}function i(e,t,r){if(t)n(e.prototype,t);if(r)n(e,r);return e}function o(e,t,r){if(t in e){Object.defineProperty(e,t,{value:r,enumerable:true,configurable:true,writable:true})}else{e[t]=r}return e}function s(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};var n=Object.keys(r);if(typeof Object.getOwnPropertySymbols==="function"){n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))}n.forEach(function(t){o(e,t,r[t])})}return e}function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);if(t){n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})}r.push.apply(r,n)}return r}function a(e,t){t=t!=null?t:{};if(Object.getOwnPropertyDescriptors){Object.defineProperties(e,Object.getOwnPropertyDescriptors(t))}else{u(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function c(e){"@swc/helpers - typeof";return e&&typeof Symbol!=="undefined"&&e.constructor===Symbol?"symbol":typeof e}function l(e,t){var r,n,i,o,s={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]};return o={next:u(0),"throw":u(1),"return":u(2)},typeof Symbol==="function"&&(o[Symbol.iterator]=function(){return this}),o;function u(e){return function(t){return a([e,t])}}function a(o){if(r)throw new TypeError("Generator is already executing.");while(s)try{if(r=1,n&&(i=o[0]&2?n["return"]:o[0]?n["throw"]||((i=n["return"])&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;if(n=0,i)o=[o[0]&2,i.value];switch(o[0]){case 0:case 1:i=o;break;case 4:s.label++;return{value:o[1],done:false};case 5:s.label++;n=o[1];o=[0];continue;case 7:o=s.ops.pop();s.trys.pop();continue;default:if(!(i=s.trys,i=i.length>0&&i[i.length-1])&&(o[0]===6||o[0]===2)){s=0;continue}if(o[0]===3&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(o[0]===6&&s.label<i[1]){s.label=i[1];i=o;break}if(i&&s.label<i[2]){s.label=i[2];s.ops.push(o);break}if(i[2])s.ops.pop();s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e];n=0}finally{r=i=0}if(o[0]&5)throw o[1];return{value:o[0]?o[1]:void 0,done:true}}}var f=Object.defineProperty;var p=function(e,t,r){return t in e?f(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r};var b=function(e,t,r){return p(e,(typeof t==="undefined"?"undefined":c(t))!="symbol"?t+"":t,r),r};import{formatJsonRpcError as h,isHttpUrl as v,log as y,parseConnectionError as g,safeJsonParse as w,safeJsonStringify as d}from"@binance/w3w-utils";import m from"cross-fetch";import{EventEmitter as O}from"eventemitter3";var P={Accept:"application/json","Content-Type":"application/json"},j="POST",k={headers:P,method:j},E=function(){"use strict";function e(t){r(this,e);this.url=t;b(this,"events",new O);b(this,"isAvailable",!1);b(this,"registering",!1);if(!v(t))throw new Error("Provided URL is not compatible with HTTP connection: ".concat(t));this.url=t}i(e,[{key:"connected",get:function e(){return this.isAvailable}},{key:"connecting",get:function e(){return this.registering}},{key:"open",value:function e(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.url;var r=this;return t(function(){return l(this,function(t){switch(t.label){case 0:return[4,r.register(e)];case 1:t.sent();return[2]}})})()}},{key:"close",value:function e(){var e=this;return t(function(){return l(this,function(t){if(!e.isAvailable)throw new Error("Connection already closed");e.onClose();return[2]})})()}},{key:"request",value:function e(e){var r=this;return t(function(){var t,n,i,o,u;return l(this,function(c){switch(c.label){case 0:y.debug("HttpClient ~ request ~ payload:",e);t=r.isAvailable;if(t)return[3,2];return[4,r.register()];case 1:t=c.sent();c.label=2;case 2:t;c.label=3;case 3:c.trys.push([3,6,,7]);n=d(e);return[4,m(r.url,a(s({},k),{body:n}))];case 4:return[4,c.sent().json()];case 5:i=c.sent(),o=typeof i=="string"?w(i):i;return[2,(y.debug("HttpClient ~ request ~ result:",o),o)];case 6:u=c.sent();return[2,r.formatError(e.id,u)];case 7:return[2]}})})()}},{key:"formatError",value:function e(e,t){var r=this.parseError(t),n=r.message||r.toString();return h(e,n)}},{key:"register",value:function e(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.url;var r=this;return t(function(){var t,n,i;return l(this,function(o){switch(o.label){case 0:if(!v(e))throw new Error("Provided URL is not compatible with HTTP connection: ".concat(e));if(r.registering)return[2,new Promise(function(e,t){r.events.once("register_error",function(e){t(e)}),r.events.once("open",function(){if(c(r.isAvailable)>"u")return t(new Error("HTTP connection is missing or invalid"));e()})})];r.url=e,r.registering=!0;o.label=1;case 1:o.trys.push([1,3,,4]);t=d({id:1,jsonrpc:"2.0",method:"test",params:[]});return[4,m(e,a(s({},k),{body:t}))];case 2:o.sent(),r.onOpen();return[3,4];case 3:n=o.sent();i=r.parseError(n);throw r.events.emit("register_error",i),r.onClose(),i;case 4:return[2]}})})()}},{key:"onOpen",value:function e(){this.isAvailable=!0,this.registering=!1,this.events.emit("open")}},{key:"onClose",value:function e(){this.isAvailable=!1,this.registering=!1,this.events.emit("open")}},{key:"parseError",value:function e(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.url;return g(e,t,"HTTP")}}]);return e}();export{E as HttpClient};//# sourceMappingURL=index.js.map